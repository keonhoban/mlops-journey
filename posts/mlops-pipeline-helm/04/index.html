<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동] | 🏔️ MLOps Journey</title>
<meta name=keywords content><meta name=description content="🧠 시나리오 설명

“실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,
이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.
Airflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”

DAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능
GitSync → DAG 자동 배포 (CI/CD 개념 적용)
Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계


✨ TL;DR

Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계
GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성
UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능


📐 아키텍처 구성도
"><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"><meta property="og:site_name" content="🏔️  MLOps Journey"><meta property="og:title" content="[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]"><meta property="og:description" content="🧠 시나리오 설명 “실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,
이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.
Airflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”
DAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능 GitSync → DAG 자동 배포 (CI/CD 개념 적용) Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계 ✨ TL;DR Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계 GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성 UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능 📐 아키텍처 구성도 "><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-03T17:11:53+09:00"><meta property="article:modified_time" content="2025-07-03T17:11:53+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]"><meta name=twitter:description content="🧠 시나리오 설명

“실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,
이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.
Airflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”

DAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능
GitSync → DAG 자동 배포 (CI/CD 개념 적용)
Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계


✨ TL;DR

Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계
GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성
UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능


📐 아키텍처 구성도
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://keonhoban.github.io/mlops-journey/posts/"},{"@type":"ListItem","position":2,"name":"[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]","item":"https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]","name":"[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync \u002b 외부 PostgreSQL \u002b Secret 연동]","description":"🧠 시나리오 설명 “실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,\n이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.\nAirflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”\nDAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능 GitSync → DAG 자동 배포 (CI/CD 개념 적용) Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계 ✨ TL;DR Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계 GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성 UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능 📐 아키텍처 구성도 ","keywords":[],"articleBody":"🧠 시나리오 설명 “실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,\n이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.\nAirflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”\nDAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능 GitSync → DAG 자동 배포 (CI/CD 개념 적용) Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계 ✨ TL;DR Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계 GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성 UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능 📐 아키텍처 구성도 🐳 커스텀 Airflow 이미지 구성 GitSync DAG에서 MLflow 연동 또는 AWS SDK 사용을 위한 Python 패키지 설치 필요\n🔸 Dockerfile FROM apache/airflow:3.0.2-python3.12 COPY requirements.txt /tmp/requirements.txt USER airflow RUN pip install --no-cache-dir -r /tmp/requirements.txt 🔸 requirements.txt mlflow==2.13.0 pandas scikit-learn boto3 🔸 빌드 \u0026 푸시 docker build -t hoizz/airflow-custom:v5-mlflow . docker push hoizz/airflow-custom:v5-mlflow 🛠 Helm 구성 🔹 values.yaml # 실행 엔진 설정 executor: KubernetesExecutor # 이미지 설정 images: airflow: repository: hoizz/airflow-custom # 커스텀 이미지 tag: v5-mlflow-20240712 # 태그 pullPolicy: IfNotPresent # 생성한 fernetKey 고정 (helm delete \u0026 install 이후에도 이전 variables 등 데이터 sync 가능) fernetKeySecretName: my-fernet-secret # DAG GitSync 설정 (GitOps 기반) dags: gitSync: enabled: true repo: git@github.com:keonhoban/airflow-dags.git branch: main subPath: dags depth: 1 wait: 10 rev: HEAD sshKeySecret: airflow-git-ssh-secret # DB 연동 (외부 PostgreSQL 사용) postgresql: enabled: false # 내부 Postgres 비활성화 data: metadataSecretName: airflow-db-secret # Secret 안의 base64된 connection 값 참조 # Airflow 환경 설정 config: AIRFLOW__CORE__LOAD_EXAMPLES: value: \"False\" AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION: value: \"False\" AIRFLOW__WEBSERVER__EXPOSE_CONFIG: value: \"True\" # 리소스 설정 (권장) scheduler: resources: requests: cpu: \"500m\" memory: \"512Mi\" limits: cpu: \"1\" memory: \"1Gi\" extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true workers: resources: requests: cpu: \"500m\" memory: \"512Mi\" limits: cpu: \"1\" memory: \"1Gi\" extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true dagProcessor: extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true # Ingress 설정 (Ingress Controller 기반 접근) ingress: enabled: true apiServer: enabled: true ingressClassName: nginx hosts: - name: airflow.local tls: enabled: false # 실무에서는 true + cert-manager 연동 필요 # Web UI 서비스 타입 설정 apiServer: service: type: ClusterIP # 외부 접근은 Ingress 경유 # 로그 PVC 설정 logs: persistence: enabled: true existingClaim: airflow-logs-pvc # (선택) remote 로그 저장소 설정 (예: S3) # config: # AIRFLOW__LOGGING__REMOTE_LOGGING: \"True\" # AIRFLOW__LOGGING__REMOTE_BASE_LOG_FOLDER: \"s3://your-bucket-name/airflow-logs\" # AIRFLOW__LOGGING__REMOTE_LOG_CONN_ID: \"aws_default\" ✅ fernet_key 생성 및 구성 # 생성 python -c \"from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())\" # secret 적용 (파일 생성 후 kubectl apply 가능) # (git에 필요한 경우 SealedSecret or SOPS or .gitignore) apiVersion: v1 kind: Secret metadata: name: my-fernet-secret namespace: airflow type: Opaque stringData: fernet-key: \"xZ69xLVkiCfJQ23fXa8oubANRIJRHZLrIeANlHhPGmQ=\" # 생성한 값으로 수정 🔐 GitSync SSH Key \u0026 Secret 구성 # SSH 키 생성 ssh-keygen -t rsa -b 4096 -C \"testuser@mlops.com\" # GitHub UI에서 Deploy Key 등록 (공개키) # K8s Secret 생성 (비공개 키) kubectl create secret generic airflow-git-ssh-secret --from-file=gitSshKey=/root/.ssh/id_rsa -n airflow 🚀 배포 명령어 kubectl create namespace airflow helm install airflow apache-airflow/airflow -n airflow -f values.yaml 🌐 접속 확인 # /etc/hosts 수정 {NodeIP} airflow.local # 브라우저 접속 http://airflow.local 🧪 확인 사항 항목 확인 방법 Airflow UI 접근 http://airflow.local DAG GitSync GitHub push → 자동 반영 여부 확인 PostgreSQL 연결 metadata DB에 연결 로그 확인 AWS 인증 연동 boto3.client() 호출 시 에러 없는지 확인 🧩 Tip GitSync는 depth: 1, wait, rev: HEAD 옵션 설정으로 최적화 필요 metadataSecretName에는 AIRFLOW__DATABASE__SQL_ALCHEMY_CONN이 base64 인코딩되어 있어야 함 각 Pod (scheduler, worker, dagProcessor)마다 AWS credential 마운트 필요 Ingress 접근을 위해선 hosts 파일에 수동 등록 필요 (로컬 클러스터인 경우) 🔧 MLOps 실전 연결 연결 항목 실무 의미 DAG GitSync GitOps 기반으로 실험/운영 동기화 자동화 External PostgreSQL 운영 DB와 통합, 백업/모니터링 가능 boto3 연동 DAG 내 S3 접근 가능 (모델 or raw 데이터 연동) mlflow API 사용 실험 자동화 가능 (training, promotion 포함) 🚨 트러블슈팅 🔻 GitSync DAG 미반영시 체크 리스트 subPath 경로 오류 Secret에 등록된 SSH key 권한 문제 GitHub deploy key에 write 권한 누락 🧭 다음 포스트 예고 ⚙️ FastAPI 서빙 + MLflow 모델 연동\n→ 모델 핫스왑, REST API 구성, Stage/Version 자동 적용까지 진행 예정입니다.\n","wordCount":"675","inLanguage":"en","datePublished":"2025-07-03T17:11:53+09:00","dateModified":"2025-07-03T17:11:53+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"},"publisher":{"@type":"Organization","name":"🏔️  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="🏔️  MLOps Journey (Alt + H)">🏔️ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="🏠 Home"><span>🏠 Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="📂 Projects"><span>📂 Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="📝 Blog"><span>📝 Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="🧗 About"><span>🧗 About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="📖 Categories"><span>📖 Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]</h1><div class=post-meta><span title='2025-07-03 17:11:53 +0900 +0900'>July 3, 2025</span>&nbsp;·&nbsp;4 min</div></header><div class=post-content><h2 id=-시나리오-설명>🧠 시나리오 설명<a hidden class=anchor aria-hidden=true href=#-시나리오-설명>#</a></h2><blockquote><p>“실무에서는 데이터 파이프라인이나 모델 학습 작업을 수시로 업데이트하게 되며,</p><p>이를 수동으로 업로드하지 않고 Git 기반으로 관리하는 것이 필수입니다.</p><p>Airflow는 GitSync 기능을 통해 DAG를 자동 동기화할 수 있습니다.”</p></blockquote><ul><li>DAG 코드가 Git으로 관리되어야 리뷰, 히스토리, 협업 가능</li><li>GitSync → DAG 자동 배포 (CI/CD 개념 적용)</li><li>Secret으로 Git 인증 → 조직 내 GitOps 문화와 연계</li></ul><hr><h2 id=-tldr>✨ TL;DR<a hidden class=anchor aria-hidden=true href=#-tldr>#</a></h2><ul><li>Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계</li><li>GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성</li><li>UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능</li></ul><hr><h2 id=-아키텍처-구성도>📐 아키텍처 구성도<a hidden class=anchor aria-hidden=true href=#-아키텍처-구성도>#</a></h2><p><img alt=04 loading=lazy src=/mlops-journey/images/04.png></p><hr><h2 id=-커스텀-airflow-이미지-구성>🐳 커스텀 Airflow 이미지 구성<a hidden class=anchor aria-hidden=true href=#-커스텀-airflow-이미지-구성>#</a></h2><p>GitSync DAG에서 MLflow 연동 또는 AWS SDK 사용을 위한 Python 패키지 설치 필요</p><h3 id=-dockerfile>🔸 Dockerfile<a hidden class=anchor aria-hidden=true href=#-dockerfile>#</a></h3><pre tabindex=0><code>FROM apache/airflow:3.0.2-python3.12

COPY requirements.txt /tmp/requirements.txt
USER airflow
RUN pip install --no-cache-dir -r /tmp/requirements.txt
</code></pre><h3 id=-requirementstxt>🔸 requirements.txt<a hidden class=anchor aria-hidden=true href=#-requirementstxt>#</a></h3><pre tabindex=0><code>mlflow==2.13.0
pandas
scikit-learn
boto3
</code></pre><h3 id=-빌드--푸시>🔸 빌드 & 푸시<a hidden class=anchor aria-hidden=true href=#-빌드--푸시>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t hoizz/airflow-custom:v5-mlflow .
</span></span><span style=display:flex><span>docker push hoizz/airflow-custom:v5-mlflow
</span></span></code></pre></div><hr><h2 id=-helm-구성>🛠 Helm 구성<a hidden class=anchor aria-hidden=true href=#-helm-구성>#</a></h2><h3 id=-valuesyaml>🔹 values.yaml<a hidden class=anchor aria-hidden=true href=#-valuesyaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># 실행 엔진 설정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>executor</span>: <span style=color:#ae81ff>KubernetesExecutor</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 이미지 설정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>images</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>airflow</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>hoizz/airflow-custom </span> <span style=color:#75715e># 커스텀 이미지</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>v5-mlflow-20240712          </span> <span style=color:#75715e># 태그 </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 생성한 fernetKey 고정 (helm delete &amp; install 이후에도 이전 variables 등 데이터 sync 가능)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>fernetKeySecretName</span>: <span style=color:#ae81ff>my-fernet-secret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DAG GitSync 설정 (GitOps 기반)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>dags</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gitSync</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>git@github.com:keonhoban/airflow-dags.git</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>branch</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>subPath</span>: <span style=color:#ae81ff>dags</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depth</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>wait</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>HEAD</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sshKeySecret</span>: <span style=color:#ae81ff>airflow-git-ssh-secret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DB 연동 (외부 PostgreSQL 사용)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>postgresql</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># 내부 Postgres 비활성화</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>metadataSecretName</span>: <span style=color:#ae81ff>airflow-db-secret </span> <span style=color:#75715e># Secret 안의 base64된 connection 값 참조</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Airflow 환경 설정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__CORE__LOAD_EXAMPLES</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;False&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;False&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__WEBSERVER__EXPOSE_CONFIG</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;True&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 리소스 설정 (권장)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scheduler</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>workers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>dagProcessor</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ingress 설정 (Ingress Controller 기반 접근)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiServer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ingressClassName</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>airflow.local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># 실무에서는 true + cert-manager 연동 필요</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Web UI 서비스 타입 설정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiServer</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP </span> <span style=color:#75715e># 외부 접근은 Ingress 경유</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 로그 PVC 설정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>existingClaim</span>: <span style=color:#ae81ff>airflow-logs-pvc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (선택) remote 로그 저장소 설정 (예: S3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># config:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_LOGGING: &#34;True&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_BASE_LOG_FOLDER: &#34;s3://your-bucket-name/airflow-logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_LOG_CONN_ID: &#34;aws_default&#34;</span>
</span></span></code></pre></div><hr><h2 id=-fernet_key-생성-및-구성>✅ <code>fernet_key</code> 생성 및 구성<a hidden class=anchor aria-hidden=true href=#-fernet_key-생성-및-구성>#</a></h2><ul><li></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 생성</span>
</span></span><span style=display:flex><span>python -c <span style=color:#e6db74>&#34;from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># secret 적용 (파일 생성 후 kubectl apply 가능)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (git에 필요한 경우 SealedSecret or SOPS or .gitignore)</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-fernet-secret
</span></span><span style=display:flex><span>  namespace: airflow
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>stringData:
</span></span><span style=display:flex><span>  fernet-key: <span style=color:#e6db74>&#34;xZ69xLVkiCfJQ23fXa8oubANRIJRHZLrIeANlHhPGmQ=&#34;</span>  <span style=color:#75715e># 생성한 값으로 수정</span>
</span></span></code></pre></div><hr><h2 id=-gitsync-ssh-key--secret-구성>🔐 GitSync SSH Key & Secret 구성<a hidden class=anchor aria-hidden=true href=#-gitsync-ssh-key--secret-구성>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># SSH 키 생성</span>
</span></span><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#34;testuser@mlops.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub UI에서 Deploy Key 등록 (공개키)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># K8s Secret 생성 (비공개 키)</span>
</span></span><span style=display:flex><span>kubectl create secret generic airflow-git-ssh-secret --from-file<span style=color:#f92672>=</span>gitSshKey<span style=color:#f92672>=</span>/root/.ssh/id_rsa -n airflow
</span></span></code></pre></div><hr><h2 id=-배포-명령어>🚀 배포 명령어<a hidden class=anchor aria-hidden=true href=#-배포-명령어>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace airflow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>helm install airflow apache-airflow/airflow -n airflow -f values.yaml
</span></span></code></pre></div><hr><h2 id=-접속-확인>🌐 접속 확인<a hidden class=anchor aria-hidden=true href=#-접속-확인>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># /etc/hosts 수정</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>NodeIP<span style=color:#f92672>}</span> airflow.local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 브라우저 접속</span>
</span></span><span style=display:flex><span>http://airflow.local
</span></span></code></pre></div><hr><h2 id=-확인-사항>🧪 확인 사항<a hidden class=anchor aria-hidden=true href=#-확인-사항>#</a></h2><table><thead><tr><th>항목</th><th>확인 방법</th></tr></thead><tbody><tr><td>Airflow UI 접근</td><td><code>http://airflow.local</code></td></tr><tr><td>DAG GitSync</td><td>GitHub push → 자동 반영 여부 확인</td></tr><tr><td>PostgreSQL 연결</td><td>metadata DB에 연결 로그 확인</td></tr><tr><td>AWS 인증 연동</td><td><code>boto3.client()</code> 호출 시 에러 없는지 확인</td></tr></tbody></table><hr><h2 id=-tip>🧩 Tip<a hidden class=anchor aria-hidden=true href=#-tip>#</a></h2><ul><li>GitSync는 <code>depth: 1</code>, <code>wait</code>, <code>rev: HEAD</code> 옵션 설정으로 최적화 필요</li><li><code>metadataSecretName</code>에는 <code>AIRFLOW__DATABASE__SQL_ALCHEMY_CONN</code>이 base64 인코딩되어 있어야 함</li><li>각 Pod (<code>scheduler</code>, <code>worker</code>, <code>dagProcessor</code>)마다 AWS credential 마운트 필요</li><li>Ingress 접근을 위해선 hosts 파일에 수동 등록 필요 (로컬 클러스터인 경우)</li></ul><hr><h2 id=-mlops-실전-연결>🔧 MLOps 실전 연결<a hidden class=anchor aria-hidden=true href=#-mlops-실전-연결>#</a></h2><table><thead><tr><th>연결 항목</th><th>실무 의미</th></tr></thead><tbody><tr><td>DAG GitSync</td><td>GitOps 기반으로 실험/운영 동기화 자동화</td></tr><tr><td>External PostgreSQL</td><td>운영 DB와 통합, 백업/모니터링 가능</td></tr><tr><td>boto3 연동</td><td>DAG 내 S3 접근 가능 (모델 or raw 데이터 연동)</td></tr><tr><td>mlflow API 사용</td><td>실험 자동화 가능 (training, promotion 포함)</td></tr></tbody></table><hr><h2 id=-트러블슈팅>🚨 트러블슈팅<a hidden class=anchor aria-hidden=true href=#-트러블슈팅>#</a></h2><h3 id=-gitsync-dag-미반영시-체크-리스트>🔻 GitSync DAG 미반영시 체크 리스트<a hidden class=anchor aria-hidden=true href=#-gitsync-dag-미반영시-체크-리스트>#</a></h3><ul><li><code>subPath</code> 경로 오류</li><li>Secret에 등록된 SSH key 권한 문제</li><li>GitHub deploy key에 write 권한 누락</li></ul><hr><h2 id=-다음-포스트-예고>🧭 다음 포스트 예고<a hidden class=anchor aria-hidden=true href=#-다음-포스트-예고>#</a></h2><blockquote><p>⚙️ FastAPI 서빙 + MLflow 모델 연동</p><p>→ 모델 핫스왑, REST API 구성, Stage/Version 자동 적용까지 진행 예정입니다.</p></blockquote></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/05/><span class=title>« Prev</span><br><span>[MLOps 플랫폼 구축 - 5단계: FastAPI 서빙: MLflow 모델 연동 및 핫스왑 구조 구축]</span>
</a><a class=next href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/03/><span class=title>Next »</span><br><span>[MLOps 플랫폼 구축 - 3단계: MLflow : PostgreSQL + S3 연동 기반 Helm 구성]</span></a></nav></footer></article></main><footer class=footer><p style=margin-top:1rem>© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>