<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™] | ğŸ”ï¸ MLOps Journey</title>
<meta name=keywords content><meta name=description content="ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,
ì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
AirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

DAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥
GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©)
Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„


âœ¨ TL;DR

Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„
GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„±
UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥


ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„
"><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"><meta property="og:site_name" content="ğŸ”ï¸  MLOps Journey"><meta property="og:title" content="[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™]"><meta property="og:description" content="ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,
ì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
AirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€
DAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥ GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©) Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„ âœ¨ TL;DR Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„ GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„± UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥ ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„ "><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-03T17:11:53+09:00"><meta property="article:modified_time" content="2025-07-03T17:11:53+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™]"><meta name=twitter:description content="ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,
ì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
AirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€

DAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥
GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©)
Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„


âœ¨ TL;DR

Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„
GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„±
UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥


ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„
"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://keonhoban.github.io/mlops-journey/posts/"},{"@type":"ListItem","position":2,"name":"[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™]","item":"https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™]","name":"[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync \u002b ì™¸ë¶€ PostgreSQL \u002b Secret ì—°ë™]","description":"ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,\nì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.\nAirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€\nDAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥ GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©) Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„ âœ¨ TL;DR Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„ GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„± UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥ ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„ ","keywords":[],"articleBody":"ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,\nì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.\nAirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€\nDAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥ GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©) Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„ âœ¨ TL;DR Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„ GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„± UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥ ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„ ğŸ³ ì»¤ìŠ¤í…€ Airflow ì´ë¯¸ì§€ êµ¬ì„± GitSync DAGì—ì„œ MLflow ì—°ë™ ë˜ëŠ” AWS SDK ì‚¬ìš©ì„ ìœ„í•œ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”\nğŸ”¸ Dockerfile FROM apache/airflow:3.0.2-python3.12 COPY requirements.txt /tmp/requirements.txt USER airflow RUN pip install --no-cache-dir -r /tmp/requirements.txt ğŸ”¸ requirements.txt mlflow==2.13.0 pandas scikit-learn boto3 ğŸ”¸ ë¹Œë“œ \u0026 í‘¸ì‹œ docker build -t hoizz/airflow-custom:v5-mlflow . docker push hoizz/airflow-custom:v5-mlflow ğŸ›  Helm êµ¬ì„± ğŸ”¹ values.yaml # ì‹¤í–‰ ì—”ì§„ ì„¤ì • executor: KubernetesExecutor # ì´ë¯¸ì§€ ì„¤ì • images: airflow: repository: hoizz/airflow-custom # ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ tag: v5-mlflow-20240712 # íƒœê·¸ pullPolicy: IfNotPresent # ìƒì„±í•œ fernetKey ê³ ì • (helm delete \u0026 install ì´í›„ì—ë„ ì´ì „ variables ë“± ë°ì´í„° sync ê°€ëŠ¥) fernetKeySecretName: my-fernet-secret # DAG GitSync ì„¤ì • (GitOps ê¸°ë°˜) dags: gitSync: enabled: true repo: git@github.com:keonhoban/airflow-dags.git branch: main subPath: dags depth: 1 wait: 10 rev: HEAD sshKeySecret: airflow-git-ssh-secret # DB ì—°ë™ (ì™¸ë¶€ PostgreSQL ì‚¬ìš©) postgresql: enabled: false # ë‚´ë¶€ Postgres ë¹„í™œì„±í™” data: metadataSecretName: airflow-db-secret # Secret ì•ˆì˜ base64ëœ connection ê°’ ì°¸ì¡° # Airflow í™˜ê²½ ì„¤ì • config: AIRFLOW__CORE__LOAD_EXAMPLES: value: \"False\" AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION: value: \"False\" AIRFLOW__WEBSERVER__EXPOSE_CONFIG: value: \"True\" # ë¦¬ì†ŒìŠ¤ ì„¤ì • (ê¶Œì¥) scheduler: resources: requests: cpu: \"500m\" memory: \"512Mi\" limits: cpu: \"1\" memory: \"1Gi\" extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true workers: resources: requests: cpu: \"500m\" memory: \"512Mi\" limits: cpu: \"1\" memory: \"1Gi\" extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true dagProcessor: extraVolumes: - name: aws-credentials secret: secretName: aws-credentials-secret extraVolumeMounts: - name: aws-credentials mountPath: /home/airflow/.aws readOnly: true # Ingress ì„¤ì • (Ingress Controller ê¸°ë°˜ ì ‘ê·¼) ingress: enabled: true apiServer: enabled: true ingressClassName: nginx hosts: - name: airflow.local tls: enabled: false # ì‹¤ë¬´ì—ì„œëŠ” true + cert-manager ì—°ë™ í•„ìš” # Web UI ì„œë¹„ìŠ¤ íƒ€ì… ì„¤ì • apiServer: service: type: ClusterIP # ì™¸ë¶€ ì ‘ê·¼ì€ Ingress ê²½ìœ  # ë¡œê·¸ PVC ì„¤ì • logs: persistence: enabled: true existingClaim: airflow-logs-pvc # (ì„ íƒ) remote ë¡œê·¸ ì €ì¥ì†Œ ì„¤ì • (ì˜ˆ: S3) # config: # AIRFLOW__LOGGING__REMOTE_LOGGING: \"True\" # AIRFLOW__LOGGING__REMOTE_BASE_LOG_FOLDER: \"s3://your-bucket-name/airflow-logs\" # AIRFLOW__LOGGING__REMOTE_LOG_CONN_ID: \"aws_default\" âœ… fernet_key ìƒì„± ë° êµ¬ì„± # ìƒì„± python -c \"from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())\" # secret ì ìš© (íŒŒì¼ ìƒì„± í›„ kubectl apply ê°€ëŠ¥) # (gitì— í•„ìš”í•œ ê²½ìš° SealedSecret or SOPS or .gitignore) apiVersion: v1 kind: Secret metadata: name: my-fernet-secret namespace: airflow type: Opaque stringData: fernet-key: \"xZ69xLVkiCfJQ23fXa8oubANRIJRHZLrIeANlHhPGmQ=\" # ìƒì„±í•œ ê°’ìœ¼ë¡œ ìˆ˜ì • ğŸ” GitSync SSH Key \u0026 Secret êµ¬ì„± # SSH í‚¤ ìƒì„± ssh-keygen -t rsa -b 4096 -C \"testuser@mlops.com\" # GitHub UIì—ì„œ Deploy Key ë“±ë¡ (ê³µê°œí‚¤) # K8s Secret ìƒì„± (ë¹„ê³µê°œ í‚¤) kubectl create secret generic airflow-git-ssh-secret --from-file=gitSshKey=/root/.ssh/id_rsa -n airflow ğŸš€ ë°°í¬ ëª…ë ¹ì–´ kubectl create namespace airflow helm install airflow apache-airflow/airflow -n airflow -f values.yaml ğŸŒ ì ‘ì† í™•ì¸ # /etc/hosts ìˆ˜ì • {NodeIP} airflow.local # ë¸Œë¼ìš°ì € ì ‘ì† http://airflow.local ğŸ§ª í™•ì¸ ì‚¬í•­ í•­ëª© í™•ì¸ ë°©ë²• Airflow UI ì ‘ê·¼ http://airflow.local DAG GitSync GitHub push â†’ ìë™ ë°˜ì˜ ì—¬ë¶€ í™•ì¸ PostgreSQL ì—°ê²° metadata DBì— ì—°ê²° ë¡œê·¸ í™•ì¸ AWS ì¸ì¦ ì—°ë™ boto3.client() í˜¸ì¶œ ì‹œ ì—ëŸ¬ ì—†ëŠ”ì§€ í™•ì¸ ğŸ§© Tip GitSyncëŠ” depth: 1, wait, rev: HEAD ì˜µì…˜ ì„¤ì •ìœ¼ë¡œ ìµœì í™” í•„ìš” metadataSecretNameì—ëŠ” AIRFLOW__DATABASE__SQL_ALCHEMY_CONNì´ base64 ì¸ì½”ë”©ë˜ì–´ ìˆì–´ì•¼ í•¨ ê° Pod (scheduler, worker, dagProcessor)ë§ˆë‹¤ AWS credential ë§ˆìš´íŠ¸ í•„ìš” Ingress ì ‘ê·¼ì„ ìœ„í•´ì„  hosts íŒŒì¼ì— ìˆ˜ë™ ë“±ë¡ í•„ìš” (ë¡œì»¬ í´ëŸ¬ìŠ¤í„°ì¸ ê²½ìš°) ğŸ”§ MLOps ì‹¤ì „ ì—°ê²° ì—°ê²° í•­ëª© ì‹¤ë¬´ ì˜ë¯¸ DAG GitSync GitOps ê¸°ë°˜ìœ¼ë¡œ ì‹¤í—˜/ìš´ì˜ ë™ê¸°í™” ìë™í™” External PostgreSQL ìš´ì˜ DBì™€ í†µí•©, ë°±ì—…/ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥ boto3 ì—°ë™ DAG ë‚´ S3 ì ‘ê·¼ ê°€ëŠ¥ (ëª¨ë¸ or raw ë°ì´í„° ì—°ë™) mlflow API ì‚¬ìš© ì‹¤í—˜ ìë™í™” ê°€ëŠ¥ (training, promotion í¬í•¨) ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ğŸ”» GitSync DAG ë¯¸ë°˜ì˜ì‹œ ì²´í¬ ë¦¬ìŠ¤íŠ¸ subPath ê²½ë¡œ ì˜¤ë¥˜ Secretì— ë“±ë¡ëœ SSH key ê¶Œí•œ ë¬¸ì œ GitHub deploy keyì— write ê¶Œí•œ ëˆ„ë½ ğŸ§­ ë‹¤ìŒ í¬ìŠ¤íŠ¸ ì˜ˆê³  âš™ï¸ FastAPI ì„œë¹™ + MLflow ëª¨ë¸ ì—°ë™\nâ†’ ëª¨ë¸ í•«ìŠ¤ì™‘, REST API êµ¬ì„±, Stage/Version ìë™ ì ìš©ê¹Œì§€ ì§„í–‰ ì˜ˆì •ì…ë‹ˆë‹¤.\n","wordCount":"675","inLanguage":"en","datePublished":"2025-07-03T17:11:53+09:00","dateModified":"2025-07-03T17:11:53+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/"},"publisher":{"@type":"Organization","name":"ğŸ”ï¸  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="ğŸ”ï¸  MLOps Journey (Alt + H)">ğŸ”ï¸ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="ğŸ  Home"><span>ğŸ  Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="ğŸ“‚ Projects"><span>ğŸ“‚ Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="ğŸ“ Blog"><span>ğŸ“ Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="ğŸ§— About"><span>ğŸ§— About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="ğŸ“– Categories"><span>ğŸ“– Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;Â»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[MLOps í”Œë«í¼ êµ¬ì¶• - 4ë‹¨ê³„: Airflow : GitSync + ì™¸ë¶€ PostgreSQL + Secret ì—°ë™]</h1><div class=post-meta><span title='2025-07-03 17:11:53 +0900 +0900'>July 3, 2025</span>&nbsp;Â·&nbsp;4 min</div></header><div class=post-content><h2 id=-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…<a hidden class=anchor aria-hidden=true href=#-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>#</a></h2><blockquote><p>â€œì‹¤ë¬´ì—ì„œëŠ” ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´ë‚˜ ëª¨ë¸ í•™ìŠµ ì‘ì—…ì„ ìˆ˜ì‹œë¡œ ì—…ë°ì´íŠ¸í•˜ê²Œ ë˜ë©°,</p><p>ì´ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šê³  Git ê¸°ë°˜ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p><p>AirflowëŠ” GitSync ê¸°ëŠ¥ì„ í†µí•´ DAGë¥¼ ìë™ ë™ê¸°í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.â€</p></blockquote><ul><li>DAG ì½”ë“œê°€ Gitìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ì•¼ ë¦¬ë·°, íˆìŠ¤í† ë¦¬, í˜‘ì—… ê°€ëŠ¥</li><li>GitSync â†’ DAG ìë™ ë°°í¬ (CI/CD ê°œë… ì ìš©)</li><li>Secretìœ¼ë¡œ Git ì¸ì¦ â†’ ì¡°ì§ ë‚´ GitOps ë¬¸í™”ì™€ ì—°ê³„</li></ul><hr><h2 id=-tldr>âœ¨ TL;DR<a hidden class=anchor aria-hidden=true href=#-tldr>#</a></h2><ul><li>Helmì„ í†µí•´ Airflowë¥¼ ë°°í¬í•˜ë©´ì„œ DAG ì½”ë“œë¥¼ Git ì €ì¥ì†Œì—ì„œ ìë™ìœ¼ë¡œ ë™ê¸°í™”í•˜ëŠ” êµ¬ì¡° ì„¤ê³„</li><li>GitSync, Secret ê¸°ë°˜ SSH ì¸ì¦, ì™¸ë¶€ PostgreSQL, AWS S3 ì—°ë™ê¹Œì§€ í¬í•¨í•´ êµ¬ì„±</li><li>UI ì ‘ê·¼ì€ Ingressë¥¼ í†µí•´ ì´ë£¨ì–´ì§€ë©°, ë¡œê·¸ëŠ” PVC ë˜ëŠ” S3ë¡œ ì„¤ì • ê°€ëŠ¥</li></ul><hr><h2 id=-ì•„í‚¤í…ì²˜-êµ¬ì„±ë„>ğŸ“ ì•„í‚¤í…ì²˜ êµ¬ì„±ë„<a hidden class=anchor aria-hidden=true href=#-ì•„í‚¤í…ì²˜-êµ¬ì„±ë„>#</a></h2><p><img alt=04 loading=lazy src=/mlops-journey/images/04.png></p><hr><h2 id=-ì»¤ìŠ¤í…€-airflow-ì´ë¯¸ì§€-êµ¬ì„±>ğŸ³ ì»¤ìŠ¤í…€ Airflow ì´ë¯¸ì§€ êµ¬ì„±<a hidden class=anchor aria-hidden=true href=#-ì»¤ìŠ¤í…€-airflow-ì´ë¯¸ì§€-êµ¬ì„±>#</a></h2><p>GitSync DAGì—ì„œ MLflow ì—°ë™ ë˜ëŠ” AWS SDK ì‚¬ìš©ì„ ìœ„í•œ Python íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”</p><h3 id=-dockerfile>ğŸ”¸ Dockerfile<a hidden class=anchor aria-hidden=true href=#-dockerfile>#</a></h3><pre tabindex=0><code>FROM apache/airflow:3.0.2-python3.12

COPY requirements.txt /tmp/requirements.txt
USER airflow
RUN pip install --no-cache-dir -r /tmp/requirements.txt
</code></pre><h3 id=-requirementstxt>ğŸ”¸ requirements.txt<a hidden class=anchor aria-hidden=true href=#-requirementstxt>#</a></h3><pre tabindex=0><code>mlflow==2.13.0
pandas
scikit-learn
boto3
</code></pre><h3 id=-ë¹Œë“œ--í‘¸ì‹œ>ğŸ”¸ ë¹Œë“œ & í‘¸ì‹œ<a hidden class=anchor aria-hidden=true href=#-ë¹Œë“œ--í‘¸ì‹œ>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t hoizz/airflow-custom:v5-mlflow .
</span></span><span style=display:flex><span>docker push hoizz/airflow-custom:v5-mlflow
</span></span></code></pre></div><hr><h2 id=-helm-êµ¬ì„±>ğŸ›  Helm êµ¬ì„±<a hidden class=anchor aria-hidden=true href=#-helm-êµ¬ì„±>#</a></h2><h3 id=-valuesyaml>ğŸ”¹ values.yaml<a hidden class=anchor aria-hidden=true href=#-valuesyaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># ì‹¤í–‰ ì—”ì§„ ì„¤ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>executor</span>: <span style=color:#ae81ff>KubernetesExecutor</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ì´ë¯¸ì§€ ì„¤ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>images</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>airflow</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>hoizz/airflow-custom </span> <span style=color:#75715e># ì»¤ìŠ¤í…€ ì´ë¯¸ì§€</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>v5-mlflow-20240712          </span> <span style=color:#75715e># íƒœê·¸ </span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ìƒì„±í•œ fernetKey ê³ ì • (helm delete &amp; install ì´í›„ì—ë„ ì´ì „ variables ë“± ë°ì´í„° sync ê°€ëŠ¥)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>fernetKeySecretName</span>: <span style=color:#ae81ff>my-fernet-secret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DAG GitSync ì„¤ì • (GitOps ê¸°ë°˜)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>dags</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>gitSync</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repo</span>: <span style=color:#ae81ff>git@github.com:keonhoban/airflow-dags.git</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>branch</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>subPath</span>: <span style=color:#ae81ff>dags</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depth</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>wait</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rev</span>: <span style=color:#ae81ff>HEAD</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sshKeySecret</span>: <span style=color:#ae81ff>airflow-git-ssh-secret</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># DB ì—°ë™ (ì™¸ë¶€ PostgreSQL ì‚¬ìš©)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>postgresql</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># ë‚´ë¶€ Postgres ë¹„í™œì„±í™”</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>metadataSecretName</span>: <span style=color:#ae81ff>airflow-db-secret </span> <span style=color:#75715e># Secret ì•ˆì˜ base64ëœ connection ê°’ ì°¸ì¡°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Airflow í™˜ê²½ ì„¤ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>config</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__CORE__LOAD_EXAMPLES</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;False&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;False&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>AIRFLOW__WEBSERVER__EXPOSE_CONFIG</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;True&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ë¦¬ì†ŒìŠ¤ ì„¤ì • (ê¶Œì¥)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scheduler</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>workers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;512Mi&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>dagProcessor</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>aws-credentials-secret</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws-credentials</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/home/airflow/.aws</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Ingress ì„¤ì • (Ingress Controller ê¸°ë°˜ ì ‘ê·¼)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiServer</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ingressClassName</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>airflow.local</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>  <span style=color:#75715e># ì‹¤ë¬´ì—ì„œëŠ” true + cert-manager ì—°ë™ í•„ìš”</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Web UI ì„œë¹„ìŠ¤ íƒ€ì… ì„¤ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiServer</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>ClusterIP </span> <span style=color:#75715e># ì™¸ë¶€ ì ‘ê·¼ì€ Ingress ê²½ìœ </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ë¡œê·¸ PVC ì„¤ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>logs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>existingClaim</span>: <span style=color:#ae81ff>airflow-logs-pvc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (ì„ íƒ) remote ë¡œê·¸ ì €ì¥ì†Œ ì„¤ì • (ì˜ˆ: S3)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># config:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_LOGGING: &#34;True&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_BASE_LOG_FOLDER: &#34;s3://your-bucket-name/airflow-logs&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   AIRFLOW__LOGGING__REMOTE_LOG_CONN_ID: &#34;aws_default&#34;</span>
</span></span></code></pre></div><hr><h2 id=-fernet_key-ìƒì„±-ë°-êµ¬ì„±>âœ… <code>fernet_key</code> ìƒì„± ë° êµ¬ì„±<a hidden class=anchor aria-hidden=true href=#-fernet_key-ìƒì„±-ë°-êµ¬ì„±>#</a></h2><ul><li></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ìƒì„±</span>
</span></span><span style=display:flex><span>python -c <span style=color:#e6db74>&#34;from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># secret ì ìš© (íŒŒì¼ ìƒì„± í›„ kubectl apply ê°€ëŠ¥)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (gitì— í•„ìš”í•œ ê²½ìš° SealedSecret or SOPS or .gitignore)</span>
</span></span><span style=display:flex><span>apiVersion: v1
</span></span><span style=display:flex><span>kind: Secret
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: my-fernet-secret
</span></span><span style=display:flex><span>  namespace: airflow
</span></span><span style=display:flex><span>type: Opaque
</span></span><span style=display:flex><span>stringData:
</span></span><span style=display:flex><span>  fernet-key: <span style=color:#e6db74>&#34;xZ69xLVkiCfJQ23fXa8oubANRIJRHZLrIeANlHhPGmQ=&#34;</span>  <span style=color:#75715e># ìƒì„±í•œ ê°’ìœ¼ë¡œ ìˆ˜ì •</span>
</span></span></code></pre></div><hr><h2 id=-gitsync-ssh-key--secret-êµ¬ì„±>ğŸ” GitSync SSH Key & Secret êµ¬ì„±<a hidden class=anchor aria-hidden=true href=#-gitsync-ssh-key--secret-êµ¬ì„±>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># SSH í‚¤ ìƒì„±</span>
</span></span><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#34;testuser@mlops.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># GitHub UIì—ì„œ Deploy Key ë“±ë¡ (ê³µê°œí‚¤)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># K8s Secret ìƒì„± (ë¹„ê³µê°œ í‚¤)</span>
</span></span><span style=display:flex><span>kubectl create secret generic airflow-git-ssh-secret --from-file<span style=color:#f92672>=</span>gitSshKey<span style=color:#f92672>=</span>/root/.ssh/id_rsa -n airflow
</span></span></code></pre></div><hr><h2 id=-ë°°í¬-ëª…ë ¹ì–´>ğŸš€ ë°°í¬ ëª…ë ¹ì–´<a hidden class=anchor aria-hidden=true href=#-ë°°í¬-ëª…ë ¹ì–´>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace airflow
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>helm install airflow apache-airflow/airflow -n airflow -f values.yaml
</span></span></code></pre></div><hr><h2 id=-ì ‘ì†-í™•ì¸>ğŸŒ ì ‘ì† í™•ì¸<a hidden class=anchor aria-hidden=true href=#-ì ‘ì†-í™•ì¸>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># /etc/hosts ìˆ˜ì •</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>NodeIP<span style=color:#f92672>}</span> airflow.local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ë¸Œë¼ìš°ì € ì ‘ì†</span>
</span></span><span style=display:flex><span>http://airflow.local
</span></span></code></pre></div><hr><h2 id=-í™•ì¸-ì‚¬í•­>ğŸ§ª í™•ì¸ ì‚¬í•­<a hidden class=anchor aria-hidden=true href=#-í™•ì¸-ì‚¬í•­>#</a></h2><table><thead><tr><th>í•­ëª©</th><th>í™•ì¸ ë°©ë²•</th></tr></thead><tbody><tr><td>Airflow UI ì ‘ê·¼</td><td><code>http://airflow.local</code></td></tr><tr><td>DAG GitSync</td><td>GitHub push â†’ ìë™ ë°˜ì˜ ì—¬ë¶€ í™•ì¸</td></tr><tr><td>PostgreSQL ì—°ê²°</td><td>metadata DBì— ì—°ê²° ë¡œê·¸ í™•ì¸</td></tr><tr><td>AWS ì¸ì¦ ì—°ë™</td><td><code>boto3.client()</code> í˜¸ì¶œ ì‹œ ì—ëŸ¬ ì—†ëŠ”ì§€ í™•ì¸</td></tr></tbody></table><hr><h2 id=-tip>ğŸ§© Tip<a hidden class=anchor aria-hidden=true href=#-tip>#</a></h2><ul><li>GitSyncëŠ” <code>depth: 1</code>, <code>wait</code>, <code>rev: HEAD</code> ì˜µì…˜ ì„¤ì •ìœ¼ë¡œ ìµœì í™” í•„ìš”</li><li><code>metadataSecretName</code>ì—ëŠ” <code>AIRFLOW__DATABASE__SQL_ALCHEMY_CONN</code>ì´ base64 ì¸ì½”ë”©ë˜ì–´ ìˆì–´ì•¼ í•¨</li><li>ê° Pod (<code>scheduler</code>, <code>worker</code>, <code>dagProcessor</code>)ë§ˆë‹¤ AWS credential ë§ˆìš´íŠ¸ í•„ìš”</li><li>Ingress ì ‘ê·¼ì„ ìœ„í•´ì„  hosts íŒŒì¼ì— ìˆ˜ë™ ë“±ë¡ í•„ìš” (ë¡œì»¬ í´ëŸ¬ìŠ¤í„°ì¸ ê²½ìš°)</li></ul><hr><h2 id=-mlops-ì‹¤ì „-ì—°ê²°>ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°<a hidden class=anchor aria-hidden=true href=#-mlops-ì‹¤ì „-ì—°ê²°>#</a></h2><table><thead><tr><th>ì—°ê²° í•­ëª©</th><th>ì‹¤ë¬´ ì˜ë¯¸</th></tr></thead><tbody><tr><td>DAG GitSync</td><td>GitOps ê¸°ë°˜ìœ¼ë¡œ ì‹¤í—˜/ìš´ì˜ ë™ê¸°í™” ìë™í™”</td></tr><tr><td>External PostgreSQL</td><td>ìš´ì˜ DBì™€ í†µí•©, ë°±ì—…/ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥</td></tr><tr><td>boto3 ì—°ë™</td><td>DAG ë‚´ S3 ì ‘ê·¼ ê°€ëŠ¥ (ëª¨ë¸ or raw ë°ì´í„° ì—°ë™)</td></tr><tr><td>mlflow API ì‚¬ìš©</td><td>ì‹¤í—˜ ìë™í™” ê°€ëŠ¥ (training, promotion í¬í•¨)</td></tr></tbody></table><hr><h2 id=-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…>ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…<a hidden class=anchor aria-hidden=true href=#-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…>#</a></h2><h3 id=-gitsync-dag-ë¯¸ë°˜ì˜ì‹œ-ì²´í¬-ë¦¬ìŠ¤íŠ¸>ğŸ”» GitSync DAG ë¯¸ë°˜ì˜ì‹œ ì²´í¬ ë¦¬ìŠ¤íŠ¸<a hidden class=anchor aria-hidden=true href=#-gitsync-dag-ë¯¸ë°˜ì˜ì‹œ-ì²´í¬-ë¦¬ìŠ¤íŠ¸>#</a></h3><ul><li><code>subPath</code> ê²½ë¡œ ì˜¤ë¥˜</li><li>Secretì— ë“±ë¡ëœ SSH key ê¶Œí•œ ë¬¸ì œ</li><li>GitHub deploy keyì— write ê¶Œí•œ ëˆ„ë½</li></ul><hr><h2 id=-ë‹¤ìŒ-í¬ìŠ¤íŠ¸-ì˜ˆê³ >ğŸ§­ ë‹¤ìŒ í¬ìŠ¤íŠ¸ ì˜ˆê³ <a hidden class=anchor aria-hidden=true href=#-ë‹¤ìŒ-í¬ìŠ¤íŠ¸-ì˜ˆê³ >#</a></h2><blockquote><p>âš™ï¸ FastAPI ì„œë¹™ + MLflow ëª¨ë¸ ì—°ë™</p><p>â†’ ëª¨ë¸ í•«ìŠ¤ì™‘, REST API êµ¬ì„±, Stage/Version ìë™ ì ìš©ê¹Œì§€ ì§„í–‰ ì˜ˆì •ì…ë‹ˆë‹¤.</p></blockquote></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/05/><span class=title>Â« Prev</span><br><span>[MLOps í”Œë«í¼ êµ¬ì¶• - 5ë‹¨ê³„: FastAPI ì„œë¹™: MLflow ëª¨ë¸ ì—°ë™ ë° í•«ìŠ¤ì™‘ êµ¬ì¡° êµ¬ì¶•]</span>
</a><a class=next href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/03/><span class=title>Next Â»</span><br><span>[MLOps í”Œë«í¼ êµ¬ì¶• - 3ë‹¨ê³„: MLflow : PostgreSQL + S3 ì—°ë™ ê¸°ë°˜ Helm êµ¬ì„±]</span></a></nav></footer></article></main><footer class=footer><p style=margin-top:1rem>Â© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>