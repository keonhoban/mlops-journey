<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…] | ğŸ”ï¸ MLOps Journey</title>
<meta name=keywords content><meta name=description content="Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤
ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€
â€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´
ì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€
â€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€
ìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½


ëª©í‘œ


Prometheus â†’ Alertmanager â†’ Slack ê²½ë¡œë¥¼
dev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,"><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/"><meta property="og:site_name" content="ğŸ”ï¸  MLOps Journey"><meta property="og:title" content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]"><meta property="og:description" content="Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤
ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€
â€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´
ì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€
â€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€
ìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€
ğŸ¯ í•µì‹¬ ìš”ì•½ ëª©í‘œ
Prometheus â†’ Alertmanager â†’ Slack ê²½ë¡œë¥¼
dev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-18T17:10:21+09:00"><meta property="article:modified_time" content="2025-10-18T17:10:21+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]"><meta name=twitter:description content="Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤
ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€
â€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´
ì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€
â€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€
ìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½


ëª©í‘œ


Prometheus â†’ Alertmanager â†’ Slack ê²½ë¡œë¥¼
dev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://keonhoban.github.io/mlops-journey/posts/"},{"@type":"ListItem","position":2,"name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack \u0026 íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]","item":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack \u0026 íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]","name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack \u0026 íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]","description":"Alertmanager Slack \u0026amp; íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤\në¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€\nâ€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´\nì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€\nâ€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€\nìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ ëª©í‘œ\nPrometheus â†’ Alertmanager â†’ Slack ê²½ë¡œë¥¼\ndev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,\n","keywords":[],"articleBody":"Alertmanager Slack \u0026 íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤\në¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€\nâ€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´\nì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€\nâ€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€\nìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ ëª©í‘œ\nPrometheus â†’ Alertmanager â†’ Slack ê²½ë¡œë¥¼\ndev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,\n**â€œê¹¨ì§€ë©´ ë°”ë¡œ ì›ì¸ ì°¾ì„ ìˆ˜ ìˆëŠ” ìˆ˜ì¤€â€**ê¹Œì§€ ì •ë¦¬\ní•µì‹¬ í¬ì¸íŠ¸\nAlertmanager ì„¤ì •ì€ SealedSecretë¡œ ê´€ë¦¬ alertmanager.alertmanagerSpec.configSecret ë¡œ CRì— ì—°ê²° dev/prod ë¼ìš°íŒ… ê¸°ì¤€ì€ namespace ë¼ë²¨ ì •ê·œì‹ null receiverë¡œ WatchdogÂ·ë¶ˆí•„ìš” ì•ŒëŒ ì†ŒìŒ ì°¨ë‹¨ or í…œí”Œë¦¿ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•´ì„œ \"function default not defined\" ì—ëŸ¬ ì œê±° ê²°ê³¼ë¬¼\nìƒˆ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ GitOpsë§Œìœ¼ë¡œ\nSlackê¹Œì§€ ì•ŒëŒ íë¦„ì„ 100% ì¬í˜„í•  ìˆ˜ ìˆëŠ” ìƒíƒœ\n1ï¸âƒ£ ì „ì²´ êµ¬ì¡° ê°œìš” ğŸ§© êµ¬ì„± ìš”ì†Œ ì—­í•  êµ¬ì„± ìš”ì†Œ ì„¤ëª… PrometheusRule ì•ŒëŒ ì¡°ê±´ ì •ì˜ (Smoke í…ŒìŠ¤íŠ¸, FastAPI ì§€ì—°, CrashLoop ë“±) Prometheus Rule í‰ê°€ â†’ firing ìƒíƒœë¡œ Alertmanagerë¡œ ì „ë‹¬ Alertmanager ë¼ë²¨ ê¸°ì¤€ìœ¼ë¡œ Slack ë˜ëŠ” null ë“±ìœ¼ë¡œ ë¼ìš°íŒ… Slack dev/prod ì±„ë„ë¡œ ë¶„ë¦¬ëœ ì•Œë¦¼ ìˆ˜ì‹  2ï¸âƒ£ ì‚¬ì „ ì¤€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸ âœ… ì¸í”„ë¼ ì „ì œ A1ì—ì„œ êµ¬ì„±í•œ monitoring-dev / monitoring-prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ kube-prometheus-stack ë™ì‘ ì¤‘ ArgoCD ì„¤ì¹˜ ë° apps/monitoring-{dev,prod}.yaml ë¡œ GitOps ìš´ì˜ ì¤‘ nginx-ingress ë° ë„ë©”ì¸(ì˜ˆ: alert-dev.local, prometheus-dev.local) ì ‘ê·¼ ê°€ëŠ¥ âœ… Alertmanager / SealedSecret / Slack ì „ì œ sealed-secrets ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì¹˜ (kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤) dev/prodìš© Slack Webhook URL ê°ê° ì¤€ë¹„ Git ë¦¬í¬ì§€í† ë¦¬ ë‚´ì— envs/dev/sealed-secrets/monitoring/, envs/prod/sealed-secrets/monitoring/ ë””ë ‰í„°ë¦¬ ì¡´ì¬ ì´ í¸ì—ì„œëŠ” A1ì—ì„œ êµ¬ì¶•í•œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ìœ„ì—\nAlertmanagerâ€“Slack ê²½ë¡œì™€ SealedSecret ê´€ë¦¬ë¥¼ ì–¹ëŠ” ë‹¨ê³„ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.\n3ï¸âƒ£ Alertmanager ì„¤ì • ì„¤ê³„ (dev/prod ë¶„ë¦¬ ê¸°ì¤€) 3-1. ë¼ìš°íŒ… ê¸°ë³¸ êµ¬ì¡° í•µì‹¬ì€ namespace ë¼ë²¨ì„ ê¸°ì¤€ìœ¼ë¡œ dev/prodë¥¼ ëª…í™•íˆ ë‚˜ëˆ„ëŠ” ê²ƒì…ë‹ˆë‹¤.\nì˜ˆì‹œ(í•µì‹¬ êµ¬ì¡°ë§Œ):\nglobal: resolve_timeout: 5m route: receiver: \"null\" # ê¸°ë³¸ì€ ë²„ë¦¼ group_by: [\"alertname\", \"namespace\"] group_wait: 30s group_interval: 5m repeat_interval: 12h routes: - receiver: \"slack-dev\" # devìš© matchers: - 'namespace=~\".*-dev|monitoring-dev|kube-system\"' - receiver: \"null\" # ê¸°íƒ€ëŠ” ë²„ë¦¼ receivers: - name: \"slack-dev\" slack_configs: - api_url: \"\" send_resolved: true title: \"ğŸš¨ [{{ .Status | toUpper }}][DEV] {{ .CommonLabels.alertname }}\" text: \u003e *Namespace:* {{ or .CommonLabels.namespace \"N/A\" }} *Severity:* {{ or .CommonLabels.severity \"none\" }} *Summary:* {{ or .CommonAnnotations.summary \"No summary\" }} *Description:* {{ or .CommonAnnotations.description \"No description\" }} *Start:* {{ (index .Alerts 0).StartsAt }} - name: \"null\" prodëŠ” slack-prod, namespace=~\".*-prod|monitoring-prod|kube-system\" íŒ¨í„´ìœ¼ë¡œ ë™ì¼ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n3-2. ì™œ or í•¨ìˆ˜ì¸ê°€? Helm í…œí”Œë¦¿ì—ì„œ ì“°ëŠ” defaultëŠ” Alertmanager í…œí”Œë¦¿ì—ì„œëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•¨ìˆ˜ AlertmanagerëŠ” Go í…œí”Œë¦¿ì˜ ë‚´ì¥ í•¨ìˆ˜ë§Œ ì‚¬ìš© ê°€ëŠ¥ ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ ì˜¤ë¥˜ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤: {{ or .CommonLabels.namespace \"N/A\" }} ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Alertmanager ë¡œê·¸ì—:\ntemplate: : function â€œdefaultâ€ not defined\nì´ ì°íˆê³ , í•´ë‹¹ ì„¤ì •ì€ ë¬´ì‹œë©ë‹ˆë‹¤.\n4ï¸âƒ£ SealedSecret ê¸°ë°˜ Alertmanager Config ê´€ë¦¬ 4-1. í‰ë¬¸ Secret â†’ SealedSecret ë³€í™˜ dev ì˜ˆì‹œ ê¸°ì¤€ì…ë‹ˆë‹¤.\nìš°ì„  /tmp/alertmanager-dev.yamlì— ìœ„ì—ì„œ ì„¤ê³„í•œ ë‚´ìš©ì„ ì €ì¥í•©ë‹ˆë‹¤. ê·¸ê±¸ Secretìœ¼ë¡œ ë§Œë“¤ë˜, ë°”ë¡œ ì ìš©í•˜ì§€ ì•Šê³  YAMLë§Œ ì¶œë ¥í•©ë‹ˆë‹¤. kubectl -n monitoring-dev create secret generic alertmanager-config-dev \\ --from-file=alertmanager.yaml=/tmp/alertmanager-dev.yaml \\ --dry-run=client -o yaml \u003e /tmp/alertmanager-config-dev.secret.yaml ê·¸ ë‹¤ìŒ SealedSecretìœ¼ë¡œ ë´‰ì¸: kubeseal \\ --controller-namespace kube-system \\ --controller-name sealed-secrets \\ --format yaml \u003c /tmp/alertmanager-config-dev.secret.yaml \\ \u003e envs/dev/sealed-secrets/monitoring/alertmanager-config-dev.yaml prodë„ ë™ì¼í•˜ê²Œ alertmanager-config-prod.yamlë¡œ ìƒì„± ì¤‘ìš”í•œ ì²´í¬ í¬ì¸íŠ¸: metadata.namespace: monitoring-dev / monitoring-prod spec.template.type: Opaque spec.encryptedData.alertmanager.yaml ì¡´ì¬ ì´ íŒŒì¼ë§Œ Gitì— ì˜¬ë ¤ë„ Webhook ì£¼ì†ŒëŠ” ë³µí˜¸í™” ë¶ˆê°€ëŠ¥í•´ì„œ ì•ˆì „í•©ë‹ˆë‹¤.\n5ï¸âƒ£ kube-prometheus-stackì— ConfigSecret ì—°ê²° A1ì—ì„œ ë§Œë“  apps/monitoring-*.yamlì— ì´ë¯¸ ì´ í•„ë“œê°€ ìˆìŠµë‹ˆë‹¤:\nalertmanager: alertmanagerSpec: configSecret: alertmanager-config-dev # dev ì—¬ê¸° ì˜¤íƒ€ê°€ ë‚˜ë©´ ì•„ë˜ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤:\nalertmanager-config-devê°€ ì•„ë‹Œ ë‹¤ë¥¸ í‚¤ ì‚¬ìš© alertmanager.configFromSecret ê°™ì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°’ ì‚¬ìš© ê·¸ëŸ¬ë©´:\nOperatorê°€ ë‚´ë¶€ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ alertmanager-*-generated Secretì„ ë§Œë“¤ê³  ê·¸ ì„¤ì •ì´ Pod ë‚´ /etc/alertmanager/config/alertmanager.yaml.gz ì— ë§ˆìš´íŠ¸ë©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë°˜ë“œì‹œ ì´ í•„ë“œë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤:\nkubectl -n monitoring-dev get alertmanager monitoring-dev-kube-promet-alertmanager \\ -o jsonpath='{.spec.configSecret}'; echo # ê¸°ëŒ€ê°’: alertmanager-config-dev kubectl -n monitoring-prod get alertmanager monitoring-prod-kube-prome-alertmanager \\ -o jsonpath='{.spec.configSecret}'; echo # ê¸°ëŒ€ê°’: alertmanager-config-prod ì´ê²Œ ë‹¤ë¥´ë©´ ì•„ë¬´ë¦¬ SealedSecretì„ ì˜ ë§Œë“¤ì–´ë„ ëŸ°íƒ€ì„ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n6ï¸âƒ£ Runtime ìƒíƒœ í™•ì¸ (í•„ìˆ˜ Runbook) 6-1. Pod ì•ˆì—ì„œ ì‹¤ì œ ì ìš©ëœ ì„¤ì • ë³´ê¸° POD=$(kubectl -n monitoring-dev get po -l app.kubernetes.io/name=alertmanager -o name | head -1) kubectl -n monitoring-dev exec \"$POD\" -c alertmanager -- \\ sh -lc 'zcat /etc/alertmanager/config/alertmanager.yaml.gz | sed -n \"1,200p\"' ì—¬ê¸°ì„œ í™•ì¸í•´ì•¼ í•  ê²ƒ:\nroute.routes[].matchersì— devìš© ì •ê·œì‹ ì¡´ì¬ receiversì— slack-dev / \"null\" ë“± ì›í•˜ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€ Webhook URLì€ ë§ˆìŠ¤í‚¹ë˜ë”ë¼ë„ êµ¬ì¡°ê°€ ìœ ì§€ë˜ëŠ”ì§€ 6-2. Alertmanager APIë¡œ í˜„ì¬ Config í™•ì¸ curl -sk https://alert-dev.local/api/v2/status \\ | jq -r '.config.original' | yq '.route, .receivers' receiver: slack-dev devìš© namespace ì •ê·œì‹ null receiver ì¡´ì¬ ì—¬ë¶€ 7ï¸âƒ£ Slack ì—°ë™ ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë‚˜ë¦¬ì˜¤ í‘œ ë‹¨ê³„ ê²€ì¦ í¬ì¸íŠ¸ í™•ì¸ ë°©ë²• 1 ConfigSecret ì—°ê²° Alertmanager CRì˜ .spec.configSecret 2 Alertmanagerê°€ ì„¤ì • ì œëŒ€ë¡œ ì½ëŠ”ì§€ /api/v2/status 3 Smoke Rule â†’ Prometheus â†’ Alertmanager /api/v1/alerts, /api/v2/alerts 4 Slackìœ¼ë¡œ ì‹¤ì œ ì•ŒëŒ ë„ì°© dev/prod ì±„ë„ì—ì„œ ë©”ì‹œì§€ í™•ì¸ 5 ì „ì†¡ ì‹¤íŒ¨ìœ¨ alertmanager_notifications_failed_total ë©”íŠ¸ë¦­ 6 ì¬ì‹œì‘ / ArgoCD Sync í›„ì—ë„ ìœ ì§€ë˜ëŠ”ì§€ Rollout + Sync í›„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ 8ï¸âƒ£ Smoke Alert (PrometheusRuleë¡œ ì „ì²´ ê²½ë¡œ í…ŒìŠ¤íŠ¸) 8-1. devìš© Smoke Rule cat \u003c\u003c'EOF' | kubectl -n monitoring-dev apply -f - apiVersion: monitoring.coreos.com/v1 kind: PrometheusRule metadata: name: alertmanager-smoke labels: release: monitoring-dev spec: groups: - name: smoke.rules rules: - alert: Smoke_Alert_To_Slack expr: vector(1) for: 1m labels: severity: warning namespace: monitoring-dev # ğŸ”´ ë¼ìš°íŒ… í‚¤ annotations: summary: \"Smoke test alert\" description: \"This is a test alert to verify Slack integration\" EOF 8-2. Prometheus â†’ Alertmanager â†’ Slack í™•ì¸ # 1) Prometheus ì•ŒëŒ ìƒíƒœ curl -sk https://prometheus-dev.local/api/v1/alerts \\ | jq '.data.alerts[] | select(.labels.alertname==\"Smoke_Alert_To_Slack\") | {state:.state,labels:.labels}' # 2) Alertmanagerì—ì„œ receiver í™•ì¸ curl -sk https://alert-dev.local/api/v2/alerts \\ | jq '.[] | select(.labels.alertname==\"Smoke_Alert_To_Slack\") | {status:.status,receiver:.receiver.name}' state: \"firing\" receiver: \"slack-dev\" ì´ ë‘ ê°€ì§€ë©´ pipelineì€ ì •ìƒì…ë‹ˆë‹¤.\nSlack ì±„ë„ì—ëŠ” ë‹¤ìŒê³¼ ë¹„ìŠ·í•œ ë©”ì‹œì§€ê°€ ë– ì•¼ í•©ë‹ˆë‹¤:\nğŸš¨ [FIRING][DEV] Smoke_Alert_To_Slack\nNamespace: monitoring-dev\nSeverity: warning\nâ€¦\ní…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬:\nkubectl -n monitoring-dev delete prometheusrule alertmanager-smoke 9ï¸âƒ£ Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸ (ë¹ ë¥¸ ì—°ê¸° ê²€ì¦) Prometheusë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë¼ìš°íŒ…ë§Œ ë¹¨ë¦¬ ë³´ê³  ì‹¶ì„ ë•Œ ì“°ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.\ndev ì±„ë„ í…ŒìŠ¤íŠ¸ curl -sk -X POST https://alert-dev.local/api/v2/alerts \\ -H 'Content-Type: application/json' \\ -d '[ { \"labels\": { \"alertname\": \"SlackTestDev\", \"severity\": \"critical\", \"namespace\": \"airflow-dev\" }, \"annotations\": { \"summary\": \"ğŸ”” Slack í…ŒìŠ¤íŠ¸ ì•ŒëŒ (dev / direct)\", \"description\": \"Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸\" } } ]' í™•ì¸:\ncurl -sk \"https://alert-dev.local/api/v2/alerts?filter=alertname%3DSlackTestDev\" \\ | jq '.[].labels' prodë„ alert-prod.local, namespace: airflow-prod ë¡œ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nğŸ”Ÿ ì „ì†¡ ì„±ê³µë¥ /ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§ Slack Webhookì´ ë§‰íˆê±°ë‚˜ í…œí”Œë¦¿ì´ ê¹¨ì¡Œì„ ë•Œ ìˆ«ìë¡œ ê°ì§€í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.\nfor env in dev prod; do echo \"=== $env ===\" echo \"âœ… Slack ì „ì†¡ ì„±ê³µë¥  (5m)\" curl -skG \"https://prometheus-${env}.local/api/v1/query\" \\ --data-urlencode 'query=sum(rate(alertmanager_notifications_total{integration=\"slack\"}[5m]))' \\ | jq '.data.result[]?.value' echo \"âŒ Slack ì „ì†¡ ì‹¤íŒ¨ìœ¨ (5m, ì´ìœ  í¬í•¨)\" curl -skG \"https://prometheus-${env}.local/api/v1/query\" \\ --data-urlencode 'query=sum by (reason)(rate(alertmanager_notifications_failed_total{integration=\"slack\"}[5m]))' \\ | jq '.data.result[]?' done ê¸°ëŒ€ ìƒíƒœ ì„±ê³µë¥ : 0ë³´ë‹¤ í° ê°’ ì‹¤íŒ¨ìœ¨: 0 ë˜ëŠ” 0.00X ìˆ˜ì¤€ ğŸ§© íŒ ìì£¼ í„°ì§€ëŠ” ì´ìŠˆ \u0026 íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì •ë¦¬ ì¦ìƒ ì›ì¸ í•´ê²°ì±… failed to initialize from secret: missing name in receiver routeì—ì„œ \"null\" ë¦¬ì‹œë²„ë¥¼ ì°¸ì¡°í•˜ëŠ”ë°, receivers: ë¸”ë¡ì— name: \"null\" ì—†ìŒ receiversì— name: \"null\" ì¶”ê°€ Alertmanager ë¡œê·¸: function \"default\" not defined í…œí”Œë¦¿ ë‚´ë¶€ì—ì„œ Helmì˜ default ì‚¬ìš© Go í…œí”Œë¦¿ orë¡œ êµì²´ ({{ or .CommonLabels.namespace \"N/A\" }}) /api/v2/alertsì—ì„œ receiver: null ë¼ìš°íŠ¸ matchers ì¡°ê±´ ë¶ˆì¼ì¹˜ Smoke Ruleì— namespace ë¼ë²¨ ì¶”ê°€, matchers ì •ê·œì‹ ë‹¤ì‹œ ì ê²€ devì—ì„œ prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ŒëŒ ë³´ì„ dev/prod ë¼ë²¨Â·selector ì„ì„ (release: monitoring-dev ì˜¤ë¥˜ ë“±) kube-prometheus-stack valuesì—ì„œ serviceMonitorSelector, kube-state-metrics.additionalLabels ì •ì • Watchdog ì•ŒëŒì´ Slackì— ê³„ì† ì˜´ Watchdog ì „ìš© ë¶„ê¸° ì—†ìŒ alertname=Watchdog ì¸ ê²½ìš° receiver: \"null\" ë¡œ ë¼ìš°íŠ¸ ë¶„ê¸° ì„¤ì •ì„ ë°”ê¿¨ëŠ”ë°ë„ ì˜ˆì „ í…œí”Œë¦¿ì´ ê³„ì† ë³´ì„ alertmanager-*-generated ì‹œí¬ë¦¿ì´ ê³„ì† ì‚¬ìš©ë¨ spec.configSecret ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ê³ , generated Secret ì‚­ì œ í›„ Alertmanager ë¡¤ë§ ì¬ì‹œì‘ ğŸ”§ MLOps ì‹¤ì „ ì—°ê²° ì´ Alertmanagerâ€“Slack ë¼ì¸ì€ ë‚˜ì¤‘ì—: FastAPI p95 ì§€ì—°, ì—ëŸ¬ìœ¨, Airflow DAG ì‹¤íŒ¨, MLflow ëª¨ë¸ ë“±ë¡ ì‹¤íŒ¨, ëª¨ë¸ í•«ìŠ¤ì™‘ ì‹¤íŒ¨, ì´ëŸ° ê²ƒë“¤ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡ì•„ë‚´ëŠ” ê´€ì¸¡ ì•ŒëŒì˜ ë°±ë³¸ì´ ë©ë‹ˆë‹¤. íŠ¹íˆ ì´ Alertmanagerâ€“Slack ë¼ì¸ì„: Airflow â†’ MLflow â†’ FastAPI í•«ìŠ¤ì™‘ / ë¡¤ë°± íŒŒì´í”„ë¼ì¸ê³¼ ì—°ê²°í•˜ë©´,\nâ€œí•™ìŠµ/ë°°í¬ ìë™í™”â€ ë¿ ì•„ë‹ˆë¼\n**â€œì•ŒëŒ â†’ ë¡¤ë°±/í•«ìŠ¤ì™‘ í›„ ìƒíƒœ í™•ì¸â€**ê¹Œì§€ ì´ì–´ì§€ëŠ”\nì™„ì „í•œ MLOps ìš´ì˜ ë£¨í”„ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nğŸ ì •ë¦¬ í•­ëª© ìƒíƒœ Alertmanager Config ê´€ë¦¬ ë°©ì‹ dev/prod ê°ê° SealedSecret(alertmanager-config-{dev,prod})ë¡œ Gitì— ì €ì¥ Alertmanager CR ì—°ë™ .spec.configSecret ì´ dev/prodì—ì„œ ê°ì ì˜¬ë°”ë¥¸ Secretì„ ê°€ë¦¬í‚´ Alertmanager ì‹¤ì œ ì„¤ì • Pod ë‚´ë¶€ /etc/alertmanager/config/alertmanager.yaml.gz ë° /api/v2/status ë¡œ í™•ì¸ ê°€ëŠ¥ Smoke Alert ê²½ë¡œ Prometheus /api/v1/alerts + Alertmanager /api/v2/alerts ì—ì„œ state: firing, receiver=slack- í™•ì¸ Slack ì±„ë„ ë¶„ë¦¬ dev/prod ì±„ë„ ê°ê°ì—ì„œ ì•ŒëŒ ìˆ˜ì‹  í™•ì¸ ì „ì†¡ ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§ alertmanager_notifications_failed_total{integration=\"slack\"} â‰’ 0 ìœ ì§€ ì¬ë°°í¬/Sync í›„ ì¼ê´€ì„± Alertmanager ë¡¤ë§ ì¬ì‹œì‘ ë° ArgoCD Sync ì´í›„ì—ë„ ë™ì¼ ì„¤ì • ìœ ì§€ ","wordCount":"1283","inLanguage":"en","datePublished":"2025-10-18T17:10:21+09:00","dateModified":"2025-10-18T17:10:21+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/"},"publisher":{"@type":"Organization","name":"ğŸ”ï¸  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="ğŸ”ï¸  MLOps Journey (Alt + H)">ğŸ”ï¸ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="ğŸ  Home"><span>ğŸ  Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="ğŸ“‚ Projects"><span>ğŸ“‚ Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="ğŸ“ Blog"><span>ğŸ“ Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="ğŸ§— About"><span>ğŸ§— About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="ğŸ“– Categories"><span>ğŸ“– Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;Â»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]</h1><div class=post-meta><span title='2025-10-18 17:10:21 +0900 +0900'>October 18, 2025</span>&nbsp;Â·&nbsp;7 min</div></header><div class=post-content><h2 id=alertmanager-slack--íŠ¸ëŸ¬ë¸”ìŠˆíŒ…>Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…<a hidden class=anchor aria-hidden=true href=#alertmanager-slack--íŠ¸ëŸ¬ë¸”ìŠˆíŒ…>#</a></h2><hr><h2 id=-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…<a hidden class=anchor aria-hidden=true href=#-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>#</a></h2><blockquote><p>â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤</p><p><strong>ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒ</strong>ì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€</p><p>â€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´</p><p><strong>ì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸</strong>ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€</p><p>â€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€</p><p>ìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€</p></blockquote><hr><h3 id=-í•µì‹¬-ìš”ì•½>ğŸ¯ í•µì‹¬ ìš”ì•½<a hidden class=anchor aria-hidden=true href=#-í•µì‹¬-ìš”ì•½>#</a></h3><ul><li><p><strong>ëª©í‘œ</strong></p><ul><li><p><code>Prometheus â†’ Alertmanager â†’ Slack</code> ê²½ë¡œë¥¼</p><p>dev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,</p><p>**â€œê¹¨ì§€ë©´ ë°”ë¡œ ì›ì¸ ì°¾ì„ ìˆ˜ ìˆëŠ” ìˆ˜ì¤€â€**ê¹Œì§€ ì •ë¦¬</p></li></ul></li><li><p><strong>í•µì‹¬ í¬ì¸íŠ¸</strong></p><ul><li>Alertmanager ì„¤ì •ì€ <strong>SealedSecret</strong>ë¡œ ê´€ë¦¬</li><li><code>alertmanager.alertmanagerSpec.configSecret</code> ë¡œ CRì— ì—°ê²°</li><li>dev/prod ë¼ìš°íŒ… ê¸°ì¤€ì€ <code>namespace</code> ë¼ë²¨ ì •ê·œì‹</li><li><code>null</code> receiverë¡œ <strong>WatchdogÂ·ë¶ˆí•„ìš” ì•ŒëŒ ì†ŒìŒ ì°¨ë‹¨</strong></li><li><code>or</code> í…œí”Œë¦¿ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•´ì„œ <code>"function default not defined"</code> ì—ëŸ¬ ì œê±°</li></ul></li><li><p><strong>ê²°ê³¼ë¬¼</strong></p><ul><li><p>ìƒˆ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ GitOpsë§Œìœ¼ë¡œ</p><p><strong>Slackê¹Œì§€ ì•ŒëŒ íë¦„ì„ 100% ì¬í˜„</strong>í•  ìˆ˜ ìˆëŠ” ìƒíƒœ</p></li></ul></li></ul><hr><h2 id=1-ì „ì²´-êµ¬ì¡°-ê°œìš”>1ï¸âƒ£ ì „ì²´ êµ¬ì¡° ê°œìš”<a hidden class=anchor aria-hidden=true href=#1-ì „ì²´-êµ¬ì¡°-ê°œìš”>#</a></h2><p><img alt=mermaid-observability-02.png loading=lazy src=/mlops-journey/images/mermaid-observability-02.png></p><h3 id=-êµ¬ì„±-ìš”ì†Œ-ì—­í• >ğŸ§© êµ¬ì„± ìš”ì†Œ ì—­í• <a hidden class=anchor aria-hidden=true href=#-êµ¬ì„±-ìš”ì†Œ-ì—­í• >#</a></h3><table><thead><tr><th>êµ¬ì„± ìš”ì†Œ</th><th>ì„¤ëª…</th></tr></thead><tbody><tr><td><code>PrometheusRule</code></td><td>ì•ŒëŒ ì¡°ê±´ ì •ì˜ (Smoke í…ŒìŠ¤íŠ¸, FastAPI ì§€ì—°, CrashLoop ë“±)</td></tr><tr><td><code>Prometheus</code></td><td>Rule í‰ê°€ â†’ firing ìƒíƒœë¡œ Alertmanagerë¡œ ì „ë‹¬</td></tr><tr><td><code>Alertmanager</code></td><td>ë¼ë²¨ ê¸°ì¤€ìœ¼ë¡œ Slack ë˜ëŠ” <code>null</code> ë“±ìœ¼ë¡œ ë¼ìš°íŒ…</td></tr><tr><td><code>Slack</code></td><td>dev/prod ì±„ë„ë¡œ ë¶„ë¦¬ëœ ì•Œë¦¼ ìˆ˜ì‹ </td></tr></tbody></table><hr><h2 id=2-ì‚¬ì „-ì¤€ë¹„-ì²´í¬ë¦¬ìŠ¤íŠ¸>2ï¸âƒ£ ì‚¬ì „ ì¤€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸<a hidden class=anchor aria-hidden=true href=#2-ì‚¬ì „-ì¤€ë¹„-ì²´í¬ë¦¬ìŠ¤íŠ¸>#</a></h2><h3 id=-ì¸í”„ë¼-ì „ì œ>âœ… ì¸í”„ë¼ ì „ì œ<a hidden class=anchor aria-hidden=true href=#-ì¸í”„ë¼-ì „ì œ>#</a></h3><ul><li><input disabled type=checkbox> A1ì—ì„œ êµ¬ì„±í•œ <code>monitoring-dev / monitoring-prod</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ kube-prometheus-stack ë™ì‘ ì¤‘</li><li><input disabled type=checkbox> <code>ArgoCD</code> ì„¤ì¹˜ ë° <code>apps/monitoring-{dev,prod}.yaml</code> ë¡œ GitOps ìš´ì˜ ì¤‘</li><li><input disabled type=checkbox> <code>nginx-ingress</code> ë° ë„ë©”ì¸(ì˜ˆ: <code>alert-dev.local</code>, <code>prometheus-dev.local</code>) ì ‘ê·¼ ê°€ëŠ¥</li></ul><h3 id=-alertmanager--sealedsecret--slack-ì „ì œ>âœ… Alertmanager / SealedSecret / Slack ì „ì œ<a hidden class=anchor aria-hidden=true href=#-alertmanager--sealedsecret--slack-ì „ì œ>#</a></h3><ul><li><input disabled type=checkbox> <code>sealed-secrets</code> ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì¹˜ (<code>kube-system</code> ë„¤ì„ìŠ¤í˜ì´ìŠ¤)</li><li><input disabled type=checkbox> dev/prodìš© Slack Webhook URL ê°ê° ì¤€ë¹„</li><li><input disabled type=checkbox> Git ë¦¬í¬ì§€í† ë¦¬ ë‚´ì— <code>envs/dev/sealed-secrets/monitoring/</code>, <code>envs/prod/sealed-secrets/monitoring/</code> ë””ë ‰í„°ë¦¬ ì¡´ì¬</li></ul><blockquote><p>ì´ í¸ì—ì„œëŠ” A1ì—ì„œ êµ¬ì¶•í•œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ìœ„ì—</p><p><strong>Alertmanagerâ€“Slack ê²½ë¡œì™€ SealedSecret ê´€ë¦¬</strong>ë¥¼ ì–¹ëŠ” ë‹¨ê³„ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.</p></blockquote><hr><h2 id=3-alertmanager-ì„¤ì •-ì„¤ê³„-devprod-ë¶„ë¦¬-ê¸°ì¤€>3ï¸âƒ£ Alertmanager ì„¤ì • ì„¤ê³„ (dev/prod ë¶„ë¦¬ ê¸°ì¤€)<a hidden class=anchor aria-hidden=true href=#3-alertmanager-ì„¤ì •-ì„¤ê³„-devprod-ë¶„ë¦¬-ê¸°ì¤€>#</a></h2><h3 id=3-1-ë¼ìš°íŒ…-ê¸°ë³¸-êµ¬ì¡°>3-1. ë¼ìš°íŒ… ê¸°ë³¸ êµ¬ì¡°<a hidden class=anchor aria-hidden=true href=#3-1-ë¼ìš°íŒ…-ê¸°ë³¸-êµ¬ì¡°>#</a></h3><p>í•µì‹¬ì€ <strong>namespace ë¼ë²¨</strong>ì„ ê¸°ì¤€ìœ¼ë¡œ dev/prodë¥¼ ëª…í™•íˆ ë‚˜ëˆ„ëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p>ì˜ˆì‹œ(í•µì‹¬ êµ¬ì¡°ë§Œ):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>resolve_timeout</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#34;null&#34;</span>               <span style=color:#75715e># ê¸°ë³¸ì€ ë²„ë¦¼</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_by</span>: [<span style=color:#e6db74>&#34;alertname&#34;</span>, <span style=color:#e6db74>&#34;namespace&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_wait</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>group_interval</span>: <span style=color:#ae81ff>5m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>repeat_interval</span>: <span style=color:#ae81ff>12h</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#34;slack-dev&#34;</span>      <span style=color:#75715e># devìš©</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e6db74>&#39;namespace=~&#34;.*-dev|monitoring-dev|kube-system&#34;&#39;</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#34;null&#34;</span>           <span style=color:#75715e># ê¸°íƒ€ëŠ” ë²„ë¦¼</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;slack-dev&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>slack_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>api_url</span>: <span style=color:#e6db74>&#34;&lt;SLACK_WEBHOOK_URL_DEV&gt;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>send_resolved</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>title</span>: <span style=color:#e6db74>&#34;ğŸš¨ [{{ .Status | toUpper }}][DEV] {{ .CommonLabels.alertname }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>text</span>: &gt;<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          *Namespace:* {{ or .CommonLabels.namespace &#34;N/A&#34; }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          *Severity:* {{ or .CommonLabels.severity &#34;none&#34; }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          *Summary:* {{ or .CommonAnnotations.summary &#34;No summary&#34; }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          *Description:* {{ or .CommonAnnotations.description &#34;No description&#34; }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          *Start:* {{ (index .Alerts 0).StartsAt }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &lt;https://prometheus-dev.local/alerts|View in Prometheus&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;null&#34;</span>
</span></span></code></pre></div><blockquote><p>prodëŠ” slack-prod, namespace=~".*-prod|monitoring-prod|kube-system" íŒ¨í„´ìœ¼ë¡œ ë™ì¼ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p></blockquote><h3 id=3-2-ì™œ-or-í•¨ìˆ˜ì¸ê°€>3-2. ì™œ <code>or</code> í•¨ìˆ˜ì¸ê°€?<a hidden class=anchor aria-hidden=true href=#3-2-ì™œ-or-í•¨ìˆ˜ì¸ê°€>#</a></h3><ul><li>Helm í…œí”Œë¦¿ì—ì„œ ì“°ëŠ” <code>default</code>ëŠ” Alertmanager í…œí”Œë¦¿ì—ì„œëŠ” <strong>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•¨ìˆ˜</strong></li><li>AlertmanagerëŠ” <strong>Go í…œí”Œë¦¿ì˜ ë‚´ì¥ í•¨ìˆ˜ë§Œ ì‚¬ìš©</strong> ê°€ëŠ¥</li><li>ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ ì˜¤ë¥˜ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>{{ <span style=color:#ae81ff>or .CommonLabels.namespace &#34;N/A&#34; }}</span>
</span></span></code></pre></div><p>ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Alertmanager ë¡œê·¸ì—:</p><blockquote><p>template: : function &ldquo;default&rdquo; not defined</p></blockquote><p>ì´ ì°íˆê³ , í•´ë‹¹ ì„¤ì •ì€ <strong>ë¬´ì‹œ</strong>ë©ë‹ˆë‹¤.</p><hr><h2 id=4-sealedsecret-ê¸°ë°˜-alertmanager-config-ê´€ë¦¬>4ï¸âƒ£ SealedSecret ê¸°ë°˜ Alertmanager Config ê´€ë¦¬<a hidden class=anchor aria-hidden=true href=#4-sealedsecret-ê¸°ë°˜-alertmanager-config-ê´€ë¦¬>#</a></h2><h3 id=4-1-í‰ë¬¸-secret--sealedsecret-ë³€í™˜>4-1. í‰ë¬¸ Secret â†’ SealedSecret ë³€í™˜<a hidden class=anchor aria-hidden=true href=#4-1-í‰ë¬¸-secret--sealedsecret-ë³€í™˜>#</a></h3><p>dev ì˜ˆì‹œ ê¸°ì¤€ì…ë‹ˆë‹¤.</p><ol><li>ìš°ì„  <code>/tmp/alertmanager-dev.yaml</code>ì— ìœ„ì—ì„œ ì„¤ê³„í•œ ë‚´ìš©ì„ ì €ì¥í•©ë‹ˆë‹¤.</li><li>ê·¸ê±¸ Secretìœ¼ë¡œ ë§Œë“¤ë˜, <strong>ë°”ë¡œ ì ìš©í•˜ì§€ ì•Šê³ </strong> YAMLë§Œ ì¶œë ¥í•©ë‹ˆë‹¤.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev create secret generic alertmanager-config-dev <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --from-file<span style=color:#f92672>=</span>alertmanager.yaml<span style=color:#f92672>=</span>/tmp/alertmanager-dev.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --dry-run<span style=color:#f92672>=</span>client -o yaml &gt; /tmp/alertmanager-config-dev.secret.yaml
</span></span></code></pre></div><ol><li>ê·¸ ë‹¤ìŒ SealedSecretìœ¼ë¡œ ë´‰ì¸:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeseal <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --controller-namespace kube-system <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --controller-name sealed-secrets <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --format yaml &lt; /tmp/alertmanager-config-dev.secret.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  &gt; envs/dev/sealed-secrets/monitoring/alertmanager-config-dev.yaml
</span></span></code></pre></div><ul><li>prodë„ ë™ì¼í•˜ê²Œ <code>alertmanager-config-prod.yaml</code>ë¡œ ìƒì„±</li><li>ì¤‘ìš”í•œ ì²´í¬ í¬ì¸íŠ¸:<ul><li><code>metadata.namespace: monitoring-dev / monitoring-prod</code></li><li><code>spec.template.type: Opaque</code></li><li><code>spec.encryptedData.alertmanager.yaml</code> ì¡´ì¬</li></ul></li></ul><blockquote><p>ì´ íŒŒì¼ë§Œ Gitì— ì˜¬ë ¤ë„ Webhook ì£¼ì†ŒëŠ” ë³µí˜¸í™” ë¶ˆê°€ëŠ¥í•´ì„œ ì•ˆì „í•©ë‹ˆë‹¤.</p></blockquote><hr><h2 id=5-kube-prometheus-stackì—-configsecret-ì—°ê²°>5ï¸âƒ£ kube-prometheus-stackì— ConfigSecret ì—°ê²°<a hidden class=anchor aria-hidden=true href=#5-kube-prometheus-stackì—-configsecret-ì—°ê²°>#</a></h2><p>A1ì—ì„œ ë§Œë“  <code>apps/monitoring-*.yaml</code>ì— ì´ë¯¸ ì´ í•„ë“œê°€ ìˆìŠµë‹ˆë‹¤:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>alertmanager</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>alertmanagerSpec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>configSecret</span>: <span style=color:#ae81ff>alertmanager-config-dev  </span> <span style=color:#75715e># dev</span>
</span></span></code></pre></div><p>ì—¬ê¸° ì˜¤íƒ€ê°€ ë‚˜ë©´ ì•„ë˜ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤:</p><ul><li><code>alertmanager-config-dev</code>ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í‚¤ ì‚¬ìš©</li><li><code>alertmanager.configFromSecret</code> ê°™ì€ <strong>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°’</strong> ì‚¬ìš©</li></ul><p>ê·¸ëŸ¬ë©´:</p><ul><li>Operatorê°€ ë‚´ë¶€ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ <code>alertmanager-*-generated</code> Secretì„ ë§Œë“¤ê³ </li><li>ê·¸ ì„¤ì •ì´ Pod ë‚´ <code>/etc/alertmanager/config/alertmanager.yaml.gz</code> ì— ë§ˆìš´íŠ¸ë©ë‹ˆë‹¤.</li></ul><p>ê·¸ë˜ì„œ ë°˜ë“œì‹œ <strong>ì´ í•„ë“œ</strong>ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev get alertmanager monitoring-dev-kube-promet-alertmanager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.configSecret}&#39;</span>; echo
</span></span><span style=display:flex><span><span style=color:#75715e># ê¸°ëŒ€ê°’: alertmanager-config-dev</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n monitoring-prod get alertmanager monitoring-prod-kube-prome-alertmanager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.spec.configSecret}&#39;</span>; echo
</span></span><span style=display:flex><span><span style=color:#75715e># ê¸°ëŒ€ê°’: alertmanager-config-prod</span>
</span></span></code></pre></div><blockquote><p>ì´ê²Œ ë‹¤ë¥´ë©´ ì•„ë¬´ë¦¬ SealedSecretì„ ì˜ ë§Œë“¤ì–´ë„ ëŸ°íƒ€ì„ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p></blockquote><hr><h2 id=6-runtime-ìƒíƒœ-í™•ì¸-í•„ìˆ˜-runbook>6ï¸âƒ£ Runtime ìƒíƒœ í™•ì¸ (í•„ìˆ˜ Runbook)<a hidden class=anchor aria-hidden=true href=#6-runtime-ìƒíƒœ-í™•ì¸-í•„ìˆ˜-runbook>#</a></h2><h3 id=6-1-pod-ì•ˆì—ì„œ-ì‹¤ì œ-ì ìš©ëœ-ì„¤ì •-ë³´ê¸°>6-1. Pod ì•ˆì—ì„œ ì‹¤ì œ ì ìš©ëœ ì„¤ì • ë³´ê¸°<a hidden class=anchor aria-hidden=true href=#6-1-pod-ì•ˆì—ì„œ-ì‹¤ì œ-ì ìš©ëœ-ì„¤ì •-ë³´ê¸°>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>POD<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl -n monitoring-dev get po -l app.kubernetes.io/name<span style=color:#f92672>=</span>alertmanager -o name | head -1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl -n monitoring-dev exec <span style=color:#e6db74>&#34;</span>$POD<span style=color:#e6db74>&#34;</span> -c alertmanager -- <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  sh -lc <span style=color:#e6db74>&#39;zcat /etc/alertmanager/config/alertmanager.yaml.gz | sed -n &#34;1,200p&#34;&#39;</span>
</span></span></code></pre></div><p>ì—¬ê¸°ì„œ í™•ì¸í•´ì•¼ í•  ê²ƒ:</p><ul><li><code>route.routes[].matchers</code>ì— devìš© ì •ê·œì‹ ì¡´ì¬</li><li><code>receivers</code>ì— <code>slack-dev</code> / <code>"null"</code> ë“± ì›í•˜ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€</li><li>Webhook URLì€ ë§ˆìŠ¤í‚¹ë˜ë”ë¼ë„ êµ¬ì¡°ê°€ ìœ ì§€ë˜ëŠ”ì§€</li></ul><h3 id=6-2-alertmanager-apië¡œ-í˜„ì¬-config-í™•ì¸>6-2. Alertmanager APIë¡œ í˜„ì¬ Config í™•ì¸<a hidden class=anchor aria-hidden=true href=#6-2-alertmanager-apië¡œ-í˜„ì¬-config-í™•ì¸>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sk https://alert-dev.local/api/v2/status <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq -r <span style=color:#e6db74>&#39;.config.original&#39;</span> | yq <span style=color:#e6db74>&#39;.route, .receivers&#39;</span>
</span></span></code></pre></div><ul><li><code>receiver: slack-dev</code></li><li>devìš© <code>namespace</code> ì •ê·œì‹</li><li><code>null</code> receiver ì¡´ì¬ ì—¬ë¶€</li></ul><hr><h2 id=7-slack-ì—°ë™-ê²€ì¦-ì‹œë‚˜ë¦¬ì˜¤>7ï¸âƒ£ Slack ì—°ë™ ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤<a hidden class=anchor aria-hidden=true href=#7-slack-ì—°ë™-ê²€ì¦-ì‹œë‚˜ë¦¬ì˜¤>#</a></h2><h3 id=ì‹œë‚˜ë¦¬ì˜¤-í‘œ>ì‹œë‚˜ë¦¬ì˜¤ í‘œ<a hidden class=anchor aria-hidden=true href=#ì‹œë‚˜ë¦¬ì˜¤-í‘œ>#</a></h3><table><thead><tr><th>ë‹¨ê³„</th><th>ê²€ì¦ í¬ì¸íŠ¸</th><th>í™•ì¸ ë°©ë²•</th></tr></thead><tbody><tr><td>1</td><td>ConfigSecret ì—°ê²°</td><td>Alertmanager CRì˜ <code>.spec.configSecret</code></td></tr><tr><td>2</td><td>Alertmanagerê°€ ì„¤ì • ì œëŒ€ë¡œ ì½ëŠ”ì§€</td><td><code>/api/v2/status</code></td></tr><tr><td>3</td><td>Smoke Rule â†’ Prometheus â†’ Alertmanager</td><td><code>/api/v1/alerts</code>, <code>/api/v2/alerts</code></td></tr><tr><td>4</td><td>Slackìœ¼ë¡œ ì‹¤ì œ ì•ŒëŒ ë„ì°©</td><td>dev/prod ì±„ë„ì—ì„œ ë©”ì‹œì§€ í™•ì¸</td></tr><tr><td>5</td><td>ì „ì†¡ ì‹¤íŒ¨ìœ¨</td><td><code>alertmanager_notifications_failed_total</code> ë©”íŠ¸ë¦­</td></tr><tr><td>6</td><td>ì¬ì‹œì‘ / ArgoCD Sync í›„ì—ë„ ìœ ì§€ë˜ëŠ”ì§€</td><td>Rollout + Sync í›„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</td></tr></tbody></table><hr><h2 id=8-smoke-alert-prometheusruleë¡œ-ì „ì²´-ê²½ë¡œ-í…ŒìŠ¤íŠ¸>8ï¸âƒ£ Smoke Alert (PrometheusRuleë¡œ ì „ì²´ ê²½ë¡œ í…ŒìŠ¤íŠ¸)<a hidden class=anchor aria-hidden=true href=#8-smoke-alert-prometheusruleë¡œ-ì „ì²´-ê²½ë¡œ-í…ŒìŠ¤íŠ¸>#</a></h2><h3 id=8-1-devìš©-smoke-rule>8-1. devìš© Smoke Rule<a hidden class=anchor aria-hidden=true href=#8-1-devìš©-smoke-rule>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; | kubectl -n monitoring-dev apply -f -
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: monitoring.coreos.com/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: PrometheusRule
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: alertmanager-smoke
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    release: monitoring-dev
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  groups:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - name: smoke.rules
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - alert: Smoke_Alert_To_Slack
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          expr: vector(1)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          for: 1m
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            severity: warning
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            namespace: monitoring-dev     # ğŸ”´ ë¼ìš°íŒ… í‚¤
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          annotations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            summary: &#34;Smoke test alert&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            description: &#34;This is a test alert to verify Slack integration&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=8-2-prometheus--alertmanager--slack-í™•ì¸>8-2. Prometheus â†’ Alertmanager â†’ Slack í™•ì¸<a hidden class=anchor aria-hidden=true href=#8-2-prometheus--alertmanager--slack-í™•ì¸>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1) Prometheus ì•ŒëŒ ìƒíƒœ</span>
</span></span><span style=display:flex><span>curl -sk https://prometheus-dev.local/api/v1/alerts <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq <span style=color:#e6db74>&#39;.data.alerts[] | select(.labels.alertname==&#34;Smoke_Alert_To_Slack&#34;) | {state:.state,labels:.labels}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2) Alertmanagerì—ì„œ receiver í™•ì¸</span>
</span></span><span style=display:flex><span>curl -sk https://alert-dev.local/api/v2/alerts <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq <span style=color:#e6db74>&#39;.[] | select(.labels.alertname==&#34;Smoke_Alert_To_Slack&#34;) | {status:.status,receiver:.receiver.name}&#39;</span>
</span></span></code></pre></div><ul><li><code>state: "firing"</code></li><li><code>receiver: "slack-dev"</code></li></ul><p>ì´ ë‘ ê°€ì§€ë©´ pipelineì€ ì •ìƒì…ë‹ˆë‹¤.</p><p>Slack ì±„ë„ì—ëŠ” ë‹¤ìŒê³¼ ë¹„ìŠ·í•œ ë©”ì‹œì§€ê°€ ë– ì•¼ í•©ë‹ˆë‹¤:</p><blockquote><p>ğŸš¨ [FIRING][DEV] Smoke_Alert_To_Slack</p><p>Namespace: monitoring-dev</p><p>Severity: warning</p><p>â€¦</p></blockquote><p>í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev delete prometheusrule alertmanager-smoke
</span></span></code></pre></div><hr><h2 id=9-alertmanager-ì§ì ‘-post-í…ŒìŠ¤íŠ¸-ë¹ ë¥¸-ì—°ê¸°-ê²€ì¦>9ï¸âƒ£ Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸ (ë¹ ë¥¸ ì—°ê¸° ê²€ì¦)<a hidden class=anchor aria-hidden=true href=#9-alertmanager-ì§ì ‘-post-í…ŒìŠ¤íŠ¸-ë¹ ë¥¸-ì—°ê¸°-ê²€ì¦>#</a></h2><p>Prometheusë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë¼ìš°íŒ…ë§Œ ë¹¨ë¦¬ ë³´ê³  ì‹¶ì„ ë•Œ ì“°ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p><h3 id=dev-ì±„ë„-í…ŒìŠ¤íŠ¸>dev ì±„ë„ í…ŒìŠ¤íŠ¸<a hidden class=anchor aria-hidden=true href=#dev-ì±„ë„-í…ŒìŠ¤íŠ¸>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sk -X POST https://alert-dev.local/api/v2/alerts <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#39;Content-Type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;[
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;labels&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;alertname&#34;: &#34;SlackTestDev&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;severity&#34;: &#34;critical&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;namespace&#34;: &#34;airflow-dev&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;annotations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;summary&#34;: &#34;ğŸ”” Slack í…ŒìŠ¤íŠ¸ ì•ŒëŒ (dev / direct)&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;description&#34;: &#34;Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]&#39;</span>
</span></span></code></pre></div><p>í™•ì¸:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sk <span style=color:#e6db74>&#34;https://alert-dev.local/api/v2/alerts?filter=alertname%3DSlackTestDev&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>| jq <span style=color:#e6db74>&#39;.[].labels&#39;</span>
</span></span></code></pre></div><blockquote><p>prodë„ alert-prod.local, namespace: airflow-prod ë¡œ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p></blockquote><hr><h2 id=-ì „ì†¡-ì„±ê³µë¥ ì‹¤íŒ¨ìœ¨-ëª¨ë‹ˆí„°ë§>ğŸ”Ÿ ì „ì†¡ ì„±ê³µë¥ /ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§<a hidden class=anchor aria-hidden=true href=#-ì „ì†¡-ì„±ê³µë¥ ì‹¤íŒ¨ìœ¨-ëª¨ë‹ˆí„°ë§>#</a></h2><p>Slack Webhookì´ ë§‰íˆê±°ë‚˜ í…œí”Œë¦¿ì´ ê¹¨ì¡Œì„ ë•Œ <strong>ìˆ«ìë¡œ ê°ì§€</strong>í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>for</span> env in dev prod; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;=== </span>$env<span style=color:#e6db74> ===&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;âœ… Slack ì „ì†¡ ì„±ê³µë¥  (5m)&#34;</span>
</span></span><span style=display:flex><span>  curl -skG <span style=color:#e6db74>&#34;https://prometheus-</span><span style=color:#e6db74>${</span>env<span style=color:#e6db74>}</span><span style=color:#e6db74>.local/api/v1/query&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --data-urlencode <span style=color:#e6db74>&#39;query=sum(rate(alertmanager_notifications_total{integration=&#34;slack&#34;}[5m]))&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  | jq <span style=color:#e6db74>&#39;.data.result[]?.value&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;âŒ Slack ì „ì†¡ ì‹¤íŒ¨ìœ¨ (5m, ì´ìœ  í¬í•¨)&#34;</span>
</span></span><span style=display:flex><span>  curl -skG <span style=color:#e6db74>&#34;https://prometheus-</span><span style=color:#e6db74>${</span>env<span style=color:#e6db74>}</span><span style=color:#e6db74>.local/api/v1/query&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --data-urlencode <span style=color:#e6db74>&#39;query=sum by (reason)(rate(alertmanager_notifications_failed_total{integration=&#34;slack&#34;}[5m]))&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  | jq <span style=color:#e6db74>&#39;.data.result[]?&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><ul><li>ê¸°ëŒ€ ìƒíƒœ<ul><li>ì„±ê³µë¥ : 0ë³´ë‹¤ í° ê°’</li><li>ì‹¤íŒ¨ìœ¨: 0 ë˜ëŠ” 0.00X ìˆ˜ì¤€</li></ul></li></ul><hr><h2 id=-íŒ>ğŸ§© íŒ<a hidden class=anchor aria-hidden=true href=#-íŒ>#</a></h2><h3 id=ìì£¼-í„°ì§€ëŠ”-ì´ìŠˆ--íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ì •ë¦¬>ìì£¼ í„°ì§€ëŠ” ì´ìŠˆ & íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#ìì£¼-í„°ì§€ëŠ”-ì´ìŠˆ--íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ì •ë¦¬>#</a></h3><table><thead><tr><th>ì¦ìƒ</th><th>ì›ì¸</th><th>í•´ê²°ì±…</th></tr></thead><tbody><tr><td><code>failed to initialize from secret: missing name in receiver</code></td><td><code>route</code>ì—ì„œ <code>"null"</code> ë¦¬ì‹œë²„ë¥¼ ì°¸ì¡°í•˜ëŠ”ë°, <code>receivers:</code> ë¸”ë¡ì— <code>name: "null"</code> ì—†ìŒ</td><td><code>receivers</code>ì— <code>name: "null"</code> ì¶”ê°€</td></tr><tr><td>Alertmanager ë¡œê·¸: <code>function "default" not defined</code></td><td>í…œí”Œë¦¿ ë‚´ë¶€ì—ì„œ Helmì˜ <code>default</code> ì‚¬ìš©</td><td>Go í…œí”Œë¦¿ <code>or</code>ë¡œ êµì²´ (<code>{{ or .CommonLabels.namespace "N/A" }}</code>)</td></tr><tr><td><code>/api/v2/alerts</code>ì—ì„œ <code>receiver: null</code></td><td>ë¼ìš°íŠ¸ matchers ì¡°ê±´ ë¶ˆì¼ì¹˜</td><td>Smoke Ruleì— <code>namespace</code> ë¼ë²¨ ì¶”ê°€, <code>matchers</code> ì •ê·œì‹ ë‹¤ì‹œ ì ê²€</td></tr><tr><td>devì—ì„œ prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ŒëŒ ë³´ì„</td><td>dev/prod ë¼ë²¨Â·selector ì„ì„ (<code>release: monitoring-dev</code> ì˜¤ë¥˜ ë“±)</td><td>kube-prometheus-stack valuesì—ì„œ <code>serviceMonitorSelector</code>, <code>kube-state-metrics.additionalLabels</code> ì •ì •</td></tr><tr><td>Watchdog ì•ŒëŒì´ Slackì— ê³„ì† ì˜´</td><td>Watchdog ì „ìš© ë¶„ê¸° ì—†ìŒ</td><td><code>alertname=Watchdog</code> ì¸ ê²½ìš° <code>receiver: "null"</code> ë¡œ ë¼ìš°íŠ¸ ë¶„ê¸°</td></tr><tr><td>ì„¤ì •ì„ ë°”ê¿¨ëŠ”ë°ë„ ì˜ˆì „ í…œí”Œë¦¿ì´ ê³„ì† ë³´ì„</td><td><code>alertmanager-*-generated</code> ì‹œí¬ë¦¿ì´ ê³„ì† ì‚¬ìš©ë¨</td><td><code>spec.configSecret</code> ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ê³ , generated Secret ì‚­ì œ í›„ Alertmanager ë¡¤ë§ ì¬ì‹œì‘</td></tr></tbody></table><hr><h2 id=-mlops-ì‹¤ì „-ì—°ê²°>ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°<a hidden class=anchor aria-hidden=true href=#-mlops-ì‹¤ì „-ì—°ê²°>#</a></h2><ul><li>ì´ Alertmanagerâ€“Slack ë¼ì¸ì€ ë‚˜ì¤‘ì—:<ul><li><strong>FastAPI p95 ì§€ì—°</strong>, ì—ëŸ¬ìœ¨,</li><li>Airflow DAG ì‹¤íŒ¨,</li><li>MLflow ëª¨ë¸ ë“±ë¡ ì‹¤íŒ¨,</li><li>ëª¨ë¸ í•«ìŠ¤ì™‘ ì‹¤íŒ¨,</li></ul></li><li>ì´ëŸ° ê²ƒë“¤ì„ <strong>ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡ì•„ë‚´ëŠ” ê´€ì¸¡ ì•ŒëŒì˜ ë°±ë³¸</strong>ì´ ë©ë‹ˆë‹¤.</li><li>íŠ¹íˆ ì´ Alertmanagerâ€“Slack ë¼ì¸ì„:<ul><li><p>Airflow â†’ MLflow â†’ FastAPI <strong>í•«ìŠ¤ì™‘ / ë¡¤ë°± íŒŒì´í”„ë¼ì¸</strong>ê³¼ ì—°ê²°í•˜ë©´,</p></li><li><p>â€œí•™ìŠµ/ë°°í¬ ìë™í™”â€ ë¿ ì•„ë‹ˆë¼</p><p>**â€œì•ŒëŒ â†’ ë¡¤ë°±/í•«ìŠ¤ì™‘ í›„ ìƒíƒœ í™•ì¸â€**ê¹Œì§€ ì´ì–´ì§€ëŠ”</p><p><strong>ì™„ì „í•œ MLOps ìš´ì˜ ë£¨í”„</strong>ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></li></ul></li></ul><hr><h2 id=-ì •ë¦¬>ğŸ ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#-ì •ë¦¬>#</a></h2><table><thead><tr><th>í•­ëª©</th><th>ìƒíƒœ</th></tr></thead><tbody><tr><td>Alertmanager Config ê´€ë¦¬ ë°©ì‹</td><td>dev/prod ê°ê° SealedSecret(<code>alertmanager-config-{dev,prod}</code>)ë¡œ Gitì— ì €ì¥</td></tr><tr><td>Alertmanager CR ì—°ë™</td><td><code>.spec.configSecret</code> ì´ dev/prodì—ì„œ ê°ì ì˜¬ë°”ë¥¸ Secretì„ ê°€ë¦¬í‚´</td></tr><tr><td>Alertmanager ì‹¤ì œ ì„¤ì •</td><td>Pod ë‚´ë¶€ <code>/etc/alertmanager/config/alertmanager.yaml.gz</code> ë°</td></tr><tr><td><code>/api/v2/status</code> ë¡œ í™•ì¸ ê°€ëŠ¥</td><td></td></tr><tr><td>Smoke Alert ê²½ë¡œ</td><td>Prometheus <code>/api/v1/alerts</code> + Alertmanager <code>/api/v2/alerts</code> ì—ì„œ</td></tr><tr><td><code>state: firing</code>, <code>receiver=slack-&lt;env></code> í™•ì¸</td><td></td></tr><tr><td>Slack ì±„ë„ ë¶„ë¦¬</td><td>dev/prod ì±„ë„ ê°ê°ì—ì„œ ì•ŒëŒ ìˆ˜ì‹  í™•ì¸</td></tr><tr><td>ì „ì†¡ ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§</td><td><code>alertmanager_notifications_failed_total{integration="slack"}</code> â‰’ 0 ìœ ì§€</td></tr><tr><td>ì¬ë°°í¬/Sync í›„ ì¼ê´€ì„±</td><td>Alertmanager ë¡¤ë§ ì¬ì‹œì‘ ë° ArgoCD Sync ì´í›„ì—ë„ ë™ì¼ ì„¤ì • ìœ ì§€</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/><span class=title>Â« Prev</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]</span>
</a><a class=next href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/01/><span class=title>Next Â»</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 1ë‹¨ê³„ : kube-prometheus-stack + GitOps êµ¬ì¶•]</span></a></nav></footer></article></main><footer class=footer><p style=margin-top:1rem>Â© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>