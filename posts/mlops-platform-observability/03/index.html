<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°] | ğŸ”ï¸ MLOps Journey</title>
<meta name=keywords content><meta name=description content="Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,
ì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€
â€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„
devì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,
ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€
â€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ ì†ë„Â·ì•ˆì •ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,
NFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬
ì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½

ë¬¸ì œ

prometheus-dev.localì—ì„œ airflow-prod, fastapi-prod ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´
kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘
NFS ê¸°ë°˜ Prometheus TSDBë¡œ worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´ ì²´ê°


ëª©í‘œ

dev/prod ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬
Prometheus TSDBë¥¼ local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ )
NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš©


ê²°ë¡ 


ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨"><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/"><meta property="og:site_name" content="ğŸ”ï¸  MLOps Journey"><meta property="og:title" content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]"><meta property="og:description" content="Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡° ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,
ì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€
â€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„
devì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,
ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€
â€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ ì†ë„Â·ì•ˆì •ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,
NFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬
ì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€
ğŸ¯ í•µì‹¬ ìš”ì•½ ë¬¸ì œ prometheus-dev.localì—ì„œ airflow-prod, fastapi-prod ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´ kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘ NFS ê¸°ë°˜ Prometheus TSDBë¡œ worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´ ì²´ê° ëª©í‘œ dev/prod ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬ Prometheus TSDBë¥¼ local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ ) NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš© ê²°ë¡  ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-22T17:10:21+09:00"><meta property="article:modified_time" content="2025-10-22T17:10:21+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]"><meta name=twitter:description content="Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,
ì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€
â€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„
devì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,
ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€
â€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ ì†ë„Â·ì•ˆì •ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,
NFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬
ì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½

ë¬¸ì œ

prometheus-dev.localì—ì„œ airflow-prod, fastapi-prod ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´
kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘
NFS ê¸°ë°˜ Prometheus TSDBë¡œ worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´ ì²´ê°


ëª©í‘œ

dev/prod ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬
Prometheus TSDBë¥¼ local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ )
NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš©


ê²°ë¡ 


ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://keonhoban.github.io/mlops-journey/posts/"},{"@type":"ListItem","position":2,"name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]","item":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]","name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 3ë‹¨ê³„ : Prometheus\/KSM\/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]","description":"Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡° ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,\nì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€\nâ€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„\ndevì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,\nì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€\nâ€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ ì†ë„Â·ì•ˆì •ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,\nNFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬\nì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ ë¬¸ì œ prometheus-dev.localì—ì„œ airflow-prod, fastapi-prod ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´ kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘ NFS ê¸°ë°˜ Prometheus TSDBë¡œ worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´ ì²´ê° ëª©í‘œ dev/prod ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬ Prometheus TSDBë¥¼ local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ ) NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš© ê²°ë¡  ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨\n","keywords":[],"articleBody":"Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡° ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,\nì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€\nâ€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„\ndevì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,\nì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€\nâ€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ ì†ë„Â·ì•ˆì •ì„±ì„ ëŒì–´ì˜¬ë¦¬ê³ ,\nNFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬\nì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ ë¬¸ì œ prometheus-dev.localì—ì„œ airflow-prod, fastapi-prod ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´ kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘ NFS ê¸°ë°˜ Prometheus TSDBë¡œ worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´ ì²´ê° ëª©í‘œ dev/prod ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬ Prometheus TSDBë¥¼ local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ ) NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš© ê²°ë¡  ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨\nTSDBë¥¼ local-pathë¡œ ì˜®ê¸°ë©´ PrometheusëŠ” ë¹ ë¥´ê³  ë…ë¦½ì ì¸ ë¡œì»¬ ë””ìŠ¤í¬,\në‚˜ë¨¸ì§€ëŠ” NFSë¡œ ì¼ê´€ì„± ìˆê²Œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡° ì™„ì„±\n1ï¸âƒ£ ë¬¸ì œ ìƒí™© ì •ë¦¬ â€” â€œì™œ devì—ì„œ prodê°€ ë³´ì´ì§€?â€ 1-1. ì‹¤ì œë¡œ ê²ªì€ ì¦ìƒ prometheus-dev.localì—ì„œ ì•„ë˜ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë©´: curl -skG 'https://prometheus-dev.local/api/v1/query' \\ --data-urlencode 'query=count by(namespace)(kube_pod_info)' ê²°ê³¼ì— airflow-prod, fastapi-prod, monitoring-prod ê°™ì€ prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ê°™ì´ ë“±ì¥ â†’ ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” ìŠ¤íƒì€ dev/prodë¡œ ë‚˜ëˆ ì ¸ ìˆëŠ”ë°,\n**ê´€ì¸¡ ë°ì´í„° ë ˆë²¨ì—ì„œëŠ” â€œì„ì—¬ ìˆëŠ” ìƒíƒœâ€**ì˜€ë˜ ê²ƒ.\n1-2. ë‚˜ì¤‘ì— ì•Œê²Œ ëœ ì§„ì§œ ì›ì¸ë“¤ kube-state-metrics.prometheus.monitor.additionalLabels.release ê°’ì„ ì˜ëª» ë„£ì–´ì„œ prod ìª½ KSMë„ release=monitoring-dev ë¡œ ì°í˜€ ë²„ë¦¼ Prometheusì˜ serviceMonitorSelector.matchLabels.release ê°€ dev/prod ê°„ ì¼ê´€ì„±ì´ ì—†ìŒ kubelet(cAdvisor) ë©”íŠ¸ë¦­ì— namespace í•„í„°ê°€ ì•ˆ ë“¤ì–´ê°€ ìˆì–´ì„œ ë…¸ë“œ ê¸°ì¤€ìœ¼ë¡œ ë–  ìˆëŠ” ëª¨ë“  ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ì´ ì„ì—¬ ë“¤ì–´ì˜´ 2ï¸âƒ£ dev/prod ì™„ì „ ë¶„ë¦¬ ì„¤ê³„ â€” â€œë¼ë²¨ë¡œ ìë¥´ëŠ” ê¸°ì¤€ ë§Œë“¤ê¸°â€ í•µì‹¬ ê°œë…ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.\nâ€œëª¨ë“  ê´€ì¸¡ ë¦¬ì†ŒìŠ¤ì—ëŠ” release=monitoring-{env} ë¼ë²¨ì„ ê°•ì œí•˜ê³ ,\nPrometheusëŠ” ìê¸° envì˜ release ê°’ë§Œ ë³¸ë‹¤.â€\n2-1. Prometheus ì…€ë ‰í„° í†µì¼ dev (apps/monitoring-dev.yaml) prometheus: prometheusSpec: serviceMonitorSelector: matchLabels: release: monitoring-dev podMonitorSelector: matchLabels: release: monitoring-dev ruleSelector: matchLabels: release: monitoring-dev prod (apps/monitoring-prod.yaml) prometheus: prometheusSpec: serviceMonitorSelector: matchLabels: release: monitoring-prod podMonitorSelector: matchLabels: release: monitoring-prod ruleSelector: matchLabels: release: monitoring-prod ì´ ì…‹ì´ í†µì¼ë¼ì•¼ í•©ë‹ˆë‹¤: ServiceMonitor.metadata.labels.release PodMonitor.metadata.labels.release PrometheusRule.metadata.labels.release devëŠ” ë¬´ì¡°ê±´ monitoring-dev, prodëŠ” ë¬´ì¡°ê±´ monitoring-prod 3ï¸âƒ£ kube-state-metrics (KSM) â€” dev/prod ë¼ë²¨ \u0026 í•„í„°ë§ 3-1. ì˜ëª»ëë˜ ë¶€ë¶„ # (ì˜¤ë¥˜) apps/monitoring-prod.yaml kube-state-metrics: prometheus: monitor: enabled: true additionalLabels: release: monitoring-dev # âŒ ì—¬ê¸°ê°€ devë¡œ ë“¤ì–´ê°€ ìˆì—ˆìŒ â†’ prod KSMì˜ ServiceMonitorë„ dev Prometheusê°€ ë³´ëŠ” release=monitoring-dev ë¼ë²¨ ì„¸íŠ¸ë¥¼ íƒ€ë²„ë¦¼.\n3-2. ìˆ˜ì •ë³¸ (í•µì‹¬) # apps/monitoring-prod.yaml kube-state-metrics: prometheus: monitor: enabled: true additionalLabels: release: monitoring-prod # âœ… prodë¡œ ìˆ˜ì • metricRelabelings: - action: keep sourceLabels: [namespace] regex: '.*-prod|monitoring-prod|kube-system' devë„ ë™ì¼ êµ¬ì¡°ë¡œ:\n# apps/monitoring-dev.yaml kube-state-metrics: prometheus: monitor: enabled: true additionalLabels: release: monitoring-dev metricRelabelings: - action: keep sourceLabels: [namespace] regex: '.*-dev|monitoring-dev|kube-system' additionalLabels.release = monitoring-{env}\nâ†’ Prometheus ìª½ serviceMonitorSelectorì™€ ì—°ê²°\nmetricRelabelings\nâ†’ namespace ê¸°ì¤€ìœ¼ë¡œ dev/prod/kube-systemë§Œ ë‚¨ê¸°ê¸°\n3-3. ê²€ì¦ ì¿¼ë¦¬ curl -skG 'https://prometheus-dev.local/api/v1/query' \\ --data-urlencode 'query=count by(namespace)(kube_pod_info)' curl -skG 'https://prometheus-prod.local/api/v1/query' \\ --data-urlencode 'query=count by(namespace)(kube_pod_info)' dev: dev, monitoring-dev, kube-system ë§Œ ë“±ì¥ prod: prod, monitoring-prod, kube-system ë§Œ ë“±ì¥ 4ï¸âƒ£ kubelet / cAdvisor â€” â€œë…¸ë“œëŠ” ê³µìœ ì¸ë°, ë©”íŠ¸ë¦­ë„ ê³µìœ ë˜ë©´ í°ì¼â€ 4-1. ë¬¸ì œ í¬ì¸íŠ¸ kubeletì˜ /metrics/cadvisor ì—”ë“œí¬ì¸íŠ¸ëŠ” ë…¸ë“œ ì „ì²´ íŒŒë“œ ë©”íŠ¸ë¦­ì„ ë…¸ì¶œ\ndev/prometheus / prod/prometheus ë‘˜ ë‹¤ kubeletì„ ìŠ¤í¬ë©í•˜ë©´,\ní•œìª½ì—ì„œ ë‹¤ë¥¸ ìª½ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë©”íŠ¸ë¦­ê¹Œì§€ ê°™ì´ ë³´ê²Œ ë¨ ê¸°ë³¸ metricRelabelingsëŠ” /metricsìš©ì´ê³ ,\n/metrics/cadvisorì—ëŠ” ì ìš©ë˜ì§€ ì•ŠìŒ\n4-2. í•´ê²°: cAdvisorMetricRelabelings ì¶”ê°€ dev ì˜ˆì‹œ:\nkubelet: service: labels: stack: dev # prodëŠ” stack: prod serviceMonitor: namespaceSelector: matchNames: [kube-system] selector: matchLabels: stack: dev # dev kubeletë§Œ íƒ€ê²Œ metricRelabelings: - action: keep sourceLabels: [namespace] regex: '.*-dev|monitoring-dev|kube-system' cAdvisorMetricRelabelings: # âœ… ì—¬ê¸°ì„œ í•œ ë²ˆ ë” í•„í„° - action: keep sourceLabels: [namespace] regex: '.*-dev|monitoring-dev|kube-system' prodëŠ” stack: prod, monitoring-prod, .*-prod ë¡œ ë™ì¼ êµ¬ì¡°.\n4-3. ê²€ì¦ ì¿¼ë¦¬ curl -skG 'https://prometheus-dev.local/api/v1/query' \\ --data-urlencode 'query=count by(namespace)(container_cpu_cfs_periods_total{job=\"kubelet\", __metrics_path__=\"/metrics/cadvisor\"})' curl -skG 'https://prometheus-prod.local/api/v1/query' \\ --data-urlencode 'query=count by(namespace)(container_cpu_cfs_periods_total{job=\"kubelet\", __metrics_path__=\"/metrics/cadvisor\"})' â†’ dev ì¿¼ë¦¬ ê²°ê³¼ì— prod namespaceê°€ ë³´ì´ë©´ ì•„ì§ ì–´ë”˜ê°€ êµ¬ë©ì´ ìˆëŠ” ê²ƒ.\nğŸ§© íŒ â€” â€œstale metric \u0026 ì¡ì†ŒìŒ ì•ŒëŒ ì •ë¦¬â€ 5-1. stale metric ì •ë¦¬ êµì°¨ ìˆ˜ì§‘ ì´ìŠˆë¥¼ í•´ê²°í–ˆì–´ë„ ì´ì „ì— ìˆ˜ì§‘ëœ ì‹œê³„ì—´ì´ ì ê¹ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nPrometheusê°€ ìì²´ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ,\ní™˜ê²½ì„ ê¹¨ë—í•˜ê²Œ ë¦¬ì…‹í•˜ê³  ì‹¶ë‹¤ë©´:\nkubectl -n monitoring-dev rollout restart deploy/monitoring-dev-kube-state-metrics kubectl -n monitoring-prod rollout restart deploy/monitoring-prod-kube-state-metrics kubectl -n monitoring-dev rollout restart statefulset prometheus-monitoring-dev-kube-promet-prometheus kubectl -n monitoring-prod rollout restart statefulset prometheus-monitoring-prod-kube-prome-prometheus 5-2. tmp-curl CrashLoopBackOff ì•ŒëŒ ì„ì‹œ ë””ë²„ê¹…ìš© Pod tmp-curlì„ ë„ì› ë‹¤ê°€ CrashLoopBackOff ìƒíƒœë¡œ ë‘ë©´\nKubePodCrashLooping ì•ŒëŒì´ ê³„ì† ëœ¹ë‹ˆë‹¤.\nkubectl -n monitoring-dev delete pod tmp-curl --force --grace-period=0 5-3. Watchdog ì•ŒëŒ Slack ì†ŒìŒ ì œê±° ê¸°ë³¸ Watchdog ì•ŒëŒì€ â€œíŒŒì´í”„ë¼ì¸ì´ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš©ë„â€ë¼ í•­ìƒ firing ë©ë‹ˆë‹¤.\nroute: routes: - match: alertname: Watchdog receiver: \"null\" receivers: - name: \"null\" â†’ Slackìœ¼ë¡œ Watchdogê°€ ë‚ ì•„ì˜¤ì§€ ì•Šê²Œ ì°¨ë‹¨.\n6ï¸âƒ£ Prometheus TSDB ìŠ¤í† ë¦¬ì§€ â€” NFS â†’ local-path ì „í™˜ ì´ì œ ì„±ëŠ¥/ì•ˆì •ì„± ìª½ ì´ì•¼ê¸°ì…ë‹ˆë‹¤.\n6-1. ì™œ Prometheusë§Œ local-pathë¡œ ì˜®ê²¼ë‚˜? TSDB íŠ¹ì„±ìƒ ì“°ê¸°Â·ì½ê¸° I/Oê°€ ë§¤ìš° ë§ê³  ë¯¼ê°í•¨ NFS ìœ„ì— ì˜¬ë¦¬ë©´: worker ë…¸ë“œ ì¢…ë£Œ ì‹œ unmount ëŒ€ê¸° â†’ ì¢…ë£Œ ì§€ì—° ë„¤íŠ¸ì›Œí¬/ì„œë²„ ë ˆì´í„´ì‹œê°€ ë°”ë¡œ ê´€ì¸¡ ì„±ëŠ¥ì— ì˜í–¥ Grafana/AlertmanagerëŠ” I/OëŸ‰ì´ í›¨ì”¬ ì ìœ¼ë¯€ë¡œ NFSë¡œë„ ì¶©ë¶„ ê·¸ë˜ì„œ êµ¬ì¡°ë¥¼ ì´ë ‡ê²Œ ì •ë¦¬:\nPrometheus: local-path (ë…¸ë“œ ë¡œì»¬ ë””ìŠ¤í¬) Grafana/Alertmanager: NFS(nfs-monitoring) 6-2. values ìˆ˜ì • dev prometheus: prometheusSpec: storageSpec: volumeClaimTemplate: spec: storageClassName: local-path # ğŸ” nfs-monitoring â†’ local-path accessModes: [\"ReadWriteOnce\"] resources: requests: storage: 50Gi prodë„ ë™ì¼ êµ¬ì¡°.\n6-3. ì‹¤ì œ ì „í™˜ ì ˆì°¨ (ë°ì´í„° ì´ˆê¸°í™” ì „ì œ) # (1) ê°’ ë°˜ì˜ kubectl apply -f apps/monitoring-dev.yaml kubectl apply -f apps/monitoring-prod.yaml # (2) Prometheus ì¼ì‹œ ì¤‘ë‹¨ kubectl -n monitoring-dev scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas=0 kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas=0 # (3) ê¸°ì¡´ NFS PVC ì‚­ì œ kubectl -n monitoring-dev delete pvc -l app.kubernetes.io/name=prometheus kubectl -n monitoring-prod delete pvc -l app.kubernetes.io/name=prometheus # (4) Prometheus ì¬ê¸°ë™ (ì´ì œ local-path ê¸°ë°˜ PVC ìƒì„±) kubectl -n monitoring-dev scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas=1 kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas=1 ì¤‘ê°„ì— ArgoCD selfHeal ë•Œë¬¸ì— ë ˆí”Œë¦¬ì¹´ê°€ ë‹¤ì‹œ ì˜¬ë¼ì˜¤ì§€ ì•Šë„ë¡\nì ê¹ íƒ€ì´ë°ë§Œ ì‹ ê²½ ì¨ì£¼ë©´ ë©ë‹ˆë‹¤.\n6-4. PVCê°€ ì‹¤ì œë¡œ local-pathë¥¼ ì“°ëŠ”ì§€ í™•ì¸ kubectl -n monitoring-dev get pvc | grep prometheus kubectl -n monitoring-prod get pvc | grep prometheus # STORAGECLASS ì—´ì´ local-path ì—¬ì•¼ ì •ìƒ 7ï¸âƒ£ Prometheus TSDB ì‹¤ì œ ìœ„ì¹˜ â€” â€œë°ì´í„°ê°€ ë””ìŠ¤í¬ ì–´ë””ì— ìˆë‚˜â€ 7-1. PVC â†’ PV â†’ í˜¸ìŠ¤íŠ¸ ê²½ë¡œ ì¶”ì  kubectl -n monitoring-dev get pvc -o yaml | grep volumeName # volumeName: pvc-xxxxxx kubectl get pv pvc-xxxxxx -o yaml | grep path # path: /opt/local-path-provisioner/pvc-xxxxxx â†’ ì‹¤ì œ TSDB ë°ì´í„°ëŠ” ë…¸ë“œì˜ ì´ ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤:\n/opt/local-path-provisioner/pvc-xxxxxx ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” ê°™ì€ ë³¼ë¥¨ì´ /prometheus ë¡œ ë§ˆìš´íŠ¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.\n7-2. ë…¸ë“œì—ì„œ ì§ì ‘ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ # ì–´ëŠ ë…¸ë“œì— ì˜¬ë¼ì™€ ìˆëŠ”ì§€ kubectl -n monitoring-dev get pod -o wide | grep prometheus # í•´ë‹¹ ë…¸ë“œì— SSH ì ‘ì† í›„ sudo du -sh /opt/local-path-provisioner/pvc-xxxxxx sudo ls /opt/local-path-provisioner/pvc-xxxxxx chunks_head, wal, snapshots ë“± TSDB êµ¬ì¡°ê°€ ë³´ì´ë©´ ì •ìƒ 8ï¸âƒ£ NFSëŠ” ì–´ë””ì— ì“°ë‚˜? â€” ê´€ì¸¡ ìŠ¤íƒ ë‚˜ë¨¸ì§€(PVC) ì „ëµ 8-1. NFS ë™ì  í”„ë¡œë¹„ì €ë„ˆ (observability ì „ìš©) Loki/Promtail, Grafana, Alertmanager ë“± ë¡œê·¸/ëŒ€ì‹œë³´ë“œ ê³„ì—´ì€\nê³µìœ  ìŠ¤í† ë¦¬ì§€ê°€ í¸í•´ì„œ NFSë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.\nhelm upgrade --install nfs-prov \\ nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\ -n storage \\ --set nfs.server=192.168.18.141 \\ --set nfs.path=/mnt/nfs_share/mlops/observability \\ --set storageClass.name=nfs-observability \\ --set storageClass.defaultClass=false \\ --set storageClass.accessModes=ReadWriteMany â†’ nfs-observability ë¼ëŠ” StorageClass ìƒì„±\nâ†’ Loki / Grafana / Alertmanager / ê¸°íƒ€ ë¡œê·¸ì„± PVì— ì‚¬ìš©\n8-2. Monitoring ìŠ¤íƒì—ì„œ NFS ì‚¬ìš©í•˜ëŠ” ì˜ì—­ Grafana: ëŒ€ì‹œë³´ë“œ/ì„¤ì • Alertmanager: ì•ŒëŒ íˆìŠ¤í† ë¦¬ Loki: ë¡œê·¸ ë³´ê´€ FastAPI/MLflow ë¡œê·¸ìš© PVC (ì„ íƒ) Prometheus TSDBëŠ” ì´ë¯¸ local-pathë¡œ ë¶„ë¦¬í–ˆìœ¼ë¯€ë¡œ\nì½ê¸°/ì“°ê¸° ë§ì€ ì‹œê³„ì—´ì€ ë¡œì»¬, ê³µìœ ê°€ í¸í•œ ì„¤ì •/ë¡œê·¸ëŠ” NFS ë¼ëŠ” ì—­í•  ë¶„ë¦¬ê°€ ë©ë‹ˆë‹¤.\nğŸ”§ MLOps ì‹¤ì „ ì—°ê²° ì‹¤í—˜ í™˜ê²½(dev)ê³¼ ìš´ì˜ í™˜ê²½(prod)ì„ ê´€ì¸¡ ë ˆë²¨ì—ì„œ ì™„ì „íˆ ë¶„ë¦¬ â€œdevì—ì„œ í•œ ì‹¤í—˜ì´ prod ê·¸ë˜í”„ì— ì„ì—¬ ë“¤ì–´ê°€ëŠ”â€ ì‚¬ê³ ë¥¼ ë¯¸ë¦¬ ì°¨ë‹¨ Prometheus TSDBë¥¼ local-pathë¡œ ë¶„ë¦¬ ë…¸ì´ì¦ˆ ë§ì€ í™˜ê²½ì—ì„œë„ ë¹ ë¥¸ ì¿¼ë¦¬ + ì•ˆì •ì ì¸ ì¢…ë£Œ í™•ë³´ NFS ê¸°ë°˜ observability ìŠ¤í† ë¦¬ì§€ ê³„ì¸µ Loki/Promtail, Grafana, Alertmanagerê°€ ê³µí†µ ìŠ¤í† ë¦¬ì§€ë¥¼ ì“°ë©´ì„œë„\ndev/prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë¼ë²¨ë¡œ ë…¼ë¦¬ ë¶„ë¦¬\nì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ A4ì—ì„œëŠ”\nLoki + Promtail + Alertmanager / Grafana ì—°ë™ì„ ë‹¤ë£¨ë©´ì„œ,\nâ€œë¡œê·¸Â·ë©”íŠ¸ë¦­Â·ì•ŒëŒì´ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ì—ì„œ ì–´ë–»ê²Œ ë§Œë‚˜ëŠ”ì§€â€ê¹Œì§€ ì´ì–´ê°€ë©´ ì¢‹ìŠµë‹ˆë‹¤.\nğŸ ì •ë¦¬ êµ¬ë¶„ ë‚´ìš© ìƒíƒœ dev/prod ë©”íŠ¸ë¦­ êµì°¨ ìˆ˜ì§‘ KSM/ServiceMonitor/Kubelet ë¼ë²¨ ì •ë¦¬ âœ… í•´ê²° kube-state-metrics í•„í„°ë§ metricRelabelingsë¡œ namespace í•„í„° âœ… ì ìš© kubelet(cAdvisor) êµì°¨ ìˆ˜ì§‘ cAdvisorMetricRelabelings ì¶”ê°€ âœ… ë¶„ë¦¬ stale metric Prometheus \u0026 KSM ì¬ì‹œì‘ âœ… ì •ë¦¬ ì„ì‹œ Pod CrashLoop ì•ŒëŒ tmp-curl ì‚­ì œ âœ… ì†ŒìŒ ì œê±° Watchdog Slack ì†ŒìŒ null receiverë¡œ ë¶„ê¸° âœ… ì°¨ë‹¨ Prometheus ìŠ¤í† ë¦¬ì§€ NFS â†’ local-path ì „í™˜ âœ… ì„±ëŠ¥/ì•ˆì •ì„± ê°œì„  TSDB ìœ„ì¹˜ íŒŒì•… /opt/local-path-provisioner/pvc-* âœ… êµ¬ì¡° ì´í•´ ","wordCount":"1225","inLanguage":"en","datePublished":"2025-10-22T17:10:21+09:00","dateModified":"2025-10-22T17:10:21+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/03/"},"publisher":{"@type":"Organization","name":"ğŸ”ï¸  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="ğŸ”ï¸  MLOps Journey (Alt + H)">ğŸ”ï¸ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="ğŸ  Home"><span>ğŸ  Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="ğŸ“‚ Projects"><span>ğŸ“‚ Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="ğŸ“ Blog"><span>ğŸ“ Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="ğŸ§— About"><span>ğŸ§— About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="ğŸ“– Categories"><span>ğŸ“– Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;Â»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]</h1><div class=post-meta><span title='2025-10-22 17:10:21 +0900 +0900'>October 22, 2025</span>&nbsp;Â·&nbsp;6 min</div></header><div class=post-content><h2 id=prometheusksmkubelet-ì™„ì „-ë¶„ë¦¬-êµ¬ì¡°>Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°<a hidden class=anchor aria-hidden=true href=#prometheusksmkubelet-ì™„ì „-ë¶„ë¦¬-êµ¬ì¡°>#</a></h2><hr><h2 id=-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…<a hidden class=anchor aria-hidden=true href=#-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>#</a></h2><blockquote><p>â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,</p><p>ì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€</p><p>â€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„</p><p>devì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,</p><p>ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ <strong>ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨</strong>í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€</p><p>â€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ <strong>ì†ë„Â·ì•ˆì •ì„±</strong>ì„ ëŒì–´ì˜¬ë¦¬ê³ ,</p><p>NFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬</p><p>ì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€</p></blockquote><hr><h3 id=-í•µì‹¬-ìš”ì•½>ğŸ¯ í•µì‹¬ ìš”ì•½<a hidden class=anchor aria-hidden=true href=#-í•µì‹¬-ìš”ì•½>#</a></h3><ul><li><strong>ë¬¸ì œ</strong><ul><li><code>prometheus-dev.local</code>ì—ì„œ <code>airflow-prod</code>, <code>fastapi-prod</code> ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´</li><li>kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘</li><li>NFS ê¸°ë°˜ Prometheus TSDBë¡œ <strong>worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´</strong> ì²´ê°</li></ul></li><li><strong>ëª©í‘œ</strong><ul><li>dev/prod <strong>ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬</strong></li><li>Prometheus TSDBë¥¼ <strong>local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ )</strong></li><li>NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš©</li></ul></li><li><strong>ê²°ë¡ </strong><ul><li><p>ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨</p></li><li><p>TSDBë¥¼ local-pathë¡œ ì˜®ê¸°ë©´ <strong>PrometheusëŠ” ë¹ ë¥´ê³  ë…ë¦½ì ì¸ ë¡œì»¬ ë””ìŠ¤í¬</strong>,</p><p>ë‚˜ë¨¸ì§€ëŠ” NFSë¡œ ì¼ê´€ì„± ìˆê²Œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡° ì™„ì„±</p></li></ul></li></ul><hr><h2 id=1-ë¬¸ì œ-ìƒí™©-ì •ë¦¬--ì™œ-devì—ì„œ-prodê°€-ë³´ì´ì§€>1ï¸âƒ£ ë¬¸ì œ ìƒí™© ì •ë¦¬ â€” â€œì™œ devì—ì„œ prodê°€ ë³´ì´ì§€?â€<a hidden class=anchor aria-hidden=true href=#1-ë¬¸ì œ-ìƒí™©-ì •ë¦¬--ì™œ-devì—ì„œ-prodê°€-ë³´ì´ì§€>#</a></h2><h3 id=1-1-ì‹¤ì œë¡œ-ê²ªì€-ì¦ìƒ>1-1. ì‹¤ì œë¡œ ê²ªì€ ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#1-1-ì‹¤ì œë¡œ-ê²ªì€-ì¦ìƒ>#</a></h3><ul><li><code>prometheus-dev.local</code>ì—ì„œ ì•„ë˜ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë©´:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -skG <span style=color:#e6db74>&#39;https://prometheus-dev.local/api/v1/query&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query=count by(namespace)(kube_pod_info)&#39;</span>
</span></span></code></pre></div><ul><li>ê²°ê³¼ì— <code>airflow-prod</code>, <code>fastapi-prod</code>, <code>monitoring-prod</code> ê°™ì€ <strong>prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ê°™ì´ ë“±ì¥</strong></li></ul><p>â†’ ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” ìŠ¤íƒì€ dev/prodë¡œ ë‚˜ëˆ ì ¸ ìˆëŠ”ë°,</p><p>**ê´€ì¸¡ ë°ì´í„° ë ˆë²¨ì—ì„œëŠ” â€œì„ì—¬ ìˆëŠ” ìƒíƒœâ€**ì˜€ë˜ ê²ƒ.</p><h3 id=1-2-ë‚˜ì¤‘ì—-ì•Œê²Œ-ëœ-ì§„ì§œ-ì›ì¸ë“¤>1-2. ë‚˜ì¤‘ì— ì•Œê²Œ ëœ ì§„ì§œ ì›ì¸ë“¤<a hidden class=anchor aria-hidden=true href=#1-2-ë‚˜ì¤‘ì—-ì•Œê²Œ-ëœ-ì§„ì§œ-ì›ì¸ë“¤>#</a></h3><ol><li><code>kube-state-metrics.prometheus.monitor.additionalLabels.release</code> ê°’ì„ ì˜ëª» ë„£ì–´ì„œ<ul><li>prod ìª½ KSMë„ <code>release=monitoring-dev</code> ë¡œ ì°í˜€ ë²„ë¦¼</li></ul></li><li>Prometheusì˜ <code>serviceMonitorSelector.matchLabels.release</code> ê°€ dev/prod ê°„ ì¼ê´€ì„±ì´ ì—†ìŒ</li><li>kubelet(cAdvisor) ë©”íŠ¸ë¦­ì— <strong>namespace í•„í„°ê°€ ì•ˆ ë“¤ì–´ê°€ ìˆì–´ì„œ</strong><ul><li>ë…¸ë“œ ê¸°ì¤€ìœ¼ë¡œ ë–  ìˆëŠ” ëª¨ë“  ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ì´ ì„ì—¬ ë“¤ì–´ì˜´</li></ul></li></ol><hr><h2 id=2-devprod-ì™„ì „-ë¶„ë¦¬-ì„¤ê³„--ë¼ë²¨ë¡œ-ìë¥´ëŠ”-ê¸°ì¤€-ë§Œë“¤ê¸°>2ï¸âƒ£ dev/prod ì™„ì „ ë¶„ë¦¬ ì„¤ê³„ â€” â€œë¼ë²¨ë¡œ ìë¥´ëŠ” ê¸°ì¤€ ë§Œë“¤ê¸°â€<a hidden class=anchor aria-hidden=true href=#2-devprod-ì™„ì „-ë¶„ë¦¬-ì„¤ê³„--ë¼ë²¨ë¡œ-ìë¥´ëŠ”-ê¸°ì¤€-ë§Œë“¤ê¸°>#</a></h2><p>í•µì‹¬ ê°œë…ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.</p><blockquote><p>â€œëª¨ë“  ê´€ì¸¡ ë¦¬ì†ŒìŠ¤ì—ëŠ” release=monitoring-{env} ë¼ë²¨ì„ ê°•ì œí•˜ê³ ,</p><p>PrometheusëŠ” ìê¸° envì˜ <code>release</code> ê°’ë§Œ ë³¸ë‹¤.â€</p></blockquote><h3 id=2-1-prometheus-ì…€ë ‰í„°-í†µì¼>2-1. Prometheus ì…€ë ‰í„° í†µì¼<a hidden class=anchor aria-hidden=true href=#2-1-prometheus-ì…€ë ‰í„°-í†µì¼>#</a></h3><h3 id=dev-appsmonitoring-devyaml>dev (<code>apps/monitoring-dev.yaml</code>)<a hidden class=anchor aria-hidden=true href=#dev-appsmonitoring-devyaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheusSpec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>serviceMonitorSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-dev</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>podMonitorSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-dev</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ruleSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-dev</span>
</span></span></code></pre></div><h3 id=prod-appsmonitoring-prodyaml>prod (<code>apps/monitoring-prod.yaml</code>)<a hidden class=anchor aria-hidden=true href=#prod-appsmonitoring-prodyaml>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheusSpec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>serviceMonitorSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-prod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>podMonitorSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-prod</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ruleSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-prod</span>
</span></span></code></pre></div><ul><li>ì´ ì…‹ì´ í†µì¼ë¼ì•¼ í•©ë‹ˆë‹¤:<ul><li><code>ServiceMonitor.metadata.labels.release</code></li><li><code>PodMonitor.metadata.labels.release</code></li><li><code>PrometheusRule.metadata.labels.release</code></li></ul></li><li>devëŠ” ë¬´ì¡°ê±´ <code>monitoring-dev</code>, prodëŠ” ë¬´ì¡°ê±´ <code>monitoring-prod</code></li></ul><hr><h2 id=3-kube-state-metrics-ksm--devprod-ë¼ë²¨--í•„í„°ë§>3ï¸âƒ£ kube-state-metrics (KSM) â€” dev/prod ë¼ë²¨ & í•„í„°ë§<a hidden class=anchor aria-hidden=true href=#3-kube-state-metrics-ksm--devprod-ë¼ë²¨--í•„í„°ë§>#</a></h2><h3 id=3-1-ì˜ëª»ëë˜-ë¶€ë¶„>3-1. ì˜ëª»ëë˜ ë¶€ë¶„<a hidden class=anchor aria-hidden=true href=#3-1-ì˜ëª»ëë˜-ë¶€ë¶„>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># (ì˜¤ë¥˜) apps/monitoring-prod.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kube-state-metrics</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitor</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>additionalLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-dev  </span> <span style=color:#75715e># âŒ ì—¬ê¸°ê°€ devë¡œ ë“¤ì–´ê°€ ìˆì—ˆìŒ</span>
</span></span></code></pre></div><p>â†’ prod KSMì˜ ServiceMonitorë„ dev Prometheusê°€ ë³´ëŠ” <code>release=monitoring-dev</code> ë¼ë²¨ ì„¸íŠ¸ë¥¼ íƒ€ë²„ë¦¼.</p><h3 id=3-2-ìˆ˜ì •ë³¸-í•µì‹¬>3-2. ìˆ˜ì •ë³¸ (í•µì‹¬)<a hidden class=anchor aria-hidden=true href=#3-2-ìˆ˜ì •ë³¸-í•µì‹¬>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># apps/monitoring-prod.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kube-state-metrics</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitor</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>additionalLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-prod  </span> <span style=color:#75715e># âœ… prodë¡œ ìˆ˜ì •</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>metricRelabelings</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>sourceLabels</span>: [<span style=color:#ae81ff>namespace]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*-prod|monitoring-prod|kube-system&#39;</span>
</span></span></code></pre></div><p>devë„ ë™ì¼ êµ¬ì¡°ë¡œ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># apps/monitoring-dev.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kube-state-metrics</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitor</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>additionalLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#ae81ff>monitoring-dev</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>metricRelabelings</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>sourceLabels</span>: [<span style=color:#ae81ff>namespace]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*-dev|monitoring-dev|kube-system&#39;</span>
</span></span></code></pre></div><ul><li><p><code>additionalLabels.release = monitoring-{env}</code></p><p>â†’ Prometheus ìª½ <code>serviceMonitorSelector</code>ì™€ ì—°ê²°</p></li><li><p><code>metricRelabelings</code></p><p>â†’ namespace ê¸°ì¤€ìœ¼ë¡œ dev/prod/kube-systemë§Œ ë‚¨ê¸°ê¸°</p></li></ul><h3 id=3-3-ê²€ì¦-ì¿¼ë¦¬>3-3. ê²€ì¦ ì¿¼ë¦¬<a hidden class=anchor aria-hidden=true href=#3-3-ê²€ì¦-ì¿¼ë¦¬>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -skG <span style=color:#e6db74>&#39;https://prometheus-dev.local/api/v1/query&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query=count by(namespace)(kube_pod_info)&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -skG <span style=color:#e6db74>&#39;https://prometheus-prod.local/api/v1/query&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query=count by(namespace)(kube_pod_info)&#39;</span>
</span></span></code></pre></div><ul><li>dev: <code>dev</code>, <code>monitoring-dev</code>, <code>kube-system</code> ë§Œ ë“±ì¥</li><li>prod: <code>prod</code>, <code>monitoring-prod</code>, <code>kube-system</code> ë§Œ ë“±ì¥</li></ul><hr><h2 id=4-kubelet--cadvisor--ë…¸ë“œëŠ”-ê³µìœ ì¸ë°-ë©”íŠ¸ë¦­ë„-ê³µìœ ë˜ë©´-í°ì¼>4ï¸âƒ£ kubelet / cAdvisor â€” â€œë…¸ë“œëŠ” ê³µìœ ì¸ë°, ë©”íŠ¸ë¦­ë„ ê³µìœ ë˜ë©´ í°ì¼â€<a hidden class=anchor aria-hidden=true href=#4-kubelet--cadvisor--ë…¸ë“œëŠ”-ê³µìœ ì¸ë°-ë©”íŠ¸ë¦­ë„-ê³µìœ ë˜ë©´-í°ì¼>#</a></h2><h3 id=4-1-ë¬¸ì œ-í¬ì¸íŠ¸>4-1. ë¬¸ì œ í¬ì¸íŠ¸<a hidden class=anchor aria-hidden=true href=#4-1-ë¬¸ì œ-í¬ì¸íŠ¸>#</a></h3><ul><li><p>kubeletì˜ <code>/metrics/cadvisor</code> ì—”ë“œí¬ì¸íŠ¸ëŠ” <strong>ë…¸ë“œ ì „ì²´ íŒŒë“œ</strong> ë©”íŠ¸ë¦­ì„ ë…¸ì¶œ</p></li><li><p>dev/prometheus / prod/prometheus ë‘˜ ë‹¤ kubeletì„ ìŠ¤í¬ë©í•˜ë©´,</p><ul><li>í•œìª½ì—ì„œ ë‹¤ë¥¸ ìª½ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë©”íŠ¸ë¦­ê¹Œì§€ ê°™ì´ ë³´ê²Œ ë¨</li></ul></li><li><p>ê¸°ë³¸ <code>metricRelabelings</code>ëŠ” <code>/metrics</code>ìš©ì´ê³ ,</p><p><code>/metrics/cadvisor</code>ì—ëŠ” <strong>ì ìš©ë˜ì§€ ì•ŠìŒ</strong></p></li></ul><h3 id=4-2-í•´ê²°-cadvisormetricrelabelings-ì¶”ê°€>4-2. í•´ê²°: <code>cAdvisorMetricRelabelings</code> ì¶”ê°€<a hidden class=anchor aria-hidden=true href=#4-2-í•´ê²°-cadvisormetricrelabelings-ì¶”ê°€>#</a></h3><p>dev ì˜ˆì‹œ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kubelet</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>stack: dev           # prodëŠ” stack</span>: <span style=color:#ae81ff>prod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceMonitor</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchNames</span>: [<span style=color:#ae81ff>kube-system]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>stack</span>: <span style=color:#ae81ff>dev        </span> <span style=color:#75715e># dev kubeletë§Œ íƒ€ê²Œ</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>metricRelabelings</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>sourceLabels</span>: [<span style=color:#ae81ff>namespace]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*-dev|monitoring-dev|kube-system&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cAdvisorMetricRelabelings</span>:     <span style=color:#75715e># âœ… ì—¬ê¸°ì„œ í•œ ë²ˆ ë” í•„í„°</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>sourceLabels</span>: [<span style=color:#ae81ff>namespace]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;.*-dev|monitoring-dev|kube-system&#39;</span>
</span></span></code></pre></div><p>prodëŠ” <code>stack: prod</code>, <code>monitoring-prod</code>, <code>.*-prod</code> ë¡œ ë™ì¼ êµ¬ì¡°.</p><h3 id=4-3-ê²€ì¦-ì¿¼ë¦¬>4-3. ê²€ì¦ ì¿¼ë¦¬<a hidden class=anchor aria-hidden=true href=#4-3-ê²€ì¦-ì¿¼ë¦¬>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -skG <span style=color:#e6db74>&#39;https://prometheus-dev.local/api/v1/query&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query=count by(namespace)(container_cpu_cfs_periods_total{job=&#34;kubelet&#34;, __metrics_path__=&#34;/metrics/cadvisor&#34;})&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -skG <span style=color:#e6db74>&#39;https://prometheus-prod.local/api/v1/query&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query=count by(namespace)(container_cpu_cfs_periods_total{job=&#34;kubelet&#34;, __metrics_path__=&#34;/metrics/cadvisor&#34;})&#39;</span>
</span></span></code></pre></div><p>â†’ dev ì¿¼ë¦¬ ê²°ê³¼ì— prod namespaceê°€ ë³´ì´ë©´ ì•„ì§ ì–´ë”˜ê°€ êµ¬ë©ì´ ìˆëŠ” ê²ƒ.</p><hr><h2 id=-íŒ--stale-metric--ì¡ì†ŒìŒ-ì•ŒëŒ-ì •ë¦¬>ğŸ§© íŒ â€” â€œstale metric & ì¡ì†ŒìŒ ì•ŒëŒ ì •ë¦¬â€<a hidden class=anchor aria-hidden=true href=#-íŒ--stale-metric--ì¡ì†ŒìŒ-ì•ŒëŒ-ì •ë¦¬>#</a></h2><h3 id=5-1-stale-metric-ì •ë¦¬>5-1. stale metric ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#5-1-stale-metric-ì •ë¦¬>#</a></h3><p>êµì°¨ ìˆ˜ì§‘ ì´ìŠˆë¥¼ í•´ê²°í–ˆì–´ë„ <strong>ì´ì „ì— ìˆ˜ì§‘ëœ ì‹œê³„ì—´</strong>ì´ ì ê¹ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><ul><li><p>Prometheusê°€ ìì²´ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ,</p><p>í™˜ê²½ì„ ê¹¨ë—í•˜ê²Œ ë¦¬ì…‹í•˜ê³  ì‹¶ë‹¤ë©´:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev  rollout restart deploy/monitoring-dev-kube-state-metrics
</span></span><span style=display:flex><span>kubectl -n monitoring-prod rollout restart deploy/monitoring-prod-kube-state-metrics
</span></span><span style=display:flex><span>kubectl -n monitoring-dev  rollout restart statefulset prometheus-monitoring-dev-kube-promet-prometheus
</span></span><span style=display:flex><span>kubectl -n monitoring-prod rollout restart statefulset prometheus-monitoring-prod-kube-prome-prometheus
</span></span></code></pre></div><h3 id=5-2-tmp-curl-crashloopbackoff-ì•ŒëŒ>5-2. tmp-curl CrashLoopBackOff ì•ŒëŒ<a hidden class=anchor aria-hidden=true href=#5-2-tmp-curl-crashloopbackoff-ì•ŒëŒ>#</a></h3><ul><li><p>ì„ì‹œ ë””ë²„ê¹…ìš© Pod <code>tmp-curl</code>ì„ ë„ì› ë‹¤ê°€ CrashLoopBackOff ìƒíƒœë¡œ ë‘ë©´</p><p><code>KubePodCrashLooping</code> ì•ŒëŒì´ ê³„ì† ëœ¹ë‹ˆë‹¤.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev delete pod tmp-curl --force --grace-period<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h3 id=5-3-watchdog-ì•ŒëŒ-slack-ì†ŒìŒ-ì œê±°>5-3. Watchdog ì•ŒëŒ Slack ì†ŒìŒ ì œê±°<a hidden class=anchor aria-hidden=true href=#5-3-watchdog-ì•ŒëŒ-slack-ì†ŒìŒ-ì œê±°>#</a></h3><p>ê¸°ë³¸ Watchdog ì•ŒëŒì€ â€œíŒŒì´í”„ë¼ì¸ì´ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš©ë„â€ë¼ í•­ìƒ firing ë©ë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>route</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>match</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>alertname</span>: <span style=color:#ae81ff>Watchdog</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>receiver</span>: <span style=color:#e6db74>&#34;null&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;null&#34;</span>
</span></span></code></pre></div><p>â†’ Slackìœ¼ë¡œ Watchdogê°€ ë‚ ì•„ì˜¤ì§€ ì•Šê²Œ ì°¨ë‹¨.</p><hr><h2 id=6-prometheus-tsdb-ìŠ¤í† ë¦¬ì§€--nfs--local-path-ì „í™˜>6ï¸âƒ£ Prometheus TSDB ìŠ¤í† ë¦¬ì§€ â€” NFS â†’ local-path ì „í™˜<a hidden class=anchor aria-hidden=true href=#6-prometheus-tsdb-ìŠ¤í† ë¦¬ì§€--nfs--local-path-ì „í™˜>#</a></h2><p>ì´ì œ <strong>ì„±ëŠ¥/ì•ˆì •ì„± ìª½ ì´ì•¼ê¸°</strong>ì…ë‹ˆë‹¤.</p><h3 id=6-1-ì™œ-prometheusë§Œ-local-pathë¡œ-ì˜®ê²¼ë‚˜>6-1. ì™œ Prometheusë§Œ local-pathë¡œ ì˜®ê²¼ë‚˜?<a hidden class=anchor aria-hidden=true href=#6-1-ì™œ-prometheusë§Œ-local-pathë¡œ-ì˜®ê²¼ë‚˜>#</a></h3><ul><li>TSDB íŠ¹ì„±ìƒ <strong>ì“°ê¸°Â·ì½ê¸° I/Oê°€ ë§¤ìš° ë§ê³  ë¯¼ê°í•¨</strong></li><li>NFS ìœ„ì— ì˜¬ë¦¬ë©´:<ul><li>worker ë…¸ë“œ ì¢…ë£Œ ì‹œ <strong>unmount ëŒ€ê¸° â†’ ì¢…ë£Œ ì§€ì—°</strong></li><li>ë„¤íŠ¸ì›Œí¬/ì„œë²„ ë ˆì´í„´ì‹œê°€ ë°”ë¡œ ê´€ì¸¡ ì„±ëŠ¥ì— ì˜í–¥</li></ul></li><li>Grafana/AlertmanagerëŠ” I/OëŸ‰ì´ í›¨ì”¬ ì ìœ¼ë¯€ë¡œ NFSë¡œë„ ì¶©ë¶„</li></ul><p>ê·¸ë˜ì„œ êµ¬ì¡°ë¥¼ ì´ë ‡ê²Œ ì •ë¦¬:</p><ul><li>Prometheus: <code>local-path</code> (ë…¸ë“œ ë¡œì»¬ ë””ìŠ¤í¬)</li><li>Grafana/Alertmanager: NFS(<code>nfs-monitoring</code>)</li></ul><h3 id=6-2-values-ìˆ˜ì •>6-2. values ìˆ˜ì •<a hidden class=anchor aria-hidden=true href=#6-2-values-ìˆ˜ì •>#</a></h3><h3 id=dev>dev<a hidden class=anchor aria-hidden=true href=#dev>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheusSpec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>storageSpec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeClaimTemplate</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>local-path     </span> <span style=color:#75715e># ğŸ” nfs-monitoring â†’ local-path</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>accessModes</span>: [<span style=color:#e6db74>&#34;ReadWriteOnce&#34;</span>]
</span></span><span style=display:flex><span>          <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>50Gi</span>
</span></span></code></pre></div><p>prodë„ ë™ì¼ êµ¬ì¡°.</p><h3 id=6-3-ì‹¤ì œ-ì „í™˜-ì ˆì°¨-ë°ì´í„°-ì´ˆê¸°í™”-ì „ì œ>6-3. ì‹¤ì œ ì „í™˜ ì ˆì°¨ (ë°ì´í„° ì´ˆê¸°í™” ì „ì œ)<a hidden class=anchor aria-hidden=true href=#6-3-ì‹¤ì œ-ì „í™˜-ì ˆì°¨-ë°ì´í„°-ì´ˆê¸°í™”-ì „ì œ>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># (1) ê°’ ë°˜ì˜</span>
</span></span><span style=display:flex><span>kubectl apply -f apps/monitoring-dev.yaml
</span></span><span style=display:flex><span>kubectl apply -f apps/monitoring-prod.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (2) Prometheus ì¼ì‹œ ì¤‘ë‹¨</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-dev  scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (3) ê¸°ì¡´ NFS PVC ì‚­ì œ</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-dev  delete pvc -l app.kubernetes.io/name<span style=color:#f92672>=</span>prometheus
</span></span><span style=display:flex><span>kubectl -n monitoring-prod delete pvc -l app.kubernetes.io/name<span style=color:#f92672>=</span>prometheus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (4) Prometheus ì¬ê¸°ë™ (ì´ì œ local-path ê¸°ë°˜ PVC ìƒì„±)</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-dev  scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><blockquote><p>ì¤‘ê°„ì— ArgoCD selfHeal ë•Œë¬¸ì— ë ˆí”Œë¦¬ì¹´ê°€ ë‹¤ì‹œ ì˜¬ë¼ì˜¤ì§€ ì•Šë„ë¡</p><p>ì ê¹ íƒ€ì´ë°ë§Œ ì‹ ê²½ ì¨ì£¼ë©´ ë©ë‹ˆë‹¤.</p></blockquote><h3 id=6-4-pvcê°€-ì‹¤ì œë¡œ-local-pathë¥¼-ì“°ëŠ”ì§€-í™•ì¸>6-4. PVCê°€ ì‹¤ì œë¡œ local-pathë¥¼ ì“°ëŠ”ì§€ í™•ì¸<a hidden class=anchor aria-hidden=true href=#6-4-pvcê°€-ì‹¤ì œë¡œ-local-pathë¥¼-ì“°ëŠ”ì§€-í™•ì¸>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev  get pvc | grep prometheus
</span></span><span style=display:flex><span>kubectl -n monitoring-prod get pvc | grep prometheus
</span></span><span style=display:flex><span><span style=color:#75715e># STORAGECLASS ì—´ì´ local-path ì—¬ì•¼ ì •ìƒ</span>
</span></span></code></pre></div><hr><h2 id=7-prometheus-tsdb-ì‹¤ì œ-ìœ„ì¹˜--ë°ì´í„°ê°€-ë””ìŠ¤í¬-ì–´ë””ì—-ìˆë‚˜>7ï¸âƒ£ Prometheus TSDB ì‹¤ì œ ìœ„ì¹˜ â€” â€œë°ì´í„°ê°€ ë””ìŠ¤í¬ ì–´ë””ì— ìˆë‚˜â€<a hidden class=anchor aria-hidden=true href=#7-prometheus-tsdb-ì‹¤ì œ-ìœ„ì¹˜--ë°ì´í„°ê°€-ë””ìŠ¤í¬-ì–´ë””ì—-ìˆë‚˜>#</a></h2><h3 id=7-1-pvc--pv--í˜¸ìŠ¤íŠ¸-ê²½ë¡œ-ì¶”ì >7-1. PVC â†’ PV â†’ í˜¸ìŠ¤íŠ¸ ê²½ë¡œ ì¶”ì <a hidden class=anchor aria-hidden=true href=#7-1-pvc--pv--í˜¸ìŠ¤íŠ¸-ê²½ë¡œ-ì¶”ì >#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n monitoring-dev get pvc &lt;prometheus-pvc-name&gt; -o yaml | grep volumeName
</span></span><span style=display:flex><span><span style=color:#75715e># volumeName: pvc-xxxxxx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get pv pvc-xxxxxx -o yaml | grep path
</span></span><span style=display:flex><span><span style=color:#75715e># path: /opt/local-path-provisioner/pvc-xxxxxx</span>
</span></span></code></pre></div><p>â†’ <strong>ì‹¤ì œ TSDB ë°ì´í„°ëŠ” ë…¸ë“œì˜ ì´ ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤:</strong></p><pre tabindex=0><code>/opt/local-path-provisioner/pvc-xxxxxx
</code></pre><p>ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” ê°™ì€ ë³¼ë¥¨ì´ <code>/prometheus</code> ë¡œ ë§ˆìš´íŠ¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><h3 id=7-2-ë…¸ë“œì—ì„œ-ì§ì ‘-í™•ì¸í•˜ê³ -ì‹¶ì„-ë•Œ>7-2. ë…¸ë“œì—ì„œ ì§ì ‘ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ<a hidden class=anchor aria-hidden=true href=#7-2-ë…¸ë“œì—ì„œ-ì§ì ‘-í™•ì¸í•˜ê³ -ì‹¶ì„-ë•Œ>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ì–´ëŠ ë…¸ë“œì— ì˜¬ë¼ì™€ ìˆëŠ”ì§€</span>
</span></span><span style=display:flex><span>kubectl -n monitoring-dev get pod -o wide | grep prometheus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># í•´ë‹¹ ë…¸ë“œì— SSH ì ‘ì† í›„</span>
</span></span><span style=display:flex><span>sudo du -sh /opt/local-path-provisioner/pvc-xxxxxx
</span></span><span style=display:flex><span>sudo ls /opt/local-path-provisioner/pvc-xxxxxx
</span></span></code></pre></div><ul><li><code>chunks_head</code>, <code>wal</code>, <code>snapshots</code> ë“± TSDB êµ¬ì¡°ê°€ ë³´ì´ë©´ ì •ìƒ</li></ul><hr><h2 id=8-nfsëŠ”-ì–´ë””ì—-ì“°ë‚˜--ê´€ì¸¡-ìŠ¤íƒ-ë‚˜ë¨¸ì§€pvc-ì „ëµ>8ï¸âƒ£ NFSëŠ” ì–´ë””ì— ì“°ë‚˜? â€” ê´€ì¸¡ ìŠ¤íƒ ë‚˜ë¨¸ì§€(PVC) ì „ëµ<a hidden class=anchor aria-hidden=true href=#8-nfsëŠ”-ì–´ë””ì—-ì“°ë‚˜--ê´€ì¸¡-ìŠ¤íƒ-ë‚˜ë¨¸ì§€pvc-ì „ëµ>#</a></h2><h3 id=8-1-nfs-ë™ì -í”„ë¡œë¹„ì €ë„ˆ-observability-ì „ìš©>8-1. NFS ë™ì  í”„ë¡œë¹„ì €ë„ˆ (observability ì „ìš©)<a hidden class=anchor aria-hidden=true href=#8-1-nfs-ë™ì -í”„ë¡œë¹„ì €ë„ˆ-observability-ì „ìš©>#</a></h3><p>Loki/Promtail, Grafana, Alertmanager ë“± <strong>ë¡œê·¸/ëŒ€ì‹œë³´ë“œ ê³„ì—´</strong>ì€</p><p>ê³µìœ  ìŠ¤í† ë¦¬ì§€ê°€ í¸í•´ì„œ NFSë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade --install nfs-prov <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -n storage <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set nfs.server<span style=color:#f92672>=</span>192.168.18.141 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set nfs.path<span style=color:#f92672>=</span>/mnt/nfs_share/mlops/observability <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set storageClass.name<span style=color:#f92672>=</span>nfs-observability <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set storageClass.defaultClass<span style=color:#f92672>=</span>false <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set storageClass.accessModes<span style=color:#f92672>=</span>ReadWriteMany
</span></span></code></pre></div><p>â†’ <code>nfs-observability</code> ë¼ëŠ” StorageClass ìƒì„±</p><p>â†’ Loki / Grafana / Alertmanager / ê¸°íƒ€ ë¡œê·¸ì„± PVì— ì‚¬ìš©</p><h3 id=8-2-monitoring-ìŠ¤íƒì—ì„œ-nfs-ì‚¬ìš©í•˜ëŠ”-ì˜ì—­>8-2. Monitoring ìŠ¤íƒì—ì„œ NFS ì‚¬ìš©í•˜ëŠ” ì˜ì—­<a hidden class=anchor aria-hidden=true href=#8-2-monitoring-ìŠ¤íƒì—ì„œ-nfs-ì‚¬ìš©í•˜ëŠ”-ì˜ì—­>#</a></h3><ul><li>Grafana: ëŒ€ì‹œë³´ë“œ/ì„¤ì •</li><li>Alertmanager: ì•ŒëŒ íˆìŠ¤í† ë¦¬</li><li>Loki: ë¡œê·¸ ë³´ê´€</li><li>FastAPI/MLflow ë¡œê·¸ìš© PVC (ì„ íƒ)</li></ul><p>Prometheus TSDBëŠ” ì´ë¯¸ local-pathë¡œ ë¶„ë¦¬í–ˆìœ¼ë¯€ë¡œ</p><p><strong>ì½ê¸°/ì“°ê¸° ë§ì€ ì‹œê³„ì—´ì€ ë¡œì»¬, ê³µìœ ê°€ í¸í•œ ì„¤ì •/ë¡œê·¸ëŠ” NFS</strong> ë¼ëŠ” ì—­í•  ë¶„ë¦¬ê°€ ë©ë‹ˆë‹¤.</p><hr><h2 id=-mlops-ì‹¤ì „-ì—°ê²°>ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°<a hidden class=anchor aria-hidden=true href=#-mlops-ì‹¤ì „-ì—°ê²°>#</a></h2><ul><li><strong>ì‹¤í—˜ í™˜ê²½(dev)ê³¼ ìš´ì˜ í™˜ê²½(prod)ì„ ê´€ì¸¡ ë ˆë²¨ì—ì„œ ì™„ì „íˆ ë¶„ë¦¬</strong><ul><li>â€œdevì—ì„œ í•œ ì‹¤í—˜ì´ prod ê·¸ë˜í”„ì— ì„ì—¬ ë“¤ì–´ê°€ëŠ”â€ ì‚¬ê³ ë¥¼ ë¯¸ë¦¬ ì°¨ë‹¨</li></ul></li><li><strong>Prometheus TSDBë¥¼ local-pathë¡œ ë¶„ë¦¬</strong><ul><li>ë…¸ì´ì¦ˆ ë§ì€ í™˜ê²½ì—ì„œë„ <strong>ë¹ ë¥¸ ì¿¼ë¦¬ + ì•ˆì •ì ì¸ ì¢…ë£Œ</strong> í™•ë³´</li></ul></li><li><strong>NFS ê¸°ë°˜ observability ìŠ¤í† ë¦¬ì§€ ê³„ì¸µ</strong><ul><li><p>Loki/Promtail, Grafana, Alertmanagerê°€ ê³µí†µ ìŠ¤í† ë¦¬ì§€ë¥¼ ì“°ë©´ì„œë„</p><p>dev/prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë¼ë²¨ë¡œ ë…¼ë¦¬ ë¶„ë¦¬</p></li></ul></li></ul><blockquote><p>ì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ A4ì—ì„œëŠ”</p><p><strong>Loki + Promtail + Alertmanager / Grafana ì—°ë™</strong>ì„ ë‹¤ë£¨ë©´ì„œ,</p><p>â€œë¡œê·¸Â·ë©”íŠ¸ë¦­Â·ì•ŒëŒì´ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ì—ì„œ ì–´ë–»ê²Œ ë§Œë‚˜ëŠ”ì§€â€ê¹Œì§€ ì´ì–´ê°€ë©´ ì¢‹ìŠµë‹ˆë‹¤.</p></blockquote><hr><h2 id=-ì •ë¦¬>ğŸ ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#-ì •ë¦¬>#</a></h2><table><thead><tr><th>êµ¬ë¶„</th><th>ë‚´ìš©</th><th>ìƒíƒœ</th></tr></thead><tbody><tr><td>dev/prod ë©”íŠ¸ë¦­ êµì°¨ ìˆ˜ì§‘</td><td>KSM/ServiceMonitor/Kubelet ë¼ë²¨ ì •ë¦¬</td><td>âœ… í•´ê²°</td></tr><tr><td>kube-state-metrics í•„í„°ë§</td><td><code>metricRelabelings</code>ë¡œ namespace í•„í„°</td><td>âœ… ì ìš©</td></tr><tr><td>kubelet(cAdvisor) êµì°¨ ìˆ˜ì§‘</td><td><code>cAdvisorMetricRelabelings</code> ì¶”ê°€</td><td>âœ… ë¶„ë¦¬</td></tr><tr><td>stale metric</td><td>Prometheus & KSM ì¬ì‹œì‘</td><td>âœ… ì •ë¦¬</td></tr><tr><td>ì„ì‹œ Pod CrashLoop ì•ŒëŒ</td><td><code>tmp-curl</code> ì‚­ì œ</td><td>âœ… ì†ŒìŒ ì œê±°</td></tr><tr><td>Watchdog Slack ì†ŒìŒ</td><td><code>null</code> receiverë¡œ ë¶„ê¸°</td><td>âœ… ì°¨ë‹¨</td></tr><tr><td>Prometheus ìŠ¤í† ë¦¬ì§€</td><td>NFS â†’ local-path ì „í™˜</td><td>âœ… ì„±ëŠ¥/ì•ˆì •ì„± ê°œì„ </td></tr><tr><td>TSDB ìœ„ì¹˜ íŒŒì•…</td><td><code>/opt/local-path-provisioner/pvc-*</code></td><td>âœ… êµ¬ì¡° ì´í•´</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/04/><span class=title>Â« Prev</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 4ë‹¨ê³„ : Loki/Promtail ë¡œê·¸ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•]</span>
</a><a class=next href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/02/><span class=title>Next Â»</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]</span></a></nav></footer></article></main><footer class=footer><p style=margin-top:1rem>Â© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>