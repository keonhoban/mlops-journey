<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[MLOps í”Œë«í¼ Observability & Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •] | ğŸ”ï¸ MLOps Journey</title>
<meta name=keywords content><meta name=description content="ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€
â€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ 
ì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½

dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ ì •ë¦¬
Alertmanager configSecret / generated-secret ì¶©ëŒ
Instant Query ì˜¤ë¥˜(log queries are not supported) ì›ë¦¬
worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ)
tmp-curl CrashLoopBackOff
NFS Flush / Permission / fsGroup ë¬¸ì œ
SealedSecret namespace mismatch
Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ
â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬


1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ
ğŸ§© ì¦ìƒ
monitoring-dev Prometheusì—ì„œ monitoring-prod ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ"><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/05/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/05/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/05/"><meta property="og:site_name" content="ğŸ”ï¸  MLOps Journey"><meta property="og:title" content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •]"><meta property="og:description" content="ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì • ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€
â€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ 
ì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€
ğŸ¯ í•µì‹¬ ìš”ì•½ dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ ì •ë¦¬ Alertmanager configSecret / generated-secret ì¶©ëŒ Instant Query ì˜¤ë¥˜(log queries are not supported) ì›ë¦¬ worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ) tmp-curl CrashLoopBackOff NFS Flush / Permission / fsGroup ë¬¸ì œ SealedSecret namespace mismatch Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬ 1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ ğŸ§© ì¦ìƒ monitoring-dev Prometheusì—ì„œ monitoring-prod ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ"><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-02T17:10:21+09:00"><meta property="article:modified_time" content="2025-11-02T17:10:21+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[MLOps í”Œë«í¼ Observability & Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •]"><meta name=twitter:description content="ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •

ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€
â€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ 
ì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€

ğŸ¯ í•µì‹¬ ìš”ì•½

dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ ì •ë¦¬
Alertmanager configSecret / generated-secret ì¶©ëŒ
Instant Query ì˜¤ë¥˜(log queries are not supported) ì›ë¦¬
worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ)
tmp-curl CrashLoopBackOff
NFS Flush / Permission / fsGroup ë¬¸ì œ
SealedSecret namespace mismatch
Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ
â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬


1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ
ğŸ§© ì¦ìƒ
monitoring-dev Prometheusì—ì„œ monitoring-prod ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://keonhoban.github.io/mlops-journey/posts/"},{"@type":"ListItem","position":2,"name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ \u0026 í•´ê²° ê³¼ì •]","item":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/05/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ \u0026 í•´ê²° ê³¼ì •]","name":"[MLOps í”Œë«í¼ Observability \u0026 Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ \u0026 í•´ê²° ê³¼ì •]","description":"ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ \u0026amp; í•´ê²° ê³¼ì • ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€\nâ€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ \nì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ ì •ë¦¬ Alertmanager configSecret / generated-secret ì¶©ëŒ Instant Query ì˜¤ë¥˜(log queries are not supported) ì›ë¦¬ worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ) tmp-curl CrashLoopBackOff NFS Flush / Permission / fsGroup ë¬¸ì œ SealedSecret namespace mismatch Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬ 1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ ğŸ§© ì¦ìƒ monitoring-dev Prometheusì—ì„œ monitoring-prod ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ\n","keywords":[],"articleBody":"ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ \u0026 í•´ê²° ê³¼ì • ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€\nâ€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ \nì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡ êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€\nğŸ¯ í•µì‹¬ ìš”ì•½ dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ ì •ë¦¬ Alertmanager configSecret / generated-secret ì¶©ëŒ Instant Query ì˜¤ë¥˜(log queries are not supported) ì›ë¦¬ worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ) tmp-curl CrashLoopBackOff NFS Flush / Permission / fsGroup ë¬¸ì œ SealedSecret namespace mismatch Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬ 1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ ğŸ§© ì¦ìƒ monitoring-dev Prometheusì—ì„œ monitoring-prod ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ\nê·¸ë˜í”„ê°€ dev/prodê°€ ì„ì—¬ë²„ë¦¬ëŠ” í˜„ìƒì´ ë°œìƒ.\nğŸ§© ê·¼ë³¸ ì›ì¸ â‘  kube-state-metrics ë¼ë²¨ ê³µìš© ì‚¬ìš© kube-state-metrics.prometheus.monitor.additionalLabels.release â†’ dev/prod ëª¨ë‘ ê°™ì€ release ê°’ì„ ì‚¬ìš©\nâ‘¡ Prometheus serviceMonitorSelector ê°€ ê³µí†µ ë¼ë²¨ í•„í„°ë§ dev/prodë¥¼ êµ¬ë¶„í•  ê¸°ì¤€ ìì²´ê°€ ì‚¬ë¼ì§.\nğŸ§© í•´ê²° í™˜ê²½ë³„ ë¼ë²¨ ë¶„ë¦¬:\nkube-state-metrics: prometheus: monitor: additionalLabels: release: \"monitoring-dev\" Prometheusì—ë„ ë™ì¼í•œ ê¸°ì¤€:\nserviceMonitorSelector: matchLabels: release: \"monitoring-dev\" ğŸ§© ì¬ë°œ ë°©ì§€ â€œdev/prod ë¼ë²¨ì´ í™˜ê²½ëª…ì„ í¬í•¨í•˜ëŠ”ê°€?â€ â€œselector.matchLabels ê°€ í™˜ê²½ë³„ë¡œ ë‚˜ë‰˜ì–´ ìˆëŠ”ê°€?â€ GitOps ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ë°˜ë“œì‹œ í¬í•¨.\n2ï¸âƒ£ Alertmanager Secret ë¯¸ì ìš© \u0026 missing name in receiver ğŸ§© ì¦ìƒ Ingress ì ‘ê·¼ì€ ì •ìƒ Slack ë©”ì‹œì§€ê°€ ì „í˜€ ì˜¤ì§€ ì•ŠìŒ /#/status í™•ì¸ ì‹œ configê°€ ê¸°ë³¸ í…œí”Œë¦¿ ğŸ§© ì›ì¸ â‘  ì˜ëª»ëœ í‚¤ ì‚¬ìš© âŒ ì˜¤íƒ€:\nalertmanager.configFromSecret â­• ì •ë‹µ:\nalertmanager.alertmanagerSpec.configSecret â‘¡ Operatorê°€ ìë™ ìƒì„±í•˜ëŠ” generated-secret ìš°ì„  ì ìš© alertmanager--generated ê°€ configSecretë³´ë‹¤ ë¨¼ì € ì ìš©ë¨.\nâ‘¢ receivers ë¸”ë¡ì´ ë¹„ì–´ ìˆìœ¼ë©´ ì˜¤ë¥˜ missing name in receiver ğŸ§© í•´ê²° spec.alertmanagerSpec.configSecret ì‚¬ìš© receivers ì´ë¦„ì„ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê°’ìœ¼ë¡œ ì •ë¦¬ generated-secretì´ ìˆëŠ”ì§€, ë‚´ìš©ì´ ë®ì–´ì“°ì§€ ì•ŠëŠ”ì§€ í™•ì¸ ğŸ§© ì¬ë°œ ë°©ì§€ AlertmanagerëŠ” Operatorê°€ ì§€ì†ì ìœ¼ë¡œ Secretì„ ì¬ìƒì„±í•œë‹¤ëŠ” ì‚¬ì‹¤ ê¸°ì–µ receivers ì´ë¦„ì´ í…œí”Œë¦¿ ë‚´ë¶€ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í•­ìƒ ì²´í¬ 3ï¸âƒ£ Instant Query ì—ëŸ¬ log queries are not supported as an instant query type ğŸ§© ì¦ìƒ Grafana / Lokiì—ì„œ ë‹¤ìŒ ì˜¤ë¥˜ ë°œìƒ:\nlog queries are not supported as an instant query type ğŸ§© ì›ì¸ Instant Query â†’ â€œë‹¨ì¼ ì‹œì  ë©”íŠ¸ë¦­ ì¡°íšŒâ€\në¡œê·¸ â†’ ë°˜ë“œì‹œ ì‹œê°„ êµ¬ê°„ì´ í•„ìš”í•¨\nâ†’ Instant Query ê°œë… ìì²´ì™€ ì¶©ëŒ\nğŸ§© í•´ê²° Range Query ì‚¬ìš©:\ncurl -G http://loki-dev:3100/loki/api/v1/query_range \\ --data-urlencode 'query={namespace=\"fastapi-dev\"}' \\ --data-urlencode start=1732440000000000000 \\ --data-urlencode end=1732440600000000000 ğŸ§© ì¬ë°œ ë°©ì§€ ë©”íŠ¸ë¦­ = ìˆœê°„ ë°ì´í„°\në¡œê·¸ = êµ¬ê°„ ë°ì´í„°\nì´ ê°œë…ë§Œ ê¸°ì–µí•˜ë©´ ë.\n4ï¸âƒ£ worker2 ì¢…ë£Œ ì§€ì—° (ì•½ 30â€“40ì´ˆ) ğŸ§© ì¦ìƒ worker2ë§Œ ì¢…ë£Œê°€ 30~40ì´ˆ ì§€ì—°ë¨.\nğŸ§© ì›ì¸ Promtail DaemonSetì´ NFS ì–¸ë§ˆìš´íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ë©´ì„œ ì§€ì—° NFS Flush ì‹œê°„ì´ ê¸¸ë©´ graceful timeout ì¦ê°€ ğŸ§© í•´ê²° terminationGracePeriodSeconds: 10 ğŸ§© ì¬ë°œ ë°©ì§€ Promtailì´ NFS ê¸°ë°˜ positions.yaml ì„ ì“¸ ê²½ìš°\nterminationGracePeriodSeconds ìµœì†Œí™” í•„ìˆ˜.\n5ï¸âƒ£ tmp-curl CrashLoopBackOff ğŸ§© ì¦ìƒ tmp-curl-* Podê°€ CrashLoopBackOff ë°˜ë³µ\nğŸ§© ì›ì¸ kube-prometheus-stackê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ìš© curl Pod TLS/Ingress ì™„ì„± ì „ì—ëŠ” readiness ì‹¤íŒ¨ë¡œ crash ğŸ§© í•´ê²° Ingress/TLS êµ¬ì¶• ì¤‘ ì ì‹œ ë°œìƒí•˜ëŠ” ì •ìƒ í˜„ìƒ êµ¬ì¡°ê°€ ì™„ì„±ë˜ë©´ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§ ğŸ§© ì¬ë°œ ë°©ì§€ ì´ PodëŠ” ì˜¤ë¥˜ê°€ ì•„ë‹ˆë¼ â€œìŠ¤íƒ ì¤€ë¹„ ì¤‘â€ì„ ì˜ë¯¸ ë¬¸ì„œí™”ë§Œ í•´ë‘ë©´ ë¬¸ì œ ì—†ìŒ 6ï¸âƒ£ FastAPI / NFS ê¶Œí•œ ë¬¸ì œ (PermissionError) ğŸ§© ì¦ìƒ FastAPI ë¡œê·¸:\nPermissionError: [Errno 13] Permission denied: '/app/logs' ğŸ§© ì›ì¸ NFSì—ì„œ root_squash ì ìš© â†’ runAsUser ë³€í™˜ Podì˜ securityContextì™€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ Permission ì˜¤ë¥˜ ë°œìƒ ğŸ§© í•´ê²° FastAPI Deployment:\nsecurityContext: fsGroup: 1000 runAsUser: 1000 NFS ì„œë²„ ë””ë ‰í† ë¦¬:\nchmod 0777 -R /mnt/nfs_share/mlops/fastapi ğŸ§© ì¬ë°œ ë°©ì§€ NFS + ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ êµ¬ì¡° = ë¬´ì¡°ê±´ fsGroup í•„ìš” 7ï¸âƒ£ Prometheus TSDB â†’ local-path ì „í™˜ ğŸ§© ì¦ìƒ Prometheus TSDB ì“°ê¸° ì§€ì—° / scrape ì§€ì—° / CPU ë¶€í•˜ ì¦ê°€\nâ†’ NFS ê¸°ë°˜ TSDBì™€ ë³‘ëª©ì´ ë§ì§€ ì•ŠìŒ\nğŸ§© ê·¼ë³¸ ì›ì¸ Prometheus TSDBëŠ” ê³  IOPS + ì €ì§€ì—° í•„ìˆ˜\nâ†’ NFSëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ë¶€ì í•©\nğŸ§© í•´ê²° local-path StorageClass ì‚¬ìš©:\nstorageClassName: local-path í•„ìˆ˜ ì¡°ì¹˜:\nkubectl scale sts prometheus --replicas=0 kubectl delete pvc kubectl scale sts prometheus --replicas=1 ğŸ§© ì¬ë°œ ë°©ì§€ Prometheusë§Œ local-path Grafana / Loki / AlertmanagerëŠ” NFSë¡œ ìœ ì§€ 8ï¸âƒ£ SealedSecret namespace mismatch ğŸ§© ì¦ìƒ ArgoCDì—ì„œ SealedSecretì´ ì •ìƒ ì ìš©ëë‹¤ê³  ë‚˜ì˜¤ëŠ”ë°\nSecret ìì²´ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ.\nğŸ§© ì›ì¸ SealedSecret.metadata.namespace\nâ‰ \nSecret.metadata.namespace\nâ†’ namespace mismatchë¡œ ìƒì„±ë˜ì§€ ì•ŠìŒ.\nğŸ§© í•´ê²° êµ¬ì¡° í†µì¼:\nmetadata: namespace: monitoring-dev ğŸ§© ì¬ë°œ ë°©ì§€ SealedSecretì€ ìµœì¢… Secretì´ ì¡´ì¬í•  namespaceì™€ ë°˜ë“œì‹œ ë™ì¼í•´ì•¼ í•¨.\n9ï¸âƒ£ ìš´ì˜ ì¤‘ ìì£¼ í—·ê°ˆë¦° í¬ì¸íŠ¸ ì •ë¦¬ NFS ìˆ˜ë°± ê°œ ë””ë ‰í„°ë¦¬ ìë™ ìƒì„± ë°©ì§€ â†’ archiveOnDelete=true Promtail positions.yaml ì˜¤ì—¼ ë°©ì§€ â†’ dev/prod PVC ë¶„ë¦¬ Alertmanager generated-secret ì‚­ì œ ê¸ˆì§€ â†’ Operatorê°€ ì¬ìƒì„± Loki ì¿¼ë¦¬ ëŠë¦´ ë•Œ â†’ ì‹œê°„ ë²”ìœ„ / ë¼ë²¨ ì¡°í•©ì´ ê³¼ë„í•œ ê²½ìš°ê°€ ëŒ€ë¶€ë¶„ ğŸ”§ MLOps ì‹¤ì „ ì—°ê²° ë¡œê·¸/ì•ŒëŒ ê¸°ë°˜ìœ¼ë¡œ ë°°í¬ ì‹¤íŒ¨ â†’ ì¦‰ì‹œ Slack ì•Œë¦¼ â†’ ìë™ A/B ë¡¤ë°± ì‹œë‚˜ë¦¬ì˜¤ê¹Œì§€ í™•ì¥ ê°€ëŠ¥\nFastAPI ì˜¤ë¥˜ ë¡œê·¸ ê¸°ë°˜ Canary ê²€ì¦ ë¡œì§ êµ¬í˜„ ê°€ëŠ¥\nAirflow â†’ MLflow â†’ FastAPI â†’ Loki â†’ Alertmanager â†’ Slack\nì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ìš´ì˜/ê´€ì¸¡ ì‹œê°ì—ì„œ ê¹Šì´ ì´í•´í•œ ë‹¨ê³„\nğŸ ì •ë¦¬ í•­ëª© ìƒíƒœ dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë© í•´ê²° Alertmanager configSecret ë¬¸ì œ í•´ê²° Loki Instant Query ì˜¤ë¥˜ ì›ë¦¬ê¹Œì§€ ì´í•´ Worker ì¢…ë£Œ ì§€ì—° í•´ê²° tmp-curl CrashLoopBackOff ì •ìƒ í˜„ìƒ FastAPI NFS ê¶Œí•œ ë¬¸ì œ í•´ê²° Prometheus TSDB local-path ì „í™˜ ì™„ë£Œ SealedSecret namespace mismatch í•´ê²° ","wordCount":"761","inLanguage":"en","datePublished":"2025-11-02T17:10:21+09:00","dateModified":"2025-11-02T17:10:21+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/05/"},"publisher":{"@type":"Organization","name":"ğŸ”ï¸  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="ğŸ”ï¸  MLOps Journey (Alt + H)">ğŸ”ï¸ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="ğŸ  Home"><span>ğŸ  Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="ğŸ“‚ Projects"><span>ğŸ“‚ Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="ğŸ“ Blog"><span>ğŸ“ Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="ğŸ§— About"><span>ğŸ§— About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="ğŸ“– Categories"><span>ğŸ“– Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;Â»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">[MLOps í”Œë«í¼ Observability & Data Pipeline - 5ë‹¨ê³„ : ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •]</h1><div class=post-meta><span title='2025-11-02 17:10:21 +0900 +0900'>November 2, 2025</span>&nbsp;Â·&nbsp;4 min</div></header><div class=post-content><h2 id=ìš´ì˜-ì¤‘-ë°œìƒí•œ-ì‹¤ì œ-ì´ìŠˆ--í•´ê²°-ê³¼ì •>ìš´ì˜ ì¤‘ ë°œìƒí•œ ì‹¤ì œ ì´ìŠˆ & í•´ê²° ê³¼ì •<a hidden class=anchor aria-hidden=true href=#ìš´ì˜-ì¤‘-ë°œìƒí•œ-ì‹¤ì œ-ì´ìŠˆ--í•´ê²°-ê³¼ì •>#</a></h2><hr><h1 id=-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…<a hidden class=anchor aria-hidden=true href=#-ì‹œë‚˜ë¦¬ì˜¤-ì„¤ëª…>#</a></h1><blockquote><p>â€œê´€ì¸¡Â·ì•Œë¦¼Â·ë¡œê·¸ ì‹œìŠ¤í…œì€ ì„¸íŒ…ë³´ë‹¤ ìš´ì˜ ì´í›„ê°€ ì§„ì§œ ì‹œì‘ì…ë‹ˆë‹¤.â€</p><p>â€œì‹¤ìš´ì˜ í™˜ê²½ì—ì„œ ë°˜ë“œì‹œ ë§ˆì£¼ì¹˜ëŠ” ë¬¸ì œë“¤(div/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©, Alertmanager ì¶©ëŒ, NFS ê¶Œí•œ, TSDB ë³‘ëª© ë“±)ì„ ì •ë¦¬í•˜ê³ </p><p><strong>ì™œ ë¬¸ì œê°€ ìƒê²¼ëŠ”ì§€ â†’ ì–´ë–»ê²Œ í•´ê²°í–ˆëŠ”ì§€ â†’ ë‹¤ì‹œëŠ” ë°˜ë³µë˜ì§€ ì•Šë„ë¡</strong> êµ¬ì¡° ìì²´ë¥¼ ì¡ì•„ì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.â€</p></blockquote><hr><h2 id=-í•µì‹¬-ìš”ì•½>ğŸ¯ í•µì‹¬ ìš”ì•½<a hidden class=anchor aria-hidden=true href=#-í•µì‹¬-ìš”ì•½>#</a></h2><ul><li>dev/prod <strong>í¬ë¡œìŠ¤ ìŠ¤í¬ë© ë¬¸ì œ</strong> ì •ë¦¬</li><li>Alertmanager configSecret / generated-secret ì¶©ëŒ</li><li>Instant Query ì˜¤ë¥˜(<code>log queries are not supported</code>) ì›ë¦¬</li><li>worker2 ì¢…ë£Œ ì§€ì—°(30~40ì´ˆ)</li><li>tmp-curl CrashLoopBackOff</li><li>NFS Flush / Permission / fsGroup ë¬¸ì œ</li><li>SealedSecret namespace mismatch</li><li>Prometheus TSDB â†’ local-path ì „í™˜ ì‹œ ë°œìƒ ê°€ëŠ¥í•œ ì´ìŠˆ</li><li><strong>â€œë¬¸ì œ â†’ ì›ì¸ â†’ í•´ê²° â†’ ì¬ë°œ ë°©ì§€â€ êµ¬ì¡°ë¡œ ì •ë¦¬</strong></li></ul><hr><h2 id=1-devprod-cross-scrape-ë¬¸ì œ>1ï¸âƒ£ dev/prod Cross-Scrape ë¬¸ì œ<a hidden class=anchor aria-hidden=true href=#1-devprod-cross-scrape-ë¬¸ì œ>#</a></h2><h3 id=-ì¦ìƒ>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ>#</a></h3><p><code>monitoring-dev</code> Prometheusì—ì„œ <code>monitoring-prod</code> ë©”íŠ¸ë¦­ê¹Œì§€ ë³´ì—¬ì„œ</p><p>ê·¸ë˜í”„ê°€ dev/prodê°€ ì„ì—¬ë²„ë¦¬ëŠ” í˜„ìƒì´ ë°œìƒ.</p><h3 id=-ê·¼ë³¸-ì›ì¸>ğŸ§© ê·¼ë³¸ ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ê·¼ë³¸-ì›ì¸>#</a></h3><h3 id=-kube-state-metrics-ë¼ë²¨-ê³µìš©-ì‚¬ìš©>â‘  kube-state-metrics ë¼ë²¨ ê³µìš© ì‚¬ìš©<a hidden class=anchor aria-hidden=true href=#-kube-state-metrics-ë¼ë²¨-ê³µìš©-ì‚¬ìš©>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>kube-state-metrics.prometheus.monitor.additionalLabels.release</span>
</span></span></code></pre></div><p>â†’ dev/prod ëª¨ë‘ ê°™ì€ <code>release</code> ê°’ì„ ì‚¬ìš©</p><h3 id=-prometheus-servicemonitorselector-ê°€-ê³µí†µ-ë¼ë²¨-í•„í„°ë§>â‘¡ Prometheus serviceMonitorSelector ê°€ ê³µí†µ ë¼ë²¨ í•„í„°ë§<a hidden class=anchor aria-hidden=true href=#-prometheus-servicemonitorselector-ê°€-ê³µí†µ-ë¼ë²¨-í•„í„°ë§>#</a></h3><p>dev/prodë¥¼ êµ¬ë¶„í•  ê¸°ì¤€ ìì²´ê°€ ì‚¬ë¼ì§.</p><h3 id=-í•´ê²°>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°>#</a></h3><p>í™˜ê²½ë³„ ë¼ë²¨ ë¶„ë¦¬:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>kube-state-metrics</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>prometheus</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>monitor</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>additionalLabels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>release</span>: <span style=color:#e6db74>&#34;monitoring-dev&#34;</span>
</span></span></code></pre></div><p>Prometheusì—ë„ ë™ì¼í•œ ê¸°ì¤€:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>serviceMonitorSelector</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>release</span>: <span style=color:#e6db74>&#34;monitoring-dev&#34;</span>
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€>#</a></h3><ul><li>â€œdev/prod ë¼ë²¨ì´ í™˜ê²½ëª…ì„ í¬í•¨í•˜ëŠ”ê°€?â€</li><li>â€œselector.matchLabels ê°€ í™˜ê²½ë³„ë¡œ ë‚˜ë‰˜ì–´ ìˆëŠ”ê°€?â€</li></ul><p>GitOps ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸ì— ë°˜ë“œì‹œ í¬í•¨.</p><hr><h2 id=2-alertmanager-secret-ë¯¸ì ìš©--missing-name-in-receiver>2ï¸âƒ£ Alertmanager Secret ë¯¸ì ìš© & <code>missing name in receiver</code><a hidden class=anchor aria-hidden=true href=#2-alertmanager-secret-ë¯¸ì ìš©--missing-name-in-receiver>#</a></h2><h3 id=-ì¦ìƒ-1>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-1>#</a></h3><ul><li>Ingress ì ‘ê·¼ì€ ì •ìƒ</li><li>Slack ë©”ì‹œì§€ê°€ ì „í˜€ ì˜¤ì§€ ì•ŠìŒ</li><li><code>/#/status</code> í™•ì¸ ì‹œ configê°€ ê¸°ë³¸ í…œí”Œë¦¿</li></ul><h3 id=-ì›ì¸>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸>#</a></h3><h3 id=-ì˜ëª»ëœ-í‚¤-ì‚¬ìš©>â‘  ì˜ëª»ëœ í‚¤ ì‚¬ìš©<a hidden class=anchor aria-hidden=true href=#-ì˜ëª»ëœ-í‚¤-ì‚¬ìš©>#</a></h3><p>âŒ ì˜¤íƒ€:</p><pre tabindex=0><code>alertmanager.configFromSecret
</code></pre><p>â­• ì •ë‹µ:</p><pre tabindex=0><code>alertmanager.alertmanagerSpec.configSecret
</code></pre><h3 id=-operatorê°€-ìë™-ìƒì„±í•˜ëŠ”-generated-secret-ìš°ì„ -ì ìš©>â‘¡ Operatorê°€ ìë™ ìƒì„±í•˜ëŠ” generated-secret ìš°ì„  ì ìš©<a hidden class=anchor aria-hidden=true href=#-operatorê°€-ìë™-ìƒì„±í•˜ëŠ”-generated-secret-ìš°ì„ -ì ìš©>#</a></h3><p><code>alertmanager-&lt;name>-generated</code> ê°€ configSecretë³´ë‹¤ ë¨¼ì € ì ìš©ë¨.</p><h3 id=-receivers-ë¸”ë¡ì´-ë¹„ì–´-ìˆìœ¼ë©´-ì˜¤ë¥˜>â‘¢ receivers ë¸”ë¡ì´ ë¹„ì–´ ìˆìœ¼ë©´ ì˜¤ë¥˜<a hidden class=anchor aria-hidden=true href=#-receivers-ë¸”ë¡ì´-ë¹„ì–´-ìˆìœ¼ë©´-ì˜¤ë¥˜>#</a></h3><pre tabindex=0><code>missing name in receiver
</code></pre><h3 id=-í•´ê²°-1>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-1>#</a></h3><ul><li><code>spec.alertmanagerSpec.configSecret</code> ì‚¬ìš©</li><li>receivers ì´ë¦„ì„ ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ê°’ìœ¼ë¡œ ì •ë¦¬</li><li>generated-secretì´ ìˆëŠ”ì§€, ë‚´ìš©ì´ ë®ì–´ì“°ì§€ ì•ŠëŠ”ì§€ í™•ì¸</li></ul><h3 id=-ì¬ë°œ-ë°©ì§€-1>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-1>#</a></h3><ul><li>AlertmanagerëŠ” Operatorê°€ ì§€ì†ì ìœ¼ë¡œ Secretì„ ì¬ìƒì„±í•œë‹¤ëŠ” ì‚¬ì‹¤ ê¸°ì–µ</li><li>receivers ì´ë¦„ì´ í…œí”Œë¦¿ ë‚´ë¶€ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í•­ìƒ ì²´í¬</li></ul><hr><h2 id=3-instant-query-ì—ëŸ¬>3ï¸âƒ£ Instant Query ì—ëŸ¬<a hidden class=anchor aria-hidden=true href=#3-instant-query-ì—ëŸ¬>#</a></h2><h3 id=log-queries-are-not-supported-as-an-instant-query-type><code>log queries are not supported as an instant query type</code><a hidden class=anchor aria-hidden=true href=#log-queries-are-not-supported-as-an-instant-query-type>#</a></h3><h3 id=-ì¦ìƒ-2>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-2>#</a></h3><p>Grafana / Lokiì—ì„œ ë‹¤ìŒ ì˜¤ë¥˜ ë°œìƒ:</p><pre tabindex=0><code>log queries are not supported as an instant query type
</code></pre><h3 id=-ì›ì¸-1>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸-1>#</a></h3><ul><li><p>Instant Query â†’ â€œë‹¨ì¼ ì‹œì  ë©”íŠ¸ë¦­ ì¡°íšŒâ€</p></li><li><p>ë¡œê·¸ â†’ <strong>ë°˜ë“œì‹œ ì‹œê°„ êµ¬ê°„</strong>ì´ í•„ìš”í•¨</p><p>â†’ Instant Query ê°œë… ìì²´ì™€ ì¶©ëŒ</p></li></ul><h3 id=-í•´ê²°-2>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-2>#</a></h3><p>Range Query ì‚¬ìš©:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -G http://loki-dev:3100/loki/api/v1/query_range <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode <span style=color:#e6db74>&#39;query={namespace=&#34;fastapi-dev&#34;}&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode start<span style=color:#f92672>=</span><span style=color:#ae81ff>1732440000000000000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --data-urlencode end<span style=color:#f92672>=</span><span style=color:#ae81ff>1732440600000000000</span>
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€-2>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-2>#</a></h3><ul><li><p>ë©”íŠ¸ë¦­ = ìˆœê°„ ë°ì´í„°</p></li><li><p>ë¡œê·¸ = êµ¬ê°„ ë°ì´í„°</p><p>ì´ ê°œë…ë§Œ ê¸°ì–µí•˜ë©´ ë.</p></li></ul><hr><h2 id=4-worker2-ì¢…ë£Œ-ì§€ì—°-ì•½-3040ì´ˆ>4ï¸âƒ£ worker2 ì¢…ë£Œ ì§€ì—° (ì•½ 30â€“40ì´ˆ)<a hidden class=anchor aria-hidden=true href=#4-worker2-ì¢…ë£Œ-ì§€ì—°-ì•½-3040ì´ˆ>#</a></h2><h3 id=-ì¦ìƒ-3>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-3>#</a></h3><p>worker2ë§Œ ì¢…ë£Œê°€ 30~40ì´ˆ ì§€ì—°ë¨.</p><h3 id=-ì›ì¸-2>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸-2>#</a></h3><ul><li>Promtail DaemonSetì´ NFS ì–¸ë§ˆìš´íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ë©´ì„œ ì§€ì—°</li><li>NFS Flush ì‹œê°„ì´ ê¸¸ë©´ graceful timeout ì¦ê°€</li></ul><h3 id=-í•´ê²°-3>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-3>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>terminationGracePeriodSeconds</span>: <span style=color:#ae81ff>10</span>
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€-3>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-3>#</a></h3><p>Promtailì´ NFS ê¸°ë°˜ positions.yaml ì„ ì“¸ ê²½ìš°</p><p>terminationGracePeriodSeconds ìµœì†Œí™” í•„ìˆ˜.</p><hr><h2 id=5-tmp-curl-crashloopbackoff>5ï¸âƒ£ tmp-curl CrashLoopBackOff<a hidden class=anchor aria-hidden=true href=#5-tmp-curl-crashloopbackoff>#</a></h2><h3 id=-ì¦ìƒ-4>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-4>#</a></h3><p><code>tmp-curl-*</code> Podê°€ CrashLoopBackOff ë°˜ë³µ</p><h3 id=-ì›ì¸-3>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸-3>#</a></h3><ul><li>kube-prometheus-stackê°€ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í…ŒìŠ¤íŠ¸ìš© curl Pod</li><li>TLS/Ingress ì™„ì„± ì „ì—ëŠ” readiness ì‹¤íŒ¨ë¡œ crash</li></ul><h3 id=-í•´ê²°-4>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-4>#</a></h3><ul><li>Ingress/TLS êµ¬ì¶• ì¤‘ ì ì‹œ ë°œìƒí•˜ëŠ” ì •ìƒ í˜„ìƒ</li><li>êµ¬ì¡°ê°€ ì™„ì„±ë˜ë©´ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§</li></ul><h3 id=-ì¬ë°œ-ë°©ì§€-4>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-4>#</a></h3><ul><li>ì´ PodëŠ” ì˜¤ë¥˜ê°€ ì•„ë‹ˆë¼ â€œìŠ¤íƒ ì¤€ë¹„ ì¤‘â€ì„ ì˜ë¯¸</li><li>ë¬¸ì„œí™”ë§Œ í•´ë‘ë©´ ë¬¸ì œ ì—†ìŒ</li></ul><hr><h2 id=6-fastapi--nfs-ê¶Œí•œ-ë¬¸ì œ-permissionerror>6ï¸âƒ£ FastAPI / NFS ê¶Œí•œ ë¬¸ì œ (PermissionError)<a hidden class=anchor aria-hidden=true href=#6-fastapi--nfs-ê¶Œí•œ-ë¬¸ì œ-permissionerror>#</a></h2><h3 id=-ì¦ìƒ-5>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-5>#</a></h3><p>FastAPI ë¡œê·¸:</p><pre tabindex=0><code>PermissionError: [Errno 13] Permission denied: &#39;/app/logs&#39;
</code></pre><h3 id=-ì›ì¸-4>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸-4>#</a></h3><ul><li>NFSì—ì„œ root_squash ì ìš© â†’ runAsUser ë³€í™˜</li><li>Podì˜ securityContextì™€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ Permission ì˜¤ë¥˜ ë°œìƒ</li></ul><h3 id=-í•´ê²°-5>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-5>#</a></h3><p>FastAPI Deployment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>securityContext</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>fsGroup</span>: <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runAsUser</span>: <span style=color:#ae81ff>1000</span>
</span></span></code></pre></div><p>NFS ì„œë²„ ë””ë ‰í† ë¦¬:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#ae81ff>0777</span> -R /mnt/nfs_share/mlops/fastapi
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€-5>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-5>#</a></h3><ul><li>NFS + ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ êµ¬ì¡° = <strong>ë¬´ì¡°ê±´ fsGroup í•„ìš”</strong></li></ul><hr><h2 id=7-prometheus-tsdb--local-path-ì „í™˜>7ï¸âƒ£ Prometheus TSDB â†’ local-path ì „í™˜<a hidden class=anchor aria-hidden=true href=#7-prometheus-tsdb--local-path-ì „í™˜>#</a></h2><h3 id=-ì¦ìƒ-6>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-6>#</a></h3><p>Prometheus TSDB ì“°ê¸° ì§€ì—° / scrape ì§€ì—° / CPU ë¶€í•˜ ì¦ê°€</p><p>â†’ NFS ê¸°ë°˜ TSDBì™€ ë³‘ëª©ì´ ë§ì§€ ì•ŠìŒ</p><h3 id=-ê·¼ë³¸-ì›ì¸-1>ğŸ§© ê·¼ë³¸ ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ê·¼ë³¸-ì›ì¸-1>#</a></h3><p>Prometheus TSDBëŠ” ê³  IOPS + ì €ì§€ì—° í•„ìˆ˜</p><p>â†’ NFSëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ë¶€ì í•©</p><h3 id=-í•´ê²°-6>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-6>#</a></h3><p>local-path StorageClass ì‚¬ìš©:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>storageClassName</span>: <span style=color:#ae81ff>local-path</span>
</span></span></code></pre></div><p>í•„ìˆ˜ ì¡°ì¹˜:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl scale sts prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>kubectl delete pvc &lt;prometheus-pvc&gt;
</span></span><span style=display:flex><span>kubectl scale sts prometheus --replicas<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€-6>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-6>#</a></h3><ul><li>Prometheusë§Œ local-path</li><li>Grafana / Loki / AlertmanagerëŠ” NFSë¡œ ìœ ì§€</li></ul><hr><h2 id=8-sealedsecret-namespace-mismatch>8ï¸âƒ£ SealedSecret namespace mismatch<a hidden class=anchor aria-hidden=true href=#8-sealedsecret-namespace-mismatch>#</a></h2><h3 id=-ì¦ìƒ-7>ğŸ§© ì¦ìƒ<a hidden class=anchor aria-hidden=true href=#-ì¦ìƒ-7>#</a></h3><p>ArgoCDì—ì„œ SealedSecretì´ ì •ìƒ ì ìš©ëë‹¤ê³  ë‚˜ì˜¤ëŠ”ë°</p><p>Secret ìì²´ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ.</p><h3 id=-ì›ì¸-5>ğŸ§© ì›ì¸<a hidden class=anchor aria-hidden=true href=#-ì›ì¸-5>#</a></h3><p>SealedSecret.metadata.namespace</p><p>â‰ </p><p>Secret.metadata.namespace</p><p>â†’ namespace mismatchë¡œ ìƒì„±ë˜ì§€ ì•ŠìŒ.</p><h3 id=-í•´ê²°-7>ğŸ§© í•´ê²°<a hidden class=anchor aria-hidden=true href=#-í•´ê²°-7>#</a></h3><p>êµ¬ì¡° í†µì¼:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring-dev</span>
</span></span></code></pre></div><h3 id=-ì¬ë°œ-ë°©ì§€-7>ğŸ§© ì¬ë°œ ë°©ì§€<a hidden class=anchor aria-hidden=true href=#-ì¬ë°œ-ë°©ì§€-7>#</a></h3><p>SealedSecretì€ ìµœì¢… Secretì´ ì¡´ì¬í•  namespaceì™€ ë°˜ë“œì‹œ ë™ì¼í•´ì•¼ í•¨.</p><hr><h2 id=9-ìš´ì˜-ì¤‘-ìì£¼-í—·ê°ˆë¦°-í¬ì¸íŠ¸-ì •ë¦¬>9ï¸âƒ£ ìš´ì˜ ì¤‘ ìì£¼ í—·ê°ˆë¦° í¬ì¸íŠ¸ ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#9-ìš´ì˜-ì¤‘-ìì£¼-í—·ê°ˆë¦°-í¬ì¸íŠ¸-ì •ë¦¬>#</a></h2><ul><li>NFS ìˆ˜ë°± ê°œ ë””ë ‰í„°ë¦¬ ìë™ ìƒì„± ë°©ì§€ â†’ <code>archiveOnDelete=true</code></li><li>Promtail positions.yaml ì˜¤ì—¼ ë°©ì§€ â†’ dev/prod PVC ë¶„ë¦¬</li><li>Alertmanager generated-secret ì‚­ì œ ê¸ˆì§€ â†’ Operatorê°€ ì¬ìƒì„±</li><li>Loki ì¿¼ë¦¬ ëŠë¦´ ë•Œ â†’ ì‹œê°„ ë²”ìœ„ / ë¼ë²¨ ì¡°í•©ì´ ê³¼ë„í•œ ê²½ìš°ê°€ ëŒ€ë¶€ë¶„</li></ul><hr><h2 id=-mlops-ì‹¤ì „-ì—°ê²°>ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°<a hidden class=anchor aria-hidden=true href=#-mlops-ì‹¤ì „-ì—°ê²°>#</a></h2><ul><li><p>ë¡œê·¸/ì•ŒëŒ ê¸°ë°˜ìœ¼ë¡œ <strong>ë°°í¬ ì‹¤íŒ¨ â†’ ì¦‰ì‹œ Slack ì•Œë¦¼ â†’ ìë™ A/B ë¡¤ë°±</strong> ì‹œë‚˜ë¦¬ì˜¤ê¹Œì§€ í™•ì¥ ê°€ëŠ¥</p></li><li><p>FastAPI ì˜¤ë¥˜ ë¡œê·¸ ê¸°ë°˜ Canary ê²€ì¦ ë¡œì§ êµ¬í˜„ ê°€ëŠ¥</p></li><li><p>Airflow â†’ MLflow â†’ FastAPI â†’ Loki â†’ Alertmanager â†’ Slack</p><p>ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ìš´ì˜/ê´€ì¸¡ ì‹œê°ì—ì„œ ê¹Šì´ ì´í•´í•œ ë‹¨ê³„</p></li></ul><hr><h2 id=-ì •ë¦¬>ğŸ ì •ë¦¬<a hidden class=anchor aria-hidden=true href=#-ì •ë¦¬>#</a></h2><table><thead><tr><th>í•­ëª©</th><th>ìƒíƒœ</th></tr></thead><tbody><tr><td>dev/prod í¬ë¡œìŠ¤ ìŠ¤í¬ë©</td><td>í•´ê²°</td></tr><tr><td>Alertmanager configSecret ë¬¸ì œ</td><td>í•´ê²°</td></tr><tr><td>Loki Instant Query ì˜¤ë¥˜</td><td>ì›ë¦¬ê¹Œì§€ ì´í•´</td></tr><tr><td>Worker ì¢…ë£Œ ì§€ì—°</td><td>í•´ê²°</td></tr><tr><td>tmp-curl CrashLoopBackOff</td><td>ì •ìƒ í˜„ìƒ</td></tr><tr><td>FastAPI NFS ê¶Œí•œ ë¬¸ì œ</td><td>í•´ê²°</td></tr><tr><td>Prometheus TSDB local-path ì „í™˜</td><td>ì™„ë£Œ</td></tr><tr><td>SealedSecret namespace mismatch</td><td>í•´ê²°</td></tr></tbody></table></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/06/><span class=title>Â« Prev</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 6ë‹¨ê³„ : FastAPI Observability Dashboard & Alert Library]</span>
</a><a class=next href=https://keonhoban.github.io/mlops-journey/posts/mlops-platform-observability/04/><span class=title>Next Â»</span><br><span>[MLOps í”Œë«í¼ Observability & Data Pipeline - 4ë‹¨ê³„ : Loki/Promtail ë¡œê·¸ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•]</span></a></nav></footer></article></main><footer class=footer><p style=margin-top:1rem>Â© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>