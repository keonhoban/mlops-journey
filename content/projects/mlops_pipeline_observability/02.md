+++
date = '2025-11-26T17:10:21+09:00'
draft = false
title = '[MLOps í”Œë«í¼ Observability & Data Pipeline - ê²€ì¦]'
categories = ['Observability', 'FastAPI', 'Data Pipeline', 'Proof of Observability', 'GitOps(ArgoCD)', 'Kubernetes', 'Prometheus', 'Loki', 'Grafana', 'Airflow', 'AWS S3', 'Slack']
+++

## ğŸ§­ ëª©ì°¨

| êµ¬ë¶„ | ì¦ëª… í¬ì¸íŠ¸ |
| --- | --- |
| **A. Observability** | ë©”íŠ¸ë¦­Â·ë¡œê·¸Â·ì•ŒëŒ dev/prod ì™„ì „ ë¶„ë¦¬ |
| **B. FastAPI Observability** | RPSÂ·p95Â·ì—ëŸ¬Â·ë¡œê·¸ íŒ¨ë„ ì •ìƒ ë™ì‘ |
| **C. Data Pipeline** | Rawâ†’Feature ETL ìë™ ì‹¤í–‰ ì„±ê³µ |
| **D. Data Pipeline Advanced** | ë²„ì „Â·ìŠ¤í‚¤ë§ˆÂ·ë©”íƒ€ë°ì´í„°Â·ê´€ì¸¡ ë“± ìš´ì˜í˜• êµ¬ì¡° |

---

# A. Observability ê³„ì¸µ

Observability ê³„ì¸µ(ëª¨ë‹ˆí„°ë§ + ë¡œê·¸ ìˆ˜ì§‘ + ì•ŒëŒ)ì´

**GitOps ê¸°ë°˜ìœ¼ë¡œ dev/prod ì™„ì „ ë¶„ë¦¬ + ìë™í™”** ë˜ì–´ ìˆìŒì„ ì¦ëª…í•©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ ArgoCD Applications (GitOps ê¸°ë°˜ êµ¬ì„±)

### âœ” 1-1. CLIë¡œ ì „ì²´ Application ìƒíƒœ í™•ì¸

```bash
kubectl -n argocd get applications
```

![proof-01-01-argocd-all-status-cmd.png](/mlops-journey/images/proof-01-01-argocd-all-status-cmd.png)

ğŸ“¸ **proof-01-01-argocd-all-status-cmd.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `airflow-dev/prod`
- `fastapi-dev/prod`
- `mlflow-dev/prod`
- `monitoring-dev/prod` (Prometheus + Grafana + Alertmanager)
- `loki-dev/prod`, `promtail-dev/prod`
- `fastapi-logs-storage-dev/prod`
- `metallb-config`
- `dev/prod-namespaces`, `dev/prod-secrets`

â†’ **SYNC STATUS = Synced**, **HEALTH STATUS = Healthy**

**ğŸ‘‰ ê²°ë¡ :** GitOps ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  Observability ê´€ë ¨ ì•±ì´

í•­ìƒ **ì •í•© ìƒíƒœ(idempotent)** ë¡œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 1-2. ArgoCD UI â€” ì „ì²´ Applications

![proof-01-02-argocd-all-status.png](/mlops-journey/images/proof-01-02-argocd-all-status.png)

ğŸ“¸ **proof-01-02-argocd-all-status.png**

**í™•ì¸ í¬ì¸íŠ¸**

- ê° Applicationì˜ Repository / Revision / Chart ë²„ì „ì´ ëª…í™•íˆ í‘œê¸°
- Destination namespaceê°€ ì—­í• ì— ë§ê²Œ ì •í™•íˆ ë¶„ë¦¬ (dev / prod)
- CreatedAt, LastSynced ë¡œ GitOps ë™ê¸°í™” ìƒíƒœ í™•ì¸ ê°€ëŠ¥
- fastapi / logs-storage / loki / promtail / monitoring ì´
    
    **ì„œë¡œ ë‹¤ë¥¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¡œ ë°°í¬**ë¨
    

**ğŸ‘‰ ê²°ë¡ :** ArgoCD UIì—ì„œë„ **dev / prod ì™„ì „ ë¶„ë¦¬ GitOps êµ¬ì¡°**ê°€ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚©ë‹ˆë‹¤.

---

### âœ” 1-3. ArgoCD UI â€” Observability ê´€ë ¨ ì•±ë§Œ í•„í„°ë§

![proof-01-01-argocd-all-status-cmd.png](/mlops-journey/images/proof-01-03-argocd-monitoring-observability.png)

ğŸ“¸ **proof-01-03-argocd-monitoring-observability.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `monitoring-dev/prod`, `loki-dev/prod`, `promtail-dev/prod`ë§Œ ë”°ë¡œ í•„í„°ë§
- Loki / Promtail / Prometheus ëª¨ë‘ **Healthy + Synced**
- dev / prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ ìš´ì˜

**ğŸ‘‰ ê²°ë¡ :** Observability ê³„ì¸µ ì „ì²´ê°€ **í™˜ê²½ë³„ë¡œ ë…ë¦½ëœ GitOps ê´€ë¦¬**ë¥¼ ë°›ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Prometheus Targets (ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìƒíƒœ)

### âœ” 2-1. Prometheus(dev) Targets UI

![proof-02-01-prometheus-dev-targets.png](/mlops-journey/images/proof-02-01-prometheus-dev-targets.png)

ğŸ“¸ **proof-02-01-prometheus-dev-targets.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `monitoring-dev-kube-promet-prometheus` ê°€ ì—¬ëŸ¬ ServiceMonitorë¥¼ ì •ìƒ scrape
- `alertmanager`, `node-exporter`, `kubelet`, `prometheus`, `apiserver`,
    
    `kube-state-metrics` ì „ë¶€ `1/1 up`
    
- FastAPI dev PodMonitor(`fastapi-dev-pm`)ì˜ ë©”íŠ¸ë¦­ë„ ì •ìƒ ìˆ˜ì§‘
- ëª¨ë“  namespaceê°€ `monitoring-dev` ë¡œ ì¼ê´€

**ğŸ‘‰ ê²°ë¡ :** dev í™˜ê²½ì—ì„œ **í´ëŸ¬ìŠ¤í„° í•µì‹¬ ì§€í‘œ + FastAPI ì§€í‘œë¥¼ ëª¨ë‘ ì•ˆì •ì ìœ¼ë¡œ ìˆ˜ì§‘**í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 2-2. Prometheus(prod) Targets UI

![proof-02-01-prometheus-prod-targets.png](/mlops-journey/images/proof-02-01-prometheus-prod-targets.png)

ğŸ“¸ **proof-02-01-prometheus-prod-targets.png**

**í™•ì¸ í¬ì¸íŠ¸**

- prod í™˜ê²½ì—ì„œë„ devì™€ ë™ì¼ êµ¬ì¡°ì˜ Targetì´ ëª¨ë‘ `up`
- `fastapi-prod-pm` PodMonitor ìˆ˜ì§‘ ì •ìƒ
- scrape duration ì•ˆì •ì 
- ëª¨ë“  namespaceê°€ `monitoring-prod` ë¡œ ê³ ì •

**ğŸ‘‰ ê²°ë¡ :** **ìš´ì˜(prod) Prometheus ì¸ìŠ¤í„´ìŠ¤ë„ ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœ**ë¡œ

ë™ì¼í•œ í’ˆì§ˆì˜ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 2-3. CLI â€” ServiceMonitor & PodMonitor ëª©ë¡

```bash
kubectl -n monitoring-dev get servicemonitor
kubectl -n monitoring-dev get podmonitor

kubectl -n monitoring-prod get servicemonitor
kubectl -n monitoring-prod get podmonitor

```

![proof-02-02-prometheus-dev-prod-target-cmd.png](/mlops-journey/images/proof-02-02-prometheus-dev-prod-target-cmd.png)

ğŸ“¸ **proof-02-02-prometheus-dev-prod-target-cmd.png**

**í™•ì¸ í¬ì¸íŠ¸**

- dev / prod ëª¨ë‘ ë™ì¼í•œ ServiceMonitor ì„¸íŠ¸:
    - grafana, alertmanager, apiserver, kubelet, operator, prometheus,
        
        kube-state-metrics, node-exporter
        
- dev: **fastapi-dev-pm**, prod: **fastapi-prod-pm** PodMonitor ì¡´ì¬

**ğŸ‘‰ ê²°ë¡ :** Prometheusê°€ dev/prodì—ì„œ **FastAPI í¬í•¨ ëª¨ë“  í•µì‹¬ íƒ€ê²Ÿì„ ì•ˆì •ì ìœ¼ë¡œ scrape**í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## 3ï¸âƒ£ Prometheus Alerts (ì•ŒëŒ ì •ì˜ ë° ë°œë™)

### âœ” 3-1. FastAPI Alert Rule ì •ì˜

![proof-03-02-prometheus-dev-alert.png](/mlops-journey/images/proof-03-01-prometheus-fastapi-test-alert.png)

ğŸ“¸ **proof-03-01-prometheus-fastapi-test-alert.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `FastAPIHighErrorRate` : 5xx error ë¹„ìœ¨ 5% ì´ˆê³¼ ì‹œ ê²½ê³ 
- `FastAPIP95LatencyHigh` : p95 latency 500ms ì´ˆê³¼ ì‹œ 10ë¶„ ë™ì•ˆ ê²½ê³ 
- í…ŒìŠ¤íŠ¸ìš© `_TEST` ê·œì¹™ 2ì¢… ì¡´ì¬ (ì¦‰ì‹œ ë°œë™ìš©)
- summary / description annotation â†’ ê·¸ëŒ€ë¡œ Slack ë©”ì‹œì§€ ë‚´ìš©ìœ¼ë¡œ ì‚¬ìš©

**ğŸ‘‰ ê²°ë¡ :** ML ì„œë¹™ API ê´€ì ì—ì„œ í•„ìˆ˜ì¸ **Error Rate / Latency ê¸°ë°˜ SLO ì•ŒëŒ**ì´ ì™„ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

### âœ” 3-2. Prometheus(dev) Alerts â€” ì•ŒëŒ ë°œë™ í™•ì¸

![proof-03-02-prometheus-dev-alert.png](/mlops-journey/images/proof-03-02-prometheus-dev-alert.png)

ğŸ“¸ **proof-03-02-prometheus-dev-alert.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `FastAPIP95LatencyHigh_TEST` ì•ŒëŒì´ FIRING
- Value, ActiveSince, expr(historgram_quantile) ì •ë³´ê°€ ì •ìƒ í‘œì‹œ
- `Watchdog(vector(1))` ì•ŒëŒë„ í•­ìƒ FIRING ìƒíƒœë¡œ alert íŒŒì´í”„ë¼ì¸ í—¬ìŠ¤ì²´í¬

**ğŸ‘‰ ê²°ë¡ :** dev Prometheusì—ì„œ **Latency ì•ŒëŒ ë¡œì§ì´ ì‹¤ì œë¡œ ë™ì‘**í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 3-3. Slack(dev) â€” ì•ŒëŒ ìˆ˜ì‹ 

![proof-03-02-prometheus-dev-alert-slack.png](/mlops-journey/images/proof-03-02-prometheus-dev-alert-slack.png)

ğŸ“¸ **proof-03-02-prometheus-dev-alert-slack.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `[FIRING][DEV] FastAPIP95LatencyHigh_TEST`, `Watchdog` ë©”ì‹œì§€ ë„ì°©
- alertname / severity / summary / description / timestamp ê·¸ëŒ€ë¡œ ë§¤í•‘
- dev ì±„ë„ë¡œë§Œ ë„ì°©

**ğŸ‘‰ ê²°ë¡ :** Prometheus â†’ Alertmanager â†’ Slack(dev) ì˜ **ì—”ë“œíˆ¬ì—”ë“œ ì•ŒëŒ ì²´ì¸**ì´ ì •ìƒì…ë‹ˆë‹¤.

---

### âœ” 3-4. Prometheus(prod) Alerts & Slack(prod)

![proof-03-02-prometheus-prod-alert.png](/mlops-journey/images/proof-03-02-prometheus-prod-alert.png)

ğŸ“¸ **proof-03-02-prometheus-prod-alert.png**

![proof-03-02-prometheus-prod-alert-slack.png](/mlops-journey/images/proof-03-02-prometheus-prod-alert-slack.png)

ğŸ“¸ **proof-03-02-prometheus-prod-alert-slack.png**

**í™•ì¸ í¬ì¸íŠ¸**

- prod í™˜ê²½ì—ì„œë„ Watchdog FIRING ìƒíƒœ ìœ ì§€
- Alertmanager(prod) â†’ Slack(prod) ì „ìš© ë¼ìš°íŒ…
- dev ì•ŒëŒì´ prod ì±„ë„ë¡œ ì„ì—¬ ë“¤ì–´ì˜¤ì§€ ì•ŠìŒ

**ğŸ‘‰ ê²°ë¡ :** dev / prod ëª¨ë‘ **í™˜ê²½ ë¶„ë¦¬ëœ ì•ŒëŒ ì‹œìŠ¤í…œ**ì„ ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤.

---

## 4ï¸âƒ£ Alertmanager Config (dev/prod ë¶„ë¦¬)

### âœ” 4-1. Alertmanager(dev) ìƒíƒœ ë° ì„¤ì •

![proof-04-01-alertmanager-dev-status.png](/mlops-journey/images/proof-04-01-alertmanager-dev-status.png)

ğŸ“¸ **proof-04-01-alertmanager-dev-status.png**

**í™•ì¸ í¬ì¸íŠ¸**

- cluster: disabled (single êµ¬ì„±)
- route.receiver = **slack-dev**
- Slack í…œí”Œë¦¿ / ìƒ‰ìƒ / footer / send_resolved=true ì„¤ì •
- group_wait 30s / group_interval 5m / repeat_interval 12h
- í–¥í›„ PagerDuty/Telegram/Webex ë¡œ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°

**ğŸ‘‰ ê²°ë¡ :** dev í™˜ê²½ ì „ìš© Alertmanager êµ¬ì„±ì´ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘ ì¤‘ì…ë‹ˆë‹¤.

---

### âœ” 4-2. Alertmanager(prod) ìƒíƒœ ë° ì„¤ì •

![proof-04-01-alertmanager-prod-status.png](/mlops-journey/images/proof-04-01-alertmanager-prod-status.png)

ğŸ“¸ **proof-04-01-alertmanager-prod-status.png**

**í™•ì¸ í¬ì¸íŠ¸**

- route.receiver = **slack-prod**
- devì™€ ë‹¤ë¥¸ Slack webhook & í…œí”Œë¦¿
- ë™ì¼ rule êµ¬ì¡°ì§€ë§Œ ì™„ì „íˆ ë‹¤ë¥¸ ì•ŒëŒ ë¼ìš°íŒ…

**ğŸ‘‰ ê²°ë¡ :** prod í™˜ê²½ì€ **ìš´ì˜ìš© Slack(prod)ë§Œ ì‚¬ìš©í•˜ëŠ” ì•ˆì •ì  ì•ŒëŒ ì±„ë„**ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 4-3. Alertmanager Secret YAML(dev/prod)

![proof-04-02-alertmanager-dev-secret-cmd.png](/mlops-journey/images/proof-04-02-alertmanager-dev-secret-cmd.png)

ğŸ“¸ **proof-04-02-alertmanager-dev-secret-cmd.png**

![proof-04-02-alertmanager-prod-secret-cmd.png](/mlops-journey/images/proof-04-02-alertmanager-prod-secret-cmd.png)

ğŸ“¸ **proof-04-02-alertmanager-prod-secret-cmd.png**

**í™•ì¸ í¬ì¸íŠ¸**

- dev : `alertmanager-monitoring-dev-kube-promet-alertmanager`
- prod : `alertmanager-monitoring-prod-kube-prome-alertmanager`
- type: Opaque, namespace dev/prod ë¶„ë¦¬
- ë‚´ë¶€ì— base64 ì¸ì½”ë”©ëœ `alertmanager.yaml` ì €ì¥

**ğŸ‘‰ ê²°ë¡ :** Alertmanager ì„¤ì • ê°’ì´ **ì¿ ë²„ë„¤í‹°ìŠ¤ Secretìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬**ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

### âœ” 4-4. Alertmanager Alerts í˜ì´ì§€(dev/prod)

![proof-04-03-alertmanager-dev-alerts.png](/mlops-journey/images/proof-04-03-alertmanager-dev-alerts.png)

ğŸ“¸ **proof-04-03-alertmanager-dev-alerts.png**

![proof-04-03-alertmanager-prod-alerts.png](/mlops-journey/images/proof-04-03-alertmanager-prod-alerts.png)

ğŸ“¸ **proof-04-03-alertmanager-prod-alerts.png**

**í™•ì¸ í¬ì¸íŠ¸**

- dev: slack-dev ê·¸ë£¹ì— `FastAPIP95LatencyHigh_TEST`, `Watchdog` í‘œì‹œ
- prod: slack-prod ê·¸ë£¹ì— `Watchdog` 1ê±´ FIRING
- severity, source, ì‹œì‘ì‹œê°„, ë¼ë²¨ì´ ê·¸ëŒ€ë¡œ í‘œì‹œë¨

**ğŸ‘‰ ê²°ë¡ :** ë‘ í™˜ê²½ ëª¨ë‘ **Alertmanager ë ˆë²¨ì—ì„œë„ ê·¸ë£¹Â·ë¼ìš°íŒ…ì´ ì •í™•íˆ ë¶„ë¦¬**ë©ë‹ˆë‹¤.

---

## 5ï¸âƒ£ Loki ë¡œê·¸ (FastAPI ë¡œê·¸ ìˆ˜ì§‘)

### âœ” 5-1. Grafana Explore â€” FastAPI(dev) ë¡œê·¸

ì¿¼ë¦¬:

```
{namespace="fastapi-dev"}

```

![proof-05-01-grafana-dev-explore-fastapi-dev.png](/mlops-journey/images/proof-05-01-grafana-dev-explore-fastapi-dev.png)

ğŸ“¸ **proof-05-01-grafana-dev-explore-fastapi-dev.png**

**í™•ì¸ í¬ì¸íŠ¸**

- GET `/metrics`, `/health`, `/predict` ë¡œê·¸ ì—°ì† ì¶œë ¥
- `service_name=fastapi-dev`, `container=fastapi` ë¼ë²¨ ì •ìƒ
- JSON prettify ì‹œì—ë„ íŒŒì‹± ì˜¤ë¥˜ ì—†ìŒ

**ğŸ‘‰ ê²°ë¡ :** **FastAPI(dev) â†’ Promtail â†’ Loki â†’ Grafana** ë¡œê·¸ íŒŒì´í”„ë¼ì¸ì´ ì˜¨ì „íˆ ì‘ë™í•©ë‹ˆë‹¤.

---

### âœ” 5-2. Grafana Explore â€” FastAPI(prod) ë¡œê·¸

```
{namespace="fastapi-prod"}

```

![proof-05-01-grafana-prod-explore-fastapi-prod.png](/mlops-journey/images/proof-05-01-grafana-prod-explore-fastapi-prod.png)

ğŸ“¸ **proof-05-01-grafana-prod-explore-fastapi-prod.png**

**í™•ì¸ í¬ì¸íŠ¸**

- devì™€ ë¶„ë¦¬ëœ log stream
- Node / Pod ë¼ë²¨ì´ prod ê¸°ì¤€ìœ¼ë¡œ ë³„ë„ ìˆ˜ì§‘
- ë¡œê·¸ ìˆ˜ì§‘ëŸ‰ì´ devì™€ ë…ë¦½ì ìœ¼ë¡œ ëˆ„ì 

**ğŸ‘‰ ê²°ë¡ :** prod í™˜ê²½ì—ì„œë„ **FastAPI ë¡œê·¸ê°€ ì™„ì „íˆ ë¶„ë¦¬ëœ Loki ì¸ìŠ¤í„´ìŠ¤ë¡œ ìˆ˜ì§‘**ë©ë‹ˆë‹¤.

---

### âœ” 5-3. Loki Pod ë¡œê·¸(dev/prod)

```bash
# dev
kubectl get pod -n observability-dev
kubectl -n observability-dev logs loki-dev-0 | head

# prod
kubectl get pod -n observability-prod
kubectl -n observability-prod logs loki-prod-0 | head

```

![proof-05-02-loki-dev-logs-cmd.png](/mlops-journey/images/proof-05-02-loki-dev-logs-cmd.png)

ğŸ“¸ **proof-05-02-loki-dev-logs-cmd.png**

![proof-05-02-loki-prod-logs-cmd.png](/mlops-journey/images/proof-05-02-loki-prod-logs-cmd.png)

ğŸ“¸ **proof-05-02-loki-prod-logs-cmd.png**

**í™•ì¸ í¬ì¸íŠ¸**

- Loki ë²„ì „/ë¦¬ë¹„ì „ í‘œê¸°, config load ì •ìƒ
- `server listening on addresses` ë¡œê·¸ë¡œ HTTP/gRPC í¬íŠ¸ í™œì„±í™” í™•ì¸
- TSDB index table ë¡œë”© ë©”ì‹œì§€ ì •ìƒ

**ğŸ‘‰ ê²°ë¡ :** dev / prod Loki ì¸ìŠ¤í„´ìŠ¤ ëª¨ë‘ **ì •ìƒ ë¶€íŒ… ë° ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”**ë¥¼ ì™„ë£Œí•©ë‹ˆë‹¤.

---

## 6ï¸âƒ£ Slack ì•ŒëŒ Smoke í…ŒìŠ¤íŠ¸ (ì•ŒëŒ ì²´ì¸ E2E ê²€ì¦)

### âœ” 6-1. Smoke Alert PrometheusRule ìƒì„±

```bash
cat <<'EOF' | kubectl -n monitoring-dev apply -f -
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: alertmanager-smoke
  labels:
    release: monitoring-dev
spec:
  groups:
    - name: smoke.rules
      rules:
        - alert: Smoke_Alert_To_Slack
          expr: vector(1)
          for: 1m
          labels:
            severity: warning
            namespace: monitoring-dev
          annotations:
            summary: "Smoke test alert"
            description: "This is a test alert to verify Slack integration"
EOF

```

![proof-06-01-smoke-prometheusRule-dev.png](/mlops-journey/images/proof-06-01-smoke-prometheusRule-dev.png)

ğŸ“¸ **proof-06-01-smoke-prometheusRule-dev.png**

**ğŸ‘‰ ê²°ë¡ :** í•­ìƒ trueì¸ `vector(1)` ê¸°ë°˜ìœ¼ë¡œ, **í•­ìƒ Firing ìƒíƒœê°€ ìœ ì§€ë˜ëŠ” Smoke Alert**ë¥¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤.

---

### âœ” 6-2. Prometheus Alertsì—ì„œ Smoke Alert FIRING

![proof-06-02-prometheus-dev-alerts-smoke.png](/mlops-journey/images/proof-06-02-prometheus-dev-alerts-smoke.png)

ğŸ“¸ **proof-06-02-prometheus-dev-alerts-smoke.png**

**í™•ì¸ í¬ì¸íŠ¸**

- alertname: `Smoke_Alert_To_Slack`
- expr: `vector(1)`
- labels: `namespace=monitoring-dev`, `severity=warning`
- `State = FIRING`, `Value = 1`

---

### âœ” 6-3. Alertmanager ê·¸ë£¹ â€” slack-dev ë¼ìš°íŒ…

![proof-06-03-alertmanager-dev-alerts-smoke.png](/mlops-journey/images/proof-06-03-alertmanager-dev-alerts-smoke.png)

ğŸ“¸ **proof-06-03-alertmanager-dev-alerts-smoke.png**

**í™•ì¸ í¬ì¸íŠ¸**

- ê·¸ë£¹ëª…: `slack-dev`
- `Smoke_Alert_To_Slack`, `FastAPIP95LatencyHigh_TEST`, `Watchdog` ê°€ ê°™ì€ ê·¸ë£¹ìœ¼ë¡œ ë¼ìš°íŒ…
- Alertmanagerê°€ ì—¬ëŸ¬ Alertë¥¼ í•˜ë‚˜ì˜ Slack ì±„ë„ë¡œ ë¬¶ì–´ ì „ì†¡í•˜ëŠ” êµ¬ì¡°

---

### âœ” 6-4. Slack #dev ì±„ë„ â€” Smoke Alert ìˆ˜ì‹ 

![proof-06-04-slack-dev-alerts-smoke.png](/mlops-journey/images/proof-06-04-slack-dev-alerts-smoke.png)

ğŸ“¸ **proof-06-04-slack-dev-alerts-smoke.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `[FIRING][DEV] Smoke_Alert_To_Slack` ë©”ì‹œì§€ ë„ì°©
- alertname / namespace / severity ë¼ë²¨ ê·¸ëŒ€ë¡œ í‘œì‹œ
- ê¸°ì¡´ FastAPI í…ŒìŠ¤íŠ¸ ì•ŒëŒë“¤ê³¼ í•¨ê»˜ dev ì±„ë„ì— ìŒ“ì„

---

### âœ” 6-5. Prometheus / Alertmanager API ê²°ê³¼ í™•ì¸

```bash
# Prometheus
curl -sk https://prometheus-dev.local/api/v1/alerts \
  | jq '.data.alerts[] | select(.labels.alertname=="Smoke_Alert_To_Slack") | {state:.state, labels:.labels}'

# Alertmanager
curl -sk https://alert-dev.local/api/v2/alerts \
  | jq '.[] | select(.labels.alertname=="Smoke_Alert_To_Slack") | {status:.status, receiver:.receiver.name}'

```

![proof-05-prometheus-alertmanager-cmd.png](/mlops-journey/images/proof-06-05-prometheus-alertmanager-cmd.png)

ğŸ“¸ **proof-06-05-prometheus-alertmanager-cmd.png**

**ê²°ê³¼ ìš”ì•½**

- Prometheus: `"state": "firing"`
- Alertmanager: `"status.state": "active"`, `"receiver": "slack-dev"`

**ğŸ‘‰ ìµœì¢… ê²°ë¡ :** PrometheusRule â†’ Prometheus â†’ Alertmanager â†’ Slack(dev)ê¹Œì§€

**ì•ŒëŒ ì²´ì¸ ì „ì²´ê°€ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘**í•¨ì„ Smoke Alertë¡œ ì¦ëª…í–ˆìŠµë‹ˆë‹¤.

---

# B. FastAPI Observability & Grafana ëŒ€ì‹œë³´ë“œ

FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤ì œ íŠ¸ë˜í”½ì„ ë°›ê³ ,

Prometheus â†’ Grafana â†’ Loki â†’ Alertmanager â†’ Slackê¹Œì§€

**End-to-End Observability**ê°€ ì œëŒ€ë¡œ ì‘ë™í•¨ì„ ì¦ëª…í•©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ FastAPI ì„±ëŠ¥ ë¶€í•˜ í…ŒìŠ¤íŠ¸(hey) â†’ ë©”íŠ¸ë¦­ ë°˜ì˜

### âœ” 1-1. hey ë¶€í•˜ í…ŒìŠ¤íŠ¸ (20ì´ˆ / q 5 / c 10)

![proof-01-fastapi-dev-hey-test.png](/mlops-journey/images/proof-01-fastapi-dev-hey-test.png)

ğŸ“¸ **proof-01-fastapi-dev-hey-test.png**

**í™•ì¸ í¬ì¸íŠ¸**

- 20ì´ˆ ë™ì•ˆ ì´ˆë‹¹ **ì•½ 49 req/s** ì²˜ë¦¬
- í‰ê·  latency â‰ˆ **4ms**, p99 â‰ˆ **10ms**
- HTTP 405ëŠ” `/predict` ì—”ë“œí¬ì¸íŠ¸ê°€ GET ë¯¸ì§€ì›ì´ë¼ ë°œìƒí•˜ì§€ë§Œ FastAPIëŠ” ì •ìƒ ë™ì‘

**ğŸ‘‰ ê²°ë¡ :** FastAPI ì•±ì˜ **ê¸°ë³¸ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±**ì´ ì¶©ë¶„í•¨ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Grafana ëŒ€ì‹œë³´ë“œ â€” RPS / Latency ì‹¤ì‹œê°„ ë°˜ì˜

### âœ” 2-1. hey íŠ¸ë˜í”½ â†’ RPS ë°˜ì˜

![proof-01-grafana-dev-hey-test.png](/mlops-journey/images/proof-01-grafana-dev-hey-test.png)

ğŸ“¸ **proof-01-grafana-dev-hey-test.png**

**í™•ì¸ í¬ì¸íŠ¸**

- Total RPS(5m)ê°€ hey ë¶€í•˜ ì‹œì ì— ë§ì¶° ìƒìŠ¹ í›„ ì•ˆì •
- RPS by status (2xx / 4xx) ë¶„í¬ ì •ìƒ í‘œì‹œ

**ğŸ‘‰ ê²°ë¡ :** FastAPI ë©”íŠ¸ë¦­ì´ **Prometheus â†’ Grafanaë¡œ ì‹¤ì‹œê°„ ë°˜ì˜**ë©ë‹ˆë‹¤.

---

### âœ” 2-2. p50 / p95 latency ê·¸ë˜í”„

![proof-01-grafana-dev-hey-test-2.png](/mlops-journey/images/proof-01-grafana-dev-hey-test-2.png)

ğŸ“¸ **proof-01-grafana-dev-hey-test-2.png**

**í™•ì¸ í¬ì¸íŠ¸**

- p50 / p95 latency ë¼ì¸ì´ hey ë¶€í•˜ êµ¬ê°„ì—ë„ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€
- histogram ê¸°ë°˜ ê³„ì‚°ì‹ì´ ì •ìƒ ë™ì‘

**ğŸ‘‰ ê²°ë¡ :** **Latency ê¸°ë°˜ Alert Ruleì˜ ê·¼ê±° ë°ì´í„°**ê°€ ì œëŒ€ë¡œ ìˆ˜ì§‘ë˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## 3ï¸âƒ£ FastAPI Alert Rule ë™ì‘ ì¦ëª…

### âœ” 3-1. PrometheusRule ì‹¤ì œ ë°˜ì˜ ìƒíƒœ

![proof-02-fastapi-dev-alert-rule.png](/mlops-journey/images/proof-02-fastapi-dev-alert-rule.png)

ğŸ“¸ **proof-02-fastapi-dev-alert-rule.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `FastAPIHighErrorRate`, `FastAPIP95LatencyHigh`
- í…ŒìŠ¤íŠ¸ìš© `FastAPIHighErrorRate_TEST`, `FastAPIP95LatencyHigh_TEST`
- ëª¨ë‘ PrometheusOperatorë¥¼ í†µí•´ clusterì— ì ìš© ì™„ë£Œ

**ğŸ‘‰ ê²°ë¡ :** FastAPI ì•ŒëŒ ì •ì˜ê°€ **ìš´ì˜ í™˜ê²½ì— ì •í™•íˆ ë°°í¬**ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### âœ” 3-2. Error Rate ì¦ê°€ ì‹œë‚˜ë¦¬ì˜¤ (404 í­ì¦)

![proof-02-fastapi-dev-alert-curl-test.png](/mlops-journey/images/proof-02-fastapi-dev-alert-curl-test.png)

ğŸ“¸ **proof-02-fastapi-dev-alert-curl-test.png**

**ì‹¤í–‰ ë‚´ìš©**

- ì •ìƒ endpointë¡œ 30íšŒ POST (2xx)
- ì¡´ì¬í•˜ì§€ ì•ŠëŠ” endpointë¡œ 30íšŒ í˜¸ì¶œ â†’ **404 ì—°ì† ë°œìƒ**
- non-2xx ë¹„ìœ¨ ì¦ê°€ â†’ Alert firing ì¡°ê±´ ë§Œì¡±

**ğŸ‘‰ ê²°ë¡ :** â€œ**FastAPI non-2xx ì¦ê°€ â†’ Alert ë°œìƒ**â€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê·¸ëŒ€ë¡œ ì¬í˜„ë©ë‹ˆë‹¤.

---

### âœ” 3-3. ê²½ëŸ‰ ë¶€í•˜ì—ì„œë„ ë©”íŠ¸ë¦­ ì •ìƒ ìˆ˜ì§‘

![proof-02-fastapi-dev-alert-library-test.png](/mlops-journey/images/proof-02-fastapi-dev-alert-library-test.png)

ğŸ“¸ **proof-02-fastapi-dev-alert-library-test.png**

**í™•ì¸ í¬ì¸íŠ¸**

- ì•½ 0.65 req/s ì˜ ë‚®ì€ íŠ¸ë˜í”½ì—ì„œë„ RPS / Status / CPU / Memory / Slow paths ì •ìƒ
- ê³ ë¶€í•˜Â·ì €ë¶€í•˜ ìƒê´€ì—†ì´ ë™ì¼í•œ ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸ ê°€ëŠ¥

**ğŸ‘‰ ê²°ë¡ :** íŠ¸ë˜í”½ ê°•ë„ì— ê´€ê³„ì—†ì´ **ê´€ì¸¡ ê°€ëŠ¥ì„±ì´ í•­ìƒ ìœ ì§€**ë©ë‹ˆë‹¤.

---

### âœ” 3-4. Alertmanager â†’ Slack ì•Œë¦¼

![proof-02-fastapi-dev-alert-library-test-slack.png](/mlops-journey/images/proof-02-fastapi-dev-alert-library-test-slack.png)

ğŸ“¸ **proof-02-fastapi-dev-alert-library-test-slack.png**

**í™•ì¸ í¬ì¸íŠ¸**

- Smoke AlertëŠ” RESOLVED, `FastAPIHighErrorRate_TEST` ëŠ” FIRING ìƒíƒœ
- Alertmanager â†’ Slack Webhook íŒŒì´í”„ë¼ì¸ì´ ì‹¤ì œ íŠ¸ë˜í”½ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘

**ğŸ‘‰ ê²°ë¡ :** FastAPI ê´€ë ¨ ì¥ì•  ë°œìƒ ì‹œ **ì‹¤ì œ ìŠ¬ë™ ì•Œë¦¼ê¹Œì§€ ì´ì–´ì§€ëŠ” ìš´ì˜ í”Œë¡œìš°**ê°€ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤.

---

# C. Data Pipeline (Airflow + S3)

ë°ì´í„° íŒŒì´í”„ë¼ì¸ì´

Raw ë°ì´í„° ìˆ˜ì§‘ â†’ ê²€ì¦ â†’ Feature ìƒì„± â†’ S3 ì €ì¥ â†’ Raw vs Feature ë¹„êµ

ê¹Œì§€ **ì—”ë“œíˆ¬ì—”ë“œë¡œ ì •í™•í•˜ê²Œ ë™ì‘**í–ˆìŒì„ ì¦ëª…í•©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ Raw ë°ì´í„° ìˆ˜ì§‘(S3) ê²€ì¦

### âœ” 1-1. Raw ë°ì´í„° ë²„í‚· ìƒì„±

![proof-01-s3-daily-raw-data.png](/mlops-journey/images/proof-01-s3-daily-raw-data.png)

ğŸ“¸ **proof-01-s3-daily-raw-data.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `datapipeline-raw-data-keonho` ë²„í‚· ì¡´ì¬
- `daily/` í´ë” ìë™ ìƒì„±

---

### âœ” 1-2. Raw Daily CSV í™•ì¸

![proof-01-s3-daily-raw-data-2.png](/mlops-journey/images/proof-01-s3-daily-raw-data-2.png)

ğŸ“¸ **proof-01-s3-daily-raw-data-2.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `daily/user_events_20251119.csv` íŒŒì¼ ì¡´ì¬
- í¬ê¸° 1.7KB, CSV ìŠ¤í‚¤ë§ˆ ì •ìƒ

**ğŸ‘‰ ê²°ë¡ :** `extract_raw_data` íƒœìŠ¤í¬ê°€ **Raw ë°ì´í„°ë¥¼ S3ì— ì •ìƒ ì—…ë¡œë“œ**í•©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Airflow DAG ì—”ë“œíˆ¬ì—”ë“œ ì‹¤í–‰

![proof-01-airflow-dag.png](/mlops-journey/images/proof-01-airflow-dag.png)

ğŸ“¸ **proof-01-airflow-dag.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `extract_raw`, `validate_data`, `build_features`, `store_features`, `summarize_run`
    
    ëª¨ë“  íƒœìŠ¤í¬ `success`
    
- ì „ì²´ ì‹¤í–‰ ì‹œê°„ ì•½ 1ë¶„, DAG Version v2

**ğŸ‘‰ ê²°ë¡ :** Raw â†’ Feature ì „ ê³¼ì •ì´ **ì¤‘ë‹¨ ì—†ì´ í•œ ë²ˆì— ì‹¤í–‰**ë©ë‹ˆë‹¤.

---

## 3ï¸âƒ£ Feature ìƒì„± ë° ì €ì¥ ê²€ì¦

### âœ” 3-1. features/ í´ë” ìƒì„±

![proof-01-s3-features-data.png](/mlops-journey/images/proof-01-s3-features-data.png)

ğŸ“¸ **proof-01-s3-features-data.png**

**í™•ì¸ í¬ì¸íŠ¸**

- DAG ì‹¤í–‰ í›„ `features/` í´ë” ìë™ ìƒì„±

---

### âœ” 3-2. Feature CSV íŒŒì¼ ìƒì„±

![proof-01-s3-features-data-2.png](/mlops-journey/images/proof-01-s3-features-data-2.png)

ğŸ“¸ **proof-01-s3-features-data-2.png**

**í™•ì¸ í¬ì¸íŠ¸**

- `features/user_events_feat_20251119.csv` ì¡´ì¬
- í¬ê¸° 236B â†’ Raw ëŒ€ë¹„ Feature ì»¬ëŸ¼ë§Œ ë‚¨ì€ í˜•íƒœ

**ğŸ‘‰ ê²°ë¡ :** `store_features` íƒœìŠ¤í¬ê°€ **Feature Engineering ê²°ê³¼ë¥¼ S3ì— ì•ˆì •ì ìœ¼ë¡œ ì €ì¥**í•©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ Raw vs Feature ìµœì¢… ë¹„êµ

### âœ” 4-1. íŒŒì¼ ë‚´ìš© ë¹„êµ (ì—‘ì…€)

![proof-03-compare-file.png](/mlops-journey/images/proof-03-compare-file.png)

ğŸ“¸ **proof-03-compare-file.png**

**í™•ì¸ í¬ì¸íŠ¸**

- ì¢Œì¸¡: `user_events_20251119.csv` ì›ë³¸ Raw
- ìš°ì¸¡: `user_events_feat_20251119.csv` Feature íŒŒì¼
- `row_sum` ê³„ì‚° ì»¬ëŸ¼ ì •ìƒ ìƒì„±
- 13552 ê°™ì´ ê°’ì´ í¬ê²Œ ë‚˜ì˜¨ rowëŠ” `amount=12000` ë“±
    
    ê³ ì•¡ ê²°ì œ ì´ë²¤íŠ¸ê°€ í•©ì‚°ëœ ì •ìƒ ê²°ê³¼
    

**ğŸ‘‰ ê²°ë¡ :** Feature ìƒì„± ë¡œì§ì´ **ì„¤ê³„í•œëŒ€ë¡œ ìˆ«ìí˜• ì»¬ëŸ¼ì„ ì¶”ì¶œÂ·ê°€ê³µ**í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

# D. Data Pipeline ê³ ë„í™” (ë²„ì „ Â· ìŠ¤í‚¤ë§ˆ Â· ë©”íƒ€ë°ì´í„° Â· ê´€ì¸¡)

ì•ì„œ êµ¬ì¶•í•œ Data Pipeline v1ì´  Raw â†’ Feature ETLì´ ì •ìƒ ì‘ë™í•¨ì„ ì¦ëª…í–ˆë‹¤ë©´,

ì´ë²ˆ v2ì—ì„œëŠ” **ê°™ì€ íŒŒì´í”„ë¼ì¸ì´ ë²„ì „Â·ìŠ¤í‚¤ë§ˆÂ·ë©”íƒ€ë°ì´í„°Â·ê´€ì¸¡ê¹Œì§€ ê°–ì¶˜ ìš´ì˜í˜• êµ¬ì¡°ë¡œ ë™ì‘í•¨**ì„ í™•ì¸í•©ë‹ˆë‹¤.

---

## 1ï¸âƒ£ S3 ë²„ì „ ë””ë ‰í„°ë¦¬ êµ¬ì¡°

![proof-01-s3-daily-user-events-dir-1.png](/mlops-journey/images/proof-01-s3-daily-user-events-dir-1.png)

ğŸ“¸ proof-01-s3-daily-user-events-dir-1.png

![proof-01-s3-daily-user-events-dir-2.png](/mlops-journey/images/proof-01-s3-daily-user-events-dir-2.png)

ğŸ“¸ proof-01-s3-daily-user-events-dir-2.png

**í™•ì¸ í¬ì¸íŠ¸**

- `features/daily_user_events/` í•˜ìœ„ì—`v_20251129T111532/`, `v_20251129T120305/` ê°™ì€ **ì‹¤í–‰ ì‹œì  ê¸°ë°˜ ë²„ì „ ë””ë ‰í„°ë¦¬ ëˆ„ì **
- ê° ë””ë ‰í„°ë¦¬ ì•„ë˜ì—`feature.csv`, `schema.json`, `metadata.json` **3ì¢… ì„¸íŠ¸ê°€ í•­ìƒ ìƒì„±**

**ğŸ‘‰ ê²°ë¡ :** ì‹¤í–‰ë§ˆë‹¤ **ë…ë¦½ëœ ë²„ì „ ë‹¨ìœ„ ì•„í‹°íŒ©íŠ¸**ê°€ ê¸°ë¡ë©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Airflow DAG v2 ì—”ë“œíˆ¬ì—”ë“œ ì‹¤í–‰

![proof-02-airflow-dag-v2.png](/mlops-journey/images/proof-02-airflow-dag-v2.png)

ğŸ“¸ proof-02-airflow-dag-v2.png

**í™•ì¸ í¬ì¸íŠ¸**

- DAG: `data_pipeline_daily_dev_v2`
- êµ¬ì„±: extract_raw â†’ validate_data â†’ build_features â†’ store_features â†’ summarize_run
- ëª¨ë“  íƒœìŠ¤í¬ success

**ğŸ‘‰ ê²°ë¡ :** Raw â†’ Feature â†’ ìš”ì•½ê¹Œì§€ **ëŠê¹€ ì—†ì´ ìë™ ì‹¤í–‰**ë©ë‹ˆë‹¤.

---

## 3ï¸âƒ£ Feature ë²„ì „ ì •ë³´ (schema Â· metadata Â· í’ˆì§ˆ êµì°¨ ê²€ì¦)

![proof-03-feature-schema-metadata.png](/mlops-journey/images/proof-03-feature-schema-metadata.png)

ğŸ“¸ proof-03-feature-schema-metadata.png

**í™•ì¸ í¬ì¸íŠ¸**

- `schema.json`
    - `feature_version`ì´ S3 ë””ë ‰í„°ë¦¬ëª…ê³¼ ì •í™•íˆ ì¼ì¹˜
    - ìƒì„± ì‹œì (KST) í¬í•¨
- `metadata.json`
    - raw/feature row ìˆ˜, null_rate, raw_valid ìƒì„¸ ê¸°ë¡
- Raw vs Feature
    - Airflow ë¡œê·¸(rows/null_rate)ì™€
    S3 íŒŒì¼(metadata.json)ê³¼
    CSV ì‹¤ë°ì´í„°ê°€ **ëª¨ë‘ ë™ì¼**

**ğŸ‘‰ ê²°ë¡ :** **ìŠ¤í‚¤ë§ˆ/ë©”íƒ€ë°ì´í„°/í’ˆì§ˆ 3ì¤‘ ê²€ì¦ìœ¼ë¡œ ì•ˆì •ì„±ì„ í™•ë³´**í•©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ Grafana ê´€ì¸¡ (Logs + Pipeline Runs)

![proof-04-grafana-dp-logs-runs.png](/mlops-journey/images/proof-04-grafana-dp-logs-runs.png)

ğŸ“¸ proof-04-grafana-dp-logs-runs.png

**í™•ì¸ í¬ì¸íŠ¸**

- `[DP]` ë¡œê·¸ë¡œ ë‹¨ê³„ë³„ ì‹¤í–‰ íë¦„(time-ordered) í™•ì¸
- summarize_run count íŒ¨ë„ë¡œ ì‹¤í–‰ ì‹œê°„ëŒ€Â·ë¹ˆë„ í™•ì¸
- ë²„ì „ ì •ë³´ì™€ ì‹¤í–‰ íŒ¨í„´ì´ í•œ í™”ë©´ì— í‘œí˜„

**ğŸ‘‰ ê²°ë¡ :** **ë¡œê·¸Â·ë©”íŠ¸ë¦­ ê¸°ë°˜ì˜ ìš´ì˜í˜• ê´€ì¸¡ì´ ì™„ì„±**ë˜ì—ˆìŠµë‹ˆë‹¤.
