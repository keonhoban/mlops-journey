+++
date = '2025-10-13T17:10:21+09:00'
draft = false
title = '[MLOps ìš´ì˜ ê³ ë„í™” - ì—í•„ë¡œê·¸]'
categories = ['MLOps Pipeline', 'Kubernetes', 'Git', 'GitOps(ArgoCD)', 'CI/CD', 'Security', 'Observability', 'Architecture']
+++

## ì—í•„ë¡œê·¸ â€” â€œí•œ ë²ˆì˜ ì»¤ë°‹ìœ¼ë¡œ ëê¹Œì§€ ê°€ëŠ” ììœ¨í˜• MLOps í”Œë«í¼â€

---

## ğŸ“Œ ì „ì²´ ê²½ë¡œ ìš”ì•½

| ìˆœì„œ | ì£¼ì œ |
| --- | --- |
| 0 | [ğŸ”— FastAPI A/BÂ·CanaryÂ·Blue-Green ì„œë¹™ ë² ì´ìŠ¤](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/01/) |
| 1 | [ğŸ”— í•«ìŠ¤ì™‘ ê³ ë„í™” (/reload ë³´ì•ˆÂ·DAG ìë™í™”)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/02/) |
| 2 | [ğŸ”— Slack Alert í†µí•© (FastAPIÂ·Airflow ê³µìš©)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/03/) |
| 3 | [ğŸ”— ëª¨ë¸ ë¡¤ë°± ìë™í™” (ë“±ë¡ ì‹¤íŒ¨ ëŒ€ë¹„ ë³µêµ¬)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/04/) |
| 4 | [ğŸ”— FastAPI ë¡œê·¸ ì•ˆì •í™” (NFS + PV/PVC + Loguru)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/05/) |
| 5 | [ğŸ”— Airflow ì•ˆì •í™” & FastAPI HTTPS ë³´ì•ˆ](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/06/) |
| 6 | [ğŸ”— GitOps ê³ ë„í™” (Argo CDÂ·MetalLBÂ·ApplicationSet)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/07/) |
| 7 | [ğŸ”— Argo CD Notifications ìë™í™” (Slack ì—°ë™)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/08/) |
| 8 | [ğŸ”— CI/CD ìš´ì˜ ìë™í™” (GitHub ActionsÂ·Helm Lint)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/09/) |
| 9 | [ğŸ”— ì‹œí¬ë¦¿ ê´€ë¦¬ & í‚¤ íšŒì „ ìë™í™” (AWSÂ·SealedSecret)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/10/) |

---

---

## ğŸ¯ ì „ì²´ ë‚´ìš© ìš”ì•½ (0~9ë‹¨ê³„)

| ë‹¨ê³„ | í•µì‹¬ ëª©í‘œ | ì£¼ìš” ê°œì„ ì  |
| --- | --- | --- |
| 0 | FastAPI ë¦¬ë‰´ì–¼ | `/predict`(ìë™) Â· `/variant/{alias}/predict`(ìˆ˜ë™) Â· `/variant/{alias}/reload`(í•«ìŠ¤ì™‘) 
â†’ **A/BÂ·CanaryÂ·Blue-Green í†µí•© ë¼ìš°íŒ… êµ¬ì¡°** |
| 1 | í•«ìŠ¤ì™‘ ë³´ì•ˆ/ìë™í™” | `/reload` í† í° ì¸ì¦ + Ingress í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ + TLS, 
**Airflow Sensor READY í›„ Reload íŠ¸ë¦¬ê±°** |
| 2 | Slack Alert í†µí•© | **FastAPI/Airflow ê³µìš© `send_slack_alert()`**, Airflow ì‹¤íŒ¨ ì½œë°± Slack ì•Œë¦¼ |
| 3 | ë¡¤ë°± ìë™í™” | ë“±ë¡ ì‹¤íŒ¨ ì‹œ **before_version** ëª…ì‹œ ë¡¤ë°±, READY ê²€ì¦ + FastAPI `/reload` ìë™ ë°˜ì˜ |
| 4 | ë¡œê·¸ ì•ˆì •í™” | **FastAPI=Loguru+NFS(PV/PVC)** / **Airflow=S3 ì—…ë¡œë“œ**, 
ê¶Œí•œ(fsGroup/runAsUser)Â·ë³´ê´€ ì£¼ê¸° í‘œì¤€í™” |
| 5 | Airflow ì•ˆì •í™”Â·HTTPS | `PythonSensor(reschedule)`Â·`ALL_SUCCESS`Â·XCom Key ê³ ì •, 
**cert-manager ê¸°ë°˜ TLS ìë™í™” (ë‚´ë¶€ CA)** |
| 6 | GitOps ì „í™˜ | **MetalLB + SealedSecret + ApplicationSet** ê¸°ë°˜ ìë™ ë°°í¬ ì²´ê³„ êµ¬ì¶• |
| 7 | GitOps ëª¨ë‹ˆí„°ë§ | **ArgoCD Notifications â†’ Slack** ì‹¤ì‹œê°„ Sync/Health ê´€ì œ |
| 8 | CI/CD ê³ ë„í™” | **Helm Lint(strict) + kubeconform + yamllint** ë§¤íŠ¸ë¦­ìŠ¤ ê²€ì¦, 
â€œPRâ†’Mergeâ†’Auto Deployâ†’ì‹¤í—˜â€ ìë™í™” |
| 9 | SecretOps í‘œì¤€í™” | **AWS Key Rotation / Re-Seal ë°˜ìë™í™”(ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜)**, GitOps ê¸°ë°˜ 
**â€œSecrets as Codeâ€ ìš´ì˜ ì²´ê³„**  |

> ğŸ”„ í•µì‹¬
> 
> 
> â€œGit ì»¤ë°‹ í•œ ë²ˆìœ¼ë¡œ í•™ìŠµâ†’ë“±ë¡â†’ë°°í¬â†’ì‹¤í—˜â†’ëª¨ë‹ˆí„°ë§â†’ë³µêµ¬ê¹Œì§€ ììœ¨ ìˆœí™˜í•œë‹¤.â€
> 

---

## âš™ï¸ Helm ê¸°ì¤€ì„  êµ¬ì¡° (Before GitOps)

```mermaid
%%{init: {'flowchart': {'htmlLabels': true}} }%%
flowchart TD
  subgraph CLU["Kubernetes Cluster"]
    subgraph NS_MF["Namespace: mlflow"]
      MF["ğŸ“¦ MLflow"]
    end
    subgraph NS_AF["Namespace: airflow"]
      AF["ğŸ“¦ Airflow"]
    end
    subgraph NS_FA["Namespace: fastapi"]
      FA["ğŸ“¦ FastAPI"]
    end
  end

  subgraph EXT["External Systems"]
    S3["ğŸª£ S3 (Artifacts & Airflow Logs)"]
    PG["ğŸ—„ï¸ PostgreSQL (MLflow Meta)"]
  end

  subgraph SEC["Kubernetes Secrets"]
    AWS["ğŸ” aws-credentials-secret"]
    MF_DB["ğŸ” mlflow-db-secret"]
    AF_DB["ğŸ” airflow-db-secret"]
  end

  MF -->|Artifacts| S3
  MF -->|Meta| PG
  AF -->|Train/Register| MF
  AF -->|Remote Logging| S3
  FA -->|Model Meta| MF
  FA -->|Model Files| S3

  AWS --> MF
  AWS --> AF
  AWS --> FA
  MF_DB --> MF
  AF_DB --> AF

  classDef node fill:#f7f7ff,stroke:#7aa7ff,stroke-width:2px,color:#0b318f;

```

**Before íŠ¹ì§•**

- `helm upgrade` ê¸°ë°˜ ìˆ˜ë™ ë°°í¬.
- Secret ìˆ˜ë™ ìƒì„± (`kubectl create secret ...`).
- Airflow ë¡œê·¸ëŠ” **S3 ì—…ë¡œë“œ**, FastAPIëŠ” **NFS(PV/PVC)** ë³´ì¡´.
- ì¸ì¦ì„œ: prodì€ `letsencrypt-prod` í‘œê¸°ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, **ë‚´ë¶€ hosts ê¸°ë°˜ self-signedì™€ ì‹¤ì§ˆ ë™ì¼**.

---

## ğŸ§© GitOps ì „í™˜ í›„ (After)

> Helm í…œí”Œë¦¿ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ, ArgoCDë¡œ ë°°í¬Â·ë³´ì•ˆÂ·ê´€ì œë¥¼ ìë™í™”.
> 

```mermaid
%%{init: {'flowchart': {'htmlLabels': true}} }%%
flowchart TD
  subgraph GIT["Git Repos"]
    CH["mlops-infra (Helm Charts + values/base,dev,prod)"]
    BOOT["bootstrap/* (argocd, sealed-secrets, ingress ë“±)"]
    APPS["apps/* (ApplicationSet, AppProject)"]
  end

  subgraph ARGO["ArgoCD"]
    APPSET["ApplicationSet (dev/prod)"]
    SYNC["Auto Sync + SelfHeal + Prune"]
    NOTI["Notifications â†’ Slack"]
  end

  subgraph CLU["Kubernetes Cluster"]
    MTLB["MetalLB (L2 LB)"]
    ING["Ingress + TLS (cert-manager ë‚´ë¶€ CA ê¸°ë°˜)"]
    subgraph NS_DEV["Namespaces: *-dev"]
      MF_D["MLflow-dev"]
      AF_D["Airflow-dev"]
      FA_D["FastAPI-dev"]
    end
    subgraph NS_PRD["Namespaces: *-prod"]
      MF_P["MLflow-prod"]
      AF_P["Airflow-prod"]
      FA_P["FastAPI-prod"]
    end
  end

  CH --> APPSET --> SYNC --> CLU
  BOOT --> SYNC
  APPS --> ARGO
  ARGO --> NOTI

  AF_D -->|Remote Logging| S3_D["S3/dev (airflow-logs)"]
  AF_P -->|Remote Logging| S3_P["S3/prod (airflow-logs)"]
  FA_D -->|App Logs| NFS_D["NFS/dev (FastAPI logs)"]
  FA_P -->|App Logs| NFS_P["NFS/prod (FastAPI logs)"]

  AF_D --> MF_D
  AF_P --> MF_P
  FA_D --> MF_D
  FA_P --> MF_P

  classDef node fill:#f7f7ff,stroke:#7aa7ff,stroke-width:2px,color:#0b318f;

```

**After íŠ¹ì§•**

- **Helm values íŒ¨í„´ ê·¸ëŒ€ë¡œ ìœ ì§€**
- **í™˜ê²½ë³„ Namespace ì™„ì „ ë¶„ë¦¬** â†’ dev/prod ë™ì‹œ ìš´ì˜ ì•ˆì •í™”
- **Airflow=S3 Remote Logging**, **FastAPI=NFS(Loguru rotation)** ìœ ì§€
- **cert-manager ë‚´ë¶€ CA ê¸°ë°˜ TLS ìë™í™”** â€” hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§ìœ¼ë¡œ ì™¸ë¶€ ë…¸ì¶œ ì—†ì´ íì‡„í˜• TLS ìš´ì˜
- **ArgoCD ApplicationSet** ìœ¼ë¡œ dev/prod ìë™ ë°°í¬ + SelfHeal
- **SealedSecret + Rotation/Re-Seal** ë¡œ Key ê´€ë¦¬ ì™„ì „ ìë™í™”
- **ìŠ¤í† ë¦¬ì§€(PV/PVC)** ëŠ” ì›Œí¬ë¡œë“œì™€ **ìƒëª…ì£¼ê¸° ë¶„ë¦¬**: **ì „ìš© Application(Prune=false, Replace=false)** ë¡œ ê´€ë¦¬í•´ ë°ì´í„° ë³´ì¡´ê³¼ ì•ˆì „í•œ ë“œë¦¬í”„íŠ¸ ê°ì‹œ

---

## ğŸ” Helm â†’ GitOps ë³€í™” ìš”ì•½

| ì˜ì—­ | Helm (Before) | GitOps (After) | ì˜ë¯¸ |
| --- | --- | --- | --- |
| ë°°í¬ ë°©ì‹ | ìˆ˜ë™ `helm upgrade` | ArgoCD Auto Sync | ìë™í™”Â·SelfHeal |
| Secret ê´€ë¦¬ | kubectl ìˆ˜ë™ | SealedSecret + Rotation/Re-Seal | â€œSecrets as Codeâ€ |
| ë¡œê·¸ | FastAPI=NFS / Airflow=S3 | FastAPI=NFS ìœ ì§€ / Airflow=S3 ì¼ì›í™” | ì´ì›í™” í‘œì¤€í™” |
| ì¸ì¦ì„œ ì²´ê³„ | `cert-manager + LE í‘œê¸° (ì‹¤ì§ˆ self-signed)` | **cert-manager ë‚´ë¶€ CA ê¸°ë°˜ ìë™ TLS (hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§)** | ì™¸ë¶€ CA ì—†ì´ ìë™ ê°±ì‹  
+ ê³µê²© í‘œë©´ ìµœì†Œí™” |
| CI/CD | ìˆ˜ë™ ë¹Œë“œ | GitHub Actions + ArgoCD Pipeline | â€œPRâ†’ë°°í¬â†’Slackâ€ ì¼ì›í™” |
| ê´€ì œ | ê°œë³„ ì•Œë¦¼ | ArgoCD Notifications + Slack | ì‹¤ì‹œê°„ ê´€ì œ ì¼ì›í™” |
| ë„¤ì„ìŠ¤í˜ì´ìŠ¤ | ë‹¨ì¼ | í™˜ê²½ë³„ ë¶„ë¦¬ | ê²©ë¦¬Â·ë³µêµ¬ ìš©ì´ |
| ìŠ¤í† ë¦¬ì§€(PV/PVC) | ìˆ˜ë™ `kubectl apply` | ì „ìš© App + prune=false + replace=false | ë°ì´í„° ë³´ì¡´Â·ìˆ˜ëª…ì£¼ê¸° ë¶„ë¦¬ |

> ìˆ˜ë™ ë¹Œë“œÂ·ë°°í¬ì—ì„œ ë²—ì–´ë‚˜, PR â†’ CI â†’ ArgoCD â†’ Slack â†’ ì‹¤í—˜ìœ¼ë¡œ ì´ì–´ì§€ëŠ” ìë™í™”ëœ â€œOne Commit Flowâ€ ì™„ì„±.
> 

---

## ğŸ” One Commit Flow

```mermaid
%%{init: {'flowchart': {'htmlLabels': true}} }%%
flowchart LR
  G["GitHub PR â†’ Merge"] --> CI["CI: Helm Lint Â· kubeconform Â· yamllint"]
  CI --> CD["CD: ArgoCD Auto Sync (ApplicationSet + SelfHeal + Prune)"]
  CD --> AF["Airflow: Train â†’ Register"]
  AF --> SEN["Sensor READY"]
  SEN --> RL["FastAPI /variant/{alias}/reload"]
  RL --> EXP["A/B Â· Canary Â· Blue-Green"]
  AF -. ì‹¤íŒ¨ì‹œ .-> RB["Rollback DAG (before_version)"]
  RB --> RL

  subgraph LOGS["Logging Layer"]
    FA_LOG["FastAPI â†’ NFS(Loguru rotation)"]
    AF_LOG["Airflow â†’ S3(Remote Logging)"]
  end

  CD --> NOTI["ArgoCD Notifications â†’ Slack"]
  AF --> AF_LOG
  RL --> FA_LOG
  EXP --> NOTI

  classDef node fill:#f7f7ff,stroke:#7aa7ff,stroke-width:2px,color:#0b318f;

```

---

## ğŸ§  ìš´ì˜ ì›ì¹™

- **ë³´ì•ˆ/ì‹œí¬ë¦¿** â†’ AWS Key Rotation + Re-Seal ì™„ì „ ìë™í™”
- **ë°°í¬ ì•ˆì •ì„±** â†’ Sensor READY ì´í›„ Reload, ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ìë™ ë°˜ì˜
- **ë¡œê·¸ êµ¬ì¡°** â†’ Airflow=S3 / FastAPI=NFS, ê¶Œí•œÂ·ë³´ê´€Â·ë¡œí…Œì´ì…˜ ì¼ì›í™”
- **TLS ì²´ê³„** â†’ cert-manager ë‚´ë¶€ CA ìë™ ê°±ì‹ , hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§ ìš´ì˜
- **GitOps ë³µì›ë ¥** â†’ ApplicationSet + SelfHeal + Pruneë¡œ OutOfSync ìë™ ë³µêµ¬
- **ìŠ¤í† ë¦¬ì§€ ë¶„ë¦¬** â†’ PV/PVCëŠ” **ì „ìš© ArgoCD App**ìœ¼ë¡œ ìš´ì˜(â€» **Prune/Replace ë¹„í™œì„±**ìœ¼ë¡œ ë°ì´í„° ì•ˆì „ì„± í™•ë³´)

---

## âœ… ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  Airflow S3 Prefix(dev/prod) ì •ìƒ ê¸°ë¡
- [ ]  FastAPI `/app/logs` NFS ê¶Œí•œ ì¼ì¹˜(fsGroup/runAsUser)
- [ ]  cert-manager ë‚´ë¶€ CA ê¸°ë°˜ TLS ì •ìƒ ë°œê¸‰
- [ ]  SealedSecret Rotation + Re-Seal ì •ìƒ ë™ì‘
- [ ]  ApplicationSet dev/prod Path ì •í•©ì„±
- [ ]  Slack ì•Œë¦¼ ì •ìƒ ë™ì‘
- [ ]  **ìŠ¤í† ë¦¬ì§€ ì „ìš© App**ì´ **`prune=false`, `replace=false`** ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ

---

## ğŸ  íšŒê³ 

> ì´ì œ ëª¨ë“  ë¹Œë“œÂ·ë°°í¬Â·ê´€ì œëŠ” GitOps ë£¨í”„ ì•ˆì—ì„œ ìë™ìœ¼ë¡œ ìˆœí™˜í•©ë‹ˆë‹¤.
> 
> 
> ì¥ì•  ì‹œ ìë™ ë³µêµ¬ë˜ê³ , ë³€ê²½ì€ ì¦‰ì‹œ ë°˜ì˜ë˜ë©°, ìš´ì˜ìëŠ” ë‹¨ì§€ **ì»¤ë°‹ í•œ ë²ˆ**ìœ¼ë¡œ í”Œë«í¼ ì „ ê³¼ì •ì„ ì œì–´í•©ë‹ˆë‹¤.
> 
> **Helmì˜ êµ¬ì¡° ìœ„ì— GitOps ìš´ì˜ ê³„ì¸µì„ ìŒ“ì•„, ììœ¨í˜• MLOpsë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.**
>

## ğŸ™Œ í”„ë¡œì íŠ¸ GitHub ì €ì¥ì†Œ

- GitHub ì½”ë“œ: [[GitOps] mlops-platform](https://https://github.com/keonhoban/mlops-infra-labs/tree/main/mlops-platform)

