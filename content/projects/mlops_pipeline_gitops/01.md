+++
date = '2025-10-03T17:10:21+09:00'
draft = false
title = '[MLOps ìš´ì˜ ê³ ë„í™” - ì—í•„ë¡œê·¸]'
categories = ['MLOps Pipeline', 'Kubernetes', 'Git', 'GitOps(ArgoCD)', 'CI/CD', 'Security', 'Observability', 'Architecture']
+++

## ì—í•„ë¡œê·¸ â€” â€œí•œ ë²ˆì˜ ì»¤ë°‹ìœ¼ë¡œ ëê¹Œì§€ ê°€ëŠ” ììœ¨í˜• MLOps í”Œë«í¼â€

---

## ğŸ“Œ ì „ì²´ ê²½ë¡œ ìš”ì•½

| ìˆœì„œ | ì£¼ì œ |
| --- | --- |
| 0 | [ğŸ”— FastAPI A/BÂ·CanaryÂ·Blue-Green ì„œë¹™ ë² ì´ìŠ¤](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/01/) |
| 1 | [ğŸ”— í•«ìŠ¤ì™‘ ê³ ë„í™” (/reload ë³´ì•ˆÂ·DAG ìë™í™”)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/02/) |
| 2 | [ğŸ”— Slack Alert í†µí•© (FastAPIÂ·Airflow ê³µìš©)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/03/) |
| 3 | [ğŸ”— ëª¨ë¸ ë¡¤ë°± ìë™í™” (ë“±ë¡ ì‹¤íŒ¨ ëŒ€ë¹„ ë³µêµ¬)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/04/) |
| 4 | [ğŸ”— FastAPI ë¡œê·¸ ì•ˆì •í™” (NFS + PV/PVC + Loguru)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/05/) |
| 5 | [ğŸ”— Airflow ì•ˆì •í™” & FastAPI HTTPS ë³´ì•ˆ](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/06/) |
| 6 | [ğŸ”— GitOps ê³ ë„í™” (Argo CDÂ·MetalLBÂ·ApplicationSet)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/07/) |
| 7 | [ğŸ”— Argo CD Notifications ìë™í™” (Slack ì—°ë™)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/08/) |
| 8 | [ğŸ”— CI/CD ìš´ì˜ ìë™í™” (GitHub ActionsÂ·Helm Lint)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/09/) |
| 9 | [ğŸ”— ì‹œí¬ë¦¿ ê´€ë¦¬ & í‚¤ íšŒì „ ìë™í™” (AWSÂ·SealedSecret)](https://keonhoban.github.io/mlops-journey/posts/mlops-platform-gitops/10/) |
| 10 | [ğŸ”— ê²€ì¦ (Proof of Automation)](https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline_gitops/02/) |

---

---

## ğŸ¯ ì „ì²´ íšŒê³  ìš”ì•½ (0~9ë‹¨ê³„)

| ë‹¨ê³„ | í•µì‹¬ ëª©í‘œ | ì£¼ìš” ê°œì„ ì  |
| --- | --- | --- |
| 0 | FastAPI ë¦¬ë‰´ì–¼ | `/predict`Â·`/variant`Â·`/reload`ë¡œ A/BÂ·CanaryÂ·Blue-Green ê³µìš© ë¼ìš°íŒ… |
| 1 | í•«ìŠ¤ì™‘ ë³´ì•ˆ/ìë™í™” | í† í° ì¸ì¦ `/reload` + Ingress í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸/TLS |
| 2 | Slack Alert í†µí•© | FastAPIÂ·Airflow ê³µìš© ì•Œë¦¼ í•¨ìˆ˜ + ì‹¤íŒ¨ ì½œë°± Slack ì—°ë™ |
| 3 | ë¡¤ë°± ìë™í™” | ë“±ë¡ ì‹¤íŒ¨ ì‹œ ì´ì „ ë²„ì „ ë¡¤ë°± + READY í›„ ìë™ `/reload` |
| 4 | ë¡œê·¸ ì•ˆì •í™” | FastAPI=NFS, Airflow=S3 ë¡œê·¸ ê³„ì¸µ ë¶„ë¦¬Â·í‘œì¤€í™” |
| 5 | Airflow ì•ˆì •í™”Â·HTTPS | Sensor/ì˜ì¡´ì„± ì •ë¦¬ + cert-manager ê¸°ë°˜ TLS |
| 6 | GitOps ì „í™˜ | MetalLB + SealedSecret + ApplicationSet ë°°í¬ êµ¬ì¡° |
| 7 | GitOps ëª¨ë‹ˆí„°ë§ | ArgoCD â†’ Slack Sync/Health ìƒíƒœ ì•Œë¦¼ |
| 8 | CI/CD ê³ ë„í™” | Helm Lint + kubeconform + yamllint PR/ë¨¸ì§€ íŒŒì´í”„ë¼ì¸ |
| 9 | SecretOps í‘œì¤€í™” | AWS Key Rotation + SealedSecret Re-seal ìë™í™” |

> ğŸ”„ í•µì‹¬
> 
> 
> â€œGit ì»¤ë°‹ í•œ ë²ˆìœ¼ë¡œ í•™ìŠµâ†’ë“±ë¡â†’ë°°í¬â†’ì‹¤í—˜â†’ëª¨ë‹ˆí„°ë§â†’ë³µêµ¬ê¹Œì§€ ììœ¨ ìˆœí™˜í•œë‹¤.â€
> 

---

## âš™ï¸ Helm ê¸°ì¤€ì„  êµ¬ì¡° (Before GitOps)

![mermaid-10-01.png](/mlops-journey/images/mermaid-10-01.png)


**Before íŠ¹ì§•**

- `helm upgrade` ê¸°ë°˜ ìˆ˜ë™ ë°°í¬.
- Secret ìˆ˜ë™ ìƒì„± (`kubectl create secret ...`).
- Airflow ë¡œê·¸ëŠ” **S3 ì—…ë¡œë“œ**, FastAPIëŠ” **NFS(PV/PVC)** ë³´ì¡´.
- ì¸ì¦ì„œ: prodì€ `letsencrypt-prod` í‘œê¸°ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, **ë‚´ë¶€ hosts ê¸°ë°˜ self-signedì™€ ì‹¤ì§ˆ ë™ì¼**.

---

## ğŸ§© GitOps ì „í™˜ í›„ (After)

> Helm í…œí”Œë¦¿ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë©´ì„œ, ArgoCDë¡œ ë°°í¬Â·ë³´ì•ˆÂ·ê´€ì œë¥¼ ìë™í™”.
> 

![mermaid-10-02.png](/mlops-journey/images/mermaid-10-02.png)

**After íŠ¹ì§•**

- **Helm values íŒ¨í„´ ê·¸ëŒ€ë¡œ ìœ ì§€**
- **í™˜ê²½ë³„ Namespace ì™„ì „ ë¶„ë¦¬** â†’ dev/prod ë™ì‹œ ìš´ì˜ ì•ˆì •í™”
- **Airflow=S3 Remote Logging**, **FastAPI=NFS(Loguru rotation)** ìœ ì§€
- **cert-manager ë‚´ë¶€ CA ê¸°ë°˜ TLS ìë™í™”** â€” hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§ìœ¼ë¡œ ì™¸ë¶€ ë…¸ì¶œ ì—†ì´ íì‡„í˜• TLS ìš´ì˜
- **ArgoCD ApplicationSet** ìœ¼ë¡œ dev/prod ìë™ ë°°í¬ + SelfHeal
- **SealedSecret + Rotation/Re-Seal** ë¡œ Key ê´€ë¦¬ ì™„ì „ ìë™í™”
- **ìŠ¤í† ë¦¬ì§€(PV/PVC)** ëŠ” ì›Œí¬ë¡œë“œì™€ **ìƒëª…ì£¼ê¸° ë¶„ë¦¬**: **ì „ìš© Application(Prune=false, Replace=false)** ë¡œ ê´€ë¦¬í•´ ë°ì´í„° ë³´ì¡´ê³¼ ì•ˆì „í•œ ë“œë¦¬í”„íŠ¸ ê°ì‹œ

---

## ğŸ” Helm â†’ GitOps ë³€í™” ìš”ì•½

| ì˜ì—­ | Helm (Before) | GitOps (After) | ì˜ë¯¸ |
| --- | --- | --- | --- |
| ë°°í¬ ë°©ì‹ | ìˆ˜ë™ `helm upgrade` | ArgoCD Auto Sync | ìë™í™”Â·SelfHeal |
| Secret ê´€ë¦¬ | kubectl ìˆ˜ë™ | SealedSecret + Rotation/Re-Seal | â€œSecrets as Codeâ€ |
| ë¡œê·¸ | FastAPI=NFS / Airflow=S3 | FastAPI=NFS ìœ ì§€ / Airflow=S3 ì¼ì›í™” | ì´ì›í™” í‘œì¤€í™” |
| ì¸ì¦ì„œ ì²´ê³„ | `cert-manager + LE í‘œê¸° (ì‹¤ì§ˆ self-signed)` | **cert-manager ë‚´ë¶€ CA ê¸°ë°˜ ìë™ TLS (hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§)** | ì™¸ë¶€ CA ì—†ì´ ìë™ ê°±ì‹  
+ ê³µê²© í‘œë©´ ìµœì†Œí™” |
| CI/CD | ìˆ˜ë™ ë¹Œë“œ | GitHub Actions + ArgoCD Pipeline | â€œPRâ†’ë°°í¬â†’Slackâ€ ì¼ì›í™” |
| ê´€ì œ | ê°œë³„ ì•Œë¦¼ | ArgoCD Notifications + Slack | ì‹¤ì‹œê°„ ê´€ì œ ì¼ì›í™” |
| ë„¤ì„ìŠ¤í˜ì´ìŠ¤ | ë‹¨ì¼ | í™˜ê²½ë³„ ë¶„ë¦¬ | ê²©ë¦¬Â·ë³µêµ¬ ìš©ì´ |
| ìŠ¤í† ë¦¬ì§€(PV/PVC) | ìˆ˜ë™ `kubectl apply` | ì „ìš© App + prune=false + replace=false | ë°ì´í„° ë³´ì¡´Â·ìˆ˜ëª…ì£¼ê¸° ë¶„ë¦¬ |

> ìˆ˜ë™ ë¹Œë“œÂ·ë°°í¬ì—ì„œ ë²—ì–´ë‚˜, PR â†’ CI â†’ ArgoCD â†’ Slack â†’ ì‹¤í—˜ìœ¼ë¡œ ì´ì–´ì§€ëŠ” ìë™í™”ëœ â€œOne Commit Flowâ€ ì™„ì„±.
> 

---

## ğŸ” One Commit Flow

![mermaid-10-03.png](/mlops-journey/images/mermaid-10-03.png)

---

## ğŸ§  ìš´ì˜ ì›ì¹™

- **ë³´ì•ˆ/ì‹œí¬ë¦¿** â†’ AWS Key Rotation + Re-Seal ì™„ì „ ìë™í™”
- **ë°°í¬ ì•ˆì •ì„±** â†’ Sensor READY ì´í›„ Reload, ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ìë™ ë°˜ì˜
- **ë¡œê·¸ êµ¬ì¡°** â†’ Airflow=S3 / FastAPI=NFS, ê¶Œí•œÂ·ë³´ê´€Â·ë¡œí…Œì´ì…˜ ì¼ì›í™”
- **TLS ì²´ê³„** â†’ cert-manager ë‚´ë¶€ CA ìë™ ê°±ì‹ , hosts ê¸°ë°˜ ë‚´ë¶€ ì‹ ë¢°ë§ ìš´ì˜
- **GitOps ë³µì›ë ¥** â†’ ApplicationSet + SelfHeal + Pruneë¡œ OutOfSync ìë™ ë³µêµ¬
- **ìŠ¤í† ë¦¬ì§€ ë¶„ë¦¬** â†’ PV/PVCëŠ” **ì „ìš© ArgoCD App**ìœ¼ë¡œ ìš´ì˜(â€» **Prune/Replace ë¹„í™œì„±**ìœ¼ë¡œ ë°ì´í„° ì•ˆì „ì„± í™•ë³´)

---

## âœ… ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  Airflow S3 Prefix(dev/prod) ì •ìƒ ê¸°ë¡
- [ ]  FastAPI `/app/logs` NFS ê¶Œí•œ ì¼ì¹˜(fsGroup/runAsUser)
- [ ]  cert-manager ë‚´ë¶€ CA ê¸°ë°˜ TLS ì •ìƒ ë°œê¸‰
- [ ]  SealedSecret Rotation + Re-Seal ì •ìƒ ë™ì‘
- [ ]  ApplicationSet dev/prod Path ì •í•©ì„±
- [ ]  Slack ì•Œë¦¼ ì •ìƒ ë™ì‘
- [ ]  **ìŠ¤í† ë¦¬ì§€ ì „ìš© App**ì´ **`prune=false`, `replace=false`** ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ

---

## ğŸ  íšŒê³ 

> ì´ì œ ëª¨ë“  ë¹Œë“œÂ·ë°°í¬Â·ê´€ì œëŠ” GitOps ë£¨í”„ ì•ˆì—ì„œ ìë™ìœ¼ë¡œ ìˆœí™˜í•©ë‹ˆë‹¤.
> 
> 
> ì¥ì•  ì‹œ ìë™ ë³µêµ¬ë˜ê³ , ë³€ê²½ì€ ì¦‰ì‹œ ë°˜ì˜ë˜ë©°, ìš´ì˜ìëŠ” ë‹¨ì§€ **ì»¤ë°‹ í•œ ë²ˆ**ìœ¼ë¡œ í”Œë«í¼ ì „ ê³¼ì •ì„ ì œì–´í•©ë‹ˆë‹¤.
> 
> **Helmì˜ êµ¬ì¡° ìœ„ì— GitOps ìš´ì˜ ê³„ì¸µì„ ìŒ“ì•„, ììœ¨í˜• MLOpsë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.**
>

## ğŸ™Œ í”„ë¡œì íŠ¸ GitHub ì €ì¥ì†Œ

- GitHub ì½”ë“œ: [[GitOps] mlops-platform](https://github.com/keonhoban/mlops-infra-labs/tree/main/mlops-platform)

