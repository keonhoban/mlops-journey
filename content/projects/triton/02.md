+++
date = '2026-01-07T13:05:22+09:00'
draft = true
title = '[Triton ìš´ì˜í˜• ì„œë¹™ í”Œë«í¼ (GitOps Â· ê²€ì¦ Â· Alerting) - ê²€ì¦(Proof)]'
categories = ['Triton', 'GitOps(ArgoCD)', 'Helm', 'Kubernetes', 'Grafana', 'ONNX', 'NFS']
+++

## ğŸ§­ ëª©ì°¨

| êµ¬ë¶„ | ì¦ëª… í¬ì¸íŠ¸ |
| --- | --- |
| **A. Triton GitOps & Dev/Prod ë¶„ë¦¬** | ArgoCD/Helm ê¸°ì¤€ìœ¼ë¡œ dev/prodê°€ ë…ë¦½ ë°°í¬ë¨ |
| **B. Model Repository & Explicit Control** | NFS model-repo + explicit load/unload ìš´ì˜ ì œì–´ ê°€ëŠ¥ |
| **C. Serving E2E ê²€ì¦** | load â†’ ready â†’ infer ì„±ê³µìœ¼ë¡œ â€œì„œë¹™ ìì²´â€ ê²€ì¦ |
| **D. Observability** | `/metrics` â†’ Prometheus scrape â†’ Grafana íŒ¨ë„ë¡œ ì¦ëª… |
| **E. Deployment Pipeline (MLflowâ†’Airflowâ†’Triton)** | ë°°í¬â†’ê²€ì¦â†’commit, ì‹¤íŒ¨ ì‹œ minimal rollbackì´ ì‘ë™ |
| **F. Alerting ìš´ì˜ í‘œì¤€** | Alertmanager null default + namespace matchë¡œ dev/prod ë¶„ê¸° ë¼ìš°íŒ… |
| **G. Triton Serving Alerts ê²€ì¦** | mean latency ì•ŒëŸ¿ firingâ†’receiverâ†’Slackê¹Œì§€ E2E ì¦ëª… |

---

# A. Triton GitOps & Dev/Prod ë¶„ë¦¬

## 1ï¸âƒ£ ArgoCD Applications (GitOps ê¸°ì¤€)

### âœ” 1-1. dev/prod ì•± ë™ê¸°í™” ìƒíƒœ í™•ì¸

```bash
kubectl -n argocd get applications | grep triton

```

**í™•ì¸ í¬ì¸íŠ¸**

- `triton-dev`, `triton-prod` ê°ê° ì¡´ì¬
- SYNCED/HEALTHY ìœ ì§€

**ğŸ‘‰ ê²°ë¡ **: Tritonì€ GitOps ê¸°ì¤€ìœ¼ë¡œ dev/prod ë…ë¦½ ë°°í¬ë˜ê³ , idempotentí•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.

---

# B. Model Repository & Explicit Control

## 1ï¸âƒ£ NFS model-repo êµ¬ì¡° ì¦ëª…

**ì¦ê±°(êµ¬ì¡°)**

```
/model-repo/dev/simple_model/1/model.onnx
/model-repo/prod/simple_model/1/model.onnx

```

**í™•ì¸ í¬ì¸íŠ¸**

- PV/PVCê°€ dev/prod ë‹¤ë¥¸ pathë¥¼ ì‚¬ìš©
- PVC ì´ë¦„ì´ ê°™ì•„ë„ namespace ê²©ë¦¬ë¡œ ì¶©ëŒ ì—†ìŒ

**ğŸ‘‰ ê²°ë¡ **: ëª¨ë¸ ì €ì¥ì†Œê°€ í™˜ê²½ë³„ë¡œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ë˜ì–´ êµì°¨ ì˜¤ì—¼ ê°€ëŠ¥ì„±ì´ ë‚®ìŠµë‹ˆë‹¤.

---

## 2ï¸âƒ£ explicit ëª¨ë“œ ì¦ëª…

**í™•ì¸ í¬ì¸íŠ¸**

- ì„œë²„ ì˜µì…˜ì— `model-control-mode=explicit`
- ìë™ ë¡œë”©ì´ ì•„ë‹Œ **ëª…ì‹œì  load í˜¸ì¶œ ì‹œë§Œ ëª¨ë¸ í™œì„±**

**ğŸ‘‰ ê²°ë¡ **: ëª¨ë¸ êµì²´/ë°°í¬ê°€ â€œí†µì œ ê°€ëŠ¥í•œ ìœ„í—˜ êµ¬ê°„â€ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.

---

# C. Serving E2E ê²€ì¦ (Load â†’ Ready â†’ Infer)

## 1ï¸âƒ£ ëª¨ë¸ ë¡œë“œ/ìƒíƒœ/í—¬ìŠ¤

### âœ” load

```bash
curl -sS -X POST http://<triton>:8000/v2/repository/models/simple_model/load

```

### âœ” ready

```bash
curl -sS http://<triton>:8000/v2/health/ready

```

### âœ” model ready

```bash
curl -sS http://<triton>:8000/v2/models/simple_model

```

**í™•ì¸ í¬ì¸íŠ¸**

- ready 200 OK
- model endpointì—ì„œ input/output shape í™•ì¸ ê°€ëŠ¥

**ğŸ‘‰ ê²°ë¡ **: ëª¨ë¸ì´ Triton ë‚´ë¶€ì— ì •ìƒ ë¡œë”©ë˜ê³  â€œì‹¤í–‰ ê°€ëŠ¥ ìƒíƒœâ€ì„ì´ í™•ì¸ë©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ ì¶”ë¡ (smooth infer) ê²€ì¦

```bash
curl -sS -X POST http://<triton>:8000/v2/models/simple_model/infer \
  -H"Content-Type: application/json" \
  -d'{"inputs":[{"name":"input","shape":[1,4],"datatype":"FP32","data":[1,2,3,4]}]}'

```

**í™•ì¸ í¬ì¸íŠ¸**

- ì…ë ¥ shape `[1,4]`ë¡œ ìš”ì²­ ì‹œ ì •ìƒ ì‘ë‹µ
- config.pbtxt dims mismatch ì‹œ load ì‹¤íŒ¨(ì—„ê²© ê²€ì¦) ê²½í—˜ í¬í•¨

**ğŸ‘‰ ê²°ë¡ **: â€œë¡œë“œ ì„±ê³µ but ì¶”ë¡  ì‹¤íŒ¨â€ ì¼€ì´ìŠ¤ê¹Œì§€ ì°¨ë‹¨í•˜ëŠ” ê¸°ì¤€ì´ ë§ˆë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

# D. Observability ì¦ëª… (/metrics â†’ Prometheus â†’ Grafana)

## 1ï¸âƒ£ /metricsì—ì„œ inference ë©”íŠ¸ë¦­ ë“±ì¥ ì¦ëª…

- ì´ˆê¸°ì—ëŠ” CPU ê¸°ë³¸ ì§€í‘œë§Œ ë³´ì¼ ìˆ˜ ìˆìŒ
- inferë¥¼ 1~2íšŒ ìˆ˜í–‰í•˜ë©´ ì•„ë˜ ë©”íŠ¸ë¦­ì´ ë‚˜íƒ€ë‚¨:
    - `nv_inference_request_success`
    - `nv_inference_request_duration_us`
    - `nv_inference_queue_duration_us`
    - `nv_inference_count`

**ğŸ‘‰ ê²°ë¡ **: Tritonì€ â€œì‹¤ì œ ì‹¤í–‰ ì‚¬ì‹¤â€ì„ ë©”íŠ¸ë¦­ìœ¼ë¡œ ë‚¨ê¸°ë©°, ê´€ì¸¡ ê°€ëŠ¥í•œ ì„œë¹™ ìƒíƒœê°€ ë©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ ServiceMonitor ê¸°ë°˜ scrape ì¦ëª…

**í™•ì¸ í¬ì¸íŠ¸**

- ServiceMonitorì— `release=monitoring-{dev|prod}` ë¼ë²¨ ì¡´ì¬
- Prometheusì˜ `serviceMonitorSelector.matchLabels.release`ì™€ 1:1 ë§¤ì¹­
- `namespaceSelector.matchNames: [Release.Namespace]`ë¡œ ìˆ˜ì§‘ ë²”ìœ„ ê³ ì •

**ğŸ‘‰ ê²°ë¡ **: dev/prod Prometheusê°€ ì„œë¡œ ë‹¤ë¥¸ namespaceë§Œ scrapeí•˜ë„ë¡ êµ¬ì¡°ì ìœ¼ë¡œ ê°•ì œë©ë‹ˆë‹¤.

---

## 3ï¸âƒ£ Grafana íŒ¨ë„ ì¦ëª…

**íŒ¨ë„(ìµœì†Œ)**

- RPS (ìš”ì²­ ìˆ˜)
- Avg Latency (mean)
- Avg Queue
- CPU
- Total Count

**ğŸ‘‰ ê²°ë¡ **: Triton ì„œë¹™ ìƒíƒœê°€ â€œëŒ€ì‹œë³´ë“œë¡œ ì„¤ëª… ê°€ëŠ¥â€í•œ ìš´ì˜ ë‹¨ìœ„ë¡œ ê²©ìƒë©ë‹ˆë‹¤.

---

# E. MLflow â†’ Airflow â†’ Triton ë°°í¬ íŒŒì´í”„ë¼ì¸ ì¦ëª…

## 1ï¸âƒ£ DAG ìƒíƒœ ì „ì´(ê²€ì¦ ì²´ì¸) ì¦ëª…

**DAG íë¦„**

- snapshot_current
- materialize_repo (MLflow â†’ ONNX â†’ model-repo ë°°ì¹˜)
- triton_load
- triton_ready
- triton_infer_smoke
- commit_current
- (fail) rollback_minimal (TriggerRule.ONE_FAILED)

**í™•ì¸ í¬ì¸íŠ¸**

- commitì€ ëª¨ë“  ê²€ì¦ ì„±ê³µ í›„ì—ë§Œ ì‹¤í–‰
- rollbackì€ ì²´ì¸ ì–´ë””ì„œë“  ì‹¤íŒ¨í•˜ë©´ ìë™ ì‹¤í–‰

**ğŸ‘‰ ê²°ë¡ **: ë°°í¬ê°€ â€œìˆ˜ë™ ê°â€ì´ ì•„ë‹ˆë¼ â€œê²€ì¦ ê¸°ë°˜ ìƒíƒœ ì „ì´â€ë¡œ ê³ ì •ë©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ current.json(commit) ì¦ëª…

**ì˜ˆì‹œ**

```json
{
"active_version":13,
"run_id":"...",
"alias":"A",
"updated_at_utc":"20251231T025902"
}

```

**ğŸ‘‰ ê²°ë¡ **: ì‚¬ëŒì´ ì•„ë‹ˆë¼ ì‹œìŠ¤í…œì´ í•´ì„ ê°€ëŠ¥í•œ ìš´ì˜ ìƒíƒœê°€ íŒŒì¼ë¡œ ê³ ì •ë©ë‹ˆë‹¤.

---

# F. Alerting ìš´ì˜ í‘œì¤€ (Dev/Prod ì² ë²½ ë¶„ë¦¬)

## 1ï¸âƒ£ Alertmanager null default ì¦ëª…

**ì •ì±…**

- route.receiver = `"null"`
- Slack ì „ì†¡ì€ routes + matchersë¡œë§Œ í—ˆìš©

**í™•ì¸ í¬ì¸íŠ¸**

- êµì°¨ namespace ì•ŒëŸ¿ì´ ë“¤ì–´ì™€ë„ receiverê°€ nullë¡œ ë–¨ì–´ì ¸ì•¼ í•¨

**ğŸ‘‰ ê²°ë¡ **: ì•ŒëŸ¿ ì‹¤ìˆ˜/ë¼ë²¨ ëˆ„ë½ì´ ìˆì–´ë„ â€œìš´ì˜ ì±„ë„ ì˜¤ì—¼â€ì„ êµ¬ì¡°ì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.

---

# G. Triton Serving Alerts ê²€ì¦ (E2E)

## 1ï¸âƒ£ PrometheusRule ì ìš© ì¦ëª…

- `TritonHighErrorRate`
- `TritonMeanLatencyHigh` (mean ê¸°ë°˜)

**ğŸ‘‰ ê²°ë¡ **: ëª¨ë¸ ì‹¤í–‰ ê´€ì (ì„œë¹™ í’ˆì§ˆ) ì•ŒëŸ¿ ì •ì˜ê°€ í´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë©ë‹ˆë‹¤.

---

## 2ï¸âƒ£ Mean Latency ì•ŒëŸ¿ firing â†’ Alertmanager receiver â†’ Slack ìˆ˜ì‹ 

### 1) loadgenìœ¼ë¡œ inference ë°œìƒ

```bash
kubectl -n triton-dev run loadgen --rm -i --restart=Never \
  --image=curlimages/curl:8.6.0 -- \
  sh -lc '
  for i in $(seq 1 20); do
    curl -sS http://triton.triton-dev.svc.cluster.local:8000/v2/models/best_model/infer \
      -H "Content-Type: application/json" \
      -d "{\"inputs\":[{\"name\":\"input\",\"shape\":[1,4],\"datatype\":\"FP32\",\"data\":[1,2,3,4]}]}" \
      >/dev/null || true
  done
  echo done
'

```

### 2) Prometheusì—ì„œ firing í™•ì¸

```bash
curl -sk https://prometheus-dev.local/api/v1/alerts \
| jq'.data.alerts[] | select(.labels.alertname=="TritonMeanLatencyHigh")'

```

### 3) Alertmanager receiver í™•ì¸

```bash
curl -sk https://alert-dev.local/api/v2/alerts/groups \
| jq'.[] | select(.labels.alertname=="TritonMeanLatencyHigh") | .receiver.name'

```

**ê¸°ëŒ€ê°’**

- dev: `"slack-dev"`
- prod: `"slack-prod"`
- êµì°¨ëŠ” `"null"`

**ğŸ‘‰ ê²°ë¡ **: Triton ì•ŒëŸ¿ì´ dev/prod ì •ì±…ì— ë”°ë¼ ì •í™•íˆ ë¼ìš°íŒ…ë˜ë©°, ìš´ì˜ í‘œì¤€ì´ ì‹¤ì œë¡œ ì‘ë™í•©ë‹ˆë‹¤.

---

## 3ï¸âƒ£ HighErrorRate â€œí…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ìš´ ì´ìœ â€ë¥¼ ë¬¸ì„œí™”í•œ ì¦ëª…

- `nv_inference_request_failure`ëŠ” â€œëª¨ë¸ ì‹¤í–‰ ë‹¨ê³„ ì‹¤íŒ¨â€ë§Œ ì¹´ìš´íŠ¸
- HTTP ì‹¤íŒ¨ìœ¨ì€ Gateway(Envoy/Nginx/Ingress) ì§€í‘œë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ìš´ì˜ì ìœ¼ë¡œ ì •í™•

**ğŸ‘‰ ê²°ë¡ **: ì•ŒëŸ¿ì„ â€œë˜ê²Œ ë§Œë“¤ê¸°â€ê°€ ì•„ë‹ˆë¼, **ìš´ì˜ ì˜ë¯¸ê°€ ë§ëŠ” ê´€ì¸¡ ì§€ì **ìœ¼ë¡œ ì„¤ê³„ë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

# âœ… ìµœì¢… ê²°ë¡ 

- Tritonì€ GitOpsë¡œ dev/prod ë¶„ë¦¬ ë°°í¬ë˜ê³ ,
- explicit ëª¨ë¸ ì œì–´ + NFS model-repoë¡œ ìš´ì˜ í†µì œ ê°€ëŠ¥í•˜ë©°,
- load/ready/inferë¡œ ì„œë¹™ E2Eê°€ ê²€ì¦ë˜ê³ ,
- `/metrics` ê¸°ë°˜ìœ¼ë¡œ ê´€ì¸¡ì´ ê°€ëŠ¥í•˜ë©°,
- MLflowâ†’Airflowâ†’Triton ë°°í¬ê°€ ê²€ì¦ ì²´ì¸ + ìµœì†Œ ë¡¤ë°±ìœ¼ë¡œ ìš´ì˜í™”ë˜ì—ˆê³ ,
- Alertmanager null default + namespace match ì •ì±…ìœ¼ë¡œ dev/prod ì•ŒëŸ¿ ì‹ ë¢°ì„±ì´ ë³´ì¥ë©ë‹ˆë‹¤.
