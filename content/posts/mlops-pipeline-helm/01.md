+++
date = '2025-06-23T17:11:47+09:00'
draft = false
title = '[MLOps í”Œëž«í¼ êµ¬ì¶• - 1ë‹¨ê³„: ì¸í”„ë¼ ì„¤ê³„ ë° í™˜ê²½ ì¤€ë¹„]'
categories = ['NFS', 'PostgreSQL', 'AWS', 'Kubernetes']
+++

## âœ¨ TL;DR

- **ë‹¨ìˆœí•œ ML íŒŒì´í”„ë¼ì¸ êµ¬ì„±**ì„ ë„˜ì–´ì„œ, **ì¸í”„ë¼ ì„¤ê³„ë¶€í„° êµ¬ì¶•ê¹Œì§€** ì§„í–‰
- MLflow, Airflow, FastAPIë¥¼ ë¡œì»¬ ì¿ ë²„ë„¤í‹°ìŠ¤ ìœ„ì—ì„œ  êµ¬ì„±, ì‹¤ë¬´ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ êµ¬ì¡°ë¥¼ ì§ì ‘ ì„¤ê³„/êµ¬í˜„
- ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” **MLOps ì¸í”„ë¼ ì „ì²´ êµ¬ì¡°**, ê·¸ë¦¬ê³  ê·¸ ê¸°ë°˜ì´ ë˜ëŠ” NFS ì„œë²„, PostgreSQL, S3 ë²„í‚·, Kubernetes í´ëŸ¬ìŠ¤í„° í™˜ê²½ ê³µìœ 

---

## ðŸ§± ì•„í‚¤í…ì²˜ êµ¬ì„±ë„

```mermaid
graph TD

%% NFS êµ¬ì¡°
subgraph NFS_VM["NFS VM"]
  NFS[(ðŸ“‚ Logs)]
end

%% PostgreSQL êµ¬ì¡°
subgraph DB_VM["PostgreSQL VM"]
  airflow_db[(ðŸ—„ï¸ airflow_db)]
  mlflow_db[(ðŸ—„ï¸ mlflow_db)]
end

%% AWS êµ¬ì¡°
subgraph AWS["AWS"]
  S3[(ðŸª£ S3 / MLflow_artifacts)]
end

%% í´ëŸ¬ìŠ¤í„°
subgraph K8s_Cluster["ðŸ“¦ K8s Cluster"]
  Airflow[Airflow Pod]
  MLflow[MLflow Pod]
  FastAPI[FastAPI Pod]
end

%% ì™¸ë¶€ ì—°ë™
Airflow --> NFS
Airflow --> airflow_db
Airflow --> S3

MLflow --> mlflow_db
MLflow --> S3

FastAPI --> S3
FastAPI --> MLflow

```

---

## ðŸ”§ ì¸í”„ë¼ ì„¤ê³„ ê°œìš”

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
| --- | --- |
| Kubernetes í´ëŸ¬ìŠ¤í„° | ë¡œì»¬ í™˜ê²½ (VMware) ê¸°ë°˜. Helm & Ingress í™œìš© |
| MLflow ì„œë²„ | ì™¸ë¶€ PostgreSQL + S3 ì—°ë™. ëª¨ë¸ ë“±ë¡, ì¶”ì , ì•„í‹°íŒ©íŠ¸ ê´€ë¦¬ |
| Airflow ì„œë²„ | DAG GitSync + S3 ì—°ë™ + PostgreSQL ì™¸ë¶€ DB ì‚¬ìš© |
| FastAPI ì„œë²„ | MLflow ëª¨ë¸ í˜¸ì¶œìš© ì˜ˆì¸¡ API. Ingressë¡œ ì™¸ë¶€ ë…¸ì¶œ |
| NFS ì„œë²„ | Airflow ë¡œê·¸ ì €ìž¥ì†Œë¡œ ì‚¬ìš©. PVCë¡œ ì—°ê²°ë¨ (S3 ê°€ëŠ¥í•˜ì§€ë§Œ, pvc í…ŒìŠ¤íŠ¸) |
| AWS S3 | MLflow ì•„í‹°íŒ©íŠ¸ ì €ìž¥ì†Œë¡œ í™œìš© |
| PostgreSQL | MLflow & Airflowì˜ metadata ì €ìž¥ì†Œ. ì™¸ë¶€ VMì—ì„œ í˜¸ìŠ¤íŒ…ë¨ |

---

## ðŸ“‚ NFS ì„œë²„ êµ¬ì„±

### âœ… ì„¤ì¹˜ & ê³µìœ  ë””ë ‰í† ë¦¬ ìƒì„± (Ubuntu ê¸°ì¤€)

```bash
sudo apt update
sudo apt install -y nfs-kernel-server

sudo mkdir -p /mnt/nfs_share/mlops/airflow/logs
sudo chown -R 50000:root /mnt/nfs_share/mlops/airflow  # ì‚¬ìš©í•  ìœ ì € UID, GID í™•ì¸ í•„ìš”
sudo chmod -R 775 /mnt/nfs_share/mlops/airflow
```

### ðŸ“„ `/etc/exports` ì„¤ì •

```bash
# ë§ˆìš´íŠ¸ ìˆ˜ê°€ ì ì€ ê²½ìš° (í”„ë¡œë•ì…˜ í™˜ê²½ ì ìš©ì‹œ root_squash ê¶Œìž¥)
/mnt/nfs_share/mlops/airflow/logs  192.168.18.0/24(rw,sync,no_subtree_check,root_squash)

# ë§ˆìš´íŠ¸ ìˆ˜ê°€ ë§Žì€ ê²½ìš° (í•„ìš”ì‹œ)
/mnt/nfs_share/mlops 192.168.18.0/24(rw,sync,no_subtree_check,root_squash)
```

```bash
# ì ìš©
sudo exportfs -rav
sudo systemctl restart nfs-kernel-server
```

ðŸ“„ PV&PVC ì„¤ì •

```bash
# cat airflow-logs-pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: airflow-logs-pv
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteMany
  nfs:
    server: 192.168.18.141
    path: /mnt/nfs_share/mlops/airflow/logs
  persistentVolumeReclaimPolicy: Retain
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: airflow-logs-pvc
  namespace: airflow
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 5Gi
      
      

# ì ìš©
kubectl apply -f airflow-logs-pv.yaml
```

---

## ðŸ—„ PostgreSQL ì™¸ë¶€ DB êµ¬ì„±

### âœ… ì„¤ì¹˜ ë° ì‚¬ìš©ìž/DB ìƒì„±

```bash
sudo apt install postgresql -y
sudo -u postgres psql
```

```sql
-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE airflow_db;
CREATE DATABASE mlflow_db;

-- DBë³„ ì‚¬ìš©ìž ìƒì„±
CREATE USER airflow_user WITH PASSWORD 'airflow1234';
CREATE USER mlflow_user WITH PASSWORD 'mlflow1234';

-- DBë³„ ê¶Œí•œ ë¶€ì—¬
GRANT ALL PRIVILEGES ON DATABASE airflow_db TO airflow_user;
GRANT ALL PRIVILEGES ON DATABASE mlflow_db TO mlflow_user;
```

### ðŸ” ì™¸ë¶€ ì ‘ì† í—ˆìš©

- `/etc/postgresql/14/main/postgresql.conf`

```
listen_addresses = '*'
```

- `/etc/postgresql/14/main/pg_hba.conf`

```
host    airflow_db     airflow_user     192.168.18.0/24   scram-sha-256
host    mlflow_db      mlflow_user      192.168.18.0/24   scram-sha-256
```

```bash
sudo systemctl restart postgresql
```

---

## ðŸª£ S3 ë²„í‚· ì¤€ë¹„ (MLflow ì•„í‹°íŒ©íŠ¸ ì €ìž¥ì†Œ)

### âœ… AWS S3 ë²„í‚· ìƒì„±

- ë²„í‚· ì´ë¦„: `mlflow-artifacts-keonho`
- ë¦¬ì „: `ap-northeast-2`
- í¼ë¸”ë¦­ ì°¨ë‹¨ ìœ ì§€, ê¸°ë³¸ ì•”í˜¸í™” ì‚¬ìš©

### âœ… IAM ì‚¬ìš©ìž ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬

- ì´ë¦„: `mlflow-airflow-user`
- ê¶Œí•œ: `AmazonS3FullAccess` (ì‹¤ìŠµìš©)
- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY` ì €ìž¥

---

## ðŸ§© Tip

- `NFS`ëŠ” ì—¬ëŸ¬ Podì—ì„œ ë¡œê·¸ë‚˜ íŒŒì¼ì„ ê³µìœ í•´ì•¼ í•  ë•Œ, PVCë¡œ ì—°ê²°í•´ë‘ë©´ ê´€ë¦¬ê°€ ì‰¬ì›€
- `PostgreSQL`ì„ ì™¸ë¶€ DBë¡œ ì“°ë©´ Helm chart ë°°í¬ ë•Œ ë‚´ë¶€ DB ì„¤ì •ì„ êº¼ì•¼ í•¨ (`enabled: false`)
- `AWS S3`ëŠ” ë°˜ë“œì‹œ **í™˜ê²½ë³€ìˆ˜ ë°©ì‹** ë˜ëŠ” **ë§ˆìš´íŠ¸ ë°©ì‹**ìœ¼ë¡œ ë³´ì•ˆ ì„¤ì •í•  ê²ƒ (ì‹¤ë¬´ì—ì„œ `.aws/credentials`ëŠ” ìµœì†Œí™”)

---

## ðŸ”§ MLOps ì‹¤ì „ ì—°ê²°

| êµ¬ì„± ìš”ì†Œ | ì‹¤ì „ ì ìš© ì‚¬ë¡€ |
| --- | --- |
| NFS ì„œë²„ | Airflow ë¡œê·¸ ê³µìœ  â†’ DAG ì‹¤íŒ¨ ë¡œê·¸ ë¶„ì„ ê°€ëŠ¥ |
| PostgreSQL ì™¸ë¶€ ì—°ë™ | MLflow/Airflow í™•ìž¥ ì‹œ **DB ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**ê³¼ ì—°ê²°ë¨ |
| S3 ì•„í‹°íŒ©íŠ¸ ì €ìž¥ | ëª¨ë¸ ë²„ì „ ê´€ë¦¬ + ëŒ€ìš©ëŸ‰ ì €ìž¥ì†Œ í™œìš© (ëª¨ë¸ ì„œë¹™ ì‹œ URIë¡œ ì ‘ê·¼ ê°€ëŠ¥) |

---

## ðŸ§­ ë‹¤ìŒ í¬ìŠ¤íŠ¸ ì˜ˆê³ 

> ðŸ” S3 & PostgreSQL ì—°ë™ì„ ìœ„í•œ ë³´ì•ˆ êµ¬ì„± ë° Secret ê´€ë¦¬
> 
> 
> â†’ ì‹¤ì œë¡œ AWS í‚¤ì™€ DB URIë¥¼ ì–´ë–»ê²Œ Kubernetes í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ê³  ì£¼ìž…í•˜ëŠ”ì§€, Helmì—ì„œ ì–´ë–»ê²Œ ë‹¤ë£¨ëŠ”ì§€ ìž‘ì„±í•  ì˜ˆì •ìž…ë‹ˆë‹¤.
>
