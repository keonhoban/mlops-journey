+++
date = '2025-06-05T20:06:39+09:00'
draft = false
title = '[Kubernetes ì‹¤ìŠµ - 3ë‹¨ê³„ : Ingress & Nginx Controller]'
categories = 'Kubernetes'
+++

## ğŸŒ Kubernetes ì‹¤ìŠµ â‘¢ â€“ Ingress & Nginx Controller

> ëª©í‘œ
> 
> 1. ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ **ë„ë©”ì¸ ë˜ëŠ” ê²½ë¡œ ê¸°ë°˜**ìœ¼ë¡œ ë¼ìš°íŒ…
> 2. Cluster ì™¸ë¶€ì—ì„œ ì„œë¹„ìŠ¤ë¥¼ `http://foo.local` í˜•ì‹ìœ¼ë¡œ ì ‘ê·¼
> 3. ì‹¤ë¬´ì—ì„œ ê°€ì¥ ë§ì´ ì“°ëŠ” Ingress êµ¬ì¡°(Nginx Ingress Controller) ìµíˆê¸°

ğŸ‘‰ ì‹¤ìŠµ ì½”ë“œëŠ” [ğŸ”— GitHub (Ingress_and_Nginx_Controller)](https://github.com/keonhoban/mlops-infra-labs/tree/main/k8s-basic/03_Ingress_and_Nginx_Controller)

---

## ğŸ§­ ì „ì²´ íë¦„ ìš”ì•½

```
â‘  Ingress Controller ì„¤ì¹˜ (minikube addons ì‚¬ìš©)
â‘¡ nginx / httpd ì„œë¹„ìŠ¤ ë°°í¬
â‘¢ Ingress ë¦¬ì†ŒìŠ¤ë¡œ ê²½ë¡œ ë¼ìš°íŒ… ì„¤ì •
â‘£ /etc/hosts ìˆ˜ì • â†’ curl í…ŒìŠ¤íŠ¸ë¡œ í™•ì¸
```

---

## ğŸ“¦ ì‹¤ìŠµ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
k8s-ingress/
â”œâ”€â”€ deploy-nginx.yaml      # nginx ë°°í¬ + ì„œë¹„ìŠ¤
â”œâ”€â”€ deploy-httpd.yaml      # httpd ë°°í¬ + ì„œë¹„ìŠ¤
â”œâ”€â”€ ingress.yaml           # Ingress ë¼ìš°íŒ… ì •ì˜
â””â”€â”€ README.md
```

---

## âš™ï¸ [1ë‹¨ê³„] Ingress Controller ì„¤ì¹˜

```bash
minikube addons enable ingress
kubectl get pods -n ingress-nginx
```

- `ingress-nginx-controller` Podê°€ `Running` ìƒíƒœë©´ ì„¤ì¹˜ ì„±ê³µ
- NodePort ê¸°ë³¸ í¬íŠ¸: `80`, `443`

---

## ğŸ§± [2ë‹¨ê³„] ì„œë¹„ìŠ¤ 2ê°œ ë°°í¬ (nginx / httpd)

### ğŸ”¹ deploy-nginx.yaml

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
    - port: 80
      targetPort: 80
```

---

### ğŸ”¹ deploy-httpd.yaml

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpd-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: httpd
  template:
    metadata:
      labels:
        app: httpd
    spec:
      containers:
      - name: httpd
        image: httpd
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: httpd-service
spec:
  selector:
    app: httpd
  ports:
    - port: 80
      targetPort: 80
```

---

## ğŸ—ºï¸ [3ë‹¨ê³„] Ingress ë¼ìš°íŒ… ì„¤ì •

### ğŸ”¹ ingress.yaml

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: example-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: foo.local
    http:
      paths:
      - path: /nginx
        pathType: Prefix
        backend:
          service:
            name: nginx-service
            port:
              number: 80
      - path: /httpd
        pathType: Prefix
        backend:
          service:
            name: httpd-service
            port:
              number: 80
```

---

## ğŸš€ [4ë‹¨ê³„] ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

### ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì ìš©

```bash
kubectl apply -f deploy-nginx.yaml
kubectl apply -f deploy-httpd.yaml
kubectl apply -f ingress.yaml
```

### minikube IP í™•ì¸

```bash
minikube ip
# ì˜ˆ: 192.168.49.2
```

### `/etc/hosts` ìˆ˜ì •

```bash
sudo nano /etc/hosts
# ì•„ë˜ ì¤„ ì¶”ê°€
192.168.49.2   foo.local
```

### curlë¡œ í…ŒìŠ¤íŠ¸

```bash
curl http://foo.local/nginx    # nginx í™”ë©´ ë°˜í™˜
curl http://foo.local/httpd    # httpd í˜ì´ì§€ ë°˜í™˜
```

---

## ğŸ¯ ì •ë¦¬ ìš”ì•½

| í•­ëª© | ë‚´ìš© |
| --- | --- |
| Ingress | HTTP(S) ìš”ì²­ì„ Path/Host ê¸°ë°˜ìœ¼ë¡œ ë‚´ë¶€ ì„œë¹„ìŠ¤ì— ë¼ìš°íŒ… |
| Ingress Controller | ì‹¤ì œ ë¼ìš°íŒ… ì²˜ë¦¬ ë‹´ë‹¹ (Nginx ë“±) |
| /etc/hosts | ë¡œì»¬ DNS ì—­í•  (í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •) |
| í™œìš© ì‚¬ë¡€ | `/api`, `/mlflow`, `/jupyter` ë“± URLë³„ ì„œë¹„ìŠ¤ ë¶„ë¦¬ ê°€ëŠ¥ |

---

## ğŸ§© ì‹¤ë¬´ íŒ

- **Ingress ControllerëŠ” ë‹¨ì¼ ì§„ì…ì  ì—­í• ** â†’ ë„ë©”ì¸ or ê²½ë¡œ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë¶„ë¦¬ ê°€ëŠ¥
- ì‹¤ë¬´ì—ì„œëŠ” TLS ì¸ì¦ì„œ ì—°ë™ (Let's Encrypt, Cert Manager)ë„ í•¨ê»˜ êµ¬ì„±
- API Gateway ì—­í• ë¡œë„ í™•ì¥ ê°€ëŠ¥ (ex. Kong, Ambassador ë“±)
- `/etc/hosts` ì„¤ì •ì€ **ê°œë°œ í™˜ê²½ ì „ìš©** (ìš´ì˜ì—ì„œëŠ” DNS ì„œë²„ì™€ ì—°ë™)
