+++
date = '2025-10-22T17:10:21+09:00'
draft = false
title = '[MLOps í”Œë«í¼ Observability & Data Pipeline - 3ë‹¨ê³„ : Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°]'
categories = ['Observability', 'Kubernetes', 'Monitoring Stack', 'Tourble Shoot', 'NFS', 'MLOps Pipeline', 'Prometheus']
+++

## Prometheus/KSM/Kubelet ì™„ì „ ë¶„ë¦¬ êµ¬ì¡°

---

## ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

> â€œdevì™€ prodëŠ” ë¶„ë¦¬ë¼ ìˆì–´ì•¼ í•˜ëŠ”ë°,
> 
> 
> ì •ì‘ ê´€ì¸¡ ë°ì´í„°ì—ì„œëŠ” ì„œë¡œ ì„ì—¬ ë³´ì´ëŠ” ë¬¸ì œê°€ ê³„ì† ìƒê²¼ìŠµë‹ˆë‹¤.â€
> 
> â€œPrometheus/KSM/Kubeletì˜ ë¼ë²¨ê³¼ ì…€ë ‰í„°ê°€ ì¡°ê¸ˆë§Œ ì–´ê¸‹ë‚˜ë„
> 
> devì—ì„œ prod ë©”íŠ¸ë¦­ì„ ì½ëŠ” ì‹¬ê°í•œ í˜¼ì„ ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì—,
> 
> ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” ê´€ì¸¡ ìŠ¤íƒì„ **ë¼ë²¨ ê¸°ë°˜ìœ¼ë¡œ ì™„ì „íˆ ì ˆë‹¨**í•˜ëŠ” ë° ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.â€
> 
> â€œê·¸ë¦¬ê³  TSDBëŠ” ë¡œì»¬ ë””ìŠ¤í¬ë¡œ ì˜®ê²¨ **ì†ë„Â·ì•ˆì •ì„±**ì„ ëŒì–´ì˜¬ë¦¬ê³ ,
> 
> NFSëŠ” ë‚˜ë¨¸ì§€ ê´€ì¸¡ ë„êµ¬ ì „ìš©ìœ¼ë¡œ ì¬ì •ë¹„í•˜ì—¬
> 
> ì´í›„ LokiÂ·Alertmanager í†µí•© ê¸°ë°˜ì˜ Observability ì „ì²´ êµ¬ì¡°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë°›ì¹  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.â€
> 

---

### ğŸ¯ í•µì‹¬ ìš”ì•½

- **ë¬¸ì œ**
    - `prometheus-dev.local`ì—ì„œ `airflow-prod`, `fastapi-prod` ë©”íŠ¸ë¦­ì´ ì„ì—¬ì„œ ë‚˜ì˜´
    - kube-state-metrics / kubelet(cAdvisor) / ServiceMonitor ë¼ë²¨ì´ ê¼¬ì—¬ devâ†”prod êµì°¨ ìˆ˜ì§‘
    - NFS ê¸°ë°˜ Prometheus TSDBë¡œ **worker2 ì¢…ë£Œ ì§€ì—° + I/O ë¶€ë‹´** ì²´ê°
- **ëª©í‘œ**
    - dev/prod **ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì™„ì „ ë¶„ë¦¬**
    - Prometheus TSDBë¥¼ **local-pathë¡œ ì „í™˜(ì†ë„Â·ì•ˆì •ì„± ê°œì„ )**
    - NFSëŠ” ê´€ì¸¡ ë„êµ¬(Grafana/Alertmanager/ë¡œê·¸ ë“±)ì—ë§Œ ì‚¬ìš©
- **ê²°ë¡ **
    - ë¼ë²¨/selector/metricRelabelings ì •ë¦¬ë§Œ í•´ë„ dev/prodê°€ ê¹¨ë—ì´ ë¶„ë¦¬ë¨
    - TSDBë¥¼ local-pathë¡œ ì˜®ê¸°ë©´ **PrometheusëŠ” ë¹ ë¥´ê³  ë…ë¦½ì ì¸ ë¡œì»¬ ë””ìŠ¤í¬**,
        
        ë‚˜ë¨¸ì§€ëŠ” NFSë¡œ ì¼ê´€ì„± ìˆê²Œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡° ì™„ì„±
        

---

## 1ï¸âƒ£ ë¬¸ì œ ìƒí™© ì •ë¦¬ â€” â€œì™œ devì—ì„œ prodê°€ ë³´ì´ì§€?â€

### 1-1. ì‹¤ì œë¡œ ê²ªì€ ì¦ìƒ

- `prometheus-dev.local`ì—ì„œ ì•„ë˜ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë©´:

```bash
curl -skG 'https://prometheus-dev.local/api/v1/query' \
  --data-urlencode 'query=count by(namespace)(kube_pod_info)'

```

- ê²°ê³¼ì— `airflow-prod`, `fastapi-prod`, `monitoring-prod` ê°™ì€ **prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ê°€ ê°™ì´ ë“±ì¥**

â†’ ê²‰ìœ¼ë¡œ ë³´ê¸°ì—” ìŠ¤íƒì€ dev/prodë¡œ ë‚˜ëˆ ì ¸ ìˆëŠ”ë°,

ê´€ì¸¡ ë°ì´í„° ë ˆë²¨ì—ì„œëŠ” â€œì„ì—¬ ìˆëŠ” ìƒíƒœâ€ì˜€ë˜ ê²ƒ.

### 1-2. ë‚˜ì¤‘ì— ì•Œê²Œ ëœ ì§„ì§œ ì›ì¸ë“¤

1. `kube-state-metrics.prometheus.monitor.additionalLabels.release` ê°’ì„ ì˜ëª» ë„£ì–´ì„œ
    - prod ìª½ KSMë„ `release=monitoring-dev` ë¡œ ì°í˜€ ë²„ë¦¼
2. Prometheusì˜ `serviceMonitorSelector.matchLabels.release` ê°€ dev/prod ê°„ ì¼ê´€ì„±ì´ ì—†ìŒ
3. kubelet(cAdvisor) ë©”íŠ¸ë¦­ì— **namespace í•„í„°ê°€ ì•ˆ ë“¤ì–´ê°€ ìˆì–´ì„œ**
    - ë…¸ë“œ ê¸°ì¤€ìœ¼ë¡œ ë–  ìˆëŠ” ëª¨ë“  ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­ì´ ì„ì—¬ ë“¤ì–´ì˜´

---

## 2ï¸âƒ£ dev/prod ì™„ì „ ë¶„ë¦¬ ì„¤ê³„ â€” â€œë¼ë²¨ë¡œ ìë¥´ëŠ” ê¸°ì¤€ ë§Œë“¤ê¸°â€

í•µì‹¬ ê°œë…ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.

> â€œëª¨ë“  ê´€ì¸¡ ë¦¬ì†ŒìŠ¤ì—ëŠ” release=monitoring-{env} ë¼ë²¨ì„ ê°•ì œí•˜ê³ ,
> 
> 
> PrometheusëŠ” ìê¸° envì˜ `release` ê°’ë§Œ ë³¸ë‹¤.â€
> 

### 2-1. Prometheus ì…€ë ‰í„° í†µì¼

### dev (`apps/monitoring-dev.yaml`)

```yaml
prometheus:
  prometheusSpec:
    serviceMonitorSelector:
      matchLabels:
        release: monitoring-dev
    podMonitorSelector:
      matchLabels:
        release: monitoring-dev
    ruleSelector:
      matchLabels:
        release: monitoring-dev

```

### prod (`apps/monitoring-prod.yaml`)

```yaml
prometheus:
  prometheusSpec:
    serviceMonitorSelector:
      matchLabels:
        release: monitoring-prod
    podMonitorSelector:
      matchLabels:
        release: monitoring-prod
    ruleSelector:
      matchLabels:
        release: monitoring-prod

```

- ì´ ì…‹ì´ í†µì¼ë¼ì•¼ í•©ë‹ˆë‹¤:
    - `ServiceMonitor.metadata.labels.release`
    - `PodMonitor.metadata.labels.release`
    - `PrometheusRule.metadata.labels.release`
- devëŠ” ë¬´ì¡°ê±´ `monitoring-dev`, prodëŠ” ë¬´ì¡°ê±´ `monitoring-prod`

---

## 3ï¸âƒ£ kube-state-metrics (KSM) â€” dev/prod ë¼ë²¨ & í•„í„°ë§

### 3-1. ì˜ëª»ëë˜ ë¶€ë¶„

```yaml
# (ì˜¤ë¥˜) apps/monitoring-prod.yaml
kube-state-metrics:
  prometheus:
    monitor:
      enabled: true
      additionalLabels:
        release: monitoring-dev   # âŒ ì—¬ê¸°ê°€ devë¡œ ë“¤ì–´ê°€ ìˆì—ˆìŒ

```

â†’ prod KSMì˜ ServiceMonitorë„ dev Prometheusê°€ ë³´ëŠ” `release=monitoring-dev` ë¼ë²¨ ì„¸íŠ¸ë¥¼ íƒ€ë²„ë¦¼.

### 3-2. ìˆ˜ì •ë³¸ (í•µì‹¬)

```yaml
# apps/monitoring-prod.yaml
kube-state-metrics:
  prometheus:
    monitor:
      enabled: true
      additionalLabels:
        release: monitoring-prod   # âœ… prodë¡œ ìˆ˜ì •
      metricRelabelings:
        - action: keep
          sourceLabels: [namespace]
          regex: '.*-prod|monitoring-prod|kube-system'

```

devë„ ë™ì¼ êµ¬ì¡°ë¡œ:

```yaml
# apps/monitoring-dev.yaml
kube-state-metrics:
  prometheus:
    monitor:
      enabled: true
      additionalLabels:
        release: monitoring-dev
      metricRelabelings:
        - action: keep
          sourceLabels: [namespace]
          regex: '.*-dev|monitoring-dev|kube-system'

```

- `additionalLabels.release = monitoring-{env}`
    
    â†’ Prometheus ìª½ `serviceMonitorSelector`ì™€ ì—°ê²°
    
- `metricRelabelings`
    
    â†’ namespace ê¸°ì¤€ìœ¼ë¡œ dev/prod/kube-systemë§Œ ë‚¨ê¸°ê¸°
    

### 3-3. ê²€ì¦ ì¿¼ë¦¬

```bash
curl -skG 'https://prometheus-dev.local/api/v1/query' \
  --data-urlencode 'query=count by(namespace)(kube_pod_info)'

curl -skG 'https://prometheus-prod.local/api/v1/query' \
  --data-urlencode 'query=count by(namespace)(kube_pod_info)'

```

- dev: `dev`, `monitoring-dev`, `kube-system` ë§Œ ë“±ì¥
- prod: `prod`, `monitoring-prod`, `kube-system` ë§Œ ë“±ì¥

---

## 4ï¸âƒ£ kubelet / cAdvisor â€” â€œë…¸ë“œëŠ” ê³µìœ ì¸ë°, ë©”íŠ¸ë¦­ë„ ê³µìœ ë˜ë©´ í°ì¼â€

### 4-1. ë¬¸ì œ í¬ì¸íŠ¸

- kubeletì˜ `/metrics/cadvisor` ì—”ë“œí¬ì¸íŠ¸ëŠ” **ë…¸ë“œ ì „ì²´ íŒŒë“œ** ë©”íŠ¸ë¦­ì„ ë…¸ì¶œ
- dev/prometheus / prod/prometheus ë‘˜ ë‹¤ kubeletì„ ìŠ¤í¬ë©í•˜ë©´,
    - í•œìª½ì—ì„œ ë‹¤ë¥¸ ìª½ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë©”íŠ¸ë¦­ê¹Œì§€ ê°™ì´ ë³´ê²Œ ë¨
- ê¸°ë³¸ `metricRelabelings`ëŠ” `/metrics`ìš©ì´ê³ ,
    
    `/metrics/cadvisor`ì—ëŠ” **ì ìš©ë˜ì§€ ì•ŠìŒ**
    

### 4-2. í•´ê²°: `cAdvisorMetricRelabelings` ì¶”ê°€

dev ì˜ˆì‹œ:

```yaml
kubelet:
  service:
    labels:
      stack: dev           # prodëŠ” stack: prod
  serviceMonitor:
    namespaceSelector:
      matchNames: [kube-system]
    selector:
      matchLabels:
        stack: dev         # dev kubeletë§Œ íƒ€ê²Œ
    metricRelabelings:
      - action: keep
        sourceLabels: [namespace]
        regex: '.*-dev|monitoring-dev|kube-system'
    cAdvisorMetricRelabelings:     # âœ… ì—¬ê¸°ì„œ í•œ ë²ˆ ë” í•„í„°
      - action: keep
        sourceLabels: [namespace]
        regex: '.*-dev|monitoring-dev|kube-system'

```

prodëŠ” `stack: prod`, `monitoring-prod`, `.*-prod` ë¡œ ë™ì¼ êµ¬ì¡°.

### 4-3. ê²€ì¦ ì¿¼ë¦¬

```bash
curl -skG 'https://prometheus-dev.local/api/v1/query' \
  --data-urlencode 'query=count by(namespace)(container_cpu_cfs_periods_total{job="kubelet", __metrics_path__="/metrics/cadvisor"})'

curl -skG 'https://prometheus-prod.local/api/v1/query' \
  --data-urlencode 'query=count by(namespace)(container_cpu_cfs_periods_total{job="kubelet", __metrics_path__="/metrics/cadvisor"})'

```

â†’ dev ì¿¼ë¦¬ ê²°ê³¼ì— prod namespaceê°€ ë³´ì´ë©´ ì•„ì§ ì–´ë”˜ê°€ êµ¬ë©ì´ ìˆëŠ” ê²ƒ.

---

## ğŸ§© íŒ â€” â€œstale metric & ì¡ì†ŒìŒ ì•ŒëŒ ì •ë¦¬â€

### 5-1. stale metric ì •ë¦¬

êµì°¨ ìˆ˜ì§‘ ì´ìŠˆë¥¼ í•´ê²°í–ˆì–´ë„ **ì´ì „ì— ìˆ˜ì§‘ëœ ì‹œê³„ì—´**ì´ ì ê¹ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Prometheusê°€ ìì²´ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ,
    
    í™˜ê²½ì„ ê¹¨ë—í•˜ê²Œ ë¦¬ì…‹í•˜ê³  ì‹¶ë‹¤ë©´:
    

```bash
kubectl -n monitoring-dev  rollout restart deploy/monitoring-dev-kube-state-metrics
kubectl -n monitoring-prod rollout restart deploy/monitoring-prod-kube-state-metrics
kubectl -n monitoring-dev  rollout restart statefulset prometheus-monitoring-dev-kube-promet-prometheus
kubectl -n monitoring-prod rollout restart statefulset prometheus-monitoring-prod-kube-prome-prometheus

```

### 5-2. tmp-curl CrashLoopBackOff ì•ŒëŒ

- ì„ì‹œ ë””ë²„ê¹…ìš© Pod `tmp-curl`ì„ ë„ì› ë‹¤ê°€ CrashLoopBackOff ìƒíƒœë¡œ ë‘ë©´
    
    `KubePodCrashLooping` ì•ŒëŒì´ ê³„ì† ëœ¹ë‹ˆë‹¤.
    

```bash
kubectl -n monitoring-dev delete pod tmp-curl --force --grace-period=0

```

### 5-3. Watchdog ì•ŒëŒ Slack ì†ŒìŒ ì œê±°

ê¸°ë³¸ Watchdog ì•ŒëŒì€ â€œíŒŒì´í”„ë¼ì¸ì´ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš©ë„â€ë¼ í•­ìƒ firing ë©ë‹ˆë‹¤.

```yaml
route:
  routes:
    - match:
        alertname: Watchdog
      receiver: "null"

receivers:
  - name: "null"

```

â†’ Slackìœ¼ë¡œ Watchdogê°€ ë‚ ì•„ì˜¤ì§€ ì•Šê²Œ ì°¨ë‹¨.

---

## 6ï¸âƒ£ Prometheus TSDB ìŠ¤í† ë¦¬ì§€ â€” NFS â†’ local-path ì „í™˜

ì´ì œ **ì„±ëŠ¥/ì•ˆì •ì„± ìª½ ì´ì•¼ê¸°**ì…ë‹ˆë‹¤.

### 6-1. ì™œ Prometheusë§Œ local-pathë¡œ ì˜®ê²¼ë‚˜?

- TSDB íŠ¹ì„±ìƒ **ì“°ê¸°Â·ì½ê¸° I/Oê°€ ë§¤ìš° ë§ê³  ë¯¼ê°í•¨**
- NFS ìœ„ì— ì˜¬ë¦¬ë©´:
    - worker ë…¸ë“œ ì¢…ë£Œ ì‹œ **unmount ëŒ€ê¸° â†’ ì¢…ë£Œ ì§€ì—°**
    - ë„¤íŠ¸ì›Œí¬/ì„œë²„ ë ˆì´í„´ì‹œê°€ ë°”ë¡œ ê´€ì¸¡ ì„±ëŠ¥ì— ì˜í–¥
- Grafana/AlertmanagerëŠ” I/OëŸ‰ì´ í›¨ì”¬ ì ìœ¼ë¯€ë¡œ NFSë¡œë„ ì¶©ë¶„

ê·¸ë˜ì„œ êµ¬ì¡°ë¥¼ ì´ë ‡ê²Œ ì •ë¦¬:

- Prometheus: `local-path` (ë…¸ë“œ ë¡œì»¬ ë””ìŠ¤í¬)
- Grafana/Alertmanager: NFS(`nfs-monitoring`)

### 6-2. values ìˆ˜ì •

### dev

```yaml
prometheus:
  prometheusSpec:
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: local-path      # ğŸ” nfs-monitoring â†’ local-path
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi

```

prodë„ ë™ì¼ êµ¬ì¡°.

### 6-3. ì‹¤ì œ ì „í™˜ ì ˆì°¨ (ë°ì´í„° ì´ˆê¸°í™” ì „ì œ)

```bash
# (1) ê°’ ë°˜ì˜
kubectl apply -f apps/monitoring-dev.yaml
kubectl apply -f apps/monitoring-prod.yaml

# (2) Prometheus ì¼ì‹œ ì¤‘ë‹¨
kubectl -n monitoring-dev  scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas=0
kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas=0

# (3) ê¸°ì¡´ NFS PVC ì‚­ì œ
kubectl -n monitoring-dev  delete pvc -l app.kubernetes.io/name=prometheus
kubectl -n monitoring-prod delete pvc -l app.kubernetes.io/name=prometheus

# (4) Prometheus ì¬ê¸°ë™ (ì´ì œ local-path ê¸°ë°˜ PVC ìƒì„±)
kubectl -n monitoring-dev  scale statefulset prometheus-monitoring-dev-kube-promet-prometheus --replicas=1
kubectl -n monitoring-prod scale statefulset prometheus-monitoring-prod-kube-prome-prometheus --replicas=1

```

> ì¤‘ê°„ì— ArgoCD selfHeal ë•Œë¬¸ì— ë ˆí”Œë¦¬ì¹´ê°€ ë‹¤ì‹œ ì˜¬ë¼ì˜¤ì§€ ì•Šë„ë¡
> 
> 
> ì ê¹ íƒ€ì´ë°ë§Œ ì‹ ê²½ ì¨ì£¼ë©´ ë©ë‹ˆë‹¤.
> 

### 6-4. PVCê°€ ì‹¤ì œë¡œ local-pathë¥¼ ì“°ëŠ”ì§€ í™•ì¸

```bash
kubectl -n monitoring-dev  get pvc | grep prometheus
kubectl -n monitoring-prod get pvc | grep prometheus
# STORAGECLASS ì—´ì´ local-path ì—¬ì•¼ ì •ìƒ

```

---

## 7ï¸âƒ£ Prometheus TSDB ì‹¤ì œ ìœ„ì¹˜ â€” â€œë°ì´í„°ê°€ ë””ìŠ¤í¬ ì–´ë””ì— ìˆë‚˜â€

### 7-1. PVC â†’ PV â†’ í˜¸ìŠ¤íŠ¸ ê²½ë¡œ ì¶”ì 

```bash
kubectl -n monitoring-dev get pvc <prometheus-pvc-name> -o yaml | grep volumeName
# volumeName: pvc-xxxxxx

kubectl get pv pvc-xxxxxx -o yaml | grep path
# path: /opt/local-path-provisioner/pvc-xxxxxx

```

â†’ **ì‹¤ì œ TSDB ë°ì´í„°ëŠ” ë…¸ë“œì˜ ì´ ê²½ë¡œì— ì €ì¥ë©ë‹ˆë‹¤:**

```
/opt/local-path-provisioner/pvc-xxxxxx

```

ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” ê°™ì€ ë³¼ë¥¨ì´ `/prometheus` ë¡œ ë§ˆìš´íŠ¸ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

### 7-2. ë…¸ë“œì—ì„œ ì§ì ‘ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ

```bash
# ì–´ëŠ ë…¸ë“œì— ì˜¬ë¼ì™€ ìˆëŠ”ì§€
kubectl -n monitoring-dev get pod -o wide | grep prometheus

# í•´ë‹¹ ë…¸ë“œì— SSH ì ‘ì† í›„
sudo du -sh /opt/local-path-provisioner/pvc-xxxxxx
sudo ls /opt/local-path-provisioner/pvc-xxxxxx

```

- `chunks_head`, `wal`, `snapshots` ë“± TSDB êµ¬ì¡°ê°€ ë³´ì´ë©´ ì •ìƒ

---

## 8ï¸âƒ£ NFSëŠ” ì–´ë””ì— ì“°ë‚˜? â€” ê´€ì¸¡ ìŠ¤íƒ ë‚˜ë¨¸ì§€(PVC) ì „ëµ

### 8-1. NFS ë™ì  í”„ë¡œë¹„ì €ë„ˆ (observability ì „ìš©)

Loki/Promtail, Grafana, Alertmanager ë“± **ë¡œê·¸/ëŒ€ì‹œë³´ë“œ ê³„ì—´**ì€

ê³µìœ  ìŠ¤í† ë¦¬ì§€ê°€ í¸í•´ì„œ NFSë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.

```bash
helm upgrade --install nfs-prov \
  nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \
  -n storage \
  --set nfs.server=192.168.18.141 \
  --set nfs.path=/mnt/nfs_share/mlops/observability \
  --set storageClass.name=nfs-observability \
  --set storageClass.defaultClass=false \
  --set storageClass.accessModes=ReadWriteMany

```

â†’ `nfs-observability` ë¼ëŠ” StorageClass ìƒì„±

â†’ Loki / Grafana / Alertmanager / ê¸°íƒ€ ë¡œê·¸ì„± PVì— ì‚¬ìš©

### 8-2. Monitoring ìŠ¤íƒì—ì„œ NFS ì‚¬ìš©í•˜ëŠ” ì˜ì—­

- Grafana: ëŒ€ì‹œë³´ë“œ/ì„¤ì •
- Alertmanager: ì•ŒëŒ íˆìŠ¤í† ë¦¬
- Loki: ë¡œê·¸ ë³´ê´€
- FastAPI/MLflow ë¡œê·¸ìš© PVC (ì„ íƒ)

Prometheus TSDBëŠ” ì´ë¯¸ local-pathë¡œ ë¶„ë¦¬í–ˆìœ¼ë¯€ë¡œ

**ì½ê¸°/ì“°ê¸° ë§ì€ ì‹œê³„ì—´ì€ ë¡œì»¬, ê³µìœ ê°€ í¸í•œ ì„¤ì •/ë¡œê·¸ëŠ” NFS** ë¼ëŠ” ì—­í•  ë¶„ë¦¬ê°€ ë©ë‹ˆë‹¤.

---

## ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°

- **ì‹¤í—˜ í™˜ê²½(dev)ê³¼ ìš´ì˜ í™˜ê²½(prod)ì„ ê´€ì¸¡ ë ˆë²¨ì—ì„œ ì™„ì „íˆ ë¶„ë¦¬**
    - â€œdevì—ì„œ í•œ ì‹¤í—˜ì´ prod ê·¸ë˜í”„ì— ì„ì—¬ ë“¤ì–´ê°€ëŠ”â€ ì‚¬ê³ ë¥¼ ë¯¸ë¦¬ ì°¨ë‹¨
- **Prometheus TSDBë¥¼ local-pathë¡œ ë¶„ë¦¬**
    - ë…¸ì´ì¦ˆ ë§ì€ í™˜ê²½ì—ì„œë„ **ë¹ ë¥¸ ì¿¼ë¦¬ + ì•ˆì •ì ì¸ ì¢…ë£Œ** í™•ë³´
- **NFS ê¸°ë°˜ observability ìŠ¤í† ë¦¬ì§€ ê³„ì¸µ**
    - Loki/Promtail, Grafana, Alertmanagerê°€ ê³µí†µ ìŠ¤í† ë¦¬ì§€ë¥¼ ì“°ë©´ì„œë„
        
        dev/prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ë¼ë²¨ë¡œ ë…¼ë¦¬ ë¶„ë¦¬
        

> ì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ”
> 
> 
> **Loki + Promtail + Alertmanager / Grafana ì—°ë™**ì„ ë‹¤ë£¨ë©´ì„œ,
> 
> â€œë¡œê·¸Â·ë©”íŠ¸ë¦­Â·ì•ŒëŒì´ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ì—ì„œ ì–´ë–»ê²Œ ë§Œë‚˜ëŠ”ì§€â€ê¹Œì§€ ì´ì–´ê°€ë©´ ì¢‹ìŠµë‹ˆë‹¤.
> 

---

## ğŸ ì •ë¦¬

| êµ¬ë¶„ | ë‚´ìš© | ìƒíƒœ |
| --- | --- | --- |
| dev/prod ë©”íŠ¸ë¦­ êµì°¨ ìˆ˜ì§‘ | KSM/ServiceMonitor/Kubelet ë¼ë²¨ ì •ë¦¬ | âœ… í•´ê²° |
| kube-state-metrics í•„í„°ë§ | `metricRelabelings`ë¡œ namespace í•„í„° | âœ… ì ìš© |
| kubelet(cAdvisor) êµì°¨ ìˆ˜ì§‘ | `cAdvisorMetricRelabelings` ì¶”ê°€ | âœ… ë¶„ë¦¬ |
| stale metric | Prometheus & KSM ì¬ì‹œì‘ | âœ… ì •ë¦¬ |
| ì„ì‹œ Pod CrashLoop ì•ŒëŒ | `tmp-curl` ì‚­ì œ | âœ… ì†ŒìŒ ì œê±° |
| Watchdog Slack ì†ŒìŒ | `null` receiverë¡œ ë¶„ê¸° | âœ… ì°¨ë‹¨ |
| Prometheus ìŠ¤í† ë¦¬ì§€ | NFS â†’ local-path ì „í™˜ | âœ… ì„±ëŠ¥/ì•ˆì •ì„± ê°œì„  |
| TSDB ìœ„ì¹˜ íŒŒì•… | `/opt/local-path-provisioner/pvc-*` | âœ… êµ¬ì¡° ì´í•´ |
