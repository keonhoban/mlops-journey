+++
date = '2025-10-18T17:10:21+09:00'
draft = false
title = '[MLOps í”Œë«í¼ Observability & Data Pipeline - 2ë‹¨ê³„ : Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]'
categories = ['Observability', 'GitOps(ArgoCD)', 'Kubernetes', 'Monitoring Stack', 'Slack', 'NFS', 'Security', 'MLOps Pipeline', 'Trouble Shoot', 'AlertManager']
+++

## Alertmanager Slack & íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

---

## ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

> â€œëª¨ë¸ì´ ì˜ í•™ìŠµë˜ê³  ì˜ ë°°í¬ë˜ëŠ” ê²ƒë³´ë‹¤
> 
> 
> **ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ ì¦‰ì‹œ ê°ì§€ë˜ëŠ” ê²ƒ**ì´ ë” ì¤‘ìš”í•  ë•Œê°€ ë§ìŠµë‹ˆë‹¤.â€
> 
> â€œê·¸ë˜ì„œ ì´ë²ˆ ë‹¨ê³„ì—ì„œëŠ” dev/prod ê°ê°ì—ì„œ ì•ŒëŒì´
> 
> **ì •í™•í•œ Slack ì±„ë„ë¡œ, ê¹¨ì§ ì—†ì´ íë¥´ëŠ” ê´€ì¸¡ íŒŒì´í”„ë¼ì¸**ì„ ë¨¼ì € ì™„ì„±í–ˆìŠµë‹ˆë‹¤.â€
> 
> â€œì´ ê¸°ë°˜ì´ ê°–ì¶°ì ¸ì•¼ ì´í›„ FastAPI ì§€ì—°, í•«ìŠ¤ì™‘ ì‹¤íŒ¨, DAG ì—ëŸ¬ ê°™ì€
> 
> ìš´ì˜í˜• MLOps ì´ë²¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.â€
> 

---

### ğŸ¯ í•µì‹¬ ìš”ì•½

- **ëª©í‘œ**
    - `Prometheus â†’ Alertmanager â†’ Slack` ê²½ë¡œë¥¼
        
        dev/prod ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒíƒœë¡œ,
        
        **â€œê¹¨ì§€ë©´ ë°”ë¡œ ì›ì¸ ì°¾ì„ ìˆ˜ ìˆëŠ” ìˆ˜ì¤€â€**ê¹Œì§€ ì •ë¦¬
        
- **í•µì‹¬ í¬ì¸íŠ¸**
    - Alertmanager ì„¤ì •ì€ **SealedSecret**ë¡œ ê´€ë¦¬
    - `alertmanager.alertmanagerSpec.configSecret` ë¡œ CRì— ì—°ê²°
    - dev/prod ë¼ìš°íŒ… ê¸°ì¤€ì€ `namespace` ë¼ë²¨ ì •ê·œì‹
    - `null` receiverë¡œ **WatchdogÂ·ë¶ˆí•„ìš” ì•ŒëŒ ì†ŒìŒ ì°¨ë‹¨**
    - `or` í…œí”Œë¦¿ í•¨ìˆ˜ë§Œ ì‚¬ìš©í•´ì„œ `"function default not defined"` ì—ëŸ¬ ì œê±°
- **ê²°ê³¼ë¬¼**
    - ìƒˆ í´ëŸ¬ìŠ¤í„°ì—ì„œë„ GitOpsë§Œìœ¼ë¡œ
        
        **Slackê¹Œì§€ ì•ŒëŒ íë¦„ì„ 100% ì¬í˜„**í•  ìˆ˜ ìˆëŠ” ìƒíƒœ
        

---

## 1ï¸âƒ£ ì „ì²´ êµ¬ì¡° ê°œìš”

![mermaid-observability-02.png](/mlops-journey/images/mermaid-observability-02.png)

### ğŸ§© êµ¬ì„± ìš”ì†Œ ì—­í• 

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
| --- | --- |
| `PrometheusRule` | ì•ŒëŒ ì¡°ê±´ ì •ì˜ (Smoke í…ŒìŠ¤íŠ¸, FastAPI ì§€ì—°, CrashLoop ë“±) |
| `Prometheus` | Rule í‰ê°€ â†’ firing ìƒíƒœë¡œ Alertmanagerë¡œ ì „ë‹¬ |
| `Alertmanager` | ë¼ë²¨ ê¸°ì¤€ìœ¼ë¡œ Slack ë˜ëŠ” `null` ë“±ìœ¼ë¡œ ë¼ìš°íŒ… |
| `Slack` | dev/prod ì±„ë„ë¡œ ë¶„ë¦¬ëœ ì•Œë¦¼ ìˆ˜ì‹  |

---

## 2ï¸âƒ£ ì‚¬ì „ ì¤€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ì¸í”„ë¼ ì „ì œ

- [ ]  A1ì—ì„œ êµ¬ì„±í•œ `monitoring-dev / monitoring-prod` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ kube-prometheus-stack ë™ì‘ ì¤‘
- [ ]  `ArgoCD` ì„¤ì¹˜ ë° `apps/monitoring-{dev,prod}.yaml` ë¡œ GitOps ìš´ì˜ ì¤‘
- [ ]  `nginx-ingress` ë° ë„ë©”ì¸(ì˜ˆ: `alert-dev.local`, `prometheus-dev.local`) ì ‘ê·¼ ê°€ëŠ¥

### âœ… Alertmanager / SealedSecret / Slack ì „ì œ

- [ ]  `sealed-secrets` ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì¹˜ (`kube-system` ë„¤ì„ìŠ¤í˜ì´ìŠ¤)
- [ ]  dev/prodìš© Slack Webhook URL ê°ê° ì¤€ë¹„
- [ ]  Git ë¦¬í¬ì§€í† ë¦¬ ë‚´ì— `envs/dev/sealed-secrets/monitoring/`, `envs/prod/sealed-secrets/monitoring/` ë””ë ‰í„°ë¦¬ ì¡´ì¬

> ì´ í¸ì—ì„œëŠ” A1ì—ì„œ êµ¬ì¶•í•œ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ìœ„ì—
> 
> 
> **Alertmanagerâ€“Slack ê²½ë¡œì™€ SealedSecret ê´€ë¦¬**ë¥¼ ì–¹ëŠ” ë‹¨ê³„ë§Œ ë‹¤ë£¹ë‹ˆë‹¤.
> 

---

## 3ï¸âƒ£ Alertmanager ì„¤ì • ì„¤ê³„ (dev/prod ë¶„ë¦¬ ê¸°ì¤€)

### 3-1. ë¼ìš°íŒ… ê¸°ë³¸ êµ¬ì¡°

í•µì‹¬ì€ **namespace ë¼ë²¨**ì„ ê¸°ì¤€ìœ¼ë¡œ dev/prodë¥¼ ëª…í™•íˆ ë‚˜ëˆ„ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì˜ˆì‹œ(í•µì‹¬ êµ¬ì¡°ë§Œ):

```yaml
global:
  resolve_timeout: 5m

route:
  receiver: "null"               # ê¸°ë³¸ì€ ë²„ë¦¼
  group_by: ["alertname", "namespace"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  routes:
    - receiver: "slack-dev"      # devìš©
      matchers:
        - 'namespace=~".*-dev|monitoring-dev|kube-system"'
    - receiver: "null"           # ê¸°íƒ€ëŠ” ë²„ë¦¼

receivers:
  - name: "slack-dev"
    slack_configs:
      - api_url: "<SLACK_WEBHOOK_URL_DEV>"
        send_resolved: true
        title: "ğŸš¨ [{{ .Status | toUpper }}][DEV] {{ .CommonLabels.alertname }}"
        text: >
          *Namespace:* {{ or .CommonLabels.namespace "N/A" }}
          *Severity:* {{ or .CommonLabels.severity "none" }}
          *Summary:* {{ or .CommonAnnotations.summary "No summary" }}
          *Description:* {{ or .CommonAnnotations.description "No description" }}
          *Start:* {{ (index .Alerts 0).StartsAt }}
          <https://prometheus-dev.local/alerts|View in Prometheus>

  - name: "null"

```

> prodëŠ” slack-prod, namespace=~".*-prod|monitoring-prod|kube-system" íŒ¨í„´ìœ¼ë¡œ ë™ì¼ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
> 

### 3-2. ì™œ `or` í•¨ìˆ˜ì¸ê°€?

- Helm í…œí”Œë¦¿ì—ì„œ ì“°ëŠ” `default`ëŠ” Alertmanager í…œí”Œë¦¿ì—ì„œëŠ” **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í•¨ìˆ˜**
- AlertmanagerëŠ” **Go í…œí”Œë¦¿ì˜ ë‚´ì¥ í•¨ìˆ˜ë§Œ ì‚¬ìš©** ê°€ëŠ¥
- ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ ì˜¤ë¥˜ ì—†ì´ ë™ì‘í•©ë‹ˆë‹¤:

```yaml
{{ or .CommonLabels.namespace "N/A" }}

```

ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Alertmanager ë¡œê·¸ì—:

> template: : function "default" not defined
> 

ì´ ì°íˆê³ , í•´ë‹¹ ì„¤ì •ì€ **ë¬´ì‹œ**ë©ë‹ˆë‹¤.

---

## 4ï¸âƒ£ SealedSecret ê¸°ë°˜ Alertmanager Config ê´€ë¦¬

### 4-1. í‰ë¬¸ Secret â†’ SealedSecret ë³€í™˜

dev ì˜ˆì‹œ ê¸°ì¤€ì…ë‹ˆë‹¤.

1. ìš°ì„  `/tmp/alertmanager-dev.yaml`ì— ìœ„ì—ì„œ ì„¤ê³„í•œ ë‚´ìš©ì„ ì €ì¥í•©ë‹ˆë‹¤.
2. ê·¸ê±¸ Secretìœ¼ë¡œ ë§Œë“¤ë˜, **ë°”ë¡œ ì ìš©í•˜ì§€ ì•Šê³ ** YAMLë§Œ ì¶œë ¥í•©ë‹ˆë‹¤.

```bash
kubectl -n monitoring-dev create secret generic alertmanager-config-dev \
  --from-file=alertmanager.yaml=/tmp/alertmanager-dev.yaml \
  --dry-run=client -o yaml > /tmp/alertmanager-config-dev.secret.yaml

```

1. ê·¸ ë‹¤ìŒ SealedSecretìœ¼ë¡œ ë´‰ì¸:

```bash
kubeseal \
  --controller-namespace kube-system \
  --controller-name sealed-secrets \
  --format yaml < /tmp/alertmanager-config-dev.secret.yaml \
  > envs/dev/sealed-secrets/monitoring/alertmanager-config-dev.yaml

```

- prodë„ ë™ì¼í•˜ê²Œ `alertmanager-config-prod.yaml`ë¡œ ìƒì„±
- ì¤‘ìš”í•œ ì²´í¬ í¬ì¸íŠ¸:
    - `metadata.namespace: monitoring-dev / monitoring-prod`
    - `spec.template.type: Opaque`
    - `spec.encryptedData.alertmanager.yaml` ì¡´ì¬

> ì´ íŒŒì¼ë§Œ Gitì— ì˜¬ë ¤ë„ Webhook ì£¼ì†ŒëŠ” ë³µí˜¸í™” ë¶ˆê°€ëŠ¥í•´ì„œ ì•ˆì „í•©ë‹ˆë‹¤.
> 

---

## 5ï¸âƒ£ kube-prometheus-stackì— ConfigSecret ì—°ê²°

A1ì—ì„œ ë§Œë“  `apps/monitoring-*.yaml`ì— ì´ë¯¸ ì´ í•„ë“œê°€ ìˆìŠµë‹ˆë‹¤:

```yaml
alertmanager:
  alertmanagerSpec:
    configSecret: alertmanager-config-dev   # dev

```

ì—¬ê¸° ì˜¤íƒ€ê°€ ë‚˜ë©´ ì•„ë˜ ë¬¸ì œê°€ ìƒê¹ë‹ˆë‹¤:

- `alertmanager-config-dev`ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í‚¤ ì‚¬ìš©
- `alertmanager.configFromSecret` ê°™ì€ **ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê°’** ì‚¬ìš©

ê·¸ëŸ¬ë©´:

- Operatorê°€ ë‚´ë¶€ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ `alertmanager-*-generated` Secretì„ ë§Œë“¤ê³ 
- ê·¸ ì„¤ì •ì´ Pod ë‚´ `/etc/alertmanager/config/alertmanager.yaml.gz` ì— ë§ˆìš´íŠ¸ë©ë‹ˆë‹¤.

ê·¸ë˜ì„œ ë°˜ë“œì‹œ **ì´ í•„ë“œ**ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
kubectl -n monitoring-dev get alertmanager monitoring-dev-kube-promet-alertmanager \
  -o jsonpath='{.spec.configSecret}'; echo
# ê¸°ëŒ€ê°’: alertmanager-config-dev

kubectl -n monitoring-prod get alertmanager monitoring-prod-kube-prome-alertmanager \
  -o jsonpath='{.spec.configSecret}'; echo
# ê¸°ëŒ€ê°’: alertmanager-config-prod

```

> ì´ê²Œ ë‹¤ë¥´ë©´ ì•„ë¬´ë¦¬ SealedSecretì„ ì˜ ë§Œë“¤ì–´ë„ ëŸ°íƒ€ì„ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
> 

---

## 6ï¸âƒ£ Runtime ìƒíƒœ í™•ì¸ (í•„ìˆ˜ Runbook)

### 6-1. Pod ì•ˆì—ì„œ ì‹¤ì œ ì ìš©ëœ ì„¤ì • ë³´ê¸°

```bash
POD=$(kubectl -n monitoring-dev get po -l app.kubernetes.io/name=alertmanager -o name | head -1)

kubectl -n monitoring-dev exec "$POD" -c alertmanager -- \
  sh -lc 'zcat /etc/alertmanager/config/alertmanager.yaml.gz | sed -n "1,200p"'

```

ì—¬ê¸°ì„œ í™•ì¸í•´ì•¼ í•  ê²ƒ:

- `route.routes[].matchers`ì— devìš© ì •ê·œì‹ ì¡´ì¬
- `receivers`ì— `slack-dev` / `"null"` ë“± ì›í•˜ëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€
- Webhook URLì€ ë§ˆìŠ¤í‚¹ë˜ë”ë¼ë„ êµ¬ì¡°ê°€ ìœ ì§€ë˜ëŠ”ì§€

### 6-2. Alertmanager APIë¡œ í˜„ì¬ Config í™•ì¸

```bash
curl -sk https://alert-dev.local/api/v2/status \
| jq -r '.config.original' | yq '.route, .receivers'

```

- `receiver: slack-dev`
- devìš© `namespace` ì •ê·œì‹
- `null` receiver ì¡´ì¬ ì—¬ë¶€

---

## 7ï¸âƒ£ Slack ì—°ë™ ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ í‘œ

| ë‹¨ê³„ | ê²€ì¦ í¬ì¸íŠ¸ | í™•ì¸ ë°©ë²• |
| --- | --- | --- |
| 1 | ConfigSecret ì—°ê²° | Alertmanager CRì˜ `.spec.configSecret` |
| 2 | Alertmanagerê°€ ì„¤ì • ì œëŒ€ë¡œ ì½ëŠ”ì§€ | `/api/v2/status` |
| 3 | Smoke Rule â†’ Prometheus â†’ Alertmanager | `/api/v1/alerts`, `/api/v2/alerts` |
| 4 | Slackìœ¼ë¡œ ì‹¤ì œ ì•ŒëŒ ë„ì°© | dev/prod ì±„ë„ì—ì„œ ë©”ì‹œì§€ í™•ì¸ |
| 5 | ì „ì†¡ ì‹¤íŒ¨ìœ¨ | `alertmanager_notifications_failed_total` ë©”íŠ¸ë¦­ |
| 6 | ì¬ì‹œì‘ / ArgoCD Sync í›„ì—ë„ ìœ ì§€ë˜ëŠ”ì§€ | Rollout + Sync í›„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ |

---

## 8ï¸âƒ£ Smoke Alert (PrometheusRuleë¡œ ì „ì²´ ê²½ë¡œ í…ŒìŠ¤íŠ¸)

### 8-1. devìš© Smoke Rule

```bash
cat <<'EOF' | kubectl -n monitoring-dev apply -f -
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: alertmanager-smoke
  labels:
    release: monitoring-dev
spec:
  groups:
    - name: smoke.rules
      rules:
        - alert: Smoke_Alert_To_Slack
          expr: vector(1)
          for: 1m
          labels:
            severity: warning
            namespace: monitoring-dev     # ğŸ”´ ë¼ìš°íŒ… í‚¤
          annotations:
            summary: "Smoke test alert"
            description: "This is a test alert to verify Slack integration"
EOF

```

### 8-2. Prometheus â†’ Alertmanager â†’ Slack í™•ì¸

```bash
# 1) Prometheus ì•ŒëŒ ìƒíƒœ
curl -sk https://prometheus-dev.local/api/v1/alerts \
| jq '.data.alerts[] | select(.labels.alertname=="Smoke_Alert_To_Slack") | {state:.state,labels:.labels}'

# 2) Alertmanagerì—ì„œ receiver í™•ì¸
curl -sk https://alert-dev.local/api/v2/alerts \
| jq '.[] | select(.labels.alertname=="Smoke_Alert_To_Slack") | {status:.status,receiver:.receiver.name}'

```

- `state: "firing"`
- `receiver: "slack-dev"`

ì´ ë‘ ê°€ì§€ë©´ pipelineì€ ì •ìƒì…ë‹ˆë‹¤.

Slack ì±„ë„ì—ëŠ” ë‹¤ìŒê³¼ ë¹„ìŠ·í•œ ë©”ì‹œì§€ê°€ ë– ì•¼ í•©ë‹ˆë‹¤:

> ğŸš¨ [FIRING][DEV] Smoke_Alert_To_Slack
> 
> 
> Namespace: monitoring-dev
> 
> Severity: warning
> 
> â€¦
> 

í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬:

```bash
kubectl -n monitoring-dev delete prometheusrule alertmanager-smoke

```

---

## 9ï¸âƒ£ Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸ (ë¹ ë¥¸ ì—°ê¸° ê²€ì¦)

Prometheusë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ë¼ìš°íŒ…ë§Œ ë¹¨ë¦¬ ë³´ê³  ì‹¶ì„ ë•Œ ì“°ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

### dev ì±„ë„ í…ŒìŠ¤íŠ¸

```bash
curl -sk -X POST https://alert-dev.local/api/v2/alerts \
  -H 'Content-Type: application/json' \
  -d '[
    {
      "labels": {
        "alertname": "SlackTestDev",
        "severity": "critical",
        "namespace": "airflow-dev"
      },
      "annotations": {
        "summary": "ğŸ”” Slack í…ŒìŠ¤íŠ¸ ì•ŒëŒ (dev / direct)",
        "description": "Alertmanager ì§ì ‘ POST í…ŒìŠ¤íŠ¸"
      }
    }
  ]'

```

í™•ì¸:

```bash
curl -sk "https://alert-dev.local/api/v2/alerts?filter=alertname%3DSlackTestDev" \
| jq '.[].labels'

```

> prodë„ alert-prod.local, namespace: airflow-prod ë¡œ ë™ì¼í•˜ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.
> 

---

## ğŸ”Ÿ ì „ì†¡ ì„±ê³µë¥ /ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§

Slack Webhookì´ ë§‰íˆê±°ë‚˜ í…œí”Œë¦¿ì´ ê¹¨ì¡Œì„ ë•Œ **ìˆ«ìë¡œ ê°ì§€**í•˜ëŠ” ì˜ì—­ì…ë‹ˆë‹¤.

```bash
for env in dev prod; do
  echo "=== $env ==="

  echo "âœ… Slack ì „ì†¡ ì„±ê³µë¥  (5m)"
  curl -skG "https://prometheus-${env}.local/api/v1/query" \
    --data-urlencode 'query=sum(rate(alertmanager_notifications_total{integration="slack"}[5m]))' \
  | jq '.data.result[]?.value'

  echo "âŒ Slack ì „ì†¡ ì‹¤íŒ¨ìœ¨ (5m, ì´ìœ  í¬í•¨)"
  curl -skG "https://prometheus-${env}.local/api/v1/query" \
    --data-urlencode 'query=sum by (reason)(rate(alertmanager_notifications_failed_total{integration="slack"}[5m]))' \
  | jq '.data.result[]?'
done

```

- ê¸°ëŒ€ ìƒíƒœ
    - ì„±ê³µë¥ : 0ë³´ë‹¤ í° ê°’
    - ì‹¤íŒ¨ìœ¨: 0 ë˜ëŠ” 0.00X ìˆ˜ì¤€

---

## ğŸ§© íŒ

### ìì£¼ í„°ì§€ëŠ” ì´ìŠˆ & íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì •ë¦¬

| ì¦ìƒ | ì›ì¸ | í•´ê²°ì±… |
| --- | --- | --- |
| `failed to initialize from secret: missing name in receiver` | `route`ì—ì„œ `"null"` ë¦¬ì‹œë²„ë¥¼ ì°¸ì¡°í•˜ëŠ”ë°, `receivers:` ë¸”ë¡ì— `name: "null"` ì—†ìŒ | `receivers`ì— `name: "null"` ì¶”ê°€ |
| Alertmanager ë¡œê·¸: `function "default" not defined` | í…œí”Œë¦¿ ë‚´ë¶€ì—ì„œ Helmì˜ `default` ì‚¬ìš© | Go í…œí”Œë¦¿ `or`ë¡œ êµì²´ (`{{ or .CommonLabels.namespace "N/A" }}`) |
| `/api/v2/alerts`ì—ì„œ `receiver: null` | ë¼ìš°íŠ¸ matchers ì¡°ê±´ ë¶ˆì¼ì¹˜ | Smoke Ruleì— `namespace` ë¼ë²¨ ì¶”ê°€, `matchers` ì •ê·œì‹ ë‹¤ì‹œ ì ê²€ |
| devì—ì„œ prod ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ŒëŒ ë³´ì„ | dev/prod ë¼ë²¨Â·selector ì„ì„ (`release: monitoring-dev` ì˜¤ë¥˜ ë“±) | kube-prometheus-stack valuesì—ì„œ `serviceMonitorSelector`, `kube-state-metrics.additionalLabels` ì •ì • |
| Watchdog ì•ŒëŒì´ Slackì— ê³„ì† ì˜´ | Watchdog ì „ìš© ë¶„ê¸° ì—†ìŒ | `alertname=Watchdog` ì¸ ê²½ìš° `receiver: "null"` ë¡œ ë¼ìš°íŠ¸ ë¶„ê¸° |
| ì„¤ì •ì„ ë°”ê¿¨ëŠ”ë°ë„ ì˜ˆì „ í…œí”Œë¦¿ì´ ê³„ì† ë³´ì„ | `alertmanager-*-generated` ì‹œí¬ë¦¿ì´ ê³„ì† ì‚¬ìš©ë¨ | `spec.configSecret` ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì •í•˜ê³ , generated Secret ì‚­ì œ í›„ Alertmanager ë¡¤ë§ ì¬ì‹œì‘ |

---

## ğŸ”§ MLOps ì‹¤ì „ ì—°ê²°

- ì´ Alertmanagerâ€“Slack ë¼ì¸ì€ ë‚˜ì¤‘ì—:
    - **FastAPI p95 ì§€ì—°**, ì—ëŸ¬ìœ¨,
    - Airflow DAG ì‹¤íŒ¨,
    - MLflow ëª¨ë¸ ë“±ë¡ ì‹¤íŒ¨,
    - ëª¨ë¸ í•«ìŠ¤ì™‘ ì‹¤íŒ¨,
- ì´ëŸ° ê²ƒë“¤ì„ **ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡ì•„ë‚´ëŠ” ê´€ì¸¡ ì•ŒëŒì˜ ë°±ë³¸**ì´ ë©ë‹ˆë‹¤.
- íŠ¹íˆ ì´ Alertmanagerâ€“Slack ë¼ì¸ì„:
    - Airflow â†’ MLflow â†’ FastAPI **í•«ìŠ¤ì™‘ / ë¡¤ë°± íŒŒì´í”„ë¼ì¸**ê³¼ ì—°ê²°í•˜ë©´,
    - â€œí•™ìŠµ/ë°°í¬ ìë™í™”â€ ë¿ ì•„ë‹ˆë¼
        
        **â€œì•ŒëŒ â†’ ë¡¤ë°±/í•«ìŠ¤ì™‘ í›„ ìƒíƒœ í™•ì¸â€**ê¹Œì§€ ì´ì–´ì§€ëŠ”
        
        **ì™„ì „í•œ MLOps ìš´ì˜ ë£¨í”„**ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        

---

## ğŸ ì •ë¦¬

| í•­ëª© | ìƒíƒœ |
| --- | --- |
| Alertmanager Config ê´€ë¦¬ ë°©ì‹ | dev/prod ê°ê° SealedSecret(`alertmanager-config-{dev,prod}`)ë¡œ Gitì— ì €ì¥ |
| Alertmanager CR ì—°ë™ | `.spec.configSecret` ì´ dev/prodì—ì„œ ê°ì ì˜¬ë°”ë¥¸ Secretì„ ê°€ë¦¬í‚´ |
| Alertmanager ì‹¤ì œ ì„¤ì • | Pod ë‚´ë¶€ `/etc/alertmanager/config/alertmanager.yaml.gz` ë° 
`/api/v2/status` ë¡œ í™•ì¸ ê°€ëŠ¥ |
| Smoke Alert ê²½ë¡œ | Prometheus `/api/v1/alerts` + Alertmanager `/api/v2/alerts` ì—ì„œ 
`state: firing`, `receiver=slack-<env>` í™•ì¸ |
| Slack ì±„ë„ ë¶„ë¦¬ | dev/prod ì±„ë„ ê°ê°ì—ì„œ ì•ŒëŒ ìˆ˜ì‹  í™•ì¸ |
| ì „ì†¡ ì‹¤íŒ¨ìœ¨ ëª¨ë‹ˆí„°ë§ | `alertmanager_notifications_failed_total{integration="slack"}` â‰’ 0 ìœ ì§€ |
| ì¬ë°°í¬/Sync í›„ ì¼ê´€ì„± | Alertmanager ë¡¤ë§ ì¬ì‹œì‘ ë° ArgoCD Sync ì´í›„ì—ë„ ë™ì¼ ì„¤ì • ìœ ì§€ |
