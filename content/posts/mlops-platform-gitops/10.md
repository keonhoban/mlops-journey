+++
date = '2025-09-25T17:10:21+09:00'
draft = false
title = '[MLOps ìš´ì˜ ê³ ë„í™” - 9ë‹¨ê³„: ì‹œí¬ë¦¿ ê´€ë¦¬ & í‚¤ íšŒì „ ìë™í™” (AWSÂ·SealedSecret)]'
categories = ['MLOps Pipeline', 'Kubernetes', 'Helm', 'Git', 'CI/CD', 'Security', 'GitOps(ArgoCD)']
+++

## ì‹œí¬ë¦¿ ê´€ë¦¬ ë° í‚¤ íšŒì „ ìë™í™”: AWS Credentials Â· SealedSecret Re-Seal

---

## ğŸ§  ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…

> â€œMLOpsì—ì„œëŠ” ëª¨ë¸ë³´ë‹¤ ë¨¼ì €, â€˜ë¹„ë°€â€™ì´ ë¨¼ì € ë¬´ë„ˆì§‘ë‹ˆë‹¤.â€
> 
> 
> â€œíŠ¹íˆ AWS í‚¤ì²˜ëŸ¼ **ì£¼ê¸°ì ìœ¼ë¡œ êµì²´í•´ì•¼ í•˜ëŠ” ê°’**ì€ ìë™í™”ê°€ í•„ìš”í•˜ì§€ë§Œ,
> 
> JWTÂ·Slack Webhookì²˜ëŸ¼ **êµì²´ ì‹œ ì˜í–¥ì´ í° ê°’**ì€ ìš´ì˜ìê°€ ì§ì ‘ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤.â€
> 
> â€œê·¸ë˜ì„œ 9ë‹¨ê³„ì—ì„œëŠ”
> 
> **â€˜ìë™í™”í•  ê²ƒê³¼ ì‚¬ëŒì´ í™•ì¸í•´ì•¼ í•  ê²ƒì„ êµ¬ë¶„í•œ SecretOps ì²´ê³„â€™ë¥¼ í™•ë¦½í•˜ëŠ” ê²ƒ**ì´ ëª©ì ì´ì—ˆìŠµë‹ˆë‹¤.â€
> 
> â€œAWS í‚¤ íšŒì „Â·SealedSecret ì¬ì•”í˜¸í™”Â·GitOps ë°˜ì˜ê¹Œì§€ëŠ”
> 
> **í•„ìš”í•œ ì‘ì—…ë“¤ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë¬¶ì–´ ë°˜ë³µì„ ìµœì†Œí™”**í–ˆê³ ,
> 
> ìš´ì˜ìê°€ â€˜ì–¸ì œ ì‹¤í–‰í• ì§€â€™ë§Œ ê²°ì •í•˜ë©´ ë˜ë„ë¡ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.â€
> 

---

## ğŸ¯ í•µì‹¬ ìš”ì•½

- **AWS IAM Access Key ì£¼ê¸° íšŒì „** â†’ Airflow / FastAPI / MLflowì— **GitOps ìë™ ë°˜ì˜**
- **SealedSecrets ì¬ì•”í˜¸í™”(Re-Seal)** ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ êµì²´ì—ë„ **ë¬´ì¤‘ë‹¨ ìš´ì˜**
- â€œ**ë³´ì•ˆ ë¦¬ìŠ¤í¬ëŠ” ìë™í™”**, **ë³€ê²½ ì˜í–¥ í° ê±´ ìˆ˜ë™**â€ì˜ ê· í˜• ìš´ì˜
- **Rotation/Re-Seal ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„** â†’ Git Commit/Push â†’ Argo CD Syncë¡œ ì´ì–´ì§€ëŠ” **ë°˜ìë™ ë³´ì•ˆ GitOps ë£¨í‹´**

---

### 1ï¸âƒ£ ì „ì²´ êµ¬ì¡° ìš”ì•½

```mermaid
flowchart TB
  subgraph SecureOps["SecretOps / Rotation Pipeline"]
    ROTATE["ops/rotate/rotate-aws-credentials.sh<br/>AWS Key íšŒì „ + SealedSecret ìƒì„±"]
    RESEAL["ops/seal/re-seal.sh<br/>ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ ë³€ê²½ ì‹œ ì¬ì•”í˜¸í™”"]
    RCK["ops/seal/rotate-controller-key.sh<br/>ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ êµì²´(í•„ìš” ì‹œ)"]
  end

  subgraph GitOps["GitOps / Argo CD"]
    COMMIT["Git Commit & Push"]
    SYNC["Argo CD Auto Sync (dev/prod)"]
  end

  subgraph K8s["Kubernetes Cluster"]
    SSC["Sealed Secrets Controller"]
    NS1["Airflow Secrets"]
    NS2["FastAPI Secrets"]
    NS3["MLflow Secrets"]
  end

  ROTATE --> COMMIT --> SYNC --> SSC --> NS1 & NS2 & NS3
  RESEAL --> COMMIT --> SYNC
  RCK --> RESEAL

  classDef node fill:#f7f7ff,stroke:#7aa7ff,stroke-width:2px,color:#0b318f;
  class SecureOps,GitOps,K8s,ROTATE,RESEAL,RCK,COMMIT,SYNC,SSC,NS1,NS2,NS3 node;

```

---

### 2ï¸âƒ£ AWS Credentials Rotation (ë°˜ìë™)

### ì‹¤í–‰ ì˜ˆì‹œ

```bash
# dev í™˜ê²½
bash ops/rotate/rotate-aws-credentials.sh dev

# prod í™˜ê²½
bash ops/rotate/rotate-aws-credentials.sh prod
```

### ë™ì‘ íë¦„

1. í˜„ì¬ IAM ì‚¬ìš©ì/ê¸°ì¡´ í‚¤ í™•ì¸
2. **ìƒˆ AccessKey/Secret ìƒì„±** â†’ `/root/backup`ì— 0600ë¡œ ë°±ì—…
3. `envs/<env>/sealed-secrets/{airflow,fastapi,mlflow}/sealed-aws-credentials-<env>-secret.yaml` ê°±ì‹ 
4. `git add/commit/push` â†’ Argo CD **Auto Sync**
5. ì •ìƒì„± ê²€ì¦ í›„ **ì´ì „ í‚¤ Inactive â†’ Delete**

---

### 3ï¸âƒ£ SealedSecret Re-Seal (ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ ë³€ê²½ ëŒ€ì‘)

> í‰ë¬¸ì€ ê±´ë“œë¦¬ì§€ ì•Šê³ , ê¸°ì¡´ ì•”í˜¸ë¬¸ë§Œ í´ëŸ¬ìŠ¤í„°ì˜ ìµœì‹  ê³µê°œí‚¤ë¡œ ì¬ì•”í˜¸í™”í•©ë‹ˆë‹¤.
> 

### ì‹¤í–‰ ì˜ˆì‹œ

```bash
# ë³€ê²½ë§Œ ë¯¸ë¦¬ í™•ì¸ (íŒŒì¼ diffë§Œ ìƒì„±)
DRY_RUN=1 bash ops/seal/re-seal.sh dev

# ì‹¤ì œ ë°˜ì˜
bash ops/seal/re-seal.sh dev
```

### ë™ì‘ íë¦„

1. í˜„ì¬ ì»¨íŠ¸ë¡¤ëŸ¬ ê³µê°œí‚¤ fingerprint í™•ì¸
2. `kubeseal --re-encrypt`ë¡œ **ëª¨ë“  SealedSecret ì¬ì•”í˜¸í™”**
3. ë ˆí¬ íŒŒì¼ êµì²´ `git commit/push` & Argo CD **Auto Sync**ë¡œ ë¬´ì¤‘ë‹¨ ì ìš©

### ì•ˆì „ ì¥ì¹˜

- ìŠ¤í¬ë¦½íŠ¸ì— **í•„ìˆ˜ ê°€ë“œ** ê¶Œì¥
    - ì»¨íŠ¸ë¡¤ëŸ¬ ì´ë¦„/ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™•ì¸: `-controller-name sealed-secrets --controller-namespace kube-system`
    - ëŒ€ìƒ ë””ë ‰í„°ë¦¬ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸: `envs/<env>/sealed-secrets/**`
    - ì‘ì—… ì „/í›„ git **clean/safe-state** í™•ì¸

---

### 4ï¸âƒ£ ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ ìì²´ êµì²´ (í•„ìš” ì‹œ)

> rotate-controller-key.sh ë¡œ sealed-secrets ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ë¥¼ ì¬ë°œê¸‰/êµì²´í•˜ê³ , ì¦‰ì‹œ Re-Sealê¹Œì§€ ì—°ë™í•©ë‹ˆë‹¤.
> 

### ì‹¤í–‰ ì˜ˆì‹œ

```bash
# êµì²´ â†’ ì „ì²´ ì¬ì•”í˜¸í™” â†’ ì»¤ë°‹/í‘¸ì‹œê¹Œì§€ ì›ìƒ· (í™˜ê²½ë³„)
bash ops/seal/rotate-controller-key.sh dev
```

### ê¶Œì¥ ìˆœì„œ

1. **ë°±ì—…**: ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ ì‹œí¬ë¦¿ dump
2. **êµì²´**: sealed-secrets ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ ì¬ë°œê¸‰
3. **ê²€ì¦**: ìƒˆ ê³µê°œí‚¤ fingerprint ì¶œë ¥
4. **Re-Seal í˜¸ì¶œ**: `ops/seal/re-seal.sh <env>` ìë™ í˜¸ì¶œ
5. **GitOps**: ì»¤ë°‹/í‘¸ì‹œ â†’ Argo CD Auto Sync
6. **ê´€ì°°**: ëŒ€ìƒ ì•± OutOfSync/ì—ëŸ¬ ì—†ìŒ í™•ì¸

> ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ êµì²´ëŠ” ë“œë¬¼ì§€ë§Œ í° ë³€ê²½ì…ë‹ˆë‹¤. ê°€ê¸‰ì  ê·¼ë¬´ ì‹œê°„ + Slack ì•Œë¦¼ í™œì„±í™” ìƒíƒœì—ì„œ ìˆ˜í–‰í•˜ì„¸ìš”.
> 

---

### 5ï¸âƒ£ ê¸°íƒ€ ì‹œí¬ë¦¿ ìš´ì˜ ë°©ì¹¨(ìˆ˜ë™ ë£¨í‹´ ìœ ì§€)

| í•­ëª© | íšŒì „ ë°©ì‹ | ì´ìœ  |
| --- | --- | --- |
| Slack Webhook | ìˆ˜ë™ | ì˜ëª» êµì²´ ì‹œ ê´€ì œ ë‹¨ì ˆ ìœ„í—˜ |
| FastAPI JWT Secret | ìˆ˜ë™ | í† í° ë¬´íš¨í™” ì˜í–¥ í¼ |
| Git SSH Key | ìˆ˜ë™ | git-sync ì¸ì¦ ì‹¤íŒ¨ ë¦¬ìŠ¤í¬ |
| DB Password | ìˆ˜ë™ | ë³€ê²½ ì£¼ê¸° ë‚®ê³  ì˜í–¥ ë²”ìœ„ í¼ |

> ì›ì¹™: ìì£¼ ë°”ë€Œê³  ìœ„í—˜í•œ ê±´ ìë™í™”, ê°€ë” ë°”ë€Œê³  ì˜í–¥ í° ê±´ ìˆ˜ë™ ê²€ì¦.
> 

---

### 6ï¸âƒ£ í–¥í›„ í™•ì¥ ê°€ëŠ¥

| ëª©í‘œ | ë°©ë²• |
| --- | --- |
| K8s-native ì™¸ë¶€ ë¹„ë°€ ì—°ë™ | **External Secrets Operator(ESO)** |
| ê´€ë¦¬í˜• ìŠ¤í† ì–´ ì‚¬ìš© | **AWS Secrets Manager** + IAM Role |
| ì™„ì „ ë¬´ì¤‘ë‹¨ | ë™ì¼ Secret ì´ë¦„ ìœ ì§€ + ê³µê¸‰ìë§Œ êµì²´ |

> ì§€ê¸ˆì˜ GitOps/Argo CDëŠ” ê·¸ëŒ€ë¡œ ë‘ê³  ë¹„ë°€ ê³µê¸‰ìë§Œ êµì²´í•˜ëŠ” ì‹ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìŠ¹ê¸‰ ê°€ëŠ¥.
> 

---

### 7ï¸âƒ£ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ]  `rotate-aws-credentials.sh` ì‹¤í–‰ í›„ **Secret ë¦¬ì†ŒìŠ¤ ë²„ì „ ì¦ê°€**(describe/events)
- [ ]  ì„œë¹„ìŠ¤ **S3/ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì ‘ê·¼ ì •ìƒ**(403 ì—†ìŒ)
- [ ]  êµ¬ Access Key **Inactive â†’ Delete** ì™„ë£Œ
- [ ]  ì»¨íŠ¸ë¡¤ëŸ¬ êµì²´/ì—…ê·¸ë ˆì´ë“œ í›„ ë°˜ë“œì‹œ **`re-seal.sh` ìˆ˜í–‰**
- [ ]  Argo CD **Auto Sync** ì •ìƒ + Drift ì—†ìŒ
- [ ]  (ì„ íƒ) Helmì— **`checksum/secret`** ë°˜ì˜í•´ ìë™ ë¡¤ì•„ì›ƒ í™•ì¸

---

### 8ï¸âƒ£ íŒ

| ì¦ìƒ | ì›ì¸ | í•´ê²° |
| --- | --- | --- |
| â€œMax 2 keysâ€ ì—ëŸ¬ | IAM í‚¤ 2ê°œ ì´ˆê³¼ | ì˜¤ë˜ëœ í‚¤ ì‚­ì œ í›„ ì¬ì‹œë„ |
| OutOfSync ë°˜ë³µ | SealedSecretë§Œ ìˆ˜ì •, ì›Œí¬ë¡œë“œ ë¡¤ì•„ì›ƒ ë¯¸ë°œìƒ | **ì²´í¬ì„¬ ì–´ë…¸í…Œì´ì…˜** ë˜ëŠ” ìˆ˜ë™ `rollout restart` |
| 403 ì ‘ê·¼ ì˜¤ë¥˜ | Podì— êµ¬ í‚¤ ë‚¨ì•„ìˆìŒ | ë¡¤ì•„ì›ƒ íŠ¸ë¦¬ê±°/ì¬ë°°í¬ |
| ë³µí˜¸í™” ì‹¤íŒ¨ | ì»¨íŠ¸ë¡¤ëŸ¬ í‚¤ ë³€ê²½ í›„ Re-Seal ë¯¸ìˆ˜í–‰ | `bash ops/seal/re-seal.sh <env>` ì‹¤í–‰ |

---

### 9ï¸âƒ£ GitOps ì—°ë™ ê´€ì  ë³´ê°•(ìš´ì˜ í¸ì˜)

- **ë””ë ‰í„°ë¦¬ í‘œì¤€í™”**
    - `envs/<env>/sealed-secrets/<app>/sealed-*.yaml`
- **Sync Wave/Order**
    - Secret/ConfigëŠ” `sync-wave: "-1"`, ì›Œí¬ë¡œë“œëŠ” `sync-wave: "0"~"1"`

---

### âœ… ìš”ì•½

| ì˜ì—­ | ìë™í™” | ìŠ¤íƒ |
| --- | --- | --- |
| AWS Key Rotation | ìë™ | AWS CLI, kubeseal, Argo CD |
| Re-Seal | ë°˜ìë™ | kubeseal (re-encrypt), git |
| Controller Key êµì²´ | ë°˜ìë™ | ìŠ¤í¬ë¦½íŠ¸ + Re-Seal + GitOps |
| ê¸°íƒ€ ì‹œí¬ë¦¿ | ìˆ˜ë™ | kubectl + kubeseal |
| í™•ì¥ | ì„ íƒ | ESO / AWS Secrets Manager |

---

### ğŸ ì •ë¦¬

> AWS Key Rotationê³¼ SealedSecret ì¬ì•”í˜¸í™” ê³¼ì •ì„
> 
> 
> **ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ìœ¼ë¡œ í‘œì¤€í™”í•´**
> 
> ìš´ì˜ìê°€ â€œí•„ìš”í•  ë•Œ ì‹¤í–‰í•˜ê³  GitOpsë¡œ ë°˜ì˜í•˜ëŠ”â€
> 
> **ì˜ë„ ê¸°ë°˜ SecretOps ì²´ê³„**ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.
> 
> ë°˜ë³µì ìœ¼ë¡œ ë²ˆê±°ë¡­ë˜ ë³´ì•ˆ ì‘ì—…ì„ **í‘œì¤€í™”í•˜ê³ , ì ˆì°¨ë¥¼ ìë™í™”**í•´
> 
> dev/prod í™˜ê²½ ì–‘ìª½ì—ì„œ **ì¼ê´€ëœ ë³´ì•ˆ GitOps íë¦„**ì„ ê°–ì¶”ëŠ” ê²ƒì´ í•µì‹¬ ëª©í‘œì˜€ìŠµë‹ˆë‹¤.
>
