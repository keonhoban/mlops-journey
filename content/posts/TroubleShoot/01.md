+++
date = '2025-06-13T21:06:20+09:00'
draft = false
title = '[TS] Airflow ê¸°ì´ˆ ìë™í™” - Airflow â†’ MLflow â†’ FastAPI'
categories = 'Trouble Shoot'
+++

> Airflow + MLflow ì—°ë™ ì‹¤ìŠµ ì¤‘ ë°œìƒí•œ ì‹¤ì „ ì—ëŸ¬ 3ì¢… ì •ë¦¬
> 
> 
> ë°œìƒ ì›ì¸ ë¶„ì„ + ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ í•´ê²° ë°©ë²•ê¹Œì§€ í¬í•¨
> 

---

## ğŸ§© ë°°ê²½

- Airflow DAG ë‚´ë¶€ì—ì„œ `mlflow.sklearn.log_model()` í˜¸ì¶œ
- ì‹¤í—˜ ìë™ ë“±ë¡ ë° Model Registry ì—°ë™ ì‹œë„
- âœ… ê²°ê³¼ì ìœ¼ë¡œ **3ê°€ì§€ ì—ëŸ¬** ìˆœì°¨ ë°œìƒ

---

## ğŸ”¥ ì—ëŸ¬ 1. `PermissionError: [Errno 13] Permission denied: '/mlflow'`

### ğŸ§  ì›ì¸ ë¶„ì„

| ì¦ìƒ | ì›ì¸ |
| --- | --- |
| `/mlflow` ê²½ë¡œ ì ‘ê·¼ ì‹¤íŒ¨ | Airflow ì»¨í…Œì´ë„ˆì— mountë˜ì§€ ì•ŠìŒ |
| `mlruns` ì“°ê¸° ì‹¤íŒ¨ | ê³µìœ  ë³¼ë¥¨ ëˆ„ë½ â†’ ì“°ê¸° ê¶Œí•œ ì—†ìŒ |
| ì‹¤í—˜ ìƒì„± ì‹¤íŒ¨ | artifact ì €ì¥ì†Œ ì§€ì • ì‹¤íŒ¨ |

### âœ… í•´ê²° ë°©ë²•

1. **Airflow ì»¨í…Œì´ë„ˆì— ê³µìœ  ë³¼ë¥¨ ì¶”ê°€**

```yaml
volumes:
  - ./mlflow:/mlflow
  - ./mlruns:/mlflow/mlruns
```

1. **ì´ˆê¸° ì‹¤í—˜ ìˆ˜ë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰**

```python
# init_experiments.py
from mlflow.tracking import MlflowClient

mlflow.set_tracking_uri("http://localhost:5000")
client = MlflowClient()

if not client.get_experiment_by_name("Iris_Model_Registry_Go"):
    client.create_experiment(
        name="Iris_Model_Registry_Go",
        artifact_location="file:///mlflow/mlruns/Iris_Model_Registry_Go"
    )
```

```bash
docker exec -it airflow_mlflow_1 python3 /mlflow/init_experiments.py
```

1. **Airflow DAG ë‚´ì—ì„œ ë™ì¼í•œ ì´ë¦„ ì§€ì •**

```python
mlflow.set_experiment("Iris_Model_Registry_Go")
```

---

## ğŸ’¥ ì—ëŸ¬ 2. `404 Not Found` on `/api/2.0/mlflow/logged-models`

### ğŸ§  ì›ì¸ ë¶„ì„

| í•µì‹¬ ë¬¸ì œ | ìƒì„¸ ì„¤ëª… |
| --- | --- |
| Model Registry API ë¯¸íƒ‘ì¬ | `mlflow ui` ë˜ëŠ” `mlflow server`ì˜ ì˜µì…˜ ëˆ„ë½ |
| `/logged-models` ê²½ë¡œ ì—†ìŒ | ê¸°ë³¸ ì‹¤í–‰ ì‹œì—ëŠ” Registry ê´€ë ¨ APIê°€ ë¹„í™œì„±í™” |

### âœ… í•´ê²° ë°©ë²•

- **ì •ìƒ ì‘ë™ ì¡°ê±´**:

| ì‹¤í–‰ ë°©ì‹ | Registry API |
| --- | --- |
| `mlflow ui` | âŒ ì—†ìŒ |
| `mlflow server` | âš ï¸ ì¼ë¶€ ì—†ìŒ |
| `mlflow server --serve-artifacts` | âœ… ëª¨ë‘ í™œì„±í™” |
| `mlflow[extras]` íŒ¨í‚¤ì§€ | âœ… ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ì‚¬ìš© í•„ìš” |

ğŸ“Œ **Dockerfile.mlflow ì˜ˆì‹œ** (ì»¤ìŠ¤í…€ êµ¬ì„±)

```
FROM python:3.10-slim
RUN pip install mlflow[extras]
CMD ["mlflow", "server", "--serve-artifacts", "--host", "0.0.0.0", "--port", "5000"]
```

---

## âš ï¸ ì—ëŸ¬ 3. Airflow CLI ì˜¤ë¥˜: `the following arguments are required: GROUP_OR_COMMAND`

### ğŸ§  ì›ì¸ ë¶„ì„

| ì¦ìƒ | ì›ì¸ |
| --- | --- |
| Airflow ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì§í›„ ì¢…ë£Œ | ëª…ë ¹ì–´ ì—†ì´ airflow ì‹¤í–‰ë¨ |
| `GROUP_OR_COMMAND` ìš”êµ¬ | `CMD`, `ENTRYPOINT` ëˆ„ë½ |

### âœ… í•´ê²° ë°©ë²•

- **ê°œë°œ/í…ŒìŠ¤íŠ¸ ìš©ë„**: `standalone` ëª¨ë“œ ì‚¬ìš©

```yaml
command: standalone
```

- **ì‹¤ë¬´ êµ¬ì„±**: `webserver`, `scheduler` ë¶„ë¦¬ ì‹¤í–‰

```yaml
command: webserver
# ë˜ëŠ”
command: scheduler
```

---

## ğŸ“¦ ê³µìœ  ë³¼ë¥¨ êµ¬ì¡° ìš”ì•½

| Host ë””ë ‰í† ë¦¬ | MLflow ì»¨í…Œì´ë„ˆ | Airflow ì»¨í…Œì´ë„ˆ |
| --- | --- | --- |
| `./mlflow` | `/mlflow` | `/mlflow` |
| `./mlruns` | `/mlflow/mlruns` | `/mlflow/mlruns` |

ğŸ“Œ **ê³µí†µ ì €ì¥ì†Œ êµ¬ì¡° í•„ìˆ˜!** â†’ ì‹¤í—˜ ë¡œê¹…, ëª¨ë¸ ì¶”ë¡ , ë“±ë¡ ê²½ë¡œ í†µì¼

---

## âœ… í•µì‹¬ ìš”ì•½

| ë¬¸ì œ | ì›ì¸ | í•´ê²° í¬ì¸íŠ¸ |
| --- | --- | --- |
| `PermissionError` | Airflow ì»¨í…Œì´ë„ˆì— mount ëˆ„ë½ | `volumes:`ë¡œ ê²½ë¡œ ê³µìœ  |
| `404 Not Found` | Registry API ë¯¸í™œì„±í™” | `--serve-artifacts` ì˜µì…˜ í•„ìˆ˜ |
| `GROUP_OR_COMMAND` | Airflow ëª…ë ¹ ë¯¸ì§€ì • | `command: standalone` ë˜ëŠ” `webserver` |

---

### âœ¨ íŒ

- Docker ê³µìœ  ê²½ë¡œëŠ” ì»¨í…Œì´ë„ˆ ê°„ **ì ˆëŒ€ ë™ì¼í•˜ê²Œ ì„¤ì •**í•´ì•¼ í•¨
- `mlflow.set_experiment()`ì€ DAGë§ˆë‹¤ ì •í™•íˆ ì„¤ì •í•´ì•¼ í•¨
- ì‹¤í—˜ ë””ë ‰í† ë¦¬ ìƒì„±ì€ ë¡œê¹… ì „ì— ë¯¸ë¦¬ ì§€ì • or ìˆ˜ë™ ìƒì„±
- í…ŒìŠ¤íŠ¸ ì¤‘ì—ëŠ” Airflowë¥¼ `standalone` ëª¨ë“œë¡œ ì‹¤í–‰í•˜ëŠ” ê²Œ í¸í•¨
