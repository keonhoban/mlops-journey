<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Helm | 🏔️ MLOps Journey</title>
<meta name=keywords content><meta name=description content><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/categories/helm/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://keonhoban.github.io/mlops-journey/categories/helm/index.xml><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/categories/helm/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/categories/helm/"><meta property="og:site_name" content="🏔️  MLOps Journey"><meta property="og:title" content="Helm"><meta property="og:locale" content="ko"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Helm"><meta name=twitter:description content></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="🏔️  MLOps Journey (Alt + H)">🏔️ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="🏠 Home"><span>🏠 Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="📂 Projects"><span>📂 Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="📝 Blog"><span>📝 Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="🧗 About"><span>🧗 About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="📖 Categories"><span>📖 Categories</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/categories/>Categories</a></div><h1>Helm</h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[MLOps 플랫폼 구축 : Airflow-MLflow-FastAPI (Helm)]</h2></header><div class=entry-content><p>📌 전체 시리즈 요약 순서 주제 1 🔗 실습을 위한 인프라 사전 구성 (Kubernetes, NFS, PostgreSQL, S3 등) 2 🔗 Secret/보안 구성 및 Kubernetes 연동 3 🔗 MLflow Tracking 서버 및 Registry 구축 4 🔗 Airflow DAG Git 연동 및 Secret 기반 구성 5 🔗 FastAPI 모델 서빙 & MLflow 모델 자동 로딩 6 🔗 Airflow + MLflow + FastAPI 연결을 통해 모델 핫스왑 💡 지금까지 구현한 아키텍처 요약 graph TD %% 클러스터 구성 subgraph "Kubernetes Cluster" subgraph "Namespace: mlflow" MLflow[📦 MLflow Pod] end subgraph "Namespace: airflow" Airflow[📦 Airflow Pod] end subgraph "Namespace: fastapi" FastAPI[📦 FastAPI Pod] end end %% 외부 시스템 subgraph "External Systems" S3[🪣 S3 Bucket] DB_PostgreSQL[🗄️ PostgreSQL DB] end %% Secret 구성 subgraph "Kubernetes Secrets" AWS_Secret[🔐 aws-credentials-secret] MLflow_DB_Secret[🔐 mlflow-db-secret] Airflow_DB_Secret[🔐 airflow-db-secret] end %% MLflow 연동 MLflow -->|"모델 메타데이터 저장"| DB_PostgreSQL MLflow -->|"모델 아티팩트 저장"| S3 AWS_Secret --> MLflow MLflow_DB_Secret --> MLflow %% Airflow 연동 Airflow -->|"모델 학습 후 등록"| MLflow Airflow -->|"추론 결과 저장"| DB_PostgreSQL AWS_Secret --> Airflow Airflow_DB_Secret --> Airflow %% FastAPI 연동 FastAPI -->|"모델 메타정보 조회"| MLflow FastAPI -->|"모델 파일 다운로드"| S3 FastAPI -->|"추론 입력 데이터 접근"| S3 AWS_Secret --> FastAPI %% 서비스 흐름 강조 style FastAPI fill:#d1f7c4,stroke:#3fa34d,stroke-width:2px style Airflow fill:#cfe2ff,stroke:#2c6ecb,stroke-width:2px style MLflow fill:#fce2c8,stroke:#e09100,stroke-width:2px Kubernetes 기반 Pod로 모든 구성 요소 운영 Secret 기반 AWS 인증 정보 및 DB 정보 주입 Ingress 기반 접근 (ex. airflow.local, mlflow.local, fastapi.local) MLflow + Airflow + FastAPI 연계로 실시간 모델 관리/서빙 자동화 🎯 실무 관점에서 강점 항목 내용 모델 실험 자동화 Airflow DAG + MLflow 연동으로 다양한 모델 버전 학습 자동화 서빙 안정성 FastAPI가 Production Stage 기준으로 모델 로드 → 무중단 핫스왑 가능 보안 구성 AWS 인증 정보 및 DB 정보는 Secret으로 주입 인프라 이식성 Helm + Docker + Kubernetes 기반 → 어디서든 이식 가능 실시간 추론 확인 Ingress 기반 UI/Endpoint 연결 → 바로 curl 테스트 가능 🔍 회고 ✅ 프로덕션 환경 고려 운영 가능한 MLOps 구조로 설계 (유지보수/보안 고려) AWS S3, PostgreSQL, Kubernetes, GitOps까지 현실 환경 가정하고 구성 Secret 설계, Volume 마운트, GitSync, 커스텀 이미지 등 세세한 부분까지 설계 주도 ✅ 자동화 기반 설계 Airflow를 통해 모델 학습 → Registry 등록 → 서빙까지 자동화 모델 핫스왑 실험까지 성공적으로 구현 🧱 부족했던 점 & 보완 계획 항목 개선 포인트 모니터링 Prometheus + Grafana로 서빙/실험 성능 모니터링 추가 필요 모델 테스트 자동화 pytest + CI 파이프라인 구성으로 품질 확보 고려 Kubeflow 연계 Kubeflow Pipelines 및 Katib 등과의 비교 분석 예정 Terraform 기반 전환 Helm 구성 요소를 코드로 관리하는 Terraform 인프라 전환 계획 📈 다음 단계 설계 기간 목표 2025년 8월 Kubeflow 기반 재구성 + 모델 자동 튜닝 실험 2025년 9월 Triton Inference Server 연동 + GPU 서빙 실습 2025년 10월 ScyllaDB & LLM 서빙 구조 실험 연말 MLOps 포트폴리오 정리 및 지원서 작성 ✨ 마치며 이번 시리즈는 단순한 학습이 아니라, 설계에 대해 고민하며
...</p></div><footer class=entry-footer><span title='2025-07-15 17:55:05 +0900 +0900'>July 15, 2025</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to [MLOps 플랫폼 구축 : Airflow-MLflow-FastAPI (Helm)]" href=https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/helm/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[MLOps 플랫폼 구축 - 6단계: 실시간 모델 핫스왑 구조 실험]</h2></header><div class=entry-content><p>✅ TL;DR Airflow에서 선택한 모델 버전에 따라 학습 스크립트를 다르게 실행 학습된 모델을 MLflow Model Registry에 등록 → Production 단계로 자동 승격 FastAPI 서버는 Production 모델을 다시 로드 → 별도 코드 수정 없이 핫스왑 완료 실무에서 모델 검증/배포 사이클 자동화에 바로 응용 가능 🧠 구조 다이어그램 (핫스왑 흐름) flowchart TD A1[Airflow DAG: 모델 학습 스크립트 실행] --> B1[MLflow 모델 등록 - 버전 선택] B1 --> C1[모델 Production 승격] C1 --> D1[FastAPI 서버 재시작] D1 --> E1[FastAPI → 최신 모델 로드] E1 --> F1[추론 API 서빙] subgraph 실험 관리 B1 C1 end subgraph 추론 서비스 D1 E1 F1 end 🧩 핵심 구성 요소 1. Airflow DAG - 모델 버전 선택 # dags/train_promote_pipeline_share.py from airflow import DAG from airflow.operators.bash import BashOperator from airflow.models import Variable from datetime import datetime default_args = { 'start_date': datetime(2023, 1, 1), } with DAG( dag_id='train_promote_pipeline_share', default_args=default_args, schedule=None, catchup=False, tags=["ml", "train"] ) as dag: # moedel_version 변수 default_var 지정 model_version = Variable.get("model_version", default_var="v1") debug_aws = BashOperator( task_id='debug_aws_credentials', bash_command='echo $HOME && ls -al $HOME/.aws && cat $HOME/.aws/credentials', env={"HOME": "/home/airflow"}, ) run_train_script = BashOperator( task_id='run_train_script', # merdel_version 변수화 bash_command=f'python /opt/airflow/dags/repo/ml_code/train_model_{model_version}.py', env={"HOME": "/home/airflow"}, ) promote_model = BashOperator( task_id='promote_model_to_production', bash_command='python /opt/airflow/dags/repo/ml_code/promote_model.py', env={"HOME": "/home/airflow"}, ) debug_aws >> run_train_script >> promote_model → Airflow UI > Admin > Variables 에서 model_version = v1 또는 v2 설정 가능
...</p></div><footer class=entry-footer><span title='2025-07-10 17:12:00 +0900 +0900'>July 10, 2025</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to [MLOps 플랫폼 구축 - 6단계: 실시간 모델 핫스왑 구조 실험]" href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/06/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[MLOps 플랫폼 구축 - 5단계: FastAPI 서빙: MLflow 모델 연동 및 핫스왑 구조 구축]</h2></header><div class=entry-content><p>✨ TL;DR MLflow에서 등록한 모델을 FastAPI 기반 REST API로 서빙합니다. mlflow.pyfunc.load_model()을 통해 Stage별 버전 관리, 핫스왑, 모델 정보 조회가 가능합니다. 쿠버네티스 기반으로 Helm Chart 배포 + AWS 인증 Secret + Ingress 접근까지 연동합니다. 📐 아키텍처 구성도 graph TD subgraph Kubernetes Cluster MLflow[MLflow Pod] FastAPI[FastAPI Pod] end subgraph Kubernetes Secrets Secret_AWS[(aws-credentials-secret)] Secret_DB_MLFLOW[(mlflow-db-secret)] end subgraph External Systems S3[(AWS S3)] DB[(PostgreSQL VM)] end Secret_AWS --> FastAPI Secret_AWS --> MLflow Secret_DB_MLFLOW --> MLflow FastAPI --> S3 FastAPI --> MLflow MLflow --> DB MLflow --> S3 🐳 FastAPI 커스텀 이미지 📦 Dockerfile FROM python:3.12 WORKDIR /app COPY app /app COPY requirements.txt . RUN pip install --no-cache-dir -r requirements.txt CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"] 📄 requirements.txt fastapi==0.110.2 uvicorn==0.29.0 mlflow==2.13.0 pandas==2.1.4 scikit-learn==1.6.1 pydantic==2.7.1 boto3==1.34.113 numpy==1.26.4 packaging==24.2 psutil==7.0.0 scipy==1.15.3 setuptools==69.5.1 🚀 빌드 & 푸시 docker build -t ghcr.io/hoizz/fastapi-ml:mlflow-model-info . docker push ghcr.io/hoizz/fastapi-ml:mlflow-model-info 🛠️ Helm 배포 구성 🧾 values.yaml replicaCount: 1 image: repository: hoizz/fastapi-ml tag: mlflow-model-info pullPolicy: IfNotPresent service: name: fastapi-service type: ClusterIP port: 80 ingress: enabled: true className: nginx host: fastapi.local annotations: nginx.ingress.kubernetes.io/rewrite-target: / env: MLFLOW_TRACKING_URI: "http://mlflow-service.mlflow.svc.cluster.local:5000" MODEL_NAME: "my_model" MODEL_STAGE: "Production" envFrom: - secretRef: name: aws-credentials-secret 📄 핵심 템플릿 fastapi-deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: fastapi-server namespace: fastapi spec: replicas: 1 selector: matchLabels: app: fastapi template: metadata: labels: app: fastapi spec: containers: - name: fastapi image: {{ .Values.image.repository }}:{{ .Values.image.tag }} ports: - containerPort: 8000 env: - name: MLFLOW_TRACKING_URI value: {{ .Values.env.MLFLOW_TRACKING_URI }} - name: MODEL_NAME value: {{ .Values.env.MODEL_NAME }} - name: MODEL_STAGE value: {{ .Values.env.MODEL_STAGE }} envFrom: - secretRef: name: aws-credentials-secret fastapi-service.yaml apiVersion: v1 kind: Service metadata: name: fastapi-service namespace: fastapi spec: type: {{ .Values.service.type }} selector: app: fastapi ports: - port: {{ .Values.service.port }} targetPort: 8000 fastapi-ingress.yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: fastapi-ingress namespace: fastapi annotations: {{- range $key, $value := .Values.ingress.annotations }} {{ $key }}: {{ $value | quote }} {{- end }} spec: ingressClassName: {{ .Values.ingress.className }} rules: - host: {{ .Values.ingress.host }} http: paths: - path: / pathType: Prefix backend: service: name: fastapi-service port: number: {{ .Values.service.port }} ⏱ 배포 kubectl create namespace fastapi helm install fastapi fastapi-helm -n fastapi # hosts 수정 {node_ip} fastapi.local # 접근 url [http://fastapi.local](http://fastapi.local/) 🧩 Tip 항목 팁 모델 핫스왑 /model-info API 제공 → 운영 시 버전 추적 필수 모델 미존재 load_model 시 MlflowException 발생 → FastAPI가 죽지 않도록 예외 처리 Ingress 설정 /etc/hosts, className, rewrite-target 필수 확인 리소스 할당 배포 시 CPU/RAM 제한 설정으로 예측 지연 방지 🔧 MLOps 실전 연결 항목 실제 의미 FastAPI REST 서빙 실시간 추론 API 운영에 적합 mlflow Stage 사용 운영과 실험 모델 분리 및 핫스왑 가능 boto3 연동 S3 객체 접근, 로그 추적, 리포트 저장 자동화 Helm 기반 배포 팀 내 재사용 가능한 마이크로서비스 패턴 완성 🧭 다음 포스트 예고 🧠 실시간 모델 핫스왑 구조 실험
...</p></div><footer class=entry-footer><span title='2025-07-07 17:11:55 +0900 +0900'>July 7, 2025</span>&nbsp;·&nbsp;3 min</footer><a class=entry-link aria-label="post link to [MLOps 플랫폼 구축 - 5단계: FastAPI 서빙: MLflow 모델 연동 및 핫스왑 구조 구축]" href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/05/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]</h2></header><div class=entry-content><p>✨ TL;DR Helm을 통해 Airflow를 배포하면서 DAG 코드를 Git 저장소에서 자동으로 동기화하는 구조 설계 GitSync, Secret 기반 SSH 인증, 외부 PostgreSQL, AWS S3 연동까지 포함해 구성 UI 접근은 Ingress를 통해 이루어지며, 로그는 PVC 또는 S3로 설정 가능 📐 아키텍처 구성도 flowchart TD subgraph K8s_Cluster["Kubernetes Cluster"] Scheduler[(Airflow Scheduler Pod)] Worker[(Airflow Worker Pod)] Webserver[(Airflow Webserver Pod)] end subgraph DAG_Repo["Git Repository"] DAG[(airflow-dags.git)] end subgraph Secrets["K8s Secrets + Configs"] SecretAWS[(aws-credentials-secret)] SecretDB[(airflow-db-secret)] end subgraph External["External Systems"] PG[(PostgreSQL: External Metadata DB)] NFS[(NFS: airflow-logs-pvc)] end %% GitSync DAG --> Scheduler DAG --> Worker DAG --> Webserver %% Secret 주입 SecretAWS --> Scheduler SecretAWS --> Worker SecretAWS --> Webserver SecretDB --> Scheduler %% 외부 연동 Scheduler --> PG Scheduler --> NFS Worker --> NFS Webserver --> NFS 🐳 커스텀 Airflow 이미지 구성 GitSync DAG에서 MLflow 연동 또는 AWS SDK 사용을 위한 Python 패키지 설치 필요
...</p></div><footer class=entry-footer><span title='2025-07-03 17:11:53 +0900 +0900'>July 3, 2025</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to [MLOps 플랫폼 구축 - 4단계: Airflow : GitSync + 외부 PostgreSQL + Secret 연동]" href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/04/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>[MLOps 플랫폼 구축 - 3단계: MLflow : PostgreSQL + S3 연동 기반 Helm 구성]</h2></header><div class=entry-content><p>✨ TL;DR MLflow를 도입시 PostgreSQL, S3, 인증 정보 주입, Helm 배포, Ingress 연동 등 설계 MLflow를 Helm으로 배포하면서 고려한 항목(보안, 아티팩트 저장소, UI 접근 등) 구성 커스텀 Docker 이미지로 psycopg2 설치, Helm chart 구성, Secret 연결까지 포함 📐 아키텍처 구성도 (with Secret & 연동 흐름) flowchart TD subgraph K8s_Cluster["Kubernetes Cluster"] MLflowPod[(MLflow Pod)] end subgraph External["External Systems"] S3[(S3: Artifact 저장소)] PG[(PostgreSQL: Tracking DB)] end subgraph Config["Helm Values + Secrets"] SecretDB[(mlflow-db-secret)] SecretAWS[(aws-credentials-secret)] ConfigMapDB[(mlflow-db-config)] end SecretDB --> MLflowPod SecretAWS --> MLflowPod ConfigMapDB --> MLflowPod MLflowPod --> S3 MLflowPod --> PG 🐳 커스텀 MLflow Docker 이미지 제작 공식 MLflow 이미지는 PostgreSQL 드라이버(psycopg2)가 포함되어 있지 않아 오류 발생
...</p></div><footer class=entry-footer><span title='2025-06-30 17:11:51 +0900 +0900'>June 30, 2025</span>&nbsp;·&nbsp;4 min</footer><a class=entry-link aria-label="post link to [MLOps 플랫폼 구축 - 3단계: MLflow : PostgreSQL + S3 연동 기반 Helm 구성]" href=https://keonhoban.github.io/mlops-journey/posts/mlops-pipeline-helm/03/></a></article></main><footer class=footer><p style=margin-top:1rem>© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>