<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Airflow 기초 자동화 - Airflow → MLflow → FastAPI] | 🏔️ MLOps Journey</title>
<meta name=keywords content><meta name=description content='🧭 전체 흐름 예시
[AIRFLOW DAG 실행]
   ↓
[train_mlflow.py]
   - iris 모델 학습
   - 파라미터/메트릭 로깅
   - 모델 Registry 등록
   ↓
[promote_mlflow.py]
   - 최신 모델을 Production으로 전환
   ↓
[FastAPI]
   - models:/IrisModel/Production → 실시간 예측
👉 실습 코드는 🔗 GitHub (Airflow + MLflow + FastAPI)

✅ [1단계] 프로젝트 기본 폴더 구조 설계
📁 1. 전체 디렉토리 구성도
mlops_project/
├── airflow/                       🛫 Airflow 설정 및 DAG 스케줄러
│   ├── dags/                      ← DAG 정의 디렉토리
│   │   └── train_with_mlflow.py   ← 학습 DAG (MLflow 연동)
│   ├── Dockerfile.airflow         ← Airflow용 Dockerfile
│   ├── requirements.txt           ← Airflow 의존성
│   └── .dockerignore
│
├── fastapi/              ⚡ FastAPI 예측 API 서버
│   ├── app/
│   │   └── main.py        ← 모델 서빙 엔드포인트
│   ├── Dockerfile.api     ← FastAPI용 Dockerfile
│   ├── requirements.txt   ← FastAPI 의존성
│   └── .dockerignore
│
├── ml_code/               🧠 ML 학습 및 프로모션 코드
│   ├── train_mlflow.py     ← 모델 학습 및 MLflow 로깅
│   └── promte_mlflow.py    ← 모델 프로모션 (Staging → Production)
│
├── mlflow_store/          🗂️ MLflow 저장소 경로 (볼륨)
│   ├── Dockerfile.mlflow   ← MLflow 서버 커스터마이징
│   ├── mlflow.db           ← Model Registry DB (sqlite)
│   ├── mlruns/             ← 실험 로그 디렉토리
│   ├── artifacts/          ← 모델 아티팩트 저장소
│   └── .dockerignore
│
├── docker-compose.yaml    🧩 전체 서비스 구성 정의
├── .env                   🔐 민감 정보 (.env로 분리)
├── README.md              📝 전체 프로젝트 문서화
├── .gitignore
└── .dockerignore

✅ [2단계] docker-compose.yaml 통합 구성
🧭 구성 목표

  
      
          서비스명
          설명
          포트
      
  
  
      
          airflow
          DAG 실행 환경 (webserver/scheduler)
          8080
      
      
          postgres
          Airflow 메타데이터 저장용 DB
          내부 통신
      
      
          mlflow
          MLflow UI + Registry 기능
          5000
      
      
          fastapi
          추론 API 서버 (모델 로딩)
          8000
      
  


이미지 사용시 주의 (UI만 제공하는 이미지 존재)


📄 docker-compose.yaml 전체 예시
version: &#39;3.8&#39;

services:
  # 📦 PostgreSQL: Airflow 메타데이터 저장용 DB
  postgres:
    image: postgres:13
    container_name: postgres
    env_file:
      - .env  # ← 민감정보 분리 (아이디/비번)
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:  # ← 코드/데이터 공유 및 영속성 보장
      - postgres_data:/var/lib/postgresql/data  # ← DB 데이터 유지 (재시작 대비)

  # 🛫 Airflow: DAG 스케줄러 및 태스크 실행
  airflow:
    build:
      context: ./airflow           # → Airflow 전용 Dockerfile 경로
      dockerfile: Dockerfile.airflow
    container_name: airflow
    command: standalone           # → 로컬 테스트용 간단 실행 명령 
                      # (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행)
                      # (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리)
    ports:
      - "8080:8080"               # → Airflow 웹 UI (localhost:8080)
    depends_on:
      - postgres                  # → DB가 먼저 올라와야 Airflow 시작 가능
    env_file:
      - .env
    environment:
      # Airflow 메타데이터 DB 연결 주소
      AIRFLOW__CORE__SQL_ALCHEMY_CONN: ${AIRFLOW__CORE__SQL_ALCHEMY_CONN}
      # Airflow 예제 DAG 불러올지 여부
      AIRFLOW__CORE__LOAD_EXAMPLES: ${AIRFLOW__CORE__LOAD_EXAMPLES}  
      MLFLOW_TRACKING_URI: http://mlflow:5000  # → DAG 코드에서 MLflow 연동
    volumes:
      - ./airflow/dags:/opt/airflow/dags     # DAG 파일 mount
      - ./ml_code:/opt/airflow/ml_code       # 학습 코드 공유
      - ./mlflow_store:/mlflow               # 모델 저장소 공유

  # 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버
  mlflow:
    build:
      context: ./mlflow_store                # 커스텀 Dockerfile 위치
      dockerfile: Dockerfile.mlflow
    ports:
      - "5000:5000"                          # → MLflow UI (localhost:5000)
    volumes:
      - ./mlflow_store:/mlflow              # 실험 로그 + DB + artifacts 저장
    environment:
      - MLFLOW_TRACKING_URI=http://0.0.0.0:5000  # 내부 컨테이너 기준 URI

  # ⚡ FastAPI: 모델 서빙 API
  fastapi:
    build:
      context: ./fastapi
      dockerfile: Dockerfile.api
    container_name: fastapi
    ports:
      - "8000:8000"                          # → 예측 API 엔드포인트 (localhost:8000)
    volumes:
      - ./fastapi/app:/app/app              # FastAPI app 디렉토리 mount
      - ./ml_code:/app/ml_code              # 학습/모델 코드 공유
      - ./mlflow_store:/mlflow              # 저장된 모델 불러오기 위한 mount

# 🗂️ 볼륨 정의 (Postgres DB 영속성 유지)
volumes:
  postgres_data:

🎁 추가로 해야 할 것

Airflow 첫 실행 후엔 보통 관리자 계정 생성도 해줘야 함:

# airflow 컨테이너 접속
docker exec -it airflow bash

# 관리자 계정 생성
airflow users create \
  --username airflow \
  --password airflow \
  --firstname Keoho \
  --lastname Ban \
  --role Admin \
  --email airflow@example.com

🔁 [구축 Tip] Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인

  
      
          공유 리소스
          설명
      
  
  
      
          ./mlflow_store:/mlflow (MLflow)
          MLflow 서버가 쓰는 로그/모델 저장소
      
      
          ./mlflow_store:/mlflow (Airflow)
          학습 후 모델 저장 위치 공유
      
      
          ./mlflow_store:/mlflow (FastAPI)
          모델 추론 시 로드 경로 공유
      
  

➡ 경로 통일성이 매우 중요함! 지금은 모두 ./mlflow로 공유 (./mlflow 하위에 /mlruns 존재)'><meta name=author content><link rel=canonical href=https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/basic/><link crossorigin=anonymous href=/mlops-journey/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://keonhoban.github.io/mlops-journey/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://keonhoban.github.io/mlops-journey/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://keonhoban.github.io/mlops-journey/favicon-32x32.png><link rel=apple-touch-icon href=https://keonhoban.github.io/mlops-journey/apple-touch-icon.png><link rel=mask-icon href=https://keonhoban.github.io/mlops-journey/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/basic/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/basic/"><meta property="og:site_name" content="🏔️  MLOps Journey"><meta property="og:title" content="[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]"><meta property="og:description" content='🧭 전체 흐름 예시 [AIRFLOW DAG 실행] ↓ [train_mlflow.py] - iris 모델 학습 - 파라미터/메트릭 로깅 - 모델 Registry 등록 ↓ [promote_mlflow.py] - 최신 모델을 Production으로 전환 ↓ [FastAPI] - models:/IrisModel/Production → 실시간 예측 👉 실습 코드는 🔗 GitHub (Airflow + MLflow + FastAPI)
✅ [1단계] 프로젝트 기본 폴더 구조 설계 📁 1. 전체 디렉토리 구성도 mlops_project/ ├── airflow/ 🛫 Airflow 설정 및 DAG 스케줄러 │ ├── dags/ ← DAG 정의 디렉토리 │ │ └── train_with_mlflow.py ← 학습 DAG (MLflow 연동) │ ├── Dockerfile.airflow ← Airflow용 Dockerfile │ ├── requirements.txt ← Airflow 의존성 │ └── .dockerignore │ ├── fastapi/ ⚡ FastAPI 예측 API 서버 │ ├── app/ │ │ └── main.py ← 모델 서빙 엔드포인트 │ ├── Dockerfile.api ← FastAPI용 Dockerfile │ ├── requirements.txt ← FastAPI 의존성 │ └── .dockerignore │ ├── ml_code/ 🧠 ML 학습 및 프로모션 코드 │ ├── train_mlflow.py ← 모델 학습 및 MLflow 로깅 │ └── promte_mlflow.py ← 모델 프로모션 (Staging → Production) │ ├── mlflow_store/ 🗂️ MLflow 저장소 경로 (볼륨) │ ├── Dockerfile.mlflow ← MLflow 서버 커스터마이징 │ ├── mlflow.db ← Model Registry DB (sqlite) │ ├── mlruns/ ← 실험 로그 디렉토리 │ ├── artifacts/ ← 모델 아티팩트 저장소 │ └── .dockerignore │ ├── docker-compose.yaml 🧩 전체 서비스 구성 정의 ├── .env 🔐 민감 정보 (.env로 분리) ├── README.md 📝 전체 프로젝트 문서화 ├── .gitignore └── .dockerignore ✅ [2단계] docker-compose.yaml 통합 구성 🧭 구성 목표 서비스명 설명 포트 airflow DAG 실행 환경 (webserver/scheduler) 8080 postgres Airflow 메타데이터 저장용 DB 내부 통신 mlflow MLflow UI + Registry 기능 5000 fastapi 추론 API 서버 (모델 로딩) 8000 이미지 사용시 주의 (UI만 제공하는 이미지 존재) 📄 docker-compose.yaml 전체 예시 version: &#39;3.8&#39; services: # 📦 PostgreSQL: Airflow 메타데이터 저장용 DB postgres: image: postgres:13 container_name: postgres env_file: - .env # ← 민감정보 분리 (아이디/비번) environment: POSTGRES_USER: ${POSTGRES_USER} POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} POSTGRES_DB: ${POSTGRES_DB} volumes: # ← 코드/데이터 공유 및 영속성 보장 - postgres_data:/var/lib/postgresql/data # ← DB 데이터 유지 (재시작 대비) # 🛫 Airflow: DAG 스케줄러 및 태스크 실행 airflow: build: context: ./airflow # → Airflow 전용 Dockerfile 경로 dockerfile: Dockerfile.airflow container_name: airflow command: standalone # → 로컬 테스트용 간단 실행 명령 # (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행) # (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리) ports: - "8080:8080" # → Airflow 웹 UI (localhost:8080) depends_on: - postgres # → DB가 먼저 올라와야 Airflow 시작 가능 env_file: - .env environment: # Airflow 메타데이터 DB 연결 주소 AIRFLOW__CORE__SQL_ALCHEMY_CONN: ${AIRFLOW__CORE__SQL_ALCHEMY_CONN} # Airflow 예제 DAG 불러올지 여부 AIRFLOW__CORE__LOAD_EXAMPLES: ${AIRFLOW__CORE__LOAD_EXAMPLES} MLFLOW_TRACKING_URI: http://mlflow:5000 # → DAG 코드에서 MLflow 연동 volumes: - ./airflow/dags:/opt/airflow/dags # DAG 파일 mount - ./ml_code:/opt/airflow/ml_code # 학습 코드 공유 - ./mlflow_store:/mlflow # 모델 저장소 공유 # 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버 mlflow: build: context: ./mlflow_store # 커스텀 Dockerfile 위치 dockerfile: Dockerfile.mlflow ports: - "5000:5000" # → MLflow UI (localhost:5000) volumes: - ./mlflow_store:/mlflow # 실험 로그 + DB + artifacts 저장 environment: - MLFLOW_TRACKING_URI=http://0.0.0.0:5000 # 내부 컨테이너 기준 URI # ⚡ FastAPI: 모델 서빙 API fastapi: build: context: ./fastapi dockerfile: Dockerfile.api container_name: fastapi ports: - "8000:8000" # → 예측 API 엔드포인트 (localhost:8000) volumes: - ./fastapi/app:/app/app # FastAPI app 디렉토리 mount - ./ml_code:/app/ml_code # 학습/모델 코드 공유 - ./mlflow_store:/mlflow # 저장된 모델 불러오기 위한 mount # 🗂️ 볼륨 정의 (Postgres DB 영속성 유지) volumes: postgres_data: 🎁 추가로 해야 할 것 Airflow 첫 실행 후엔 보통 관리자 계정 생성도 해줘야 함: # airflow 컨테이너 접속 docker exec -it airflow bash # 관리자 계정 생성 airflow users create \ --username airflow \ --password airflow \ --firstname Keoho \ --lastname Ban \ --role Admin \ --email airflow@example.com 🔁 [구축 Tip] Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인 공유 리소스 설명 ./mlflow_store:/mlflow (MLflow) MLflow 서버가 쓰는 로그/모델 저장소 ./mlflow_store:/mlflow (Airflow) 학습 후 모델 저장 위치 공유 ./mlflow_store:/mlflow (FastAPI) 모델 추론 시 로드 경로 공유 ➡ 경로 통일성이 매우 중요함! 지금은 모두 ./mlflow로 공유 (./mlflow 하위에 /mlruns 존재)'><meta property="og:locale" content="ko"><meta property="og:type" content="article"><meta property="article:section" content="projects"><meta property="article:published_time" content="2025-06-13T20:58:51+09:00"><meta property="article:modified_time" content="2025-06-13T20:58:51+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]"><meta name=twitter:description content='🧭 전체 흐름 예시
[AIRFLOW DAG 실행]
   ↓
[train_mlflow.py]
   - iris 모델 학습
   - 파라미터/메트릭 로깅
   - 모델 Registry 등록
   ↓
[promote_mlflow.py]
   - 최신 모델을 Production으로 전환
   ↓
[FastAPI]
   - models:/IrisModel/Production → 실시간 예측
👉 실습 코드는 🔗 GitHub (Airflow + MLflow + FastAPI)

✅ [1단계] 프로젝트 기본 폴더 구조 설계
📁 1. 전체 디렉토리 구성도
mlops_project/
├── airflow/                       🛫 Airflow 설정 및 DAG 스케줄러
│   ├── dags/                      ← DAG 정의 디렉토리
│   │   └── train_with_mlflow.py   ← 학습 DAG (MLflow 연동)
│   ├── Dockerfile.airflow         ← Airflow용 Dockerfile
│   ├── requirements.txt           ← Airflow 의존성
│   └── .dockerignore
│
├── fastapi/              ⚡ FastAPI 예측 API 서버
│   ├── app/
│   │   └── main.py        ← 모델 서빙 엔드포인트
│   ├── Dockerfile.api     ← FastAPI용 Dockerfile
│   ├── requirements.txt   ← FastAPI 의존성
│   └── .dockerignore
│
├── ml_code/               🧠 ML 학습 및 프로모션 코드
│   ├── train_mlflow.py     ← 모델 학습 및 MLflow 로깅
│   └── promte_mlflow.py    ← 모델 프로모션 (Staging → Production)
│
├── mlflow_store/          🗂️ MLflow 저장소 경로 (볼륨)
│   ├── Dockerfile.mlflow   ← MLflow 서버 커스터마이징
│   ├── mlflow.db           ← Model Registry DB (sqlite)
│   ├── mlruns/             ← 실험 로그 디렉토리
│   ├── artifacts/          ← 모델 아티팩트 저장소
│   └── .dockerignore
│
├── docker-compose.yaml    🧩 전체 서비스 구성 정의
├── .env                   🔐 민감 정보 (.env로 분리)
├── README.md              📝 전체 프로젝트 문서화
├── .gitignore
└── .dockerignore

✅ [2단계] docker-compose.yaml 통합 구성
🧭 구성 목표

  
      
          서비스명
          설명
          포트
      
  
  
      
          airflow
          DAG 실행 환경 (webserver/scheduler)
          8080
      
      
          postgres
          Airflow 메타데이터 저장용 DB
          내부 통신
      
      
          mlflow
          MLflow UI + Registry 기능
          5000
      
      
          fastapi
          추론 API 서버 (모델 로딩)
          8000
      
  


이미지 사용시 주의 (UI만 제공하는 이미지 존재)


📄 docker-compose.yaml 전체 예시
version: &#39;3.8&#39;

services:
  # 📦 PostgreSQL: Airflow 메타데이터 저장용 DB
  postgres:
    image: postgres:13
    container_name: postgres
    env_file:
      - .env  # ← 민감정보 분리 (아이디/비번)
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:  # ← 코드/데이터 공유 및 영속성 보장
      - postgres_data:/var/lib/postgresql/data  # ← DB 데이터 유지 (재시작 대비)

  # 🛫 Airflow: DAG 스케줄러 및 태스크 실행
  airflow:
    build:
      context: ./airflow           # → Airflow 전용 Dockerfile 경로
      dockerfile: Dockerfile.airflow
    container_name: airflow
    command: standalone           # → 로컬 테스트용 간단 실행 명령 
                      # (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행)
                      # (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리)
    ports:
      - "8080:8080"               # → Airflow 웹 UI (localhost:8080)
    depends_on:
      - postgres                  # → DB가 먼저 올라와야 Airflow 시작 가능
    env_file:
      - .env
    environment:
      # Airflow 메타데이터 DB 연결 주소
      AIRFLOW__CORE__SQL_ALCHEMY_CONN: ${AIRFLOW__CORE__SQL_ALCHEMY_CONN}
      # Airflow 예제 DAG 불러올지 여부
      AIRFLOW__CORE__LOAD_EXAMPLES: ${AIRFLOW__CORE__LOAD_EXAMPLES}  
      MLFLOW_TRACKING_URI: http://mlflow:5000  # → DAG 코드에서 MLflow 연동
    volumes:
      - ./airflow/dags:/opt/airflow/dags     # DAG 파일 mount
      - ./ml_code:/opt/airflow/ml_code       # 학습 코드 공유
      - ./mlflow_store:/mlflow               # 모델 저장소 공유

  # 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버
  mlflow:
    build:
      context: ./mlflow_store                # 커스텀 Dockerfile 위치
      dockerfile: Dockerfile.mlflow
    ports:
      - "5000:5000"                          # → MLflow UI (localhost:5000)
    volumes:
      - ./mlflow_store:/mlflow              # 실험 로그 + DB + artifacts 저장
    environment:
      - MLFLOW_TRACKING_URI=http://0.0.0.0:5000  # 내부 컨테이너 기준 URI

  # ⚡ FastAPI: 모델 서빙 API
  fastapi:
    build:
      context: ./fastapi
      dockerfile: Dockerfile.api
    container_name: fastapi
    ports:
      - "8000:8000"                          # → 예측 API 엔드포인트 (localhost:8000)
    volumes:
      - ./fastapi/app:/app/app              # FastAPI app 디렉토리 mount
      - ./ml_code:/app/ml_code              # 학습/모델 코드 공유
      - ./mlflow_store:/mlflow              # 저장된 모델 불러오기 위한 mount

# 🗂️ 볼륨 정의 (Postgres DB 영속성 유지)
volumes:
  postgres_data:

🎁 추가로 해야 할 것

Airflow 첫 실행 후엔 보통 관리자 계정 생성도 해줘야 함:

# airflow 컨테이너 접속
docker exec -it airflow bash

# 관리자 계정 생성
airflow users create \
  --username airflow \
  --password airflow \
  --firstname Keoho \
  --lastname Ban \
  --role Admin \
  --email airflow@example.com

🔁 [구축 Tip] Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인

  
      
          공유 리소스
          설명
      
  
  
      
          ./mlflow_store:/mlflow (MLflow)
          MLflow 서버가 쓰는 로그/모델 저장소
      
      
          ./mlflow_store:/mlflow (Airflow)
          학습 후 모델 저장 위치 공유
      
      
          ./mlflow_store:/mlflow (FastAPI)
          모델 추론 시 로드 경로 공유
      
  

➡ 경로 통일성이 매우 중요함! 지금은 모두 ./mlflow로 공유 (./mlflow 하위에 /mlruns 존재)'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"https://keonhoban.github.io/mlops-journey/projects/"},{"@type":"ListItem","position":2,"name":"[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]","item":"https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/basic/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]","name":"[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]","description":"🧭 전체 흐름 예시 [AIRFLOW DAG 실행] ↓ [train_mlflow.py] - iris 모델 학습 - 파라미터/메트릭 로깅 - 모델 Registry 등록 ↓ [promote_mlflow.py] - 최신 모델을 Production으로 전환 ↓ [FastAPI] - models:/IrisModel/Production → 실시간 예측 👉 실습 코드는 🔗 GitHub (Airflow + MLflow + FastAPI)\n✅ [1단계] 프로젝트 기본 폴더 구조 설계 📁 1. 전체 디렉토리 구성도 mlops_project/ ├── airflow/ 🛫 Airflow 설정 및 DAG 스케줄러 │ ├── dags/ ← DAG 정의 디렉토리 │ │ └── train_with_mlflow.py ← 학습 DAG (MLflow 연동) │ ├── Dockerfile.airflow ← Airflow용 Dockerfile │ ├── requirements.txt ← Airflow 의존성 │ └── .dockerignore │ ├── fastapi/ ⚡ FastAPI 예측 API 서버 │ ├── app/ │ │ └── main.py ← 모델 서빙 엔드포인트 │ ├── Dockerfile.api ← FastAPI용 Dockerfile │ ├── requirements.txt ← FastAPI 의존성 │ └── .dockerignore │ ├── ml_code/ 🧠 ML 학습 및 프로모션 코드 │ ├── train_mlflow.py ← 모델 학습 및 MLflow 로깅 │ └── promte_mlflow.py ← 모델 프로모션 (Staging → Production) │ ├── mlflow_store/ 🗂️ MLflow 저장소 경로 (볼륨) │ ├── Dockerfile.mlflow ← MLflow 서버 커스터마이징 │ ├── mlflow.db ← Model Registry DB (sqlite) │ ├── mlruns/ ← 실험 로그 디렉토리 │ ├── artifacts/ ← 모델 아티팩트 저장소 │ └── .dockerignore │ ├── docker-compose.yaml 🧩 전체 서비스 구성 정의 ├── .env 🔐 민감 정보 (.env로 분리) ├── README.md 📝 전체 프로젝트 문서화 ├── .gitignore └── .dockerignore ✅ [2단계] docker-compose.yaml 통합 구성 🧭 구성 목표 서비스명 설명 포트 airflow DAG 실행 환경 (webserver/scheduler) 8080 postgres Airflow 메타데이터 저장용 DB 내부 통신 mlflow MLflow UI + Registry 기능 5000 fastapi 추론 API 서버 (모델 로딩) 8000 이미지 사용시 주의 (UI만 제공하는 이미지 존재) 📄 docker-compose.yaml 전체 예시 version: \u0026#39;3.8\u0026#39; services: # 📦 PostgreSQL: Airflow 메타데이터 저장용 DB postgres: image: postgres:13 container_name: postgres env_file: - .env # ← 민감정보 분리 (아이디/비번) environment: POSTGRES_USER: ${POSTGRES_USER} POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} POSTGRES_DB: ${POSTGRES_DB} volumes: # ← 코드/데이터 공유 및 영속성 보장 - postgres_data:/var/lib/postgresql/data # ← DB 데이터 유지 (재시작 대비) # 🛫 Airflow: DAG 스케줄러 및 태스크 실행 airflow: build: context: ./airflow # → Airflow 전용 Dockerfile 경로 dockerfile: Dockerfile.airflow container_name: airflow command: standalone # → 로컬 테스트용 간단 실행 명령 # (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행) # (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리) ports: - \u0026#34;8080:8080\u0026#34; # → Airflow 웹 UI (localhost:8080) depends_on: - postgres # → DB가 먼저 올라와야 Airflow 시작 가능 env_file: - .env environment: # Airflow 메타데이터 DB 연결 주소 AIRFLOW__CORE__SQL_ALCHEMY_CONN: ${AIRFLOW__CORE__SQL_ALCHEMY_CONN} # Airflow 예제 DAG 불러올지 여부 AIRFLOW__CORE__LOAD_EXAMPLES: ${AIRFLOW__CORE__LOAD_EXAMPLES} MLFLOW_TRACKING_URI: http://mlflow:5000 # → DAG 코드에서 MLflow 연동 volumes: - ./airflow/dags:/opt/airflow/dags # DAG 파일 mount - ./ml_code:/opt/airflow/ml_code # 학습 코드 공유 - ./mlflow_store:/mlflow # 모델 저장소 공유 # 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버 mlflow: build: context: ./mlflow_store # 커스텀 Dockerfile 위치 dockerfile: Dockerfile.mlflow ports: - \u0026#34;5000:5000\u0026#34; # → MLflow UI (localhost:5000) volumes: - ./mlflow_store:/mlflow # 실험 로그 + DB + artifacts 저장 environment: - MLFLOW_TRACKING_URI=http://0.0.0.0:5000 # 내부 컨테이너 기준 URI # ⚡ FastAPI: 모델 서빙 API fastapi: build: context: ./fastapi dockerfile: Dockerfile.api container_name: fastapi ports: - \u0026#34;8000:8000\u0026#34; # → 예측 API 엔드포인트 (localhost:8000) volumes: - ./fastapi/app:/app/app # FastAPI app 디렉토리 mount - ./ml_code:/app/ml_code # 학습/모델 코드 공유 - ./mlflow_store:/mlflow # 저장된 모델 불러오기 위한 mount # 🗂️ 볼륨 정의 (Postgres DB 영속성 유지) volumes: postgres_data: 🎁 추가로 해야 할 것 Airflow 첫 실행 후엔 보통 관리자 계정 생성도 해줘야 함: # airflow 컨테이너 접속 docker exec -it airflow bash # 관리자 계정 생성 airflow users create \\ --username airflow \\ --password airflow \\ --firstname Keoho \\ --lastname Ban \\ --role Admin \\ --email airflow@example.com 🔁 [구축 Tip] Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인 공유 리소스 설명 ./mlflow_store:/mlflow (MLflow) MLflow 서버가 쓰는 로그/모델 저장소 ./mlflow_store:/mlflow (Airflow) 학습 후 모델 저장 위치 공유 ./mlflow_store:/mlflow (FastAPI) 모델 추론 시 로드 경로 공유 ➡ 경로 통일성이 매우 중요함! 지금은 모두 ./mlflow로 공유 (./mlflow 하위에 /mlruns 존재)\n","keywords":[],"articleBody":"🧭 전체 흐름 예시 [AIRFLOW DAG 실행] ↓ [train_mlflow.py] - iris 모델 학습 - 파라미터/메트릭 로깅 - 모델 Registry 등록 ↓ [promote_mlflow.py] - 최신 모델을 Production으로 전환 ↓ [FastAPI] - models:/IrisModel/Production → 실시간 예측 👉 실습 코드는 🔗 GitHub (Airflow + MLflow + FastAPI)\n✅ [1단계] 프로젝트 기본 폴더 구조 설계 📁 1. 전체 디렉토리 구성도 mlops_project/ ├── airflow/ 🛫 Airflow 설정 및 DAG 스케줄러 │ ├── dags/ ← DAG 정의 디렉토리 │ │ └── train_with_mlflow.py ← 학습 DAG (MLflow 연동) │ ├── Dockerfile.airflow ← Airflow용 Dockerfile │ ├── requirements.txt ← Airflow 의존성 │ └── .dockerignore │ ├── fastapi/ ⚡ FastAPI 예측 API 서버 │ ├── app/ │ │ └── main.py ← 모델 서빙 엔드포인트 │ ├── Dockerfile.api ← FastAPI용 Dockerfile │ ├── requirements.txt ← FastAPI 의존성 │ └── .dockerignore │ ├── ml_code/ 🧠 ML 학습 및 프로모션 코드 │ ├── train_mlflow.py ← 모델 학습 및 MLflow 로깅 │ └── promte_mlflow.py ← 모델 프로모션 (Staging → Production) │ ├── mlflow_store/ 🗂️ MLflow 저장소 경로 (볼륨) │ ├── Dockerfile.mlflow ← MLflow 서버 커스터마이징 │ ├── mlflow.db ← Model Registry DB (sqlite) │ ├── mlruns/ ← 실험 로그 디렉토리 │ ├── artifacts/ ← 모델 아티팩트 저장소 │ └── .dockerignore │ ├── docker-compose.yaml 🧩 전체 서비스 구성 정의 ├── .env 🔐 민감 정보 (.env로 분리) ├── README.md 📝 전체 프로젝트 문서화 ├── .gitignore └── .dockerignore ✅ [2단계] docker-compose.yaml 통합 구성 🧭 구성 목표 서비스명 설명 포트 airflow DAG 실행 환경 (webserver/scheduler) 8080 postgres Airflow 메타데이터 저장용 DB 내부 통신 mlflow MLflow UI + Registry 기능 5000 fastapi 추론 API 서버 (모델 로딩) 8000 이미지 사용시 주의 (UI만 제공하는 이미지 존재) 📄 docker-compose.yaml 전체 예시 version: '3.8' services: # 📦 PostgreSQL: Airflow 메타데이터 저장용 DB postgres: image: postgres:13 container_name: postgres env_file: - .env # ← 민감정보 분리 (아이디/비번) environment: POSTGRES_USER: ${POSTGRES_USER} POSTGRES_PASSWORD: ${POSTGRES_PASSWORD} POSTGRES_DB: ${POSTGRES_DB} volumes: # ← 코드/데이터 공유 및 영속성 보장 - postgres_data:/var/lib/postgresql/data # ← DB 데이터 유지 (재시작 대비) # 🛫 Airflow: DAG 스케줄러 및 태스크 실행 airflow: build: context: ./airflow # → Airflow 전용 Dockerfile 경로 dockerfile: Dockerfile.airflow container_name: airflow command: standalone # → 로컬 테스트용 간단 실행 명령 # (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행) # (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리) ports: - \"8080:8080\" # → Airflow 웹 UI (localhost:8080) depends_on: - postgres # → DB가 먼저 올라와야 Airflow 시작 가능 env_file: - .env environment: # Airflow 메타데이터 DB 연결 주소 AIRFLOW__CORE__SQL_ALCHEMY_CONN: ${AIRFLOW__CORE__SQL_ALCHEMY_CONN} # Airflow 예제 DAG 불러올지 여부 AIRFLOW__CORE__LOAD_EXAMPLES: ${AIRFLOW__CORE__LOAD_EXAMPLES} MLFLOW_TRACKING_URI: http://mlflow:5000 # → DAG 코드에서 MLflow 연동 volumes: - ./airflow/dags:/opt/airflow/dags # DAG 파일 mount - ./ml_code:/opt/airflow/ml_code # 학습 코드 공유 - ./mlflow_store:/mlflow # 모델 저장소 공유 # 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버 mlflow: build: context: ./mlflow_store # 커스텀 Dockerfile 위치 dockerfile: Dockerfile.mlflow ports: - \"5000:5000\" # → MLflow UI (localhost:5000) volumes: - ./mlflow_store:/mlflow # 실험 로그 + DB + artifacts 저장 environment: - MLFLOW_TRACKING_URI=http://0.0.0.0:5000 # 내부 컨테이너 기준 URI # ⚡ FastAPI: 모델 서빙 API fastapi: build: context: ./fastapi dockerfile: Dockerfile.api container_name: fastapi ports: - \"8000:8000\" # → 예측 API 엔드포인트 (localhost:8000) volumes: - ./fastapi/app:/app/app # FastAPI app 디렉토리 mount - ./ml_code:/app/ml_code # 학습/모델 코드 공유 - ./mlflow_store:/mlflow # 저장된 모델 불러오기 위한 mount # 🗂️ 볼륨 정의 (Postgres DB 영속성 유지) volumes: postgres_data: 🎁 추가로 해야 할 것 Airflow 첫 실행 후엔 보통 관리자 계정 생성도 해줘야 함: # airflow 컨테이너 접속 docker exec -it airflow bash # 관리자 계정 생성 airflow users create \\ --username airflow \\ --password airflow \\ --firstname Keoho \\ --lastname Ban \\ --role Admin \\ --email airflow@example.com 🔁 [구축 Tip] Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인 공유 리소스 설명 ./mlflow_store:/mlflow (MLflow) MLflow 서버가 쓰는 로그/모델 저장소 ./mlflow_store:/mlflow (Airflow) 학습 후 모델 저장 위치 공유 ./mlflow_store:/mlflow (FastAPI) 모델 추론 시 로드 경로 공유 ➡ 경로 통일성이 매우 중요함! 지금은 모두 ./mlflow로 공유 (./mlflow 하위에 /mlruns 존재)\n✅ [권장] .env로 민감 정보 분리하기 📄 1. .env 파일 작성 # .env # PostgreSQL POSTGRES_USER=airflow POSTGRES_PASSWORD=airflow POSTGRES_DB=airflow # Airflow 환경 변수 AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql+psycopg2://airflow:airflow@postgres/airflow AIRFLOW__CORE__LOAD_EXAMPLES=False 👉 이 값들은 예시용이고, 실제로는 비밀번호나 DB 이름을 더 복잡하게 설정하는 게 좋음\n✅ [3단계] Dockerfile 구성 🐘 1. Dockerfile.airflow (Airflow 컨테이너) DAG 실행, ML 코드 실행, MLflow 로깅까지 가능한 환경을 만들자.\n📄 airflow/Dockerfile.airflow\nFROM apache/airflow:2.8.1-python3.10 # 환경 변수 설정 ENV AIRFLOW_HOME=/opt/airflow # Airflow 실행 사용자로 전환 USER airflow # 필요한 추가 패키지 설치 (mlflow, scikit-learn 등) RUN pip install --no-cache-dir \\ mlflow \\ scikit-learn \\ pandas ⚙️ airflow/requirements.txt 예시 (선택) mlflow scikit-learn pandas ❗ 하지만 Dockerfile.airflow에서 직접 pip install 했기 때문에 꼭 필요하진 않지만, 관리용으로 두는 것도 좋음\n🚀 2. Dockerfile.mlflow (FastAPI 컨테이너) 📄 mlflow_store/Dockerfile.mlflow\nFROM python:3.10-slim # 시스템 도구 설치 RUN apt update \u0026\u0026 apt install -y curl sqlite3 git # MLflow 설치 RUN pip install mlflow[extras] scikit-learn # 작업 디렉토리 WORKDIR /mlflow CMD [\"mlflow\", \"server\", \\ \"--backend-store-uri=sqlite:///mlflow.db\", \\ \"--default-artifact-root=/mlflow/artifacts\", \\ \"--host=0.0.0.0\", \\ \"--port=5000\", \\ \"--serve-artifacts\"] ❗ docker-compose.yaml 의 command 에서 진행안될시 사용\n🚀 3. Dockerfile.api (FastAPI 컨테이너) 📄 fastapi/Dockerfile.api\nFROM python:3.10-slim # 작업 디렉토리 설정 WORKDIR /app # 앱 디렉토리 복사 COPY app /app/app # 의존성 설치 COPY requirements.txt /app/requirements.txt RUN pip install --no-cache-dir --upgrade pip \u0026\u0026 \\ pip install -r /app/requirements.txt # FastAPI 앱 실행 (uvicorn) CMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8000\"] ❗ 패키지 개수가 많다면 requirement를 COPY 하여 사용도 가능\n⚙️ fastapi/requirements.txt fastapi uvicorn mlflow scikit-learn pydantic 필요 시 pandas, joblib, numpy도 추가 가능\n📁 FastAPI 구성 (fastapi/app/main.py) from fastapi import FastAPI from pydantic import BaseModel from typing import List import mlflow.pyfunc import pandas as pd # 🎯 FastAPI 앱 인스턴스 생성 app = FastAPI() # 📌 MLflow 추적 서버 URI 설정 (MLflow Tracking Server로 연결) mlflow.set_tracking_uri(\"http://mlflow:5000\") # 🔄 Production 단계 모델 로드 (모델 레지스트리에서 이름 + 스테이지 기반 로드) # - \"models:/IrisModel/Production\" 형식 # - 컨테이너 실행 시점에 모델이 이미 등록 \u0026 프로덕션 상태여야 함 model = mlflow.pyfunc.load_model(\"models:/IrisModel/Production\") # 📦 입력 데이터 스키마 정의 # - 클라이언트가 JSON으로 넘겨야 할 데이터 형태 명시 # - pydantic으로 자동 유효성 검사 가능 class IrisInput(BaseModel): sepal_length: float sepal_width: float petal_length: float petal_width: float # ✅ 헬스 체크용 기본 엔드포인트 @app.get(\"/\") def home(): return {\"message\": \"FastAPI + MLflow 예측 API\"} # 🔮 예측 요청 처리 엔드포인트 @app.post(\"/predict\") def predict(data: List[IrisInput]): # 1️⃣ 입력 데이터 → pandas DataFrame 변환 (= 2차원 구조 / 현재 1행 4열) input_df = pd.DataFrame([item.dict() for item in data]) # 2️⃣ 모델 학습 시 사용했던 컬럼명으로 변경 및 데이터 순서 정렬 (스키마 맞춤) input_df.columns = [ \"sepal length (cm)\", \"sepal width (cm)\", \"petal length (cm)\", \"petal width (cm)\" ] # 3️⃣ MLflow로부터 로드된 모델을 활용한 예측 수행 (= serving) preds = model.predict(input_df) # 4️⃣ 결과를 JSON 형태로 반환 return {\"predictions\": preds.tolist()} ✅ [4단계] Airflow DAG + MLflow 연동 🎯 목표 요약 항목 내용 DAG 역할 PythonOperator로 ML 학습 스크립트 실행 ML 코드 train_mlflow.py및 promote_mlflow.py 를 실행하여 학습 및 승격 + MLflow 로깅 연동 결과 파라미터, 메트릭, 모델 저장 + Model Registry 등록후 스테이지 “production” 승격까지 자동화 🧪 1. ML 학습 코드 작성 (ml_code/train_mlflow.py) # ml_code/train_mlflow.py import mlflow import mlflow.sklearn from sklearn.datasets import load_iris from sklearn.ensemble import RandomForestClassifier from sklearn.metrics import accuracy_score def run_experiment(): # 📍 MLflow 서버 주소 설정 (Tracking URI) # (- docker-compose.yaml의 airflow에 environment로 MLFLOW_TRACKING_URI 존재시 생략 가능) mlflow.set_tracking_uri(\"http://mlflow:5000\") # 단, 로컬에서 진행시 필요 # 🧪 실험 이름 설정 (없으면 자동 생성) mlflow.set_experiment(\"iris_experiment\") # 🚀 새로운 실험 run 시작 with mlflow.start_run() as run: # 📊 데이터 로딩 data = load_iris() X, y = data.data, data.target # 🔍 모델 학습 model = RandomForestClassifier(n_estimators=100, random_state=42) model.fit(X, y) preds = model.predict(X) # ✅ 성능 평가 acc = accuracy_score(y, preds) # 📝 실험 정보 로깅 mlflow.log_param(\"n_estimators\", 100) mlflow.log_metric(\"accuracy\", acc) # 📦 모델 저장 + 레지스트리 등록 # - `artifact_path`: 아티팩트 저장 디렉토리 이름 # - `registered_model_name`: 레지스트리에서 모델 이름으로 관리됨 mlflow.sklearn.log_model( model, artifact_path=\"model\", registered_model_name=\"IrisModel\" ) # 🖨️ 결과 출력 print(f\"✅ Run ID: {run.info.run_id}, Accuracy: {acc}\") # 🔧 직접 실행할 경우만 함수 실행 if __name__ == \"__main__\": run_experiment() 🧪 2. ML 학습 코드 작성 (ml_code/promote_mlflow.py) # ml_code/promote_mlflow.py from mlflow.tracking import MlflowClient def promote_model(): # 🧭 MLflow 클라이언트 인스턴스 생성 (서버와 직접 통신) # (- docker-compose.yaml의 airflow에 environment로 MLFLOW_TRACKING_URI 존재함) client = MlflowClient() # 🔍 \"IrisModel\"의 등록된 모델 중 현재 어떤 Stage에도 배정되지 않은 최신 버전 가져오기 latest_versions = client.get_latest_versions(\"IrisModel\", stages=[\"None\"]) if not latest_versions: print(\"❗ 등록된 모델이 없습니다.\") return # ⏫ 가장 최신 버전 선택 (= .version 을 통해 속성 값 추출 / .name or .stage 등 가능) latest_version = latest_versions[0].version # 🚀 해당 버전을 Production 단계로 전환 client.transition_model_version_stage( name=\"IrisModel\", version=latest_version, stage=\"Production\" ) # ✅ 결과 출력 print(f\"🚀 IrisModel version {latest_version} → Production 등록 완료\") # 🔧 Airflow나 CLI에서 호출될 수 있도록 함수화 🛠️ 2. Airflow DAG 작성 (airflow/dags/train_with_mlflow.py) # airflow/dags/train_with_mlflow.py # 🔧 Airflow DAG 기본 구성 from airflow import DAG from airflow.operators.python import PythonOperator from datetime import datetime import sys # 📁 ml_code 디렉토리 경로 추가 (import 가능하도록 설정) sys.path.append(\"/opt/airflow/ml_code\") # 📦 학습 함수와 승격 함수 import from train_mlflow import run_experiment # 모델 학습 및 등록 from promote_mlflow import promote_model # 모델 스테이지 전환 # 🧾 DAG 기본 설정 default_args = { 'start_date': datetime(2023, 1, 1), 'retries': 1, # 실패 시 재시도 횟수 } # 📅 DAG 정의 with DAG( dag_id='train_with_mlflow', # DAG 이름 (Airflow UI에 표시) default_args=default_args, schedule_interval=None, # 수동 실행 (스케줄 없음) catchup=False, # 과거 날짜 실행 안 함 tags=['ml', 'mlflow'], # 태그 (필터링용) ) as dag: # 🧪 [1단계] 모델 학습 및 MLflow에 등록 train_task = PythonOperator( task_id='run_training', python_callable=run_experiment, # 실행할 함수 지정 ) # 🚀 [2단계] 최신 버전 모델을 Production으로 Promote promote_task = PythonOperator( task_id='promote_model_to_production', python_callable=promote_model, ) # 📍 작업 실행 순서 정의: 학습 후 → 승격 train_task \u003e\u003e promote_task 🔧 3. Docker 경로와 볼륨 정리 (복습) 컨테이너 로딩 경로 역할 Airflow /opt/airflow/ml_code/train_mlflow.py 학습 실행 MLflow /mlflow/mlruns/ 모델 저장소 FastAPI /mlflow/mlruns/ 모델 로드 ➡ 로컬의 /mlflow_store를 모든 컨테이너에 공통 mount했기 때문에 문제없이 공유됨!\n✅ 4. 실행 후 기대 결과 $ docker-compose up --build Airflow 웹 UI에서 train_with_mlflow DAG 실행 →\n✅ 모델이 학습되고\n✅ /mlflow/mlruns/에 artifact가 저장되며\n✅ IrisModel이 Model Registry에 등록됨 ✅ promote_mlflow.py 실행을 통해, 등록된 모델을 Staging 또는 Production 단계로 자동 승격함\n🔍 확인 방법 Airflow 웹 UI → localhost:8080 MLflow UI → localhost:5000 Experiments → iris_experiment 모델 성능 로그 + IrisModel 등록 여부 확인 가능 🧪 테스트 예시 curl -X POST http://localhost:8000/predict \\ -H \"Content-Type: application/json\" \\ -d '[ { \"sepal_length\": 5.1, \"sepal_width\": 3.5, \"petal_length\": 1.4, \"petal_width\": 0.2 }, { \"sepal_length\": 6.0, \"sepal_width\": 2.9, \"petal_length\": 4.5, \"petal_width\": 1.5 } ]' 예시 결과:\n{ \"predictions\":[0,1] } ","wordCount":"1703","inLanguage":"en","datePublished":"2025-06-13T20:58:51+09:00","dateModified":"2025-06-13T20:58:51+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://keonhoban.github.io/mlops-journey/projects/mlops_pipeline/basic/"},"publisher":{"@type":"Organization","name":"🏔️  MLOps Journey","logo":{"@type":"ImageObject","url":"https://keonhoban.github.io/mlops-journey/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://keonhoban.github.io/mlops-journey/ accesskey=h title="🏔️  MLOps Journey (Alt + H)">🏔️ MLOps Journey</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://keonhoban.github.io/mlops-journey/ title="🏠 Home"><span>🏠 Home</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/projects/ title="📂 Projects"><span>📂 Projects</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/posts/ title="📝 Blog"><span>📝 Blog</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/about/ title="🧗 About"><span>🧗 About</span></a></li><li><a href=https://keonhoban.github.io/mlops-journey/categories/ title="📖 Categories"><span>📖 Categories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://keonhoban.github.io/mlops-journey/>Home</a>&nbsp;»&nbsp;<a href=https://keonhoban.github.io/mlops-journey/projects/>Projects</a></div><h1 class="post-title entry-hint-parent">[Airflow 기초 자동화 - Airflow → MLflow → FastAPI]</h1><div class=post-meta><span title='2025-06-13 20:58:51 +0900 +0900'>June 13, 2025</span>&nbsp;·&nbsp;8 min</div></header><div class=post-content><h2 id=-전체-흐름-예시>🧭 전체 흐름 예시<a hidden class=anchor aria-hidden=true href=#-전체-흐름-예시>#</a></h2><pre tabindex=0><code>[AIRFLOW DAG 실행]
   ↓
[train_mlflow.py]
   - iris 모델 학습
   - 파라미터/메트릭 로깅
   - 모델 Registry 등록
   ↓
[promote_mlflow.py]
   - 최신 모델을 Production으로 전환
   ↓
[FastAPI]
   - models:/IrisModel/Production → 실시간 예측
</code></pre><p>👉 실습 코드는 <a href=https://github.com/keonhoban/mlops-infra-labs/tree/main/airflow_mlflow_fastapi>🔗 GitHub (Airflow + MLflow + FastAPI)</a></p><hr><h2 id=-1단계-프로젝트-기본-폴더-구조-설계>✅ [1단계] 프로젝트 기본 폴더 구조 설계<a hidden class=anchor aria-hidden=true href=#-1단계-프로젝트-기본-폴더-구조-설계>#</a></h2><h3 id=-1-전체-디렉토리-구성도>📁 1. 전체 디렉토리 구성도<a hidden class=anchor aria-hidden=true href=#-1-전체-디렉토리-구성도>#</a></h3><pre tabindex=0><code>mlops_project/
├── airflow/                       🛫 Airflow 설정 및 DAG 스케줄러
│   ├── dags/                      ← DAG 정의 디렉토리
│   │   └── train_with_mlflow.py   ← 학습 DAG (MLflow 연동)
│   ├── Dockerfile.airflow         ← Airflow용 Dockerfile
│   ├── requirements.txt           ← Airflow 의존성
│   └── .dockerignore
│
├── fastapi/              ⚡ FastAPI 예측 API 서버
│   ├── app/
│   │   └── main.py        ← 모델 서빙 엔드포인트
│   ├── Dockerfile.api     ← FastAPI용 Dockerfile
│   ├── requirements.txt   ← FastAPI 의존성
│   └── .dockerignore
│
├── ml_code/               🧠 ML 학습 및 프로모션 코드
│   ├── train_mlflow.py     ← 모델 학습 및 MLflow 로깅
│   └── promte_mlflow.py    ← 모델 프로모션 (Staging → Production)
│
├── mlflow_store/          🗂️ MLflow 저장소 경로 (볼륨)
│   ├── Dockerfile.mlflow   ← MLflow 서버 커스터마이징
│   ├── mlflow.db           ← Model Registry DB (sqlite)
│   ├── mlruns/             ← 실험 로그 디렉토리
│   ├── artifacts/          ← 모델 아티팩트 저장소
│   └── .dockerignore
│
├── docker-compose.yaml    🧩 전체 서비스 구성 정의
├── .env                   🔐 민감 정보 (.env로 분리)
├── README.md              📝 전체 프로젝트 문서화
├── .gitignore
└── .dockerignore
</code></pre><hr><h2 id=-2단계-docker-composeyaml-통합-구성>✅ [2단계] <code>docker-compose.yaml</code> 통합 구성<a hidden class=anchor aria-hidden=true href=#-2단계-docker-composeyaml-통합-구성>#</a></h2><h3 id=-구성-목표>🧭 구성 목표<a hidden class=anchor aria-hidden=true href=#-구성-목표>#</a></h3><table><thead><tr><th>서비스명</th><th>설명</th><th>포트</th></tr></thead><tbody><tr><td><code>airflow</code></td><td>DAG 실행 환경 (webserver/scheduler)</td><td><code>8080</code></td></tr><tr><td><code>postgres</code></td><td>Airflow 메타데이터 저장용 DB</td><td>내부 통신</td></tr><tr><td><code>mlflow</code></td><td>MLflow UI + Registry 기능</td><td><code>5000</code></td></tr><tr><td><code>fastapi</code></td><td>추론 API 서버 (모델 로딩)</td><td><code>8000</code></td></tr></tbody></table><ul><li>이미지 사용시 주의 (UI만 제공하는 이미지 존재)</li></ul><hr><h3 id=-docker-composeyaml-전체-예시>📄 <code>docker-compose.yaml</code> 전체 예시<a hidden class=anchor aria-hidden=true href=#-docker-composeyaml-전체-예시>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># 📦 PostgreSQL: Airflow 메타데이터 저장용 DB</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:13</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_file</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>.env </span> <span style=color:#75715e># ← 민감정보 분리 (아이디/비번)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>${POSTGRES_USER}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>${POSTGRES_PASSWORD}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>${POSTGRES_DB}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:  <span style=color:#75715e># ← 코드/데이터 공유 및 영속성 보장</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres_data:/var/lib/postgresql/data </span> <span style=color:#75715e># ← DB 데이터 유지 (재시작 대비)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 🛫 Airflow: DAG 스케줄러 및 태스크 실행</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>airflow</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>./airflow          </span> <span style=color:#75715e># → Airflow 전용 Dockerfile 경로</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile.airflow</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>airflow</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>standalone          </span> <span style=color:#75715e># → 로컬 테스트용 간단 실행 명령 </span>
</span></span><span style=display:flex><span>                      <span style=color:#75715e># (- Scheduler + Webserver + DB 초기화까지 자동으로 한번에 실행)</span>
</span></span><span style=display:flex><span>                      <span style=color:#75715e># (- 실무/운영에서는 airflow-webserver, airflow-scheduler 필드 분리)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8080:8080&#34;</span>               <span style=color:#75715e># → Airflow 웹 UI (localhost:8080)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>postgres                 </span> <span style=color:#75715e># → DB가 먼저 올라와야 Airflow 시작 가능</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_file</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>.env</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Airflow 메타데이터 DB 연결 주소</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>AIRFLOW__CORE__SQL_ALCHEMY_CONN</span>: <span style=color:#ae81ff>${AIRFLOW__CORE__SQL_ALCHEMY_CONN}</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Airflow 예제 DAG 불러올지 여부</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>AIRFLOW__CORE__LOAD_EXAMPLES</span>: <span style=color:#ae81ff>${AIRFLOW__CORE__LOAD_EXAMPLES}  </span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MLFLOW_TRACKING_URI</span>: <span style=color:#ae81ff>http://mlflow:5000 </span> <span style=color:#75715e># → DAG 코드에서 MLflow 연동</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./airflow/dags:/opt/airflow/dags    </span> <span style=color:#75715e># DAG 파일 mount</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./ml_code:/opt/airflow/ml_code      </span> <span style=color:#75715e># 학습 코드 공유</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./mlflow_store:/mlflow              </span> <span style=color:#75715e># 모델 저장소 공유</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># 🔬 MLflow: 실험 추적 + 모델 레지스트리 서버</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mlflow</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>./mlflow_store               </span> <span style=color:#75715e># 커스텀 Dockerfile 위치</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile.mlflow</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5000:5000&#34;</span>                          <span style=color:#75715e># → MLflow UI (localhost:5000)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./mlflow_store:/mlflow             </span> <span style=color:#75715e># 실험 로그 + DB + artifacts 저장</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MLFLOW_TRACKING_URI=http://0.0.0.0:5000 </span> <span style=color:#75715e># 내부 컨테이너 기준 URI</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># ⚡ FastAPI: 모델 서빙 API</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fastapi</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>./fastapi</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile.api</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>fastapi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8000:8000&#34;</span>                          <span style=color:#75715e># → 예측 API 엔드포인트 (localhost:8000)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./fastapi/app:/app/app             </span> <span style=color:#75715e># FastAPI app 디렉토리 mount</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./ml_code:/app/ml_code             </span> <span style=color:#75715e># 학습/모델 코드 공유</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./mlflow_store:/mlflow             </span> <span style=color:#75715e># 저장된 모델 불러오기 위한 mount</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🗂️ 볼륨 정의 (Postgres DB 영속성 유지)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres_data</span>:
</span></span></code></pre></div><hr><h2 id=-추가로-해야-할-것>🎁 추가로 해야 할 것<a hidden class=anchor aria-hidden=true href=#-추가로-해야-할-것>#</a></h2><ul><li>Airflow 첫 실행 후엔 보통 <strong>관리자 계정 생성</strong>도 해줘야 함:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># airflow 컨테이너 접속</span>
</span></span><span style=display:flex><span>docker exec -it airflow bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 관리자 계정 생성</span>
</span></span><span style=display:flex><span>airflow users create <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --username airflow <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --password airflow <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --firstname Keoho <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --lastname Ban <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --role Admin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --email airflow@example.com
</span></span></code></pre></div><hr><h3 id=-구축-tip-airflow-fastapi-mlflow-간-공유-볼륨-구조-확인>🔁 [구축 Tip] <strong>Airflow, FastAPI, MLflow 간 공유 볼륨 구조 확인</strong><a hidden class=anchor aria-hidden=true href=#-구축-tip-airflow-fastapi-mlflow-간-공유-볼륨-구조-확인>#</a></h3><table><thead><tr><th>공유 리소스</th><th>설명</th></tr></thead><tbody><tr><td><code>./mlflow_store:/mlflow</code> (MLflow)</td><td>MLflow 서버가 쓰는 로그/모델 저장소</td></tr><tr><td><code>./mlflow_store:/mlflow</code> (Airflow)</td><td>학습 후 모델 저장 위치 공유</td></tr><tr><td><code>./mlflow_store:/mlflow</code> (FastAPI)</td><td>모델 추론 시 로드 경로 공유</td></tr></tbody></table><p>➡ <strong>경로 통일성</strong>이 매우 중요함! 지금은 모두 <code>./mlflow</code>로 공유 (./mlflow 하위에 /mlruns 존재)</p><hr><h3 id=-권장-env로-민감-정보-분리하기>✅ [권장] <code>.env</code>로 민감 정보 분리하기<a hidden class=anchor aria-hidden=true href=#-권장-env로-민감-정보-분리하기>#</a></h3><h3 id=-1-env-파일-작성>📄 1. <code>.env</code> 파일 작성<a hidden class=anchor aria-hidden=true href=#-1-env-파일-작성>#</a></h3><pre tabindex=0><code># .env

# PostgreSQL
POSTGRES_USER=airflow
POSTGRES_PASSWORD=airflow
POSTGRES_DB=airflow

# Airflow 환경 변수
AIRFLOW__CORE__SQL_ALCHEMY_CONN=postgresql+psycopg2://airflow:airflow@postgres/airflow
AIRFLOW__CORE__LOAD_EXAMPLES=False
</code></pre><blockquote><p>👉 이 값들은 예시용이고, 실제로는 비밀번호나 DB 이름을 더 복잡하게 설정하는 게 좋음</p></blockquote><hr><h2 id=-3단계-dockerfile-구성>✅ [3단계] Dockerfile 구성<a hidden class=anchor aria-hidden=true href=#-3단계-dockerfile-구성>#</a></h2><h3 id=-1-dockerfileairflow-airflow-컨테이너>🐘 1. <code>Dockerfile.airflow</code> (Airflow 컨테이너)<a hidden class=anchor aria-hidden=true href=#-1-dockerfileairflow-airflow-컨테이너>#</a></h3><blockquote><p>DAG 실행, ML 코드 실행, MLflow 로깅까지 가능한 환경을 만들자.</p></blockquote><p>📄 <strong><code>airflow/Dockerfile.airflow</code></strong></p><pre tabindex=0><code>FROM apache/airflow:2.8.1-python3.10

# 환경 변수 설정
ENV AIRFLOW_HOME=/opt/airflow

# Airflow 실행 사용자로 전환
USER airflow

# 필요한 추가 패키지 설치 (mlflow, scikit-learn 등)
RUN pip install --no-cache-dir \
    mlflow \
    scikit-learn \
    pandas
</code></pre><hr><h3 id=-airflowrequirementstxt-예시-선택>⚙️ <code>airflow/requirements.txt</code> 예시 (선택)<a hidden class=anchor aria-hidden=true href=#-airflowrequirementstxt-예시-선택>#</a></h3><pre tabindex=0><code>mlflow
scikit-learn
pandas
</code></pre><blockquote><p>❗ 하지만 Dockerfile.airflow에서 직접 pip install 했기 때문에 꼭 필요하진 않지만, 관리용으로 두는 것도 좋음</p></blockquote><hr><h3 id=-2-dockerfilemlflow-fastapi-컨테이너>🚀 2. <code>Dockerfile.mlflow</code> (FastAPI 컨테이너)<a hidden class=anchor aria-hidden=true href=#-2-dockerfilemlflow-fastapi-컨테이너>#</a></h3><p>📄 <strong><code>mlflow_store/Dockerfile.mlflow</code></strong></p><pre tabindex=0><code>FROM python:3.10-slim

# 시스템 도구 설치
RUN apt update &amp;&amp; apt install -y curl sqlite3 git

# MLflow 설치
RUN pip install mlflow[extras] scikit-learn

# 작업 디렉토리
WORKDIR /mlflow

CMD [&#34;mlflow&#34;, &#34;server&#34;, \
     &#34;--backend-store-uri=sqlite:///mlflow.db&#34;, \
     &#34;--default-artifact-root=/mlflow/artifacts&#34;, \
     &#34;--host=0.0.0.0&#34;, \
     &#34;--port=5000&#34;, \
     &#34;--serve-artifacts&#34;]
</code></pre><blockquote><p>❗ docker-compose.yaml 의 command 에서 진행안될시 사용</p></blockquote><hr><h3 id=-3-dockerfileapi-fastapi-컨테이너>🚀 3. <code>Dockerfile.api</code> (FastAPI 컨테이너)<a hidden class=anchor aria-hidden=true href=#-3-dockerfileapi-fastapi-컨테이너>#</a></h3><p>📄 <strong><code>fastapi/Dockerfile.api</code></strong></p><pre tabindex=0><code>FROM python:3.10-slim

# 작업 디렉토리 설정
WORKDIR /app

# 앱 디렉토리 복사
COPY app /app/app

# 의존성 설치
COPY requirements.txt /app/requirements.txt
RUN pip install --no-cache-dir --upgrade pip &amp;&amp; \
    pip install -r /app/requirements.txt

# FastAPI 앱 실행 (uvicorn)
CMD [&#34;uvicorn&#34;, &#34;app.main:app&#34;, &#34;--host&#34;, &#34;0.0.0.0&#34;, &#34;--port&#34;, &#34;8000&#34;]
</code></pre><blockquote><p>❗ 패키지 개수가 많다면 requirement를 COPY 하여 사용도 가능</p></blockquote><hr><h3 id=-fastapirequirementstxt>⚙️ <code>fastapi/requirements.txt</code><a hidden class=anchor aria-hidden=true href=#-fastapirequirementstxt>#</a></h3><pre tabindex=0><code>fastapi
uvicorn
mlflow
scikit-learn
pydantic
</code></pre><blockquote><p>필요 시 pandas, joblib, numpy도 추가 가능</p></blockquote><hr><h2 id=-fastapi-구성-fastapiappmainpy>📁 FastAPI 구성 (<code>fastapi/app/main.py</code>)<a hidden class=anchor aria-hidden=true href=#-fastapi-구성-fastapiappmainpy>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> fastapi <span style=color:#f92672>import</span> FastAPI
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pydantic <span style=color:#f92672>import</span> BaseModel
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> mlflow.pyfunc
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🎯 FastAPI 앱 인스턴스 생성</span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> FastAPI()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 📌 MLflow 추적 서버 URI 설정 (MLflow Tracking Server로 연결)</span>
</span></span><span style=display:flex><span>mlflow<span style=color:#f92672>.</span>set_tracking_uri(<span style=color:#e6db74>&#34;http://mlflow:5000&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🔄 Production 단계 모델 로드 (모델 레지스트리에서 이름 + 스테이지 기반 로드)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     - &#34;models:/IrisModel/Production&#34; 형식</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     - 컨테이너 실행 시점에 모델이 이미 등록 &amp; 프로덕션 상태여야 함</span>
</span></span><span style=display:flex><span>model <span style=color:#f92672>=</span> mlflow<span style=color:#f92672>.</span>pyfunc<span style=color:#f92672>.</span>load_model(<span style=color:#e6db74>&#34;models:/IrisModel/Production&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 📦 입력 데이터 스키마 정의</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     - 클라이언트가 JSON으로 넘겨야 할 데이터 형태 명시</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     - pydantic으로 자동 유효성 검사 가능</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IrisInput</span>(BaseModel):
</span></span><span style=display:flex><span>    sepal_length: float
</span></span><span style=display:flex><span>    sepal_width: float
</span></span><span style=display:flex><span>    petal_length: float
</span></span><span style=display:flex><span>    petal_width: float
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ✅ 헬스 체크용 기본 엔드포인트</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.get</span>(<span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>home</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;FastAPI + MLflow 예측 API&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🔮 예측 요청 처리 엔드포인트</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.post</span>(<span style=color:#e6db74>&#34;/predict&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>predict</span>(data: List[IrisInput]):
</span></span><span style=display:flex><span>    <span style=color:#75715e># 1️⃣ 입력 데이터 → pandas DataFrame 변환 (= 2차원 구조 / 현재 1행 4열)</span>
</span></span><span style=display:flex><span>    input_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame([item<span style=color:#f92672>.</span>dict() <span style=color:#66d9ef>for</span> item <span style=color:#f92672>in</span> data])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 2️⃣ 모델 학습 시 사용했던 컬럼명으로 변경 및 데이터 순서 정렬 (스키마 맞춤)</span>
</span></span><span style=display:flex><span>    input_df<span style=color:#f92672>.</span>columns <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sepal length (cm)&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sepal width (cm)&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;petal length (cm)&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;petal width (cm)&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 3️⃣ MLflow로부터 로드된 모델을 활용한 예측 수행 (= serving)</span>
</span></span><span style=display:flex><span>    preds <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>predict(input_df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 4️⃣ 결과를 JSON 형태로 반환</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {<span style=color:#e6db74>&#34;predictions&#34;</span>: preds<span style=color:#f92672>.</span>tolist()}
</span></span></code></pre></div><hr><h2 id=-4단계-airflow-dag--mlflow-연동>✅ [4단계] Airflow DAG + MLflow 연동<a hidden class=anchor aria-hidden=true href=#-4단계-airflow-dag--mlflow-연동>#</a></h2><h3 id=-목표-요약>🎯 목표 요약<a hidden class=anchor aria-hidden=true href=#-목표-요약>#</a></h3><table><thead><tr><th>항목</th><th>내용</th></tr></thead><tbody><tr><td>DAG 역할</td><td>PythonOperator로 ML 학습 스크립트 실행</td></tr><tr><td>ML 코드</td><td><code>train_mlflow.py</code>및 <code>promote_mlflow.py</code> 를 실행하여 학습 및 승격 + MLflow 로깅</td></tr><tr><td>연동 결과</td><td>파라미터, 메트릭, 모델 저장 + Model Registry 등록후 스테이지 “production” 승격까지 자동화</td></tr></tbody></table><hr><h2 id=-1-ml-학습-코드-작성-ml_codetrain_mlflowpy>🧪 1. ML 학습 코드 작성 (<code>ml_code/train_mlflow.py</code>)<a hidden class=anchor aria-hidden=true href=#-1-ml-학습-코드-작성-ml_codetrain_mlflowpy>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># ml_code/train_mlflow.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> mlflow
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> mlflow.sklearn
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.datasets <span style=color:#f92672>import</span> load_iris
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.ensemble <span style=color:#f92672>import</span> RandomForestClassifier
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> accuracy_score
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>run_experiment</span>():
</span></span><span style=display:flex><span>  <span style=color:#75715e># 📍 MLflow 서버 주소 설정 (Tracking URI) </span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># (- docker-compose.yaml의 airflow에 environment로 MLFLOW_TRACKING_URI 존재시 생략 가능)</span>
</span></span><span style=display:flex><span>    mlflow<span style=color:#f92672>.</span>set_tracking_uri(<span style=color:#e6db74>&#34;http://mlflow:5000&#34;</span>)  <span style=color:#75715e># 단, 로컬에서 진행시 필요</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🧪 실험 이름 설정 (없으면 자동 생성)</span>
</span></span><span style=display:flex><span>    mlflow<span style=color:#f92672>.</span>set_experiment(<span style=color:#e6db74>&#34;iris_experiment&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🚀 새로운 실험 run 시작</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> mlflow<span style=color:#f92672>.</span>start_run() <span style=color:#66d9ef>as</span> run:
</span></span><span style=display:flex><span>        <span style=color:#75715e># 📊 데이터 로딩</span>
</span></span><span style=display:flex><span>        data <span style=color:#f92672>=</span> load_iris()
</span></span><span style=display:flex><span>        X, y <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>data, data<span style=color:#f92672>.</span>target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 🔍 모델 학습</span>
</span></span><span style=display:flex><span>        model <span style=color:#f92672>=</span> RandomForestClassifier(n_estimators<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>)
</span></span><span style=display:flex><span>        model<span style=color:#f92672>.</span>fit(X, y)
</span></span><span style=display:flex><span>        preds <span style=color:#f92672>=</span> model<span style=color:#f92672>.</span>predict(X)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># ✅ 성능 평가</span>
</span></span><span style=display:flex><span>        acc <span style=color:#f92672>=</span> accuracy_score(y, preds)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 📝 실험 정보 로깅</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#f92672>.</span>log_param(<span style=color:#e6db74>&#34;n_estimators&#34;</span>, <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>        mlflow<span style=color:#f92672>.</span>log_metric(<span style=color:#e6db74>&#34;accuracy&#34;</span>, acc)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 📦 모델 저장 + 레지스트리 등록</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#    - `artifact_path`: 아티팩트 저장 디렉토리 이름</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#    - `registered_model_name`: 레지스트리에서 모델 이름으로 관리됨</span>
</span></span><span style=display:flex><span>        mlflow<span style=color:#f92672>.</span>sklearn<span style=color:#f92672>.</span>log_model(
</span></span><span style=display:flex><span>            model,
</span></span><span style=display:flex><span>            artifact_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;model&#34;</span>,
</span></span><span style=display:flex><span>            registered_model_name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;IrisModel&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 🖨️ 결과 출력</span>
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;✅ Run ID: </span><span style=color:#e6db74>{</span>run<span style=color:#f92672>.</span>info<span style=color:#f92672>.</span>run_id<span style=color:#e6db74>}</span><span style=color:#e6db74>, Accuracy: </span><span style=color:#e6db74>{</span>acc<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🔧 직접 실행할 경우만 함수 실행</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    run_experiment()
</span></span></code></pre></div><hr><h2 id=-2-ml-학습-코드-작성-ml_codepromote_mlflowpy>🧪 2. ML 학습 코드 작성 (<code>ml_code/promote_mlflow.py</code>)<a hidden class=anchor aria-hidden=true href=#-2-ml-학습-코드-작성-ml_codepromote_mlflowpy>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># ml_code/promote_mlflow.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> mlflow.tracking <span style=color:#f92672>import</span> MlflowClient
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>promote_model</span>():
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🧭 MLflow 클라이언트 인스턴스 생성 (서버와 직접 통신)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># (- docker-compose.yaml의 airflow에 environment로 MLFLOW_TRACKING_URI 존재함)</span>
</span></span><span style=display:flex><span>    client <span style=color:#f92672>=</span> MlflowClient()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🔍 &#34;IrisModel&#34;의 등록된 모델 중 현재 어떤 Stage에도 배정되지 않은 최신 버전 가져오기</span>
</span></span><span style=display:flex><span>    latest_versions <span style=color:#f92672>=</span> client<span style=color:#f92672>.</span>get_latest_versions(<span style=color:#e6db74>&#34;IrisModel&#34;</span>, stages<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;None&#34;</span>])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> latest_versions:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;❗ 등록된 모델이 없습니다.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ⏫ 가장 최신 버전 선택 (= .version 을 통해 속성 값 추출 / .name or .stage 등 가능)</span>
</span></span><span style=display:flex><span>    latest_version <span style=color:#f92672>=</span> latest_versions[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>version
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🚀 해당 버전을 Production 단계로 전환</span>
</span></span><span style=display:flex><span>    client<span style=color:#f92672>.</span>transition_model_version_stage(
</span></span><span style=display:flex><span>        name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;IrisModel&#34;</span>,
</span></span><span style=display:flex><span>        version<span style=color:#f92672>=</span>latest_version,
</span></span><span style=display:flex><span>        stage<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Production&#34;</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># ✅ 결과 출력</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;🚀 IrisModel version </span><span style=color:#e6db74>{</span>latest_version<span style=color:#e6db74>}</span><span style=color:#e6db74> → Production 등록 완료&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🔧 Airflow나 CLI에서 호출될 수 있도록 함수화</span>
</span></span></code></pre></div><hr><h2 id=-2-airflow-dag-작성-airflowdagstrain_with_mlflowpy>🛠️ 2. Airflow DAG 작성 (<code>airflow/dags/train_with_mlflow.py</code>)<a hidden class=anchor aria-hidden=true href=#-2-airflow-dag-작성-airflowdagstrain_with_mlflowpy>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># airflow/dags/train_with_mlflow.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🔧 Airflow DAG 기본 구성</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> airflow <span style=color:#f92672>import</span> DAG
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> airflow.operators.python <span style=color:#f92672>import</span> PythonOperator
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 📁 ml_code 디렉토리 경로 추가 (import 가능하도록 설정)</span>
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#34;/opt/airflow/ml_code&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 📦 학습 함수와 승격 함수 import</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> train_mlflow <span style=color:#f92672>import</span> run_experiment      <span style=color:#75715e># 모델 학습 및 등록</span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> promote_mlflow <span style=color:#f92672>import</span> promote_model    <span style=color:#75715e># 모델 스테이지 전환</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 🧾 DAG 기본 설정</span>
</span></span><span style=display:flex><span>default_args <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;start_date&#39;</span>: datetime(<span style=color:#ae81ff>2023</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;retries&#39;</span>: <span style=color:#ae81ff>1</span>,  <span style=color:#75715e># 실패 시 재시도 횟수</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 📅 DAG 정의</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>with</span> DAG(
</span></span><span style=display:flex><span>    dag_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;train_with_mlflow&#39;</span>,             <span style=color:#75715e># DAG 이름 (Airflow UI에 표시)</span>
</span></span><span style=display:flex><span>    default_args<span style=color:#f92672>=</span>default_args,
</span></span><span style=display:flex><span>    schedule_interval<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>,                 <span style=color:#75715e># 수동 실행 (스케줄 없음)</span>
</span></span><span style=display:flex><span>    catchup<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,                          <span style=color:#75715e># 과거 날짜 실행 안 함</span>
</span></span><span style=display:flex><span>    tags<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;ml&#39;</span>, <span style=color:#e6db74>&#39;mlflow&#39;</span>],                  <span style=color:#75715e># 태그 (필터링용)</span>
</span></span><span style=display:flex><span>) <span style=color:#66d9ef>as</span> dag:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🧪 [1단계] 모델 학습 및 MLflow에 등록</span>
</span></span><span style=display:flex><span>    train_task <span style=color:#f92672>=</span> PythonOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;run_training&#39;</span>,
</span></span><span style=display:flex><span>        python_callable<span style=color:#f92672>=</span>run_experiment,     <span style=color:#75715e># 실행할 함수 지정</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 🚀 [2단계] 최신 버전 모델을 Production으로 Promote</span>
</span></span><span style=display:flex><span>    promote_task <span style=color:#f92672>=</span> PythonOperator(
</span></span><span style=display:flex><span>        task_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;promote_model_to_production&#39;</span>,
</span></span><span style=display:flex><span>        python_callable<span style=color:#f92672>=</span>promote_model,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 📍 작업 실행 순서 정의: 학습 후 → 승격</span>
</span></span><span style=display:flex><span>    train_task <span style=color:#f92672>&gt;&gt;</span> promote_task
</span></span></code></pre></div><hr><h2 id=-3-docker-경로와-볼륨-정리-복습>🔧 3. Docker 경로와 볼륨 정리 (복습)<a hidden class=anchor aria-hidden=true href=#-3-docker-경로와-볼륨-정리-복습>#</a></h2><table><thead><tr><th>컨테이너</th><th>로딩 경로</th><th>역할</th></tr></thead><tbody><tr><td>Airflow</td><td><code>/opt/airflow/ml_code/train_mlflow.py</code></td><td>학습 실행</td></tr><tr><td>MLflow</td><td><code>/mlflow/mlruns/</code></td><td>모델 저장소</td></tr><tr><td>FastAPI</td><td><code>/mlflow/mlruns/</code></td><td>모델 로드</td></tr></tbody></table><p>➡ 로컬의 <code>/mlflow_store</code>를 <strong>모든 컨테이너에 공통 mount</strong>했기 때문에 문제없이 공유됨!</p><hr><h2 id=-4-실행-후-기대-결과>✅ 4. 실행 후 기대 결과<a hidden class=anchor aria-hidden=true href=#-4-실행-후-기대-결과>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker-compose up --build
</span></span></code></pre></div><p>Airflow 웹 UI에서 <code>train_with_mlflow</code> DAG 실행 →</p><p>✅ 모델이 학습되고</p><p>✅ <code>/mlflow/mlruns/</code>에 artifact가 저장되며</p><p>✅ <code>IrisModel</code>이 <strong>Model Registry</strong>에 등록됨
✅ <code>promote_mlflow.py</code> 실행을 통해, 등록된 모델을 <strong>Staging</strong> 또는 <strong>Production</strong> 단계로 자동 승격함</p><hr><h2 id=-확인-방법>🔍 확인 방법<a hidden class=anchor aria-hidden=true href=#-확인-방법>#</a></h2><ol><li>Airflow 웹 UI → <code>localhost:8080</code></li><li>MLflow UI → <code>localhost:5000</code><ul><li>Experiments → <code>iris_experiment</code></li><li>모델 성능 로그 + <code>IrisModel</code> 등록 여부 확인 가능</li></ul></li></ol><hr><h3 id=-테스트-예시>🧪 테스트 예시<a hidden class=anchor aria-hidden=true href=#-테스트-예시>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X POST http://localhost:8000/predict <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#e6db74>&#39;[
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;sepal_length&#34;: 5.1,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;sepal_width&#34;: 3.5,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;petal_length&#34;: 1.4,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;petal_width&#34;: 0.2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;sepal_length&#34;: 6.0,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;sepal_width&#34;: 2.9,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;petal_length&#34;: 4.5,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;petal_width&#34;: 1.5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]&#39;</span>
</span></span></code></pre></div><blockquote><p>예시 결과:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#f92672>&#34;predictions&#34;</span>:[<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><p style=margin-top:1rem>© 2025 Keonho Ban | <a href=https://github.com/keonhoban target=_blank>GitHub</a> | <a href=mailto:keonho0510@naver.com>Email</a></p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>